/*! angular-drag@0.0.1-beta | https://github.com/aui/angular-drag */

/*!
 * ClockPicker v0.0.7 (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/master/LICENSE)
 */

/*!
 * lhgcore Calendar Plugin v3.0.0
 * Date : 2012-03-13 10:35:11
 * Copyright (c) 2009 - 2012 By Li Hui Gang
 */

/*! 开启IE6 CSS背景图片缓存 */

/*!--------------------------------------------------------------*/

(function(){var e;e=angular.module("daterangepicker",[]),e.constant("dateRangePickerConfig",{clearLabel:"Clear",locale:{separator:" - ",format:"YYYY-MM-DD"}}),e.directive("dateRangePicker",["$compile","$timeout","$parse","dateRangePickerConfig",function(e,t,a,o){return{require:"ngModel",restrict:"A",scope:{min:"=",max:"=",model:"=ngModel",opts:"=options",clearable:"="},link:function(e,t,a,s){var n,r,i,c,l,d,p,u,m,g,f,h,_,v;return c=function(){var e,t;return t=angular.extend.apply(angular,Array.prototype.slice.call(arguments).map(function(e){return null!=e?e.locale:void 0}).filter(function(e){return!!e})),e=angular.extend.apply(angular,arguments),e.locale=t,e},_=$(t),h=e.opts,v=c({},o,h),l=null,n=function(){return l.setStartDate(),l.setEndDate()},d=function(e){return function(t){if(l&&t)return e(moment(t))}},u=d(function(e){return l.endDate<e&&l.setEndDate(e),v.startDate=e,l.setStartDate(e)}),p=d(function(e){return l.startDate>e&&l.setStartDate(e),v.endDate=e,l.setEndDate(e)}),m=function(e){return function(t,a){return!t||!a||e(moment(t),moment(a))}},f=m(function(e,t){return e.isBefore(t)||e.isSame(t,"day")}),g=m(function(e,t){return e.isAfter(t)||e.isSame(t,"day")}),s.$formatters.push(function(e){var t;return t=function(e){return moment.isMoment(e)?e.format(v.locale.format):moment(e).format(v.locale.format)},v.singleDatePicker&&e?t(e):e.startDate?[t(e.startDate),t(e.endDate)].join(v.locale.separator):""}),s.$render=function(){return s.$modelValue&&s.$modelValue.startDate?(u(s.$modelValue.startDate),p(s.$modelValue.endDate)):n(),_.val(s.$viewValue)},s.$parsers.push(function(e){var t,a,o;return t=function(e){return moment(e,v.locale.format)},a={startDate:null,endDate:null},angular.isString(e)&&e.length>0&&(v.singleDatePicker?a=t(e):(o=e.split(v.locale.separator).map(t),a.startDate=o[0].startOf("day"),a.endDate=o[1].endOf("day"))),a}),s.$isEmpty=function(e){return!(angular.isString(e)&&e.length>0)},r=function(){var t,a;_.daterangepicker(angular.extend(v,{autoUpdateInput:!1}),function(t,a){return e.$apply(function(){return e.model=v.singleDatePicker?t:{startDate:t,endDate:a}})}),l=_.data("daterangepicker"),a=[];for(t in v.eventHandlers)a.push(_.on(t,function(t){var a;return a=t.type+"."+t.namespace,e.$evalAsync(v.eventHandlers[a])}));return a},r(),e.$watch("model.startDate",function(e){return u(e)}),e.$watch("model.endDate",function(e){return p(e)}),i=function(t,o,n,i){if(a[t])return s.$validators[t]=function(e){return e&&o(v[i],e[n])},e.$watch(t,function(e){return v[i]=!!e&&moment(e),r()})},i("min",f,"startDate","minDate"),i("max",g,"endDate","maxDate"),a.options&&e.$watch("opts",function(e){return v=c(v,e),r()},!0),a.clearable&&e.$watch("clearable",function(t){if(t&&(v=c(v,{locale:{cancelLabel:v.clearLabel}})),r(),t)return _.on("cancel.daterangepicker",function(){return e.$apply(function(){return e.model=v.singleDatePicker?null:{startDate:null,endDate:null}})})}),e.$on("$destroy",function(){return null!=l?l.remove():void 0})}}}])}).call(this),define("angularDateRangePicker",["angular"],function(){}),define("apps/common/controllers/controllers",["angular"],function(e){var t=e.module("controllers",["ngProgress"]);return t.controller("mchController",["$scope","$rootScope","$state","$http","$location","ngProgressFactory","logoutResource","$modal","Flash",function(e,t,a,o,s,n,r,i,c){t.__shop_type=_global.shop_type||_global.shop.type,e._global=_global;var l=[["Widgets","Uploadimage","Table","Link","Unlink","Blockquote","HorizontalRule"],["Find","Preview","Source"],["FontSize","Bold","Italic","Underline","TextColor","BGColor","-","NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]];2==t.__shop_type&&(l=[["Widgets","Uploadimage","Table","Blockquote","HorizontalRule"],["Find","Preview"],["FontSize","Bold","Italic","Underline","TextColor","BGColor","-","NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]]),t.editorOptions=window._editorOptions={extraPlugins:"uploadimage,widgets",height:"200px",toolbar:l,allowedContent:!0},e.topProgressbar=n.createInstance(),e.topProgressbar.setColor("#f40"),e.$on("$viewContentLoaded",function(){return 2!=_global.shop_type?void(t.titleH5="商户后台"):void(t.os.isAndroid||t.os.isPhone?t.titleH5="微小店商户后台":t.os.isPc&&(t.titleH5="商户后台"))}),e.$on("$stateChangeStart",function(){e.topProgressbar.start()}),e.$on("$stateChangeSuccess",function(t){setTimeout(function(){d.callServer()},500),e.topProgressbar.complete()});var d={getCookie:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),a=document.cookie.match(t);return a?unescape(a[2]):""},setCookie:function(e,t,a,o){var s=new Date,e=e?e:"true",a=a?a:30;a<0?s.setTime(s.getTime()-1e3):s.setTime(s.getTime()+24*a*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+s.toGMTString()+";path=/"},generateUUID:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:7&a|8).toString(16)});return t},callServer:function(){var e=d.getCookie("uuid");""==e&&(e=d.generateUUID(),d.setCookie("uuid",e,730,!0));var t={cur_url:window.location.href,prev_url:d.getCookie("new_prev_url"),width:screen.width,height:screen.height,title:$(document).attr("title"),merchant_id:_global.shop?_global.shop.merchant_id:0,shop_id:_global.shop?_global.shop.id:0,appid:_global.shop?_global.shop.magic_appid:0,member_id:0,uuid:e,referrer_url:document.referrer};this.setCookie("new_prev_url",t.cur_url,.01041,!0),a.includes("auth.register")&&$.ajax({url:"https://s1tj.wxrrd.com/wxdreg",dataType:"jsonp",jsonp:"jsoncallback",type:"post",data:t,success:function(){}})}},p=function(){o.get("/user/me.json").then(function(a){if(_global.shop=a.data.shop,e.me=a.data.account,40==_global.shop.platform_type||41==_global.shop.platform_type){var o=window.location.href;o=o+"?_="+_global.shop.id,window.location.href=o}var s=1;_global.shop_type?s=_global.shop_type:_global.shop&&(s=_global.shop.type),e.$broadcast("to-shop",e.me),e.merchant=a.data.merchant,""==e.merchant.logo&&(e.merchant.logo=t.__shop_type>=2?"image/shop-logo-"+t.__shop_type+".jpg":"image/merchant-logo.jpg"),_global.shop.logo=_global.shop.logo||(t.__shop_type>=2?"image/shop-logo-"+t.__shop_type+".jpg":"image/shop-logo.jpg"),e.shop=_global.shop,f()},function(t){e.me={id:0}}),2==t.__shop_type&&o.get("/shop/qrcode.json").then(function(t){e.qrcode=t.data,e.copy_text=e.qrcode.url,e.$broadcast("topbarFinished")},function(e){})};2==t.__shop_type&&(e.showMessage=function(){c.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.showul=function(){$("#shopul").css({display:"block"})},e.hideul=function(){$("#shopul").css({display:"none"})},e.community=function(){0==e.me.if_community&&o.post("/community/community.json").then(function(e){$("#community_new").hide()},function(e){})},e.welfare=function(){0==e.me.if_welfare&&o.post("/invite/welfare.json").then(function(e){$("#welfare_new").hide()},function(e){})});var u=function(){i.open({animation:!1,controller:"auth.valid.mobile",templateUrl:"assets/js/apps/auth/templates/valid.mobile.modal.html",size:"big",resolve:{username:function(){return e.me.username},mobile:function(){return e.me.mobile}}})},m=function(){i.open({animation:!1,controller:"auth.perfect.merchant",templateUrl:"assets/js/apps/auth/templates/perfect.merchants.modal.html",size:"sm",resolve:{}})};e.guestPath=["/auth/resetpwd","/auth/active"],e.guestPath.indexOf(s.path())==-1&&p();var g;e.$on("login",function(a,o){p(),_global=o,e._global=o,g=e.$watch("me",function(a){2!=t.__shop_type&&(""==a.mobile||0==a.is_verification_mobile?u():0!=a.id&&e.merchant&&""==e.merchant.mobile?m():0==a.id||""!=a.email&&a.email||m())})}),e.logout=function(){r.get("",function(t,o){t.success&&(g&&g(),""!=t.synlogout&&$("body").append(t.synlogout),delete e._global.is_admin,e._global.privs="",delete e._global.setting,e.me={id:0},1!=e._global.custom_type_code?window.location.href=e._global.url.custom_login_base:_global.staff?a.go("auth.stafflogin"):a.go("auth.login"))})};var f=function(){e.checkApp=function(t){if(e._global.shop.rrd_app){var a=JSON.parse(e._global.shop.rrd_app);switch(t){case"android":return 1==parseInt(a.android);case"ios":return 1==parseInt(a.ios);case"wxpay":return 1==parseInt(a.ios)||1==parseInt(a.android)}}return!1}};t.checkPriv=function(t){return!(e._global.exclude_privs&&e._global.exclude_privs.indexOf(t)>=0)&&(1==e._global.is_admin||!(e._global.privs.indexOf(t)<0))};var h={apps:{check:[{priv:"shop_ump_peerpay",tostate:"shop.apps.peerpay.list"},{priv:"shop_ump_bargain",tostate:"shop.apps.bargain.list",params:{status:"all"}},{priv:"shop_ump_pintuan",tostate:"shop.apps.pintuan.list",params:{status:"all"}},{priv:"shop_ump_snatch",tostate:"shop.apps.snatch.list"},{priv:"shop_ump_collect",tostate:"shop.apps.collect.list"},{priv:"shop_apps_guess",tostate:"shop.apps.guess.list"},{priv:"shop_apps_article",tostate:"shop.apps.article.manage"},{priv:"shop_apps_auction",tostate:"shop.apps.auction.list",params:{status:"all"}}],defaultRoute:{tostate:"shop.apps.thirdapp.list"}},umps:{check:[{priv:"shop_ump_coupon",tostate:"shop.ump.coupon.list"},{priv:"shop_ump_discount",tostate:"shop.ump.discount.list"},{priv:"shop_ump_ordercount",tostate:"shop.ump.ordercount.list"},{priv:"shop_ump_seckill",tostate:"shop.ump.seckill.list",params:{status:"all"}},{priv:"shop_ump_bangmian_list",tostate:"shop.ump.bangmian.list",params:{status:"all"}},{priv:"shop_ump_repurchase",tostate:"shop.ump.repurchase.list"}],defaultRoute:{tostate:"shop.ump.dynamics.list",params:{status:"all"}}},order:{check:[{priv:"shop_order_list",tostate:"shop.order.all.list"},{priv:"shop_order_comment",tostate:"shop.order.comment"},{priv:"shop_order_delivery",tostate:"shop.order.delivery"},{priv:"shop_order_setting",tostate:"shop.order.setting"},{priv:"shop_order_fetchlog",tostate:"shop.order.fetchlog"},{priv:"shop_order_virtual",tostate:"shop.order.virtual"}],defaultRoute:{tostate:"shop.order.all.list",params:{status:"all"}}},hexiao:{check:[{priv:"shop_order_hxverfiy",tostate:"shop.order.verification.validate"},{priv:"shop_order_fetchlog",tostate:"shop.order.verification.fetchlog"},{priv:"shop_order_virtual",tostate:"shop.order.verification.virtual"},{priv:"shop_order_writeoff",tostate:"shop.order.verification.underline"}],defaultRoute:{tostate:"shop.order.verification.validate"}},design:{check:[{priv:"shop_design_feature",tostate:"shop.design.feature.list"},{priv:"shop_design_tag",tostate:"shop.design.tag.list"},{priv:"shop_design_goods",tostate:"shop.design.goods.list"},{priv:"shop_design_component",tostate:"shop.design.component.list"},{priv:"shop_design_nav",tostate:"shop.design.nav"},,{priv:"shop_bottom_nav",tostate:"shop.design.bottomNav"},{priv:"shop_design_widget",tostate:"shop.design.widget"}],defaultRoute:{tostate:"shop.design.feature.list"}},delivery:{check:[{priv:"shop_delivery_company",tostate:"shop.delivery.company.list"},{priv:"shop_delivery_shipments",tostate:"shop.delivery.shipments.list"},{priv:"shop_delivery_waybill",tostate:"shop.delivery.waybill.list"},{priv:"shop_delivery_selffetch",tostate:"shop.delivery.selffetch.list"},{priv:"shop_delivery_setting",tostate:"shop.delivery.setting.main"}],defaultRoute:{tostate:"shop.delivery.company.list"}}};t.goViews=function(e){var o=!1;for(var s in h[e].check)if(t.checkPriv(h[e].check[s].priv)){o=!0,a.go(h[e].check[s].tostate,h[e].check[s].params);break}o||a.go(h[e].defaultRoute.tostate,h[e].defaultRoute.params)},e.checkExtend=function(t){if("undefined"!=typeof e._global.shop&&e._global.shop.extend){var a=e._global.shop.extend.split(",");for(var o in a)if(t==a[o])return!0}return!1},t.os=function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),a=/(?:SymbianOS)/.test(e)||t,o=/(?:Android)/.test(e),s=/(?:Firefox)/.test(e),n=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||o&&!/(?:Mobile)/.test(e)||s&&/(?:Tablet)/.test(e)),r=/(?:iPhone)/.test(e)&&!n,i=!r&&!o&&!a;return{isTablet:n,isPhone:r,isAndroid:o,isPc:i}}()}]),t}),define("apps/common/directives/directives",["angular"],function(e){return e.module("directives",[])}),define("apps/common/services/services",["angular"],function(e){var t=e.module("services",[]);t.factory("listBackParams",[function(){var e={};return{set:function(t,a,o){switch(typeof t){case"object":e[a]=t;break;default:e[a]="undefined"!=typeof e[a]?e[a]:{},e[a][o]=t}},get:function(t){return e[t]?e[t]:null}}}]);var a="http://xueyuan.rrdshang.com/content/play?id=";return t.constant("videoAddress",{pintuan:a+111,promise:a+110,snatch:a+109,bargain:a+108,seckill:a+107,coupon:a+106,collect:a+105,discount:a+104,order:a+103,magic:a+102,selffetch:a+101,supplier:a+100,comment:a+99,credit:a+98,member:a+97,guider:a+96,partner:a+95,merchant:a+94,guider_member:a+93,virtual:a+92,guess:a+91,article:a+90,dynamics:a+89,mall:a+88,auction:a+87}),t}),define("apps/common/filters/filters",["angular"],function(e){var t=e.module("filters",[]);return t}),!function(e){function t(o){if(a[o])return a[o].exports;var s=a[o]={exports:{},id:o,loaded:!1};return e[o].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";var o=a(1),s=a(2),n=s.module("angular-drag",[]);n.directive("drag",function(){return{restrict:"A",link:function(e,t){var a=t[0],s=a.querySelector("[drag-handle]");s||new o(a)}}}),n.directive("dragHandle",function(){return{restrict:"A",link:function(e,t){for(var a=t[0];!a.hasAttribute("drag");)a=a.parentNode;t.on(o.START,function(e){new o(a,e),e.preventDefault()})}}})},function(e,t,a){"use strict";function o(){}function s(){return!1}function n(e,t,a){return e?new n.create(e,t,a):(this.start=r.proxy(this.start,this),this.move=r.proxy(this.move,this),void(this.end=r.proxy(this.end,this)))}var r=a(3),i=r(window),c=r(document),l="createTouch"in document,d=document.documentElement,p=!("minWidth"in d.style),u=!p&&"onlosecapture"in d,m="setCapture"in d,g={start:l?"touchstart":"mousedown",move:l?"touchmove":"mousemove",end:l?"touchend":"mouseup"},f=0,h=l?function(e,t){return(e.touches||e.originalEvent.touches)[t]}:function(e){return e},_=function(){var e=document.createElement("div"),t="Khtml Ms O Moz Webkit".split(" "),a=t.length;return function(o){if(o in e.style)return o;for(o=o.replace(/^[a-z]/,function(e){return e.toUpperCase()});a--;)if(t[a]+o in e.style)return t[a]+o;return null}}(),v=_("transform");n.prototype={constructor:n,start:function(e){return this.touchId=f,e=h(e,f),f++,this.target=r(e.target),c.on("selectstart",s).on("dblclick",this.end),u?this.target.on("losecapture",this.end):i.on("blur",this.end),m&&this.target[0].setCapture(),c.on(g.move,this.move).on(g.end,this.end),this.onstart(e),!1},move:function(e){return e=h(e,this.touchId),this.onmove(e),!1},end:function(e){return this.touchId=f,e=h(e,f),f--,c.off("selectstart",s).off("dblclick",this.end),u?this.target.off("losecapture",this.end):i.off("blur",this.end),m&&this.target[0].releaseCapture(),c.off(g.move,this.move).off(g.end,this.end),this.onend(e),!1}},n.create=function(e,t,a){var o,s,l,d,p,u,m,g,f,h,_=r(e),y=this,b=new n;"undefined"==typeof a&&(a=!!v),this.GPU=a,b.onstart=function(t){var a="BODY"===e.parentNode.nodeName?c:_.offsetParent(),n="fixed"===_.css("position"),r=_.position(),v=i.width(),b=i.height(),$=a.scrollLeft(),k=a.scrollTop(),P=a.width(),w=a.height(),D=_.outerWidth(),C=_.outerHeight(),x=r.left,I=r.top;y.GPU?(l=n?-x:-x-$,d=n?-I:-I-k,p=n?v-D-x:P-D-x,u=n?b-C-I:w-C-I,o=0,s=0,m=x,g=I):(l=0,d=0,p=n?v-D+l:P-D,u=n?b-C+d:w-C,o=m=x,s=g=I),f=t.clientX,h=t.clientY,y.onstart(t)},b.onmove=function(t){var a=e.style;y.GPU?(o=t.clientX-f,s=t.clientY-h):(o=t.clientX-f+m,s=t.clientY-h+g),o=Math.max(l,Math.min(p,o)),s=Math.max(d,Math.min(u,s)),y.GPU?a[v]="translate3d("+o+"px, "+s+"px, 0px)":(a.left=o+"px",a.top=s+"px"),y.onmove(t)},b.onend=function(t){var a=e.style;y.GPU?(a[v]="",a.left=o+m+"px",a.top=s+g+"px"):(a.left=o+"px",a.top=s+"px"),y.onend(t)},t?b.start(t):(_.on(n.START,b.start),this.destroy=function(){_.off(n.START,b.start)})},n.START=g.start,n.MOVE=g.move,n.END=g.end,n.create.prototype={constructor:n.create,onstart:o,onmove:o,onend:o,destroy:o},e.exports=n},function(e,t){e.exports=angular},function(e,t){e.exports=jQuery}]),define("angularDrag",["angular","jquery"],function(){}),define("app",["angular","jquery","ui.router","ui.bootstrap","ui.select","ui.sortable","ngProgress","xeditable","ngCkeditor","ngDragDrop","ngResource","ngClipboard","flashAlert","ngAnimate","ngPopover","ngDateRange","angularDateRangePicker","mwl.confirm","apps/common/controllers/controllers","apps/common/directives/directives","apps/common/services/services","apps/common/filters/filters","templates","angularDrag"],function(e){var t=e.module("mch",["ui.bootstrap","ui.select","ui.sortable","states","ngProgress","xeditable","ngCkeditor","ngDragDrop","ngResource","ngClipboard","flash","ngAnimate","ngPopover","ngDateRange","daterangepicker","mwl.confirm","controllers","directives","services","filters","templates","angular-drag"]);return t.config(["ngClipProvider",function(e){e.setPath("assets/js/libs/zeroclipboard/ZeroClipboard.swf")}]),t.config([function(){window.Utils={prompt:function(){return window.prompt.apply(window,Array.prototype.slice.call(arguments))},confirm:function(){return window.confirm.apply(window,Array.prototype.slice.call(arguments))}}}]),t.config(["$httpProvider",function(e){e.interceptors.push(["$q","$location","Flash","$injector",function(e,t,a,o){return{response:function(t){return t||e.when(t)},responseError:function(o){switch(o.status){case 500:a.create("danger","系统错误，请稍后再试！");break;case 401:var s=["/auth/login","/auth/stafflogin","/auth/resetpwd","/auth/register","/auth/loginaggregate","/rrds_promotion/sub/template_library","/rrds_promotion/sub/add","/rrds_promotion/sub/edit","/rrds_promotion/setting","/rrdsposter/sub/template_library","/rrdsposter/sub/add","/rrdsposter/sub/edit","/rrdsposter/setting","/rrdsposter/goods_material_library"];s.indexOf(t.$$path)===-1&&window.location.replace("/auth/login")}return e.reject(o)}}}])}]).run(["editableOptions","editableThemes",function(e,t){t.bs3.inputClass="input-xs",t.bs3.buttonsClass="btn-xs",e.theme="bs3",e.icon_set="font-awesome"}]),t}),define("apps/common/states/states",["angular"],function(e){var t=e.module("states",["ui.router"]);return t.config(["$locationProvider",function(e){e.html5Mode(!0)}]),t}),define("apps/demo/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("demo",{url:"/demo",templateUrl:"assets/js/apps/demo/templates/main.html",controller:"demo"})}])}),define("apps/demo/states/_base",["apps/demo/states/main"],function(){}),define("apps/demo/controllers/main",["apps/common/controllers/controllers"],function(e){e.controller("demo",["$scope","Flash","$modal","$filter",function(e,t,a,o){e.flashAlert=function(e){t.create(e,"提示演示！")};var s=e.city=this;s.regions={country:1},s.start="province",s.end="district",e.dt="2014-08-01 - 2014-08-11",e.dialog=function(){var e=a.open({animation:!1,templateUrl:"modalDemo.html",controller:"ModalInstanceCtrl"});e.result.then(function(e){},function(){})},e.dates2={startDate:moment("2013-09-20"),endDate:moment("2013-09-25")},e.dates3={startDate:moment(),endDate:moment().add(1,"day")},e.dates4={startDate:moment().subtract(1,"day"),endDate:moment().subtract(1,"day")},e.ranges={"今天":[moment(),moment()],"明天":[moment().add("days",1),moment().add("days",1)],"未来7天":[moment(),moment().add("days",6)],"未来15天":[moment(),moment().add("days",15)],"本月":[moment(),moment().endOf("month")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)]},e.color="#cccccc"}]).controller("ModalInstanceCtrl",["$scope","$rootScope","$modalInstance",function(e,t,a){e.ok=function(){a.close(1)},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/demo/controllers/_base",["apps/demo/controllers/main"],function(){}),define("apps/demo/directives/_base",[],function(){}),define("apps/demo/main",["apps/demo/states/_base","apps/demo/controllers/_base","apps/demo/directives/_base"],function(){}),define("apps/common/directives/topbar",["apps/common/directives/directives"],function(e){e.directive("topBar",[function(){return{restrict:"A",replace:!0,templateUrl:"assets/js/apps/common/templates/topbar.html",controller:["$scope","$http","$state","$timeout","$stateParams","$rootScope",function(e,t,a,o,s,n){e.$state=a,e.$stateParams=s,e.isH5=!1,e.$on("$viewContentLoaded",function(){return 2!=_global.shop_type?void(e.isH5=!1):void(n.os.isAndroid||n.os.isPhone?e.isH5=!0:n.os.isPc&&(e.isH5=!1))}),e.$watch("me",function(a){a&&a.id>0&&(e.message={noreadCount:0,txt:"查看更多",page:0,listBoxStyle:{display:"none"},refresh:!0,items:new Array},e.noreadCount=function(){t.get("/user/system_message_noread_count.json").success(function(t){e.message.noreadCount=t})},e.noreadCount(),e.$on("to-topbar",function(t,a){e.noreadCount()}),e.listBoxShow=function(){e.message.listBoxStyle={display:"block"}},e.getMessage=function(a){e.message.refresh=!1,e.message.txt="刷新中...",t.get("/user/system_message.json",{params:{offset:10*e.message.page}}).success(function(t){0==t.length?o(function(){e.message.refresh=!0,e.message.txt="没有更新"},2e3):(e.message.data=t,Array.prototype.push.apply(e.message.data,e.message.items),e.message.items=e.message.data,e.message.refresh=!0,e.message.txt="查看更多",e.message.page++)})},e.getMessage(),e.changeStatus=function(){this.item.is_read="1",t.get("/user/system_message_read/"+this.item.id+".json").success(function(t){t.status&&e.message.noreadCount--})})})}]}}])}),define("apps/common/directives/pagination",["apps/common/directives/directives"],function(e){e.directive("tmPagination",[function(){return{restrict:"EA",templateUrl:"assets/js/apps/common/templates/pagination.html",replace:!0,scope:{conf:"="},link:function(e,t,a){e.maxSize=e.conf.maxSize||5,e.boundaryLinks=!e.conf.notBoundaryLinks,e.conf.currentPage=parseInt(e.conf.currentPage)?parseInt(e.conf.currentPage):1,e.conf.totalItems=parseInt(e.conf.totalItems),e.setPage=function(t){return t>Math.ceil(e.conf.totalItems/e.conf.itemsPerPage)?(e.conf.currentPage=Math.ceil(e.conf.totalItems/e.conf.itemsPerPage),e.pageNo="",!1):(e.conf.currentPage=t,void(e.pageNo=""))}}}}])}),define("apps/common/directives/upload_imglist",["apps/common/directives/directives"],function(e){e.directive("uploadImglist",[function(){return{restrict:"A",replace:!0,scope:{uploadimages:"=",limit:"@"},templateUrl:"assets/js/apps/common/templates/upload_imglist.html",link:function(e,t,a){e._global=_global;var o=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w\- .\/?%&=]*)?/,s=new RegExp(o);"undefined"!=typeof e.limit&&e.$watch("uploadimages",function(){"undefined"!=typeof e.uploadimages&&e.uploadimages.splice(e.limit)}),e.remove=function(t){e.uploadimages.splice(t.$index,1)},e.sortableOptions={cursor:"move",zIndex:99999,axis:"x"},e.checkUrl=function(e){s.test(e.url)?e.img=e.url:e.img=_global.url.ms+e.url}}}}])}),define("apps/common/directives/addimage",["apps/common/directives/directives","apps/common/controllers/controllers","fileupload"],function(e,t,a){e.directive("addImage",["$http",function(e){return{restrict:"A",replace:!0,scope:{help:"=addImageHelp"},controller:"addImageCtrl",templateUrl:"assets/js/apps/common/templates/addimage.html",link:function(e,t,a){}}}]).directive("remoteImage",["$http","Flash",function(e,t){return{restrict:"A",require:"?^ngModel",scope:{remote:"=",remoteshow:"=",upimages:"="},link:function(a,o,s,n){o.bind("click",function(){a.remote||(a.remote=""),a.remote.indexOf("http")>-1?e.get("/take_online_pic.json?url="+a.remote).success(function(e){if(null!=n){var t=[];t.push(e),n.$isEmpty(n.$viewValue)?n.$setViewValue(t):n.$setViewValue(n.$modelValue.concat(t)),a.remoteshow=!1}else a.upimages=a.upimages+1;a.remote=""}).error(function(){t.create("danger","网络图片地址错误")}):t.create("danger","请先填写网络图片")})}}}]).directive("upLoad",["$http","Flash",function(e,t){return{restrict:"A",transclude:!0,require:"?^ngModel",scope:{upimages:"=",restrict:"="},templateUrl:"assets/js/apps/common/templates/upload.html",link:function(a,o,s,n){function r(){var e=a.token_res;l.formData=function(t){return t.push({name:"token",value:e.token}),t.push({name:"x:merchant_id",value:_global.shop.merchant_id}),t.push({name:"x:group_id",value:a.group_id}),t},o.fileupload(l)}function i(){e.get("/attachment/qiniu_token").success(function(e){a.token_res=e,r()})}if(a.restrict)if(a.restrict.indexOf(",")>-1)var c=a.restrict.split(",");else var c=a.restrict;a.group_id=0,a.$on("group_id",function(e,t){a.group_id=t,r()}),a.load_text="上传图片";var l={url:"https"==_global.http_pref?"https://up.qbox.me":"http://up.qiniu.com",dataType:"json",add:function(e,o){a.$apply(function(){a.load_text="正在上传"});for(var s=0;s<o.files.length;s++){if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(o.files[s].name))return t.create("danger","图片类型必须是.gif,jpeg,jpg,png中的一种"),a.$apply(function(){a.load_text="上传图片"}),!1;if(o.files[s].size>2097152)return t.create("danger","最大上传图片为2M"),a.$apply(function(){a.load_text="上传图片"}),!1}o.submit()},progressall:function(e,t){var o=parseInt(t.loaded/t.total*100,10);a.$apply(function(){a.load_text="已上传"+o+"%"})}},d=0;null!=n?l.done=function(e,o){if(c&&c.indexOf(o.result.imageinfo.format)<0)return t.create("danger","请上传"+c.toString()+"格式的图片"),a.load_text="上传图片",!1;var s=[];s.push(o.result),a.$apply(function(){n.$isEmpty(n.$viewValue)?n.$setViewValue(s):n.$setViewValue(n.$modelValue.concat(s))}),a.load_text="上传图片",o.result.url?t.create("success","上传成功"):t.create("danger","上传失败,请尝试刷新页面")}:l.done=function(e,o){if(c&&c.indexOf(o.result.imageinfo.format)<0)return t.create("danger","请上传"+c.toString()+"格式的图片"),a.load_text="上传图片",!1;var s=[];s.push(o.result),d+=1,d==o.originalFiles.length&&(a.$apply(function(){a.upimages=a.upimages+1}),d=0),a.load_text="上传图片",o.result.url?t.create("success","上传成功"):t.create("danger","上传失败,请尝试刷新页面")},i(),a.time=Date.parse(new Date),o.click(function(){a.time_new=Date.parse(new Date),a.time_new-a.time>36e5&&i()})}}}]).directive("imageSpace",["$modal",function(e){return{restrict:"A",replace:!0,require:"?^ngModel",scope:{restrict:"="},link:function(t,a,o,s){a.bind("click",function(){var a=e.open({animation:!1,templateUrl:"assets/js/apps/common/templates/addimage.space.html",controller:"imageSpaceModelCtrl",windowClass:"imageUploadModal",resolve:{restrict:function(){return t.restrict}}});a.result.then(function(e){"undefined"==typeof s.$modelValue?s.$setViewValue(e):s.$setViewValue(s.$modelValue.concat(e))})})}}}]),t.controller("addImageCtrl",["$scope","$modal",function(e,t){e.remoteshow=!1}]).controller("imageSpaceModelCtrl",["$scope","$http","$modalInstance","attachment","attachmentGroup","restrict",function(e,t,a,o,s,n){e._global=_global,e.upimages=0,e.restrict=n,e.searchParam={groupid:0},e.lastSearchParam={},e.paginationConf={currentPage:1,itemsPerPage:18},s.get(function(t){e.groupList=t.data});var r=function(){var t={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,type:"image",group_id:e.searchParam.groupid,title:e.searchParam.title};e.searchParam.title&&(e.lastSearchParam.title=e.searchParam.title),o.getList(t,function(t){e.paginationConf.totalItems=t._count,e.images=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage + upimages",r),e.choose=function(t){e.selectedImages=[],t.checked=!t.checked,angular.forEach(e.images,function(t){1==t.checked&&e.selectedImages.push({url:t.url,id:t.id})})},e.ok=function(){angular.isUndefined(e.selectedImages)?a.dismiss("cancel"):a.close(e.selectedImages)},e.cancel=function(){a.dismiss("cancel")},e.search=function(t){angular.isDefined(t)&&e.searchParam.groupid!=t?(delete e.searchParam.title,delete e.lastSearchParam.title,e.searchParam.groupid=parseInt(t),e.$broadcast("group_id",e.searchParam.groupid),i()):e.lastSearchParam.title!=e.searchParam.title&&r()};var i=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:r()}}])}),define("apps/common/directives/addvoice",["apps/common/directives/directives","apps/common/controllers/controllers","fileupload"],function(e,t,a){e.directive("upLoadVoice",["$http","Flash",function(e,t){return{restrict:"A",transclude:!0,require:"?^ngModel",scope:{upvoice:"="},templateUrl:"assets/js/apps/common/templates/upload_voice.html",link:function(a,o,s,n){a.load_text="上传语音";var r={url:"https"==_global.http_pref?"https://up.qbox.me":"http://up.qiniu.com",dataType:"json",add:function(e,o){a.$apply(function(){a.load_text="正在上传"});for(var s=0;s<o.files.length;s++){if(!/\.(amr|mp3)$/.test(o.files[s].name))return t.create("danger","语音类型必须是.amr,mp3中的一种"),a.$apply(function(){a.load_text="上传语音"}),!1;if(o.files[s].size>2097152)return t.create("danger","最大上传图片为2M"),a.$apply(function(){a.load_text="上传语音"}),!1}o.submit()},progressall:function(e,t){var o=parseInt(t.loaded/t.total*100,10);a.$apply(function(){a.load_text="已上传"+o+"%"})},done:function(e,o){var s=[];s.push(o.result),a.$apply(function(){a.upvoice=a.upvoice+1,a.load_text="上传语音"}),t.create("success","上传成功")}};e.get("/attachment/qiniu_token").success(function(e){r.formData=function(t){return t.push({name:"token",value:e.token}),t.push({name:"x:merchant_id",value:_global.shop.merchant_id}),t},o.fileupload(r)})}}}]).directive("voiceSpace",["$modal",function(e){return{restrict:"A",replace:!0,require:"?^ngModel",scope:{},link:function(t,a,o,s){a.bind("click",function(){var t=e.open({animation:!1,templateUrl:"assets/js/apps/common/templates/addvoice.space.html",controller:"voiceSpaceModelCtrl"});t.result.then(function(e){s.$setViewValue(e)})})}}}]),t.controller("voiceSpaceModelCtrl",["$scope","$http","$modalInstance",function(e,t,a){e._global=_global;var o=function(){var a={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};t.get("/attachment?type=audio&offset="+(a.offset-1)*a.limit+"&limit="+a.limit).success(function(t){e.paginationConf.totalItems=t._count,e.voiceList=t.data})};e.paginationConf={currentPage:1,itemsPerPage:5},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage + upvoice",o),e.voicePlayClick=function(e,t){var a=($(t.target),'<div id="audio_wrapper" style="display: none;"><audio id="audio_player" preload="" type="audio/mpeg" src="'+_global.url.ms+e.url+'"></audio></div>');$("#audio_wrapper").length>0?$("#audio_player").attr("src",_global.url.ms+e.url):$("body").append(a);var o=document.getElementById("audio_player");o.play()},e.choose=function(e){a.close(e)},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/common/directives/cityselect",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("citySelect",[function(){return{require:"?ngModel",restrict:"AE",replace:!0,scope:{model:"=ngModel",modeldata:"="},templateUrl:"assets/js/apps/common/templates/cityselect.html",controller:"citySelectCtrl",link:function(e,t,a,o){}}}]),t.controller("citySelectCtrl",["$scope","$http","$resource",function(e,t,a){var o;e.modeldata?o=e.modeldata:$.ajax({url:"/regions.json",type:"GET",dateType:"json",async:!1}).done(function(e){o=e});var s=e.ctrl=this;if(s.open=!1,s.tab=[{keyword:"country",name:"国家",class:!1},{keyword:"province",name:"省份",class:!1},{keyword:"city",name:"城市",class:!1},{keyword:"district",name:"县区",class:!1}],!e.model.start||!e.model.end)throw new Error("必须传入start end");if(angular.forEach(s.tab,function(t,a){t.keyword==e.model.start&&(0==a?s.start_name="world":s.start_name=s.tab[a-1].keyword,s.tab.splice(0,a))}),angular.forEach(s.tab,function(t,a){t.keyword==e.model.end&&s.tab.splice(a+1,4)}),s.tab[0].class=!0,s.level=s.tab.length,s.regions=e.model.regions,s.changeIds=[],s.selected=[],s.regions&&angular.isNumber(s.regions[e.model.start])){for("country"==e.model.start?("world"==s.start_name,s.id=[0]):s.id=[],angular.forEach(s.regions,function(e,t){s.id=s.id.concat(e)}),i=0;i<s.level;i++)angular.forEach(o[s.id[i]],function(e,t){
if(s.id[i+1]==e.id)return s.selected=s.selected.concat(e),!1});s.city=[],angular.forEach(s.selected,function(e,t){s.city=s.city.concat(e.name)})}else s.regions&&angular.isString(s.regions[e.model.start])&&s.regions[e.model.start]?(s.city=[],angular.forEach(s.regions,function(e,t){angular.isString(e)&&s.city.length<s.level&&(s.city=s.city.concat(e))})):s.print="请选择";"world"==s.start_name?s.num=0:angular.forEach(s.regions,function(e,t){t==s.start_name&&(s.num=e)}),s.areadata=o[s.num],s.changeIds=s.changeIds.concat(s.num),s.selectTab=function(e){angular.forEach(s.areadata,function(e,t){e.class=!1}),e.class=!0,s.selected.splice(s.changeIds.length-1,4);var t=s.selected.length;s.selected=s.selected.concat(e),t<s.level-1?(angular.forEach(s.tab,function(e,t){e.class=!1}),s.tab[t+1].class=!0,s.changeIds=s.changeIds.concat(e.id),s.areadata=o[e.id]):s.open=!1,s.city=[],angular.forEach(s.selected,function(e,t){s.city=s.city.concat(e.name)})},s.changeTab=function(e){"undefined"!=typeof s.changeIds[e]&&(angular.forEach(s.tab,function(e,t){e.class=!1}),s.tab[e].class=!0,s.changeIds.splice(e+1,4),s.selected.splice(s.changeIds.length-1,4),s.areadata=o[s.changeIds[e]])},e.$watch("ctrl.city",function(){if(angular.isArray(s.city)){var t="";angular.forEach(s.city,function(e,a){0==a?t=e:t+=" - "+e}),s.print=t,e.model.selected=s.selected}})}])}),define("apps/common/directives/popover",["apps/common/directives/directives"],function(e){e.directive("ngPopover",["ngPopover",function(e){return{restrict:"A",link:function(t,a,o){e.open(a,t,o)}}}])}),define("apps/common/directives/popoverconfirm",["apps/common/directives/directives"],function(directives){directives.directive("ngPopoverConfirm",[function(){return{restirct:"A",link:function(scope,element,attrs){element.popover({html:!0,placement:"left",trigger:"manual",content:"<span data-popover-confirm-container>           <span class='btn btn-primary popover-confirm-btn'>             Confirm           </span>           <span class='btn popover-cancel-btn'>             Cancel           </span>         </span>"}),$(document).off("click","[ng-popover-confirm]"),$(document).on("click","[ng-popover-confirm]",function(){var e=$(this);e.next();e.popover("toggle")}),$(document).off("click",".popover-confirm-btn"),$(document).on("click",".popover-confirm-btn",function(){var popover=$(this).closest(".popover"),btn=popover.prev(),callback=btn.attr("ng-popover-confirm"),result=eval("scope."+callback);btn.popover("hide")}),$(document).off("click",".popover-cancel-btn"),$(document).on("click",".popover-cancel-btn",function(){var e=$(this).closest(".popover"),t=e.prev();t.popover("hide")})}}}])}),define("apps/common/directives/bindhtml",["apps/common/directives/directives"],function(e){e.directive("bindHtml",[function(){return function(e,t,a){a.bindHtml&&e.$watch(a.bindHtml,function(e){t.html(e||"")})}}])}),define("apps/common/directives/colorpicker",["apps/common/directives/directives","colorPicker"],function(e,t){e.directive("colorPicker",[function(){return{restrict:"AE",require:"?ngModel",scope:{color:"=ngModel"},template:'<div class="colorSelector"><div class="color-child"></div></div>',link:function(e,t,a,o){var s="#000000";e.$watch("color",function(a){void 0!=a&&(s=e.color,t.find(".color-child").css("backgroundColor",s))}),t.ColorPicker({color:s,onShow:function(e){return $(e).fadeIn(500),!1},onHide:function(e){return $(e).fadeOut(500),!1},onChange:function(e,t,a){o.$setViewValue("#"+t)}}),e.$on("$destroy",function(){$(".colorpicker").remove()})}}}])}),function(){function e(e){return document.createElementNS(c,e)}function t(e){return(e<10?"0":"")+e}function a(e){var t=++h+"";return e?e+t:t}function o(o,r){function c(e,t){var a=p.offset(),o=/^touch/.test(e.type),n=a.left+_,c=a.top+_,d=(o?e.originalEvent.touches[0]:e).pageX-n,u=(o?e.originalEvent.touches[0]:e).pageY-c,f=Math.sqrt(d*d+u*u),h=!1;if(!t||!(f<v-b||f>v+b)){e.preventDefault();var y=setTimeout(function(){s.addClass("clockpicker-moving")},200);l&&p.append(I.canvas),I.setHand(d,u,!t,!0),i.off(m).on(m,function(e){e.preventDefault();var t=/^touch/.test(e.type),a=(t?e.originalEvent.touches[0]:e).pageX-n,o=(t?e.originalEvent.touches[0]:e).pageY-c;(h||a!==d||o!==u)&&(h=!0,I.setHand(a,o,!1,!0))}),i.off(g).on(g,function(e){i.off(g),e.preventDefault();var a=/^touch/.test(e.type),o=(a?e.originalEvent.changedTouches[0]:e).pageX-n,l=(a?e.originalEvent.changedTouches[0]:e).pageY-c;(t||h)&&o===d&&l===u&&I.setHand(o,l),"hours"===I.currentView?I.toggleView("minutes",k/2):r.autoclose&&(I.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){I.done()},k/2)),p.prepend(G),clearTimeout(y),s.removeClass("clockpicker-moving"),i.off(m)})}}var d=n(P),p=d.find(".clockpicker-plate"),f=d.find(".clockpicker-hours"),h=d.find(".clockpicker-minutes"),w=d.find(".clockpicker-am-pm-block"),D="INPUT"===o.prop("tagName"),C=D?o:o.find("input"),x=o.find(".input-group-addon"),I=this;if(this.id=a("cp"),this.element=o,this.options=r,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=D,this.input=C,this.addon=x,this.popover=d,this.plate=p,this.hoursView=f,this.minutesView=h,this.amPmBlock=w,this.spanHours=d.find(".clockpicker-span-hours"),this.spanMinutes=d.find(".clockpicker-span-minutes"),this.spanAmPm=d.find(".clockpicker-span-am-pm"),this.amOrPm="PM",r.twelvehour){var S=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");n(S);n('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){I.amOrPm="AM",n(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),n('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){I.amOrPm="PM",n(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}r.autoclose||n('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+r.donetext+"</button>").click(n.proxy(this.done,this)).appendTo(d),"top"!==r.placement&&"bottom"!==r.placement||"top"!==r.align&&"bottom"!==r.align||(r.align="left"),"left"!==r.placement&&"right"!==r.placement||"left"!==r.align&&"right"!==r.align||(r.align="top"),d.addClass(r.placement),d.addClass("clockpicker-align-"+r.align),this.spanHours.click(n.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(n.proxy(this.toggleView,this,"minutes")),C.on("focus.clockpicker click.clockpicker",n.proxy(this.show,this)),x.on("click.clockpicker",n.proxy(this.toggle,this));var j,T,E,R=n('<div class="clockpicker-tick"></div>');if(r.twelvehour)for(j=1;j<13;j+=1){T=R.clone(),E=j/6*Math.PI;var U=v;T.css("font-size","120%"),T.css({left:_+Math.sin(E)*U-b,top:_-Math.cos(E)*U-b}),T.html(0===j?"00":j),f.append(T),T.on(u,c)}else for(j=0;j<24;j+=1){T=R.clone(),E=j/6*Math.PI;var F=j>0&&j<13,U=F?y:v;T.css({left:_+Math.sin(E)*U-b,top:_-Math.cos(E)*U-b}),F&&T.css("font-size","120%"),T.html(0===j?"00":j),f.append(T),T.on(u,c)}for(j=0;j<60;j+=5)T=R.clone(),E=j/30*Math.PI,T.css({left:_+Math.sin(E)*v-b,top:_-Math.cos(E)*v-b}),T.css("font-size","120%"),T.html(t(j)),h.append(T),T.on(u,c);if(p.on(u,function(e){0===n(e.target).closest(".clockpicker-tick").length&&c(e,!0)}),l){var G=d.find(".clockpicker-canvas"),A=e("svg");A.setAttribute("class","clockpicker-svg"),A.setAttribute("width",$),A.setAttribute("height",$);var L=e("g");L.setAttribute("transform","translate("+_+","+_+")");var M=e("circle");M.setAttribute("class","clockpicker-canvas-bearing"),M.setAttribute("cx",0),M.setAttribute("cy",0),M.setAttribute("r",2);var O=e("line");O.setAttribute("x1",0),O.setAttribute("y1",0);var q=e("circle");q.setAttribute("class","clockpicker-canvas-bg"),q.setAttribute("r",b);var B=e("circle");B.setAttribute("class","clockpicker-canvas-fg"),B.setAttribute("r",3.5),L.appendChild(O),L.appendChild(q),L.appendChild(B),L.appendChild(M),A.appendChild(L),G.append(A),this.hand=O,this.bg=q,this.fg=B,this.bearing=M,this.g=L,this.canvas=G}}var s,n=window.jQuery,r=n(window),i=n(document),c="http://www.w3.org/2000/svg",l="SVGAngle"in window&&function(){var e,t=document.createElement("div");return t.innerHTML="<svg/>",e=(t.firstChild&&t.firstChild.namespaceURI)==c,t.innerHTML="",e}(),d=function(){var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e}(),p="ontouchstart"in window,u="mousedown"+(p?" touchstart":""),m="mousemove.clockpicker"+(p?" touchmove.clockpicker":""),g="mouseup.clockpicker"+(p?" touchend.clockpicker":""),f=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,h=0,_=100,v=80,y=54,b=13,$=2*_,k=d?350:1,P=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");o.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},o.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},o.prototype.locate=function(){var e=this.element,t=this.popover,a=e.offset(),o=e.outerWidth(),s=e.outerHeight(),n=this.options.placement,r=this.options.align,i={};switch(t.show(),n){case"bottom":i.top=a.top+s;break;case"right":i.left=a.left+o;break;case"top":i.top=a.top-t.outerHeight();break;case"left":i.left=a.left-t.outerWidth()}switch(r){case"left":i.left=a.left;break;case"right":i.left=a.left+o-t.outerWidth();break;case"top":i.top=a.top;break;case"bottom":i.top=a.top+s-t.outerHeight()}t.css(i)},o.prototype.show=function(e){if(!this.isShown){var a=this;this.isAppended||(s=n(document.body).append(this.popover),r.on("resize.clockpicker"+this.id,function(){a.isShown&&a.locate()}),this.isAppended=!0);var o=((this.input.prop("value")||this.options.default||"")+"").split(":");if("now"===o[0]){var c=new Date(+new Date+this.options.fromnow);o=[c.getHours(),c.getMinutes()]}this.hours=+o[0]||0,this.minutes=+o[1]||0,this.spanHours.html(t(this.hours)),this.spanMinutes.html(t(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,i.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(e){var t=n(e.target);0===t.closest(a.popover).length&&0===t.closest(a.addon).length&&0===t.closest(a.input).length&&a.hide()}),i.on("keyup.clockpicker."+this.id,function(e){27===e.keyCode&&a.hide()})}},o.prototype.hide=function(){this.isShown=!1,i.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),i.off("keyup.clockpicker."+this.id),this.popover.hide()},o.prototype.toggleView=function(e,t){var a="hours"===e,o=a?this.hoursView:this.minutesView,s=a?this.minutesView:this.hoursView;this.currentView=e,this.spanHours.toggleClass("text-primary",a),this.spanMinutes.toggleClass("text-primary",!a),s.addClass("clockpicker-dial-out"),o.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(t),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){s.css("visibility","hidden")},k)},o.prototype.resetClock=function(e){var t=this.currentView,a=this[t],o="hours"===t,s=Math.PI/(o?6:30),n=a*s,r=o&&a>0&&a<13?y:v,i=Math.sin(n)*r,c=-Math.cos(n)*r,d=this;l&&e?(d.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){d.canvas.removeClass("clockpicker-canvas-out"),d.setHand(i,c)},e)):this.setHand(i,c)},o.prototype.setHand=function(e,a,o,s){var r,i=Math.atan2(e,-a),c="hours"===this.currentView,d=Math.PI/(c||o?6:30),p=Math.sqrt(e*e+a*a),u=this.options,m=c&&p<(v+y)/2,g=m?y:v;if(u.twelvehour&&(g=v),i<0&&(i=2*Math.PI+i),r=Math.round(i/d),i=r*d,u.twelvehour?c?0===r&&(r=12):(o&&(r*=5),60===r&&(r=0)):c?(12===r&&(r=0),r=m?0===r?12:r:0===r?0:r+12):(o&&(r*=5),60===r&&(r=0)),this[this.currentView]!==r&&f&&this.options.vibrate&&(this.vibrateTimer||(navigator[f](10),this.vibrateTimer=setTimeout(n.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=r,this[c?"spanHours":"spanMinutes"].html(t(r)),!l)return void this[c?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var e=n(this);e.toggleClass("active",r===+e.html())});s||!c&&r%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var h=Math.sin(i)*g,_=-Math.cos(i)*g;this.hand.setAttribute("x2",h),this.hand.setAttribute("y2",_),this.bg.setAttribute("cx",h),this.bg.setAttribute("cy",_),this.fg.setAttribute("cx",h),this.fg.setAttribute("cy",_)},o.prototype.done=function(){this.hide();var e=this.input.prop("value"),a=t(this.hours)+":"+t(this.minutes);this.options.twelvehour&&(a+=this.amOrPm),this.input.prop("value",a),a!==e&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur")},o.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(r.off("resize.clockpicker"+this.id),this.popover.remove())},n.fn.clockpicker=function(e){var t=Array.prototype.slice.call(arguments,1);return this.each(function(){var a=n(this),s=a.data("clockpicker");if(s)"function"==typeof s[e]&&s[e].apply(s,t);else{var r=n.extend({},o.DEFAULTS,a.data(),"object"==typeof e&&e);a.data("clockpicker",new o(a,r))}})}}(),define("clockPicker",["jquery"],function(){}),define("apps/common/directives/clockpicker",["apps/common/directives/directives","clockPicker"],function(e,t){e.directive("clockPicker",[function(){return{restrict:"AE",scope:{value:"="},template:'<div class="input-group clockpicker" data-autoclose="true"><input type="text" class="form-control" ng-model="value"><span class="input-group-addon"><span class="fa fa-clock-o"></span></span></div>',link:function(e,t,a){t.clockpicker({autoclose:!0}),e.$on("$destroy",function(){$(".clockpicker-popover").remove()})}}}])}),define("apps/common/directives/choiceimage",["apps/common/directives/directives"],function(e){e.directive("choiceImage",["saveAttachment",function(e){return{require:"?ngModel",restrict:"A",replace:!0,templateUrl:"assets/js/apps/common/templates/choiceimage.html",scope:{src:"=",imgid:"=",attachmentdata:"=",restrict:"@"},link:function(t,a,o,s){t._global=_global,t.$watch("images",function(){if(!angular.isUndefined(t.images)&&(t.src=t.images[t.images.length-1].url,angular.isDefined(o.imgid)&&(t.imgid=t.images[t.images.length-1].id),o.attachment)){var a=t.images[t.images.length-1];e.save({aid:a.id,url:a.url,forever:1},function(e){t.attachmentdata.wx_mid=e.msg.id,t.attachmentdata.url=e.msg.url,t.attachmentdata.forever=1},function(){})}})}}}])}),define("apps/common/directives/choiceicon",["apps/common/directives/directives"],function(e){e.directive("choiceIcon",[function(){return{require:"?ngModel",restrict:"A",replace:!0,templateUrl:"assets/js/apps/common/templates/choiceicon.html",scope:{src:"=",iconclass:"@"},link:function(e,t,a,o){e._global=_global,e.iconclass=a.iconclass,e.$watch("images",function(){angular.isUndefined(e.images)||(e.src=e.images[e.images.length-1].url,e.imgid=e.images[e.images.length-1].id)})}}}])}),define("apps/common/directives/validity",["apps/common/directives/directives"],function(e){e.directive("customRequired",[function(){return{restrict:"A",require:"ngModel",scope:{requirederror:"@"},link:function(e,t,a,o){var s=$(t);if(o)var n=function(t){var a=!o.$isEmpty(t),n="undefined"!=typeof e.requirederror?e.requirederror:"必填";return!a&&o.$dirty?s.hasClass("custom-required-error")||(s.addClass("custom-required-error"),s.offsetParent().after('<p class="custom-required-error-info error-text">'+n+"</p>")):(s.removeClass("custom-required-error"),s.offsetParent().next(".custom-required-error-info").remove()),o.$setValidity("customRequired",a),a?t:void 0};o.$formatters.push(n),o.$parsers.push(n)}}}]),e.directive("customNumber",[function(){return{restrict:"A",require:"ngModel",scope:{numbertype:"@",decimal:"@",min:"@",max:"@",maxstring:"@",minstring:"@"},link:function(e,t,a,o){var s=$(t),n=angular.isDefined(e.decimal)?e.decimal:0;if(s.unbind("blur"),o)var r=function(e){var t=!o.$isEmpty(e)&&!isNaN(e)&&parseFloat(e)>=0;return!t&&o.$dirty?s.hasClass("custom-number-error")||(s.addClass("custom-number-error"),s.parent(".validator-form").after('<p class="custom-number-error-info error-text">请输入一个非负数</p>')):(s.removeClass("custom-number-error"),s.parent(".validator-form").next(".custom-number-error-info").remove(),n>0?s.bind("blur",function(){""!=e&&null!=e&&($(this).val(parseFloat(e).toFixed(n)),$(this).trigger("change"))}):s.bind("blur",function(){""!=e&&null!=e&&($(this).val(parseInt(e)),$(this).trigger("change"))})),o.$setValidity("customNumber",t),t?e:void 0},i=function(t){var a=angular.isDefined(e.min)?e.min:0,n=angular.isDefined(e.minstring)?e.minstring:null;if(!a)return t;var r=!o.$isEmpty(t)&&!isNaN(t)&&parseFloat(t)>a;return!r&&o.$dirty?s.hasClass("custom-number-error")||(s.addClass("custom-number-error"),n?s.parent(".validator-form").after('<p class="custom-number-error-info error-text">'+n+"</p>"):s.parent(".validator-form").after('<p class="custom-number-error-info error-text">请输入一个大于'+a+"的数字</p>")):(s.removeClass("custom-number-error"),s.parent(".validator-form").next(".custom-number-error-info").remove()),o.$setValidity("customNumber",r),r?t:void 0},c=function(t){var a=angular.isDefined(e.max)?e.max:null,n=angular.isDefined(e.maxstring)?e.maxstring:null;if(!a)return t;var r=!o.$isEmpty(t)&&!isNaN(t)&&parseFloat(t)<=a;return!r&&o.$dirty?s.hasClass("custom-number-error")||(s.addClass("custom-number-error"),n?s.parent(".validator-form").after('<p class="custom-number-error-info error-text">'+n+"</p>"):s.parent(".validator-form").after('<p class="custom-number-error-info error-text">请输入一个不大于'+a+"的正数</p>")):(s.removeClass("custom-number-error"),s.parent(".validator-form").next(".custom-number-error-info").remove()),o.$setValidity("customNumber",r),r?t:void 0};o.$formatters.push(r,i,c),o.$parsers.push(r,i,c)}}}]),e.directive("customRepeat",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){if(o){var s=t.inheritedData("$formController")[a.customRepeat],n=function(e){var t;return t=!s.$viewValue||e===s.$viewValue,o.$setValidity("repeat",t),t?e:void 0};o.$parsers.push(n),o.$formatters.push(n),s.$parsers.push(function(e){return o.$setValidity("repeat",e===o.$viewValue),e})}}}}]),e.directive("telValidity",[function(){return{restrict:"A",require:"ngModel",scope:{requirederror:"@"},link:function(e,t,a,o){var s=$(t);if(o)var n=function(t){var a=/^1[3|4|5|7|8][0-9]\d{8}$/,n=!o.$isEmpty(t)&&a.test(t),r="undefined"!=typeof e.requirederror?e.requirederror:"请填写正确的手机号码";return!n&&o.$dirty?s.hasClass("custom-required-error")||(s.addClass("custom-required-error"),s.offsetParent().after('<p class="custom-required-error-info error-text">'+r+"</p>")):(s.removeClass("custom-required-error"),s.offsetParent().next(".custom-required-error-info").remove()),o.$setValidity("telValidity",n),n?t:void 0};o.$formatters.push(n),o.$parsers.push(n)}}}]),e.directive("charCodeValidity",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){var s=$(t),n=function(e){var t;if(e){t=e.length;for(var o=0,n=-1,r=0;r<t;r++)if(n=e.charCodeAt(r),o+=n>=0&&n<=128?1:2,o>a.length){e=e.substring(0,r);break}return s.bind("blur",function(){""!=e&&null!=e&&($(this).val(e),$(this).trigger("change"))}),e}};o.$formatters.push(n),o.$parsers.push(n)}}}])}),define("apps/common/directives/model_link",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("modelLink",["$modal","ngPopover",function(e,t){return{restrict:"AE",require:"?ngModel",scope:{item:"=ngModel",type:"=",data:"="},link:function(t,a,o,s){var n=function(){var a=e.open({animation:!1,templateUrl:"assets/js/apps/common/templates/model.link.html",controller:"ModelLinkCtrl",resolve:{type:function(){return t.type}}});a.result.then(function(e){t.item.data={};var a,o=e.name?e.name:e.title;switch(t.type){case"mall_feature":a="微页面",t.item.data.feature_id=e.id;break;case"mall_goods":a="商品",t.item.data.goods_id=e.id;break;case"feature":a="微页面",t.item.data.feature_id=e.id;break;case"tag":a="分组",t.item.data.tag_id=e.id;break;case"goods":a="商品",t.item.data.goods_id=e.id;break;case"buy":a="直接购买",t.item.data.cart_id=e.id}t.item.link_type=t.type,t.item.link_title=a+"|"+o,t.item.link_url=e.link_url})};a.bind("click",function(){"mall_feature"==t.type||"mall_goods"==t.type||"feature"==t.type||"tag"==t.type||"goods"==t.type||"buy"==t.type?n():t.$apply(function(){t.item.link_type=t.data.type,t.item.link_title=t.data.title,t.item.link_url=t.data.url})})}}}]),t.controller("ModelLinkCtrl",["$scope","$modalInstance","type","goodsResource","mall_feature","mall_goodsResource","feature","tagResource",function(e,t,a,o,s,n,r,i){var c,l=function(){o.get({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};switch(a){case"mall_feature":c=function(){s.get({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};break;case"mall_goods":c=function(){n.get({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};break;case"feature":c=function(){r.get({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};break;case"tag":c=function(){i.get({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};break;case"goods":c=l;break;case"buy":c=function(){_global.mall?n.get({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",sale:1,direction:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data}):o.get({column:"created_at",sale:1,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:e.paginationConf.sort,title:e.keyword},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})}}e.paginationConf={currentPage:1,itemsPerPage:5,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.search=function(){c()},e.selected=function(e){t.close(e)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/common/directives/resizable",["apps/common/directives/directives"],function(e){e.directive("resizable",[function(){return{restrict:"AE",link:function(e,t){t.resizable()}}}])}),function(e,t,a){function o(e){var t=e.keyCode||e.charCode;return t>=48&&t<=57||t>=37&&t<=40||8==t||46==t}function s(e){var t=this,a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours()%12==0?12:t.getHours()%12,"H+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),w:"0123456".indexOf(t.getDay()),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in a)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[o]:("00"+a[o]).substr((""+a[o]).length)));return e}function n(t,a){function o(t,a){if(sting=e.trim(t),""!==t)return a=a.replace(/yyyy/,y4).replace(/yy/,y2).replace(/MM/,M2).replace(/M/,M1).replace(/dd/,d2).replace(/d/,d1).replace(/HH/,H2).replace(/H/,H1).replace(/mm/,m2).replace(/m/,m1).replace(/ss/,s2).replace(/s/,s1),a=new RegExp("^"+a+"$"),n=a,a.test(t)}function s(e){var t,a=[],o=0;for(yi=e.indexOf("yyyy"),yi<0&&(yi=e.indexOf("yy")),yi>=0&&(a[o]=yi,o++),Mi=e.indexOf("MM"),Mi<0&&(Mi=e.indexOf("M")),Mi>=0&&(a[o]=Mi,o++),di=e.indexOf("dd"),di<0&&(di=e.indexOf("d")),di>=0&&(a[o]=di,o++),Hi=e.indexOf("HH"),Hi<0&&(Hi=e.indexOf("H")),Hi>=0&&(a[o]=Hi,o++),mi=e.indexOf("mm"),mi<0&&(mi=e.indexOf("m")),mi>=0&&(a[o]=mi,o++),si=e.indexOf("ss"),si<0&&(si=e.indexOf("s")),si>=0&&(a[o]=si,o++),t=[yi,Mi,di,Hi,mi,si],o=0;o<a.length-1;o++)for(j=0;j<a.length-1-o;j++)if(a[j]>a[j+1]){var s=a[j];a[j]=a[j+1],a[j+1]=s}for(o=0;o<a.length;o++)for(j=0;j<t.length;j++)a[o]==t[j]&&(t[j]=o);return t}var n,r=new Date;if(y4="([0-9]{4})",y2="([0-9]{2})",yi=-1,M2="(0[1-9]|1[0-2])",M1="([1-9]|1[0-2])",Mi=-1,d2="(0[1-9]|[1-2][0-9]|30|31)",d1="([1-9]|[1-2][0-9]|30|31)",di=-1,H2="([0-1][0-9]|20|21|22|23)",H1="([0-9]|1[0-9]|20|21|22|23)",Hi=-1,m2="([0-5][0-9])",m1="([0-9]|[1-5][0-9])",mi=-1,s2="([0-5][0-9])",s1="([0-9]|[1-5][0-9])",si=-1,o(t,a)){var i,c=n.exec(t),l=s(a),d=l[0]>=0?c[l[0]+1]:r.getFullYear(),p=l[1]>=0?c[l[1]+1]-1:r.getMonth(),u=l[2]>=0?c[l[2]+1]:r.getDate(),m=l[3]>=0?c[l[3]+1]:r.getHours(),g=l[4]>=0?c[l[4]+1]:r.getMinutes(),f=l[5]>=0?c[l[5]+1]:r.getSeconds(),i=new Date(d,p,u,m,g,f);return i.getDate()==u?i:r}return r}function r(t,a,o){var r=new Date;return/%/.test(t)?(o=o||0,t=t.replace(/%y/,r.getFullYear()).replace(/%M/,r.getMonth()+1).replace(/%d/,r.getDate()+o).replace(/%H/,r.getHours()).replace(/%m/,r.getMinutes()).replace(/%s/,r.getSeconds()).replace(l,"0$1")):/^#[\w-]+$/.test(t)&&(t=e.trim(e(t)[0].value),t.length>0&&a&&(t=s.call(n(t,a),"yyyy-MM-dd"))),t}var i,c=t.document,l=/\b(\w)\b/g,d=!!t.ActiveXObject,p=d&&!t.XMLHttpRequest,u=e(t),m="JCA"+(new Date).getTime(),g=function(e,t){for(var a,o=e.length;t<o&&(a=c.querySelector?e[t].src:e[t].getAttribute("src",4),a.substr(a.lastIndexOf("/")).indexOf("lhgcalendar")===-1);t++);return a.substr(0,a.lastIndexOf("/")+1)}(c.getElementsByTagName("script"),0),f=p?'<iframe id="lhgcal_frm" hideFocus="true" frameborder="0" src="about:blank" style="position:absolute;z-index:-1;width:100%;top:0px;left:0px;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>':"",h='<table class="lcui_border" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="lcui_lt"></td><td class="lcui_t"></td><td class="lcui_rt"></td></tr><tr><td class="lcui_l"></td><td><div class="lcui_head"><table width="100%" cellspacing="0" cellpadding="0" border="0"><tr><td width="14"><a class="cui_pm" href="javascript:void(0);"></a></td><td width="40"><input class="cui_im" maxlength="4" value=""/>月</td><td><a class="cui_nm" href="javascript:void(0);"></a></td><td width="14"><a class="cui_py" href="javascript:void(0);"></a></td><td width="60"><input class="cui_iy" maxlength="4" value=""/>年</td><td width="9"><a class="cui_ny" href="javascript:void(0);"></a></td></tr></table><div class="cui_ymlist" style="display:none;"><table width="100%" cellspacing="1" cellpadding="0" border="0"><thead class="cui_ybar"><tr><td><a class="cui_pybar" href="javascript:void(0);">«</a></td><td><a class="cui_cybar" href="javascript:void(0);">×</a></td><td><a class="cui_nybar" href="javascript:void(0);">»</a></td></tr></thead><tbody class="cui_lbox"></tbody></table></div></div><div class="lcui_body"><table cellspacing="1" cellpadding="0" border="0"><thead><tr><td>日</td><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td>六</td></tr></thead><tbody class="cui_db"></tbody></table></div><div class="cui_foot"><table width="100%" cellspacing="0" cellpadding="0" border="0"><tr><td align="center" class="lcui_today"><a class="cui_tbtn" href="javascript:void(0);">今天</a></td><td align="center" class="lcui_time"><input class="cui_hour" maxlength="2"/>:<input class="cui_minute" maxlength="2"/>:<input class="cui_second" maxlength="2"/></td><td align="center" class="lcui_empty"><a class="cui_dbtn" href="javascript:void(0);">清空</a></td></tr></table></div></td><td class="lcui_r"></td></tr><tr><td class="lcui_lb"></td><td class="lcui_b"></td><td class="lcui_rb"></td></tr></tbody></table>'+f;try{c.execCommand("BackgroundImageCache",!1,!0)}catch(e){}!function(e){var t=c.createElement("link");t.href=g+"skins/lhgcalendar.css",t.rel="stylesheet"}(c.getElementsByTagName("head")[0]);var _=function(e){e=e||{};var t=_.setting;for(var o in t)e[o]===a&&(e[o]=t[o]);return i?i._init(e):new _.fn._init(e)};_.fn=_.prototype={constructor:_,_init:function(t){var a,o,s,c=this,d=c._getEvent();return c.config=t,c.DOM=a=c.DOM||c._getDOM(),c.evObj=d.srcElement||d.target,c.inpE=t.id?e(t.id)[0]:c.evObj,t.btnBar?a.foot[0].style.display="":a.foot[0].style.display="none",t.minDate&&(t.minDate=r(t.minDate,t.targetFormat,t.noToday?1:0)),t.maxDate&&(t.maxDate=r(t.maxDate,t.targetFormat,t.noToday?-1:0)),o=e.trim(c.inpE.value),s=o.length>0?n(o,t.format):new Date,a.hour[0].value=(s.getHours()+"").replace(l,"0$1"),a.minute[0].value=(s.getMinutes()+"").replace(l,"0$1"),a.second[0].value=(s.getSeconds()+"").replace(l,"0$1"),e("input",a.foot[0]).attr({disabled:!(t.format.indexOf("H")>=0)}),c._draw(s).show()._offset(c.evObj),p&&e("#lhgcal_frm").css({height:a.wrap[0].offsetHeight+"px"}),i||(a.wrap[0].style.width=a.wrap[0].offsetWidth+"px",c._addEvent(),i=c),c},_draw:function(e,t){var a,o,s,n,i,d,p,u,m,g=this,f=g.DOM,h=[],_=g.config,v=0;g.year=n=e.getFullYear(),g.month=i=e.getMonth()+1,g.day=t||e.getDate(),f.iy[0].value=n,f.im[0].value=i,a=new Date(n,i-1,1).getDay(),o=new Date(n,i-1,0).getDate(),s=new Date(n,i,0).getDate();for(var y=0;y<a;y++)h.push(o),o--;h.reverse();for(var y=1;y<=s;y++)h.push(y);for(var y=1;y<=42-s-a;y++)h.push(y);d=c.createDocumentFragment();for(var y=0;y<6;y++){p=c.createElement("tr");for(var b=0;b<7;b++){if(u=c.createElement("td"),m=(n+"-"+i+"-"+h[v]).replace(l,"0$1"),v<a||v>=s+a||_.minDate&&_.minDate>m||_.maxDate&&_.maxDate<m||_.disWeek&&_.disWeek.indexOf(b)>=0)g._setCell(u,h[v]);else if(_.disDate){for(var $=0,k=_.disDate.length;$<k;$++){/%/.test(_.disDate[$])&&(_.disDate[$]=r(_.disDate[$]));var P=new RegExp(_.disDate[$]),w=_.enDate?!P.test(m):P.test(m);if(w)break}w?g._setCell(u,h[v]):g._setCell(u,h[v],!0)}else g._setCell(u,h[v],!0);p.appendChild(u),v++}d.appendChild(p)}for(;f.db[0].firstChild;)f.db[0].removeChild(f.db[0].firstChild);return f.db[0].appendChild(d),g},_setCell:function(t,a,o){o?(t.innerHTML='<a href="javascript:void(0);">'+a+"</a>",t.firstChild[m+"D"]=a+"",a===this.day&&e(t).addClass("cui_today")):t.innerHTML=a+""},_drawList:function(e,t){for(var a,o,s=this.DOM,n=c.createDocumentFragment(),r=0;r<4;r++){a=c.createElement("tr");for(var i=0;i<3;i++)o=c.createElement("td"),o.innerHTML='<a href="javascript:void(0);">'+(t?t[e]:e)+"</a>",a.appendChild(o),t?o.firstChild[m+"M"]=e:o.firstChild[m+"Y"]=e,e++;n.appendChild(a)}for(;s.lbox[0].firstChild;)s.lbox[0].removeChild(s.lbox[0].firstChild);return s.lbox[0].appendChild(n),this},_showList:function(){this.DOM.ymlist[0].style.display="block"},_hideList:function(){this.DOM.ymlist[0].style.display="none"},_offset:function(){var t,a=this,o=a.DOM,s=e(a.evObj).offset(),n=s.top+a.evObj.offsetHeight,r=u.width(),i=u.height(),c=u.scrollLeft(),l=u.scrollTop(),d=o.wrap[0].offsetWidth,p=o.wrap[0].offsetHeight;return n+p>i+l&&(n=s.top-p-2),s.left+d>r+c&&(s.left-=d),
o.wrap.css({left:s.left+"px",top:n+"px"}),t=o.im.offset().top+o.im[0].offsetHeight,o.ymlist[0].style.top=t-n+"px",a},_getDOM:function(){var t=c.createElement("div");t.style.cssText="position:absolute;display:none;z-index:"+this.config.zIndex+";",t.innerHTML=h;for(var a,o=0,s={wrap:e(t)},n=t.getElementsByTagName("*"),r=n.length;o<r;o++)a=n[o].className.split("cui_")[1],a&&(s[a]=e(n[o]));return c.body.appendChild(t),s},_getEvent:function(){if(d)return t.event;for(var e=this._getEvent.caller;null!=e;){var a=e.arguments[0];if(a&&(a+"").indexOf("Event")>=0)return a;e=e.caller}return null},_setDate:function(t){t=parseInt(t,10);var a=this,o=a.config,n=a.DOM,r=new Date(a.year,a.month-1,t);if(o.format.indexOf("H")>=0){var i=parseInt(n.hour[0].value,10),c=parseInt(n.minute[0].value,10),l=parseInt(n.second[0].value,10);r=new Date(a.year,a.month-1,t,i,c,l)}if(a.day=t,o.onSetDate&&o.onSetDate.call(a),a.inpE.value=s.call(r,o.format),o.real){var d=o.format.indexOf("H")>=0?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd";e(o.real)[0].value=s.call(r,d)}a.hide()},_addEvent:function(){var t=this,a=t.DOM;a.wrap.bind("click",function(o){var s=o.target;if(s[m+"D"])t._setDate(s[m+"D"]);else if(s===a.pm[0])t._draw(new Date(t.year,t.month-2),t.day);else if(s===a.nm[0])t._draw(new Date(t.year,t.month),t.day);else if(s===a.py[0])t._draw(new Date(t.year-1,t.month-1),t.day);else if(s===a.ny[0])t._draw(new Date(t.year+1,t.month-1),t.day);else if(s===a.tbtn[0]){var n=new Date;t.year=n.getFullYear(),t.month=n.getMonth()+1,t.day=n.getDate(),t._setDate(t.day)}else if(s===a.dbtn[0]){var r=t.config;r.onSetDate&&(t.year="",t.month="",t.day="",r.onSetDate.call(t)),t.inpE.value="",t.hide(),r.real&&(e(r.real)[0].value="")}else{if(s===a.im[0]){var i=["01","02","03","04","05","06","07","08","09","10","11","12"],c=a.im.offset().left-parseInt(a.wrap[0].style.left,10);return a.im[0].select(),a.ybar[0].style.display="none",a.ymlist[0].style.left=c+"px",t._drawList(0,i)._showList(),!1}if(s===a.iy[0]){var c=a.iy.offset().left-parseInt(a.wrap[0].style.left,10);return a.iy[0].select(),a.ybar[0].style.display="",a.ymlist[0].style.left=c+"px",t._drawList(t.year-4)._showList(),!1}var n=new Date,l=a.im[0].value||n.getMonth()+1,d=a.iy[0].value||n.getFullYear();t._draw(new Date(d,l-1),t.day)}return t._hideList(),!1}),a.ymlist.bind("click",function(o){var s=o.target;if(s[m+"M"]>=0)a.im[0].value=s[m+"M"]+1,t._draw(new Date(t.year,s[m+"M"]),t.day)._hideList();else if(s[m+"Y"])a.iy[0].value=s[m+"Y"],t._draw(new Date(s[m+"Y"],t.month-1),t.day)._hideList();else if(s===a.pybar[0]){var n=e("a",a.lbox[0])[0][m+"Y"];t._drawList(n-12)}else if(s===a.nybar[0]){var n=e("a",a.lbox[0])[0][m+"Y"];t._drawList(n+12)}else s===a.cybar[0]&&t._hideList();return!1}),a.im.bind("keypress",o),a.iy.bind("keypress",o),a.hour.bind("keypress",o),a.minute.bind("keypress",o),a.second.bind("keypress",o),e(c).bind("click",function(e){e.target!==t.evObj&&t.hide()._hideList()})},show:function(){return this.DOM.wrap[0].style.display="block",this},hide:function(){return this.DOM.wrap[0].style.display="none",this},getDate:function(e){var t=this,a=t.DOM,o=parseInt(a.hour[0].value,10),s=parseInt(a.minute[0].value,10),n=parseInt(a.second[0].value,10);if(""===t.year&&""===t.month&&""===t.day)return"";switch(formatNumber=function(e){return e<10?"0"+e:e},e){case"y":return t.year;case"M":return t.month;case"d":return t.day;case"H":return o;case"m":return s;case"s":return n;case"date":return t.year+"-"+t.month+"-"+t.day;case"dateTime":return t.year+"-"+formatNumber(t.month)+"-"+formatNumber(t.day)+" "+formatNumber(o)+":"+formatNumber(s)+":"+formatNumber(n)}}},_.fn._init.prototype=_.fn,_.formatDate=function(e,t){return s.call(e,t)},_.setting={id:null,format:"yyyy-MM-dd",minDate:null,maxDate:null,btnBar:!0,targetFormat:null,disWeek:null,onSetDate:null,real:null,disDate:null,enDate:!1,zIndex:99999,noToday:!1,linkageObj:null},e.fn.calendar=function(e,t){return t=t||"click",this.bind(t,function(){return _(e),!1}),this},t.lhgcalendar=e.calendar=_}(this.jQuery||this.lhgcore,this),define("lhgcalendar",function(){}),define("apps/common/directives/lhgcalendar",["apps/common/directives/directives","lhgcalendar"],function(e){e.directive("calendarTime",["$parse",function(e){return{restrict:"AE",replace:!0,require:"ngModel",scope:{minDate:"@",maxDate:"@",maxDateText:"@",minDateText:"@",btnbar:"@",format:"@"},link:function(e,t,a,o){e.btnbar=angular.isUndefined(e.btnbar),angular.isUndefined(e.format)&&(e.format="yyyy-MM-dd HH:mm:ss"),t.calendar({format:e.format,minDate:e.minDate,maxDate:e.maxDate,btnBar:e.btnbar,onSetDate:function(){o.$setViewValue(this.getDate("dateTime"))}}),t.next("span").calendar({format:"yyyy-MM-dd HH:mm:ss",minDate:e.minDate,maxDate:e.maxDate,onSetDate:function(){t.val(this.getDate("dateTime")),o.$setViewValue(this.getDate("dateTime"))}});var s=$(t);if(o){var n=function(t){var a=angular.isDefined(e.maxDate)?e.maxDate:null,n=angular.isDefined(e.maxDateText)?e.maxDateText:null;if(!a)return t;if(t)var r=new Date(Date.parse(t.replace(/-/g,"/"))).getTime(),i=new Date(Date.parse(a.replace(/-/g,"/"))).getTime();else var c=!0;var c=!o.$isEmpty(t)&&r<=i;return!c&&o.$dirty?s.hasClass("custom-number-error")||(n||(n="时间输入错误"),s.addClass("custom-number-error"),s.parent().after('<p class="custom-number-error-info error-text">'+n+"</p>")):(s.removeClass("custom-number-error"),s.parent().next(".custom-number-error-info").remove()),t?o.$setValidity("calendarTime",c):o.$setValidity("calendarTime",!0),c?t:void 0},r=function(t){var a=angular.isDefined(e.minDate)?e.minDate:null,n=angular.isDefined(e.minDateText)?e.minDateText:null;if(!a)return t;if(t)var r=new Date(Date.parse(t.replace(/-/g,"/"))).getTime(),i=new Date(Date.parse(a.replace(/-/g,"/"))).getTime(),c=!o.$isEmpty(t)&&r>=i;else var c=!0;return!c&&o.$dirty?s.hasClass("custom-number-error")||(n||(n="时间输入错误"),s.addClass("custom-number-error"),s.parent().after('<p class="custom-number-error-info error-text">'+n+"</p>")):(s.removeClass("custom-number-error"),s.parent().next(".custom-number-error-info").remove()),t?o.$setValidity("calendarTime",c):o.$setValidity("calendarTime",!0),c?t:void 0};o.$formatters.push(n,r),o.$parsers.push(n,r)}}}}])}),define("apps/common/directives/popover.create",["apps/common/directives/directives"],function(e){e.directive("popoverCreate",[function(){return{restrict:"AE",controller:"popover.create as vm",bindToController:!0,scope:{confirmText:"@",cancelText:"@",message:"@",placement:"@",onConfirm:"&",onCancel:"&",confirmButtonType:"@",cancelButtonType:"@",isOpen:"=",info:"="}}}]).controller("popover.create",["$scope","$document","$element","$compile","$position","$window","confirmationPopoverDefaults","$timeout",function(e,t,a,o,s,n,r,i){function c(){_=angular.element(h),_.css("display","none"),o(_)(e)}function l(){angular.forEach(f.info,function(e,t){f.info[t].value=""})}function d(){var e=s.positionElements(a,_,f.popoverPlacement,!0);e.top+="px",e.left+="px",_.css(e)}function p(){f.isVisible||(l(),t.find("body").append(_),_.css({display:"block"}),d(),f.isVisible=!0),f.isOpen=!0}function u(){f.isVisible&&(_.remove(),c(),f.isVisible=!1),f.isOpen=!1}function m(){f.isVisible?u():p(),e.$apply()}function g(t){!f.isVisible||_[0].contains(t.target)||a[0].contains(t.target)||(u(),e.$apply())}var f=this;f.defaults=r,f.popoverPlacement=f.placement||f.defaults.placement;var h=['<div class="popover" ng-class="vm.popoverPlacement">','<div class="arrow"></div>','<div class="popover-content">',"<div>",'<div class="form-group">'];angular.forEach(f.info,function(e,t){h.push('<input type="text" class="form-control input-sm" ng-model="vm.info.'+t+'.value" id="input-addProp-name-pop" placeholder="请输入'+f.info[t].name+'">')}),h=h.concat(["</div>",'<div class="form-inline">','<button type="button" class="btn btn-success btn-sm" ng-click="vm.onConfirm(); vm.hidePopover()" ng-bind-html="vm.confirmText || vm.defaults.confirmText"></button>','<button type="button" class="btn btn-default btn-sm" ng-click="vm.onCancel(); vm.hidePopover()" ng-bind-html="vm.cancelText || vm.defaults.cancelText"></button>',"</div>","</div>","</div>","</div>"]).join("\n");var _;f.isVisible=!1,c(),f.showPopover=p,f.hidePopover=u,f.togglePopover=m,e.$watch("vm.isOpen",function(e){i(function(){e?p():u()})}),a.bind("click",m),n.addEventListener("resize",d),t.bind("click",g),t.bind("touchend",g),e.$on("$destroy",function(){_.remove(),a.unbind("click",m),n.removeEventListener("resize",d),t.unbind("click",g),t.unbind("touchend",g)})}])}),define("apps/common/directives/partner.city.select",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("partnerCitySelect",["$modal",function(e){return{restrict:"EA",scope:{size:"@size",exist:"=exist",already:"=already"},require:"?^ngModel",link:function(t,a,o,s){a.bind("click",function(){var a=e.open({animation:!1,templateUrl:"assets/js/apps/common/templates/partner.city.select.html",controller:"partner.city.ctrl",size:t.size,resolve:{exist:function(){return t.exist},already:function(){return t.already}}});a.result.then(function(e){s.$setViewValue({ids:e.ids.join(","),ida:e.ida,names:e.names.join(",")})})})}}}]),t.controller("partner.city.ctrl",["$scope","$http","$modalInstance","Flash","exist","already",function(e,t,a,o,s,n){function r(t){angular.forEach(e.regions[t.prov].sub,function(a,o){a.checked=t.status,t.status?a.child=a.sub.length:a.child=0,delete e.selected[a.id]}),t.status?e.regions[t.prov].child=e.regions[t.prov].sub.length:e.regions[t.prov].child=0}function i(t){angular.forEach(e.regions[t.prov].sub[t.city].sub,function(e,a){e.checked=t.status})}function c(t,a,o,s,n,r){var i=0;return!!a[o.id]&&(angular.forEach(a[o.id],function(c,l){s[c.id]&&(c.checked=!0,o.child=++i,"city"==t?(angular.forEach(a[c.id],function(e,t){e.checked=!0}),c.child=a[c.id].length,e.selected[c.id]={id:c.id,index:l,name:c.name,type:"city",prov:n.prov,provName:n.provName}):(e.regions[n.prov].child=0,angular.forEach(e.regions[n.prov].sub,function(t,a){t.child>0&&e.regions[n.prov].child++}),e.selected[c.id]={id:c.id,index:l,name:c.name,type:"dist",city:n.city,cityName:n.name,prov:n.prov,provName:n.name})),r[c.id]&&angular.isUndefined(s[c.id])&&(c.disabled=!0,o.disabled=!0)}),o.sub=a[o.id])}function l(t,a){var o=0,s=[];s=a||0==a?e.regions[t].sub[a].sub:e.regions[t].sub;for(var n in s){if(!s[n].checked)break;o++}return o==s.length}function d(t){e.selected[e.regions[t].id]={id:e.regions[t].id,index:t,name:e.regions[t].name,type:"prov"},angular.forEach(e.regions[t].sub,function(t,a){delete e.selected[t.id],angular.forEach(t.sub,function(t,a){delete e.selected[t.id]})}),e.regions[t].child=e.regions[t].sub.length}function p(t,a){e.selected[e.regions[t].sub[a].id]={id:e.regions[t].sub[a].id,index:a,name:e.regions[t].sub[a].name,type:"city",prov:t,provName:e.regions[t].name},angular.forEach(e.regions[t].sub[a].sub,function(t,a){delete e.selected[t.id]}),e.regions[t].sub[a].child=e.regions[t].sub[a].sub.length}e.selected={},t({method:"GET",url:"/regions.json"}).then(function(t){var a=t.data,o={},i={};if(s){s=s.split(",");for(var l in s)o[s[l]]=!0}n&&(n=n.split(","),angular.forEach(n,function(e,t){i[e]=!0})),e.regions=a[1];var d={};angular.forEach(e.regions,function(t,s){d={},d.prov=s,d.provName=t.name,c("city",a,t,o,d,i),angular.forEach(t.sub,function(e,n){d.prov=s,d.provName=t.name,d.city=n,d.cityName=e.name,c("dist",a,e,o,d,i)}),o[t.id]?(t.checked=!0,e.selected[t.id]={id:t.id,index:s,name:t.name,type:"prov"},r({prov:s,status:!0})):i[t.id]&&(t.disabled=!0,r({prov:s,status:!1,disabled:!0}))})},function(e){}),e.cityIn={},e.distsIn={},e.showCity=function(t,a,o){switch(t){case"city":e.provActive=a,e.cityIn.prov!=a&&(e.cityIn={prov:a},e.citys=e.regions[a].sub,e.distsIn={},e.dists={});break;case"dist":e.cityActive=o,e.distsIn.prov==a&&e.distsIn.city==o||(e.distsIn={prov:a,city:o},e.dists=e.regions[a].sub[o].sub);break;default:return!1}},e.selectCity=function(t,a){var o=!1,s=!1;switch(t){case"prov":e.regions[a].checked?(o=!0,e.selected[e.regions[a].id]={id:e.regions[a].id,index:a,name:e.regions[a].name,type:"prov"}):delete e.selected[e.regions[a].id],r({prov:a,status:o});break;case"city":e.regions[e.cityIn.prov].sub[a].checked&&(o=!0),o?(s=l(e.cityIn.prov),e.regions[e.cityIn.prov].checked=s,s?d(e.cityIn.prov):(p(e.cityIn.prov,a),e.regions[e.cityIn.prov].child=e.regions[e.cityIn.prov].child?e.regions[e.cityIn.prov].child+1:1),e.regions[e.cityIn.prov].sub[a].child=e.regions[e.cityIn.prov].sub[a].sub.length):(e.regions[e.cityIn.prov].checked=!1,e.regions[e.cityIn.prov].child=e.regions[e.cityIn.prov].child-1,e.regions[e.cityIn.prov].sub[a].child=0,delete e.selected[e.regions[e.cityIn.prov].id],delete e.selected[e.regions[e.cityIn.prov].sub[a].id],angular.forEach(e.regions[e.cityIn.prov].sub,function(t,o){t.checked&&(e.selected[t.id]={id:t.id,index:a,name:t.name,type:"city",prov:e.cityIn.prov,provName:e.regions[e.cityIn.prov].name})})),i({prov:e.cityIn.prov,city:a,status:o});break;case"dist":if(e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].checked&&(o=!0),o)if(s=l(e.distsIn.prov,e.distsIn.city),e.regions[e.distsIn.prov].sub[e.distsIn.city].checked=s,s){var n=l(e.distsIn.prov);e.regions[e.distsIn.prov].checked=n,n?d(e.distsIn.prov):p(e.distsIn.prov,e.distsIn.city)}else e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].id]={id:e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].id,index:a,name:e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].name,type:"dist",city:e.distsIn.city,cityName:e.regions[e.distsIn.prov].sub[e.distsIn.city].name,prov:e.distsIn.prov,provName:e.regions[e.distsIn.prov].name},e.regions[e.distsIn.prov].sub[e.distsIn.city].child=e.regions[e.distsIn.prov].sub[e.distsIn.city].child?e.regions[e.distsIn.prov].sub[e.distsIn.city].child+1:1,e.regions[e.distsIn.prov].child=0,angular.forEach(e.regions[e.distsIn.prov].sub,function(t,a){t.child>0&&e.regions[e.distsIn.prov].child++});else delete e.selected[e.regions[e.distsIn.prov].id],delete e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].id],delete e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].id],e.regions[e.distsIn.prov].checked=!1,e.regions[e.distsIn.prov].sub[e.distsIn.city].checked=!1,e.regions[e.distsIn.prov].sub[e.distsIn.city].child=e.regions[e.distsIn.prov].sub[e.distsIn.city].child-1,angular.forEach(e.regions[e.distsIn.prov].sub,function(t,o){t.checked&&(e.selected[t.id]={id:t.id,index:a,name:t.name,type:"city",prov:e.distsIn.prov,provName:e.regions[e.distsIn.prov].name})}),angular.forEach(e.regions[e.distsIn.prov].sub[e.distsIn.city].sub,function(t,o){t.checked&&(e.selected[t.id]={id:t.id,index:a,name:t.name,type:"dist",city:e.distsIn.city,cityName:e.regions[e.distsIn.prov].sub[e.distsIn.city].name,prov:e.distsIn.prov,provName:e.regions[e.distsIn.prov].name})}),0==e.regions[e.distsIn.prov].sub[e.distsIn.city].child&&e.regions[e.distsIn.prov].child--;break;default:return!1}},e.$watch("selected",function(t){var a=[];angular.forEach(t,function(e,t){switch(e.type){case"prov":a.push(e.name);break;case"city":a.push(e.provName+" "+e.name);break;case"dist":a.push(e.provName+" "+e.cityName+" "+e.name);break;default:return!1}}),e.selectInfo=a.join(",")},!0),e.selectedCancel=function(t){var a=e.selected[t],o=a.index,s=!1;switch(e.selected[t].type){case"prov":e.regions[o].checked=s,r({prov:o,status:s});break;case"city":e.regions[a.prov].sub[o].checked=s,i({prov:a.prov,city:o,status:s});break;case"dist":e.regions[a.prov].sub[a.city].sub[o].checked=s;break;default:return!1}delete e.selected[t]},e.save=function(){if(Object.keys(e.selected).length<=0)return void o.create("warning","请至少选择一个城市");var t={ids:[],ida:[],names:[]};angular.forEach(e.selected,function(a,o){switch(a.type){case"prov":t.ida.push({id:a.id,pid1:0,pid2:0});break;case"city":t.ida.push({id:a.id,pid1:e.regions[a.prov].id,pid2:0});break;case"dist":t.ida.push({id:a.id,pid1:e.regions[a.prov].sub[a.city].id,pid2:e.regions[a.prov].id})}t.ids.push(a.id),t.names.push(a.name)}),a.close(t)},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/common/directives/onekeyclearinput",["apps/common/directives/directives"],function(e){e.directive("oneKeyClearInput",["$timeout",function(e){return{restrict:"A",scope:!0,link:function(e,t,a,o){function s(){c=t.offsetParent();var o=t.offset().top+t.outerHeight()/2-r/2-c.offset().top-1.4*i,s=t.offset().left+t.outerWidth()-r-i-c.offset().left-5;n.css({position:"absolute",top:o,left:s,fontSize:r,color:"#ccc",padding:i+1,display:"none",zIndex:1e3}),c.find(".one-key-clear").remove(),c.append(n),c.is("label")&&c.click(function(t){var o=t.clientX,c=t.clientY,l=n.offset().top;s=n.offset().left,o>s-i&&o<s+r+i&&c>l-i&&c<l+r+i&&e.$apply(a.ngModel+"=null")}),n.click(function(t){e.$apply(a.ngModel+"=null"),t.stopPropagation()})}var n=angular.element('<i class="if if-close-circle one-key-clear"></i>'),r=(t.html().length+t.attr("class")?t.attr("class").split(" ").join(""):"oneKey",18),i=6,c=null;e.checkVal=function(){return a.$$element.val()},e.$watch("checkVal()",function(e){e?(c||s(),n.show()):n.hide()})}}}])}),define("apps/common/directives/exportcheck",["apps/common/directives/directives","apps/common/controllers/controllers"],function(directives,controllers){directives.directive("exportCheck",["$compile",function(e){return{restrict:"A",require:"?^ngModel",scope:!0,controller:"export.check.ctrl",link:function(t,a,o,s){t.limit={limit_from:parseInt(a.attr("limit_from")||0),limit_to:parseInt(a.attr("limit_to")||5e3)};var n=angular.element('<div class="form-group">                        <label class="control-label">开始行数：</label>                        <div class="controls">                            <input type="number" class="form-control" ng-model="limit.limit_from" ng-blur="formatnum()"/>                        </div>                    </div>'),r=angular.element('<div class="form-group">                        <label class="control-label">导出行数：</label>                        <div class="controls">                            <input type="number" class="form-control" ng-model="limit.limit_to" ng-blur="limitnum()">                        </div>                    </div>'),i=a;btnContainer=i.find(".form-group"),angular.element("<hr/>").insertBefore(btnContainer),n.insertBefore(btnContainer),r.insertBefore(btnContainer),e(n)(t),e(r)(t)}}}]),controllers.controller("export.check.ctrl",["$scope","Flash",function($scope,Flash){$scope.formatnum=function(){var e=$scope.limit.limit_from;(e<0||!e)&&0!=e?(Flash.create("danger","开始行数最小为0"),$scope.limit.limit_from=0):$scope.limit.limit_from=e},$scope.limitnum=function(e){var e=$scope.limit.limit_to;e<=0||e>5e3||!e?(Flash.create("danger","导出行数最小为1,最大为5000"),$scope.limit.limit_to=5e3):$scope.limit.limit_to=e},$scope.export=function(resultI){var result=angular.copy(resultI),url=result.url;return angular.isDefined(result.ids)&&result.ids.length?(url=url+"ids="+result.ids.join(","),angular.isDefined(result.export)?url=url+"&export="+result.export:url+="&export=1",void(window.location.href=url)):(angular.isDefined(result.dates)&&""!=result.dates?(result.dates=eval(result.dates),result.dates=result.dates.split("/"),result.params.startDate=result.dates[0],result.params.endDate=result.dates[1]):(delete result.params.startDate,delete result.params.endDate),angular.isDefined(result.finishDates)&&""!=result.finishDates?(result.finishDates=eval(result.finishDates),result.finishDates=result.finishDates.split("/"),result.params.startFinishDate=result.finishDates[0],result.params.endFinishDate=result.finishDates[1]):(delete result.params.startFinishDate,delete result.params.endFinishDate),angular.isDefined(result.areas)&&result.areas&&(result.params.province=result.areas.selected[0]?result.areas.selected[0].id:"",result.params.city=result.areas.selected[1]?result.areas.selected[1].id:"",result.params.district=result.areas.selected[2]?result.areas.selected[2].id:""),angular.isDefined(result.dates_t_created)&&""!=result.dates_t_created?(result.dates_t_created=eval(result.dates_t_created),result.dates_t_created=result.dates_t_created.split("/"),result.params.created_at_start=result.dates_t_created[0],result.params.created_at_end=result.dates_t_created[1]):(delete result.params.created_at_start,delete result.params.created_at_end),angular.isDefined(result.dates_t_settled)&&""!=result.dates_t_settled?(result.dates_t_settled=eval(result.dates_t_settled),result.dates_t_settled=result.dates_t_settled.split("/"),result.params.settled_at_start=result.dates_t_settled[0],result.params.settled_at_end=result.dates_t_settled[1]):(delete result.params.settled_at_start,delete result.params.settled_at_end),delete result.params.limit,delete result.params.offset,angular.forEach(result.params,function(e,t){angular.isUndefined(e)||(url+=t+"="+e+"&")}),angular.isDefined(result.sorting)&&angular.forEach(result.params,function(e,t){angular.isUndefined(e)||(url+=t+"="+e+"&")}),url+="offset="+$scope.limit.limit_from+"&limit="+$scope.limit.limit_to+"&limit_from="+$scope.limit.limit_from+"&limit_to="+$scope.limit.limit_to,angular.isDefined(result.export)?url=url+"&export="+result.export:url+="&export=1",window.location.href=url,void Flash.create("success","正在导出,请等待..."))}}])}),define("apps/common/directives/select.goods",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("selectGoods",["$modal",function(e){return{restrict:"A",scope:{size:"@size",resources:"=resources",choice:"=choice",reload:"&reload"},require:"?^ngModel",link:function(t,a,o,s){a.prepend(angular.element("<i class='fa fa-plus'></i>")),a.bind("click",function(){var a=e.open({animation:!1,templateUrl:"assets/js/apps/common/templates/select.goods.html",controller:"select.goods.ctrl",windowClass:"modal-open",resolve:{resources:function(){return t.resources},choice:function(){return t.choice}}});a.result.then(function(e){e&&t.reload()()})})}}}]),t.controller("select.goods.ctrl",["$scope","tagResource","resources","choice","$modal","$modalInstance",function(e,t,a,o,s,n){function r(){t.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.cancel=function(){n.dismiss("cancel")},e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},r();var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),a(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){i()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.sorting={price:"",stock:"",csale:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),i()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.choice=function(e){var t=$.extend(!0,o,{resolve:{goods_id:function(){return e}}}),a=s.open(t);a.result.then(function(e){e&&n.close(1)})}}])}),define("apps/common/directives/opguide",["apps/common/directives/directives"],function(e){e.directive("opguide",["$rootScope","$http","$position","$timeout","Flash",function(e,t,a,o,s){return{restrict:"AE",transclude:!0,replace:!0,scope:{},templateUrl:"assets/js/apps/common/templates/opguide.html",link:function(e,n,r){e.$on("topbarFinished",function(r,i){o(function(){function o(e){var t,o,s=angular.element(".gu-"+e),n=4==e?angular.element("#guide-"+(e-1)):angular.element("#guide-"+e),r=a.offset(n);switch(e){case 1:t=r.top-62,o=r.left+2;break;case 2:t=r.top-62,o=r.left+2;break;case 3:t=r.top+5,o=r.left-225;break;case 4:t=r.top+5,o=r.left-325}s.css({top:t,left:o})}var r=!0,i=angular.element("#guide-1"),c=angular.element("#guide-2");e.activeStep=1,0==i.length&&(e.activeStep++,0==c.length&&e.activeStep++),o(e.activeStep),t.get("/shop/qrcode.json").success(function(t){e.qrcode=t}),e.showMessage=function(){s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.nextStep=function(a){3==a?(e.activeStep++,o(e.activeStep)):4==a?r&&(r=!1,t.put("/user/guide.json").success(function(e){e.success&&n.remove()}).error(function(e){e.error&&s.create("danger",e.error.message)})):1==i.length&&0==c.length?(e.activeStep+=2,o(e.activeStep)):(e.activeStep++,o(e.activeStep))}},0)})}}}])}),define("apps/common/directives/title",["apps/common/directives/directives"],function(e){e.directive("titleH5",["$rootScope","$timeout",function(e,t){return{link:function(){if(2!=_global.shop_type)return void(e.titleH5="商户后台");var a=function(a,o){e.os.isAndroid||e.os.isPhone?(e.titleH5="微小店商户后台",t(function(){e.titleH5=o.data&&o.data.pageTitle?o.data.pageTitle:"商户后台"})):e.os.isPc&&(e.titleH5="商户后台")};e.$on("$stateChangeSuccess",a),e.$watch("titleH5",function(e){document.getElementsByTagName("body")[0];document.title=e;var t=document.createElement("iframe");t.title="微小店商户后台",t.width=0,t.height=0,t.src="//m.baidu.com/favicon.ico",t.style.display="none",t.addEventListener("load",function(){setTimeout(function(){document.body.removeChild(t)},0)}),document.body.appendChild(t)})}}}])}),define("apps/common/directives/_base",["apps/common/directives/topbar","apps/common/directives/pagination","apps/common/directives/upload_imglist","apps/common/directives/addimage","apps/common/directives/addvoice","apps/common/directives/cityselect","apps/common/directives/popover","apps/common/directives/popoverconfirm","apps/common/directives/bindhtml","apps/common/directives/colorpicker","apps/common/directives/clockpicker","apps/common/directives/choiceimage","apps/common/directives/choiceicon","apps/common/directives/validity","apps/common/directives/model_link","apps/common/directives/resizable","apps/common/directives/lhgcalendar","apps/common/directives/popover.create","apps/common/directives/partner.city.select","apps/common/directives/onekeyclearinput","apps/common/directives/exportcheck","apps/common/directives/select.goods","apps/common/directives/opguide","apps/common/directives/title"],function(){}),define("apps/common/filters/textdisplay",["apps/common/filters/filters"],function(e){e.filter("textdisplay",function(){return function(e,t,a){var o=10,s="...";return t&&(o=parseInt(t)),a&&(s=a),e.length<o||e.length==o?e:e.substring(0,o)+s}})}),define("apps/common/filters/mchDate",["apps/common/filters/filters"],function(e){e.filter("mchDate",function(){return function(e,t,a){var o="YYYY-MM-DD";return t&&(o=t),e||"current"!=a?moment(e).format(o):moment().format(o)}})}),define("apps/common/filters/_base",["apps/common/filters/textdisplay","apps/common/filters/mchDate"],function(){}),define("apps/common/services/checkAddArr",["apps/common/services/services"],function(e){e.factory("checkAddArrService",[function(){return{checkAddArr:function(e,t,a){var o={flag:!0,index:null,value:null};return angular.forEach(e,function(s,n){angular.forEach(t,function(t){n>0&&"asce"==a&&1*s[t.key]<=1*e[n-1][t.key]&&o.flag&&(o={flag:!1,value:t.value,index:n})})}),o}}}])}),define("apps/common/services/_base",["apps/common/services/checkAddArr"],function(){}),define("apps/auth/states/login",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth",{abstract:!0,url:"/auth",templateUrl:"assets/js/apps/auth/templates/layout.html"}).state("auth.login",{url:"/login",templateUrl:"assets/js/apps/auth/templates/login.html",controller:"auth.login",data:{pageTitle:"微小店商户后台"}}).state("auth.stafflogin",{url:"/stafflogin",templateUrl:"assets/js/apps/auth/templates/stafflogin.html",controller:"auth.stafflogin"})}])}),define("apps/auth/states/bind",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.bind",{url:"/bind",templateUrl:"assets/js/apps/auth/templates/bind.html"})}])}),define("apps/auth/states/resetpwd",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.resetpwd",{url:"/resetpwd",templateUrl:"assets/js/apps/auth/templates/resetpwd.html",controller:"auth.resetpwd"}).state("auth.setpwd",{url:"/setpwd/:mobile",templateUrl:"assets/js/apps/auth/templates/setpwd.html",controller:"auth.setpwd"})}])}),define("apps/auth/states/register",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.register",{url:"/register",controller:"auth.register",templateUrl:"assets/js/apps/auth/templates/register.html",data:{pageTitle:"微小店商户后台"}})}])}),define("apps/auth/states/active",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.active",{url:"/active",templateUrl:"assets/js/apps/auth/templates/active.html",controller:"auth.active"})}])}),define("apps/auth/states/realnameauth",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.realnameauth",{url:"/realnameauth",templateUrl:"assets/js/apps/auth/templates/realNameAuth.html",controller:"auth.realnameauth",data:{pageTitle:"微小店商户后台"}})}])}),define("apps/auth/states/loginaggregate",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.loginaggregate",{url:"/loginaggregate",templateUrl:"assets/js/apps/auth/templates/loginAggregate.html",controller:"auth.loginaggregate",data:{pageTitle:"微小店商户后台"}})}])}),define("apps/auth/states/resetpwdh",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("auth.resetpwdh",{url:"/resetpwdh/:mobile",templateUrl:"assets/js/apps/auth/templates/resetpwdH.html",controller:"auth.resetpwdh",data:{pageTitle:"微小店商户后台"}})}])}),define("apps/auth/states/_base",["apps/auth/states/login","apps/auth/states/bind","apps/auth/states/resetpwd","apps/auth/states/register","apps/auth/states/active","apps/auth/states/realnameauth","apps/auth/states/loginaggregate","apps/auth/states/resetpwdh"],function(){}),define("apps/auth/controllers/login",["apps/common/controllers/controllers","wxLogin"],function(e){e.controller("auth.login",["$scope","$rootScope","$state","$modal","$q","$timeout","Flash","login","loginbankgroundimg",function(e,t,a,o,s,n,r,i,c){function l(t){function o(){if(["40","41"].indexOf(t.platform_type+"")!==-1)window.location.href="/profile/password";else{a.go("profile.password");for(var e in p)p[e].close(0);p=[]}}function n(t,o){t||(o.data.mall?window.location.href="/mall":["40","41"].indexOf(o.platform_type+"")!==-1?window.location.href=_global.url.custom_base+"/shop":a.go("shop.dashboard")),""!=o.synlogin&&$("body").append(o.synlogin),e.$emit("login",o.data)}var r=s.all([d({flag:!t.isUpdatedPassword&&!/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,18}$/.test(e.entity.password),defer:0,jsonData:{title:"请更新密码(弱密码)",content:"系统检测到您的账号密码为弱密码，建议您修改密码以提高账号安全性。",tips:"密码必须包含大小写字母和数字，6~18位。",buttons:["下次再说","修改密码"],gos:o}}),d({flag:t.isUpdatedPassword,defer:0,jsonData:{title:"请更新密码(每月更新密码)",content:"系统检测到您的账号密码一个月内没有更新，建议您修改密码以提高账号安全性。",tips:"密码必须包含大小写字母和数字，6~18位。",buttons:["下次再说","修改密码"],gos:o}})]);r.then(function(e){var a=!1;for(var o in e)if(e[o]){a=!0;break}n(a,t)})}function d(e){return s(function(t,a){e.flag?n(function(){var a=o.open({animation:!1,controller:"auth.valid.pwd",templateUrl:"assets/js/apps/auth/templates/valid.pwd.modal.html",backdrop:"static",size:"pwd",resolve:{jsonData:function(){return e.jsonData}}});a.result.then(function(e){t(e)}),p.push(a)},e.defer):t(0)})}e.auth_mod="account",e.entity={username:""},e.isH5=!1,e.isLogin=!1,new WxLogin({id:"js-weixin-login",appid:_global.url.weixin_qrconnect_id,scope:"snsapi_login",redirect_uri:_global.url.base+"/weixin/qrlogincode",
state:"",style:"",href:_global.url.static_https+"build/css/weixin-login.css"}),e.$on("$viewContentLoaded",function(){return 2!=_global.shop_type?void(e.isH5=!1):void(t.os.isAndroid||t.os.isPhone?e.isH5=!0:t.os.isPc&&(e.isH5=!1))}),e.login={text:"登录",enable:1,captcha_src:"/captcha",changeCaptcha:function(){e.login.captcha_src="/captcha?"+Math.random()}},e.login.changeCaptcha(),e.clearInput=function(){e.entity.username=""},e.toResetPass=function(){1==e.isH5?a.go("auth.resetpwdh",{mobile:e.entity.username}):a.go("auth.resetpwd")},e.phoneLength=function(){e.entity.username&&e.entity.username.length>13&&(e.entity.username=e.entity.username.substring(0,13))},e.phoneFormat=function(t){var a=t.keyCode;return 8==a||46==a||void(e.entity.username&&""!=e.entity.username&&(3!=e.entity.username.length&&8!=e.entity.username.length||(e.entity.username+=" ")))},e.closeModal=function(){e.isLogin=!1,window.location.href="/shop"},e.submitForm=function(o){if(o){e.login.text="登录中...",e.form.$invalid=!0;var s=e.entity.username.replace(/\s/g,"");i.save({captcha:e.entity.captcha,password:e.entity.password,username:s},function(o){if($(".header.auth").css("display","block"),e.login.captcha_src="/captcha?"+Math.random(),o.error)o.enabled==-2&&d({flag:1,defer:0,jsonData:{title:"请激活账号",content:"系统检测到您的账号近三个月未登陆过,已启动休眠状态保护您的账号,请激活账号。",buttons:["暂不激活","手机号激活"],gos:function(){a.go("auth.active")}}}),e.login.text="登录",e.form.$invalid=!1,e.login.errors=o.error,1==e.isH5&&(o.error.message.captcha&&r.create("danger","图形验证码不正确，请重新输入"),o.error.message.login&&r.create("danger","手机号或密码错误，请重新输入"));else{if(2==o.data.shop_type&&0==o.data.is_auth&&1==o.data.is_admin)return 2!=_global.shop_type?void(window.location.href="/certification/info"):(t.os.isAndroid||t.os.isPhone?a.go("auth.realnameauth"):t.os.isPc&&(window.location.href="/certification/info"),!1);e.isLogin=!0,1!=e.isH5&&l(o)}})}},e.imgdata=[],e.bankgroundimg=function(){c.get({},function(t){e.imgdata=t.data,e.imgdata.length>0&&2!=_global.shop_type&&setTimeout(function(){function e(e){function t(t){i||((t>0&&c==r||t<0&&0==c)&&(t>0?(s=e.children("div").first().remove(),s.hide(),e.append(s)):(s=e.children("div").last().remove(),s.hide(),e.prepend(s)),c-=t,a()),i=!0,n=e.children(),o=n[c+t],$(o).fadeIn(400,function(){c+=t,i=!1}))}function a(){n=e.children();for(var t=0;t<n.length;++t)n[t].style.display=t==c?"block":""}var o,s,n=e.children(),r=n.length-1,i=!1,c=0;return a(),{next:function(){t(1)},prev:function(){t(-1)},itemsNum:n&&n.length}}var t=e($(".slider-rrd"));t.itemsNum&&t.itemsNum>1&&setInterval(function(){t.next()},4e3)},100)},function(e){r.create("danger",e.data.error.message)})},e.bankgroundimg();var p=[]}]),e.controller("auth.valid.pwd",["$scope","$modalInstance","jsonData",function(e,t,a){e.jsonData=a,e.close=function(){t.close(0)},e.goPwd=function(){t.close(1),a.gos()}}])}),define("apps/auth/controllers/resetpwd",["apps/common/controllers/controllers"],function(e){e.controller("auth.resetpwd",["$scope","$http","resetpwdResource","$state","Flash",function(e,t,a,o,s){e.resetpwd={mobile:"",captcha:"",type:1},e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.submitForm=function(t){t&&a.sendForgetMsg(e.resetpwd,function(){o.go("auth.setpwd",{mobile:e.resetpwd.mobile})},function(e){s.create("danger",e.data.error.message)})}}])}),define("apps/auth/controllers/setpwd",["apps/common/controllers/controllers"],function(e){e.controller("auth.setpwd",["$scope","$http","$state","$stateParams","Flash","resetpwdResource",function(e,t,a,o,s,n){e.setpwd={mobile:o.mobile,type:1},e.submitForm=function(t){t&&n.resetPassword(e.setpwd,function(e){e.error?s.create("danger",e.error.message):a.go("auth.login")},function(e){s.create("danger",e.data.error.message)})}}])}),define("apps/auth/controllers/valid.mobile",["apps/common/controllers/controllers"],function(e){e.controller("auth.valid.mobile",["$scope","$http","$state","$interval","Flash","$modalInstance","username","mobile",function(e,t,a,o,s,n,r,i){e.entity={username:r,mobile:i,captcha:"",check_code:""},e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.isCodeSend=!1,e.vlogin={text:"确认",clickTxt:"获取验证码",second:120,clickStatus:!1},e.verifiyForm=function(a){e.form.$invalid=!0,a&&t({url:"verifiyphone.json",method:"put",data:{mobile:e.entity.mobile,check_code:e.entity.check_code,type:"2"}}).success(function(t){e.form.$invalid=!1,t.error?s.create("warning",t.error.message):(s.create("success",'<span><i class="fa fa-check"></i> <strong>恭喜您，验证成功！</strong></span>'),n.close(e.entity.mobile))}).error(function(t){e.form.$invalid=!1,s.create("danger",t.error.message)})},e.getVerifiy=function(){t({url:"send_verfity_message.json",method:"put",data:{captcha:e.entity.captcha,mobile:e.entity.mobile,type:"2"}}).success(function(t){t&&(e.vlogin.timer=o(function(){e.vlogin.second>0?(e.isCodeSend=!0,e.vlogin.clickTxt="重新获取("+e.vlogin.second+")",e.vlogin.second--):(e.isCodeSend=!1,o.cancel(e.vlogin.timer),e.vlogin.clickTxt="重新获取",e.vlogin.second=120)},1e3))}).error(function(t){s.create("danger",t.error.message),e.vlogin.clickTxt="重新获取"})},e.cancel=function(){n.dismiss("cancel")}}])}),define("apps/auth/controllers/perfect.merchant",["apps/common/controllers/controllers"],function(e){e.controller("auth.perfect.merchant",["$scope","$http","$state","$interval","Flash","$modalInstance",function(e,t,a,o,s,n){e.cancel=function(){n.dismiss("cancel")},e.goToShop=function(){e.cancel(),a.go("profile.setting")}}])}),define("apps/auth/controllers/stafflogin",["apps/common/controllers/controllers","wxLogin"],function(e){e.controller("auth.stafflogin",["$scope","Flash","staffLogin",function(e,t,a){e.submitForm=function(o){o&&(e.login.text="请求中...",e.form.$invalid=!0,a.save(e.entity,function(t){t.status?(e.login.step=2,e.login.header="微信扫码登录商户后台",new WxLogin({id:"js-weixin-login",appid:t.data.appid,scope:"snsapi_login",redirect_uri:t.data.redirect_uri,state:t.data.state,style:"",href:_global.url.static_https+"build/css/weixin-login.css"})):(e.login.text="下一步",e.form.$invalid=!1,e.login.error=t.message)},function(){e.login.text="下一步",e.form.$invalid=!1,t.create("danger","系统错误，请稍后再试！")}))},e.entity={account:"",username:"",password:""},e.login={text:"下一步",step:1,header:"员工账号登录"}}])}),define("apps/auth/controllers/register",["apps/common/controllers/controllers"],function(e){e.controller("auth.register",["$scope","$http","$modal","registerResource","$state","$stateParams","Flash","$interval","login","$rootScope",function(e,t,a,o,s,n,r,i,c,l){e.register={captcha:"",mobile:"",msgCaptcha:"",name:"",password:"",rePassword:"",auth_name:"",auth_number:"",address:"",inviter_id:_global.inviter_id},e.isPc=!0,e.register.sureReg=!0,e.show_msg=!1,e.isLogin=!1,e.pwdCheckError=!0,e.$on("$viewContentLoaded",function(){return 2!=_global.shop_type?void(e.isPc=!0):void(l.os.isAndroid||l.os.isPhone?e.isPc=!1:l.os.isPc&&(e.isPc=!0))}),e.showMsg=function(){$(".layer").css("display","block")},e.closeMsg=function(){$(".layer").css("display","none")},e.phoneLength=function(){e.register.mobile&&e.register.mobile.length>13&&(e.register.mobile=e.register.mobile.substring(0,13))},e.phoneFormat=function(t){var a=t.keyCode;return 8==a||46==a||void(e.register.mobile&&""!=e.register.mobile&&(3!=e.register.mobile.length&&8!=e.register.mobile.length||(e.register.mobile+=" ")))},e.closeModal=function(){e.isLogin=!1,window.location.href="/shop"},e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.submitForm=function(t){if(t){var n=e.register.mobile.replace(/\s/g,"");o.doRegister({address:e.register.address,captcha:e.register.captcha,mobile:n,msgCaptcha:e.register.msgCaptcha,name:e.register.name,password:e.register.password,rePassword:e.register.rePassword,auth_name:e.register.auth_name,auth_number:e.register.auth_number,inviter_id:e.register.inviter_id,sureReg:e.register.sureReg},function(t){if(t.status)r.create("success","注册成功"),c.save({reg:1,username:n,password:e.register.password},function(t){t.error?s.go("auth.login"):0==e.isPc?e.isLogin=!0:(t.data.mall?window.location.href="/mall":s.go("shop.dashboard"),""!=t.synlogin&&$("body").append(t.synlogin),e.$emit("login",t.data))});else{e.changeCaptcha(),e.register.msgCaptcha="",e.register.captcha="";var o=function(o){var s=a.open({animation:!1,controller:"certification.modal",template:'<div class="modal-body">                                                    <div class="row">                                                        <div class="col-sm-12">                                                            <div class="controls">                                                                <span class="text-center" ng-class="{true:\'title\'}[$root.os.isAndroid || $root.os.isPhone]">{{msg.titile}}</span>                                                                <span class="text-center">{{msg.content}}</span>                                                            </div>                                                        </div>                                                    </div>                                        </div>                                        <div class="modal-footer ">                                            <button class="btn btn-primary btn-sm center-block" type="button"  ng-click="close()">{{certification_test}}</button>                                        </div>',size:o,backdrop:"static",resolve:{certificationData:function(){return t}}});s.result.then(function(t){e.register.auth_number="",e.register.auth_name=""})};t.error_type?o():r.create("danger",t.msg)}},function(t){e.changeCaptcha(),e.register.msgCaptcha="",e.register.captcha="",r.create("danger",t.data.error.message)})}},e.dogetacc=function(){e.code=!1,e.paracont="获取短信验证码",e.paracontT="获取验证码",e.paraclass="btn-info",e.paraclassT="btn-info"},e.dogetacc_init=function(){var t=e.register.mobile.replace(/\s/g,"");if(!t)return r.create("danger","请输入手机号码"),!1;if(!/^1(3|4|5|7|8)\d{9}$/.test(t))return r.create("danger","请输入11位有效手机号"),!1;e.code=!0,e.paraevent=!0;var a=60,s=void 0;o.sendRegisterMsg({phone:t,captcha:e.register.captcha},function(t){t.status?s=i(function(){a<=0?(i.cancel(s),s=void 0,a=60,e.paracont="重发短信验证码",e.paracontT="重新获取",e.paraclass="btn-info",e.paraclassT="btn-info",e.paraevent=!0,e.code=!1):(e.paracont=a+"秒后重发",e.paracontT=a+"秒后重发",e.paraclass="btn-default",e.paraclassT="btn-doing",a--)},1e3):(e.code=!1,e.changeCaptcha(),r.create("danger","手机号码已经存在"))},function(t){e.code=!1,e.changeCaptcha(),r.create("danger",t.data.error.message)})},e.dogetacc(),e.phoneCheck=function(){e.form.password.$invalid&&(e.form.$invalid=!0)},e.captchaCheck=function(){e.form.password.$invalid&&(e.form.$invalid=!0)},e.msgCaptchaCheck=function(){e.form.password.$invalid&&(e.form.$invalid=!0)},e.checkboxCheck=function(){e.form.password.$invalid&&(e.form.$invalid=!0)},e.pwdCheck=function(){var t="";return t=e.register.password,t.length>20||t.length<6?(e.form.password.$invalid=!0,e.form.password.$dirty=!0,e.form.$valid=!1,e.form.$invalid=!0,e.form.password.$error={length:!0}):/[a-z]/.test(t)&&/[A-Z]/.test(t)&&/[0-9]/.test(t)?/\s/.test(t)?(e.form.password.$invalid=!0,e.form.password.$dirty=!0,e.form.$valid=!1,e.form.$invalid=!0,e.form.password.$error={blank:!0}):/[a-z]/.test(t)&&/[A-Z]/.test(t)&&/[0-9]/.test(t)||/[(\~)(\!)(\@)(\#)(\$)(\%)(\^)(\&)(\*)(\()(\))(\-)(\_)(\+)(\=)(\[)(\])(\{)(\})(\|)(\\)(\;)(\:)(\')(\")(\,)(\.)(\/)(\<)(\>)(\?)(\)]+/.test(t)?(e.form.password.$error={},e.form.password.$invalid=!1,e.pwdCheckError=!1,e.form.password.$dirty=!1):(e.form.password.$invalid=!0,e.form.password.$dirty=!0,e.form.$valid=!1,e.form.$invalid=!0,e.form.password.$error={notcommon:!0}):(e.form.password.$invalid=!0,e.form.password.$dirty=!0,e.form.$valid=!1,e.form.$invalid=!0,e.form.password.$error={multi:!0})}}]),e.directive("pwCheck",[function(){return{require:"ngModel",link:function(e,t,a,o){var s=t.inheritedData("$formController")[a.pwCheck];o.$parsers.push(function(e){return e===s.$viewValue?(o.$setValidity("repeat",!0),e):void o.$setValidity("repeat",!1)}),s.$parsers.push(function(e){return o.$setValidity("repeat",e===o.$viewValue),e})}}}]),e.controller("auth.register.modal",["$scope","$resource","$modal","certification","$modalInstance","Flash","certificationData",function(e,t,a,o,s,n,r){e.certification_test="重新输入",e.msg=r.msg,"实名认证通道已被锁定，24小时后自动解锁"==r.msg&&(e.certification_test="明天再来"),e.close=function(){s.close(0)}}])}),define("apps/auth/controllers/active",["apps/common/controllers/controllers"],function(e){e.controller("auth.active",["$scope","$state","Flash","sentActiveCodeResource","shopActiveResource",function(e,t,a,o,s){e.code_form={username:"",mobile:"",captcha:""},e.hasSendCode=!1,e.codeform_btn="发送短信验证码",e.codeForm=function(t){t&&(e.codeform_btn="发送中...",e.codeform.$invalid=!0,o.save({username:e.code_form.username,mobile:e.code_form.mobile,captcha:e.code_form.captcha,type:10},function(t){e.codeform_btn="发送短信验证码",e.codeform.$invalid=!1,e.changeCaptcha(),t.error?a.create("danger",t.error.message):(e.hasSendCode=!0,a.create("success",t.message))},function(t){e.codeform_btn="发送短信验证码",e.codeform.$invalid=!1,e.changeCaptcha(),a.create("danger",t.data.error.message)}))},e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.active_form={check_code:""},e.activeform_btn="激活账号",e.activeForm=function(o){o&&(e.activeform_btn="激活账号中...",e.activeform.$invalid=!0,s.save({check_code:e.active_form.check_code,username:e.code_form.username,mobile:e.code_form.mobile,type:10},function(o){o.status?(a.create("success",o.message),t.go("auth.login")):(a.create("danger",o.message),e.activeform_btn="激活账号",e.activeform.$invalid=!1)}))}}])}),define("apps/auth/controllers/realnameauth",["apps/common/controllers/controllers"],function(e){e.controller("auth.realnameauth",["$scope","$resource","$modal","certification","certificationLoader","Flash","$state",function(e,t,a,o,s,n,r){e.auth_info=s,e.pass={},e.btn_text="实名认证",e.submitForm=function(t){t&&(e.btn_text="认证中...",e.form.$invalid=!0,o.update(e.pass,function(t){if(t.status)e.btn_text="实名认证",window.location.href="/shop";else{var o=function(o){var s=a.open({animation:!1,controller:"certification.modal",template:'<div class="modal-body">                                                    <div class="row">                                                        <div class="col-sm-12">                                                            <div class="controls">                                                                <span class="text-center" ng-class="{true:\'title\'}[$root.os.isAndroid || $root.os.isPhone]">{{msg.titile}}</span>                                                                <span class="text-center">{{msg.content}}</span>                                                            </div>                                                        </div>                                                    </div>                                        </div>                                        <div class="modal-footer ">                                            <button class="btn btn-primary btn-sm center-block" type="button"  ng-click="close()">{{certification_test}}</button>                                        </div>',size:o,backdrop:"static",resolve:{certificationData:function(){return t}}});s.result.then(function(t){e.pass.auth_number="",e.pass.auth_name=""})};o(),e.btn_text="实名认证",e.form.$invalid=!1}},function(t){e.btn_text="实名认证",e.form.$invalid=!1,n.create("danger",t.data.error.message)}))}}]),e.controller("certification.modal",["$scope","$resource","$modal","certification","$modalInstance","Flash","certificationData","$rootScope",function(e,t,a,o,s,n,r,i){e.certification_test="重新输入",e.msg=r.msg,"实名认证通道已被锁定，24小时后自动解锁"==r.msg&&(e.certification_test="明天再来"),e.close=function(){s.close(0)}}])}),define("apps/auth/controllers/resetpwdh",["apps/common/controllers/controllers"],function(e){e.controller("auth.resetpwdh",["$scope","$http","resetpwdResource","$state","Flash","$stateParams","$interval",function(e,t,a,o,s,n,r){e.setpwd={mobile:n.mobile||"",captcha:"",type:1},e.eyeShow=!0,e.type=!0,e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.eyeS=function(){e.eyeShow=!1,e.type=!1},e.eyeH=function(){e.eyeShow=!0,e.type=!0},e.phoneLength=function(){e.setpwd.mobile&&e.setpwd.mobile.length>13&&(e.setpwd.mobile=e.setpwd.mobile.substring(0,13))},e.phoneFormat=function(t){var a=t.keyCode;return 8==a||46==a||void(e.setpwd.mobile&&""!=e.setpwd.mobile&&(3!=e.setpwd.mobile.length&&8!=e.setpwd.mobile.length||(e.setpwd.mobile+=" ")))},e.submitForm=function(t){var n=e.setpwd.mobile.replace(/\s/g,"");t&&a.resetPassword({check_code:e.setpwd.check_code,mobile:n,password:e.setpwd.password,password_confirmation:e.setpwd.password,type:e.setpwd.type},function(e){e.error?"100003"==e.error.code?s.create("danger","短信验证码不正确，请重新输入"):s.create("danger",e.error.message):o.go("auth.login")},function(e){"100003"==e.data.error.code?s.create("danger","短信验证码不正确，请重新输入"):s.create("danger",e.data.error.message)})},e.dogetacc=function(){e.code=!1,e.paracont="获取验证码",e.paraclass=!1},e.dogetacc_init=function(){var t=e.setpwd.mobile.replace(/\s/g,"");if(!t)return s.create("danger","请输入手机号码"),!1;if(!/^1(3|4|5|7|8)\d{9}$/.test(t))return s.create("danger","请输入11位有效手机号"),!1;e.code=!0,e.paraevent=!0;var o=60,n=void 0;a.sendForgetMsg({mobile:t,captcha:e.setpwd.captcha,type:e.setpwd.type},function(t){t.success?n=r(function(){o<=0?(r.cancel(n),n=void 0,o=60,e.paracont="重新获取",e.paraclass=!1,e.paraevent=!0,e.code=!1):(e.paracont=o+"秒后重发",e.paraclass=!0,o--)},1e3):(e.code=!1,e.changeCaptcha())},function(t){e.code=!1,e.changeCaptcha(),s.create("danger",t.data.error.message)})},e.dogetacc()}])}),define("apps/auth/controllers/loginaggregate",["apps/common/controllers/controllers"],function(e){e.controller("auth.loginaggregate",["$scope","$state","$rootScope",function(e,t,a){e.toRegister=function(){t.go("auth.register")}}])}),define("apps/auth/controllers/_base",["apps/auth/controllers/login","apps/auth/controllers/resetpwd","apps/auth/controllers/setpwd","apps/auth/controllers/valid.mobile","apps/auth/controllers/perfect.merchant","apps/auth/controllers/stafflogin","apps/auth/controllers/register","apps/auth/controllers/active","apps/auth/controllers/realnameauth","apps/auth/controllers/resetpwdh","apps/auth/controllers/loginaggregate"],function(){}),define("apps/auth/directives/_base",[],function(){}),define("apps/auth/services/login",["apps/common/services/services"],function(e){e.factory("login",["$resource",function(e){return e("/auth/login.json",{},{})}]),e.factory("staffLogin",["$resource",function(e){return e("/staff/login.json",{},{})}]),e.factory("logoutResource",["$resource",function(e){return e("/auth/logout.json",{},{})}]),e.factory("loginbankgroundimg",["$resource",function(e){return e("/advertisement.json",{},{get:{method:"GET",url:"/advertisement.json"}})}])}),define("apps/auth/services/resetpwd",["apps/common/services/services"],function(e){e.factory("resetpwdResource",["$resource",function(e){return e("send_forget_message.json",{},{sendForgetMsg:{method:"POST",url:"send_forget_message.json"},resetPassword:{method:"PUT",url:"forgetpass.json"}})}])}),define("apps/auth/services/register",["apps/common/services/services"],function(e){e.factory("registerResource",["$resource",function(e){return e("send_register_message.json",{},{sendRegisterMsg:{method:"POST",url:"send_register_message.json"},doRegister:{method:"POST",url:"do_register.json"},doCreateshop:{method:"POST",url:"do_createshop.json"},doCreateClass:{method:"GET",url:"do_getshopcate.json"}})}])}),define("apps/auth/services/active",["apps/common/services/services"],function(e){e.factory("shopActiveResource",["$resource",function(e){return e("/auth/shop_active.json",{},{})}]),e.factory("sentActiveCodeResource",["$resource",function(e){return e("/auth/check_user_info.json",{},{})}])}),define("apps/auth/services/_base",["apps/auth/services/login","apps/auth/services/resetpwd","apps/auth/services/register","apps/auth/services/active"],function(){}),define("apps/auth/main",["apps/auth/states/_base","apps/auth/controllers/_base","apps/auth/directives/_base","apps/auth/services/_base"],function(){}),define("apps/shop/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("/",{url:"/",controller:["$scope","$state",function(e,t,a){t.go("shop.dashboard")}]}).state("shop",{abstract:!0,url:"/shop",templateUrl:"assets/js/apps/shop/templates/layout.html",controller:"shop.layout"}).state("shop.dashboard",{url:"",templateUrl:"assets/js/apps/shop/templates/dashboard.html",controller:"shop"})}])}),define("apps/shop/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.setting",{abstract:!0,url:"/setting",templateUrl:"assets/js/apps/shop/templates/setting.tab.html"}).state("shop.setting.base",{url:"",templateUrl:"assets/js/apps/shop/templates/setting.html",controller:"shop.setting"}).state("shop.setting.kefu",{url:"/kefu",templateUrl:"assets/js/apps/shop/templates/setting.kefu.html",controller:"shop.setting.kefu"}).state("shop.setting.dynamics",{url:"/dynamics",templateUrl:"assets/js/apps/shop/templates/setting.dynamics.html",controller:"shop.setting.dynamics"}).state("shop.setting.promise",{url:"/promise",templateUrl:"assets/js/apps/shop/templates/setting.promise.html",controller:"shop.setting.promise"}).state("shop.setting.address",{url:"/address",templateUrl:"assets/js/apps/shop/templates/setting.address.html",controller:"shop.setting.address"}).state("shop.setting.recommend",{url:"/recommend",templateUrl:"assets/js/apps/shop/templates/setting.recommend.html",controller:"shop.setting.recommend"}).state("shop.log",{url:"/log",templateUrl:"assets/js/apps/shop/templates/log.html",controller:"shop.setting.log"})}])}),define("apps/shop/states/_base",["apps/shop/states/main","apps/shop/states/setting"],function(){}),define("apps/shop/controllers/main",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("shop",["$scope","shopResource","baseinfoResource","topSalesResource","qrcodeResource","Flash","$http","$modal","videoAddress",function(e,a,o,s,n,r,i,c,l){e.videoAddress=l;var d=t.init(document.getElementById("chart")),p=[],u=[],m=[],g=[],f={tooltip:{trigger:"axis"},legend:{data:["总订单","已成功","已发货"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:p}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"总订单",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:u},{name:"已成功",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:m},{name:"已发货",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:g}]};a.query(function(e){angular.forEach(e,function(e,t){p.push(e.date),u.push(e.trade_count),g.push(e.c_send_num),m.push(e.c_success_num)}),d.setOption(f)}),o.get(function(t){e.baseinfo=t}),s.get(function(t){e.goods=t.data}),n.get(function(t){e.qrcode=t,e.copy_text=e.qrcode.url}),e.showMessage=function(){r.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.$on("to-shop",function(t,a){e.mobile=a});var h=function(){i.get("affiche/indexAffichePic").then(function(t){t.data.data.url&&t.data.data.url.indexOf("http")==-1&&(t.data.data.url="http://"+t.data.data.url),2==t.data.data.type?(e.anData=t.data.data,_(t.data.data.id,!0)):e.mobile&&""!=e.mobile.mobile&&0!=e.mobile.is_verification_mobile&&(e.anData=t.data.data)},function(e){})};h(),e.is_showWord={show:!0},e.noShowWord=function(){e.is_showWord.show=!1},e.noShow=function(t){e.anData.is_show=!1,e.is_showWord.show=!1,_(t)},e.postNum=function(){e.$emit("to-topbar",!0)};var _=function(t,a){a?i({method:"GET",url:"affiche/afficheInfo",params:{id:e.anData.id,readed:a}}).then(function(t){e.postNum()}):i({method:"GET",url:"affiche/afficheInfo",params:{id:t}}).then(function(t){e.postNum()})};e.freeApply=function(){c.open({animation:!1,templateUrl:"assets/js/apps/shop/templates/applyRrds.html",controller:"rrdshang",windowClass:"rrdshang-Modal",resolve:{items:function(){return e.merchant.rrdshang_url}}})}}]),e.controller("rrdshang",["$scope","$modalInstance","$window","items",function(e,t,a,o){e._global=_global,e.goApplyEc=function(){a.open(o,"_blank"),t.dismiss("cancel")},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/shop/controllers/shop.setting",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting",["$scope","shop","Flash","$stateParams",function(e,t,a,o){e.shop_info=t.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,t.update(e.shop_info,function(o){_global.shop&&(_global.shop.name=e.shop_info.name,_global.shop.logo=e.shop_info.logo),e.shop_info=t.get(),e.btn_text="保存",a.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}))}}])}),define("apps/shop/controllers/shop.setting.kefu",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.kefu",["$scope","settingKefuResource","Flash","$stateParams","KefuMerInfoResource","$modal",function(e,t,a,o,s,n){e.setting={enabled:0,type:1,mechat:{base:null,kefu:[]}},e.setting_api={type:3},e.datatrue=!1,e.viewOrderInfo=function(e){var t=n.open({animation:!1,templateUrl:"assets/js/apps/shop/templates/setting.fastbus.form.html",controller:"shop.setting.fastbus.form",resolve:{}});t.result.then(function(e){e.success===!0&&r()})};var r=function(){s.get("",function(t){0==t.status?e.viewOrderInfo():1==t.status&&(e.datatrue=!0,e.setting_api.comp_id=t.kuaishangInfo.comp_id,e.setting_api.user_name=t.kuaishangInfo.user_name,e.setting_api.link=t.kuaishangInfo.link,e.setting_api.code=t.kuaishangInfo.code)})};e.fastbut=function(){r()};var i=function(){t.get("",function(t){null==t.kefu&&(t.kefu=e.setting),t.kefu&&(e.setting={enabled:t.kefu.enabled,type:t.kefu.type,pages:t.kefu.pages}),t.kuaishang&&(e.setting.kuaishang_subdomain=t.kuaishang.kuaishang_subdomain,e.setting.kuaishang_ci=t.kuaishang.kuaishang_ci,e.setting.kuaishang_fi=t.kuaishang.kuaishang_fi,e.setting.kuaishang_cas=t.kuaishang.kuaishang_cas),t.mechat&&(e.setting.mechat=t.mechat),3==t.kefu.type&&e.fastbut()})};i(),e.is_mechat=!1,e.$watch("setting.type",function(t){switch(t){case"1":e.is_mechat=!1;break;case"2":e.setting.mechat.base||(e.is_mechat=!0)}}),e.btn_text="保存",e.submitForm=function(o){if(o){e.btn_text="保存中...",e.form.$invalid=!0;var s={enabled:e.setting.enabled,pages:e.setting.pages,type:parseInt(e.setting.type)};switch(s.type){case 1:s.kuaishang_cas=e.setting.kuaishang_cas,s.kuaishang_ci=e.setting.kuaishang_ci,s.kuaishang_fi=e.setting.kuaishang_fi,s.kuaishang_subdomain=e.setting.kuaishang_subdomain}t.save(s,function(t){i(),e.btn_text="保存",a.create("success"," 保存成功！"),e.form.$invalid=!1},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)})}}}])}),define("apps/shop/controllers/shop.setting.promise",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.promise",["$scope","shop","Flash","settingprimiseResource","merchantSettingResource","$modal","videoAddress",function(e,t,a,o,s,n,r){e.videoAddress=r,e.paginationConf={currentPage:1,itemsPerPage:100},e.searchInfo={title:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var i=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.promiseData=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){i()},s.get(function(t){e.is_open=1==t.label_enabled}),e.merchant_open_promise_status=!1,e.merchant_open_promise=function(){var t=1==e.is_open?1:0;e.merchant_open_promise_status=!0,s.save({label_enabled:t},function(o){e.merchant_open_promise_status=!1,o.success?(a.create("success"," 操作成功！"),e.is_open=1==t):(a.create("danger",o.msg),e.is_open=1!=t)},function(t){e.merchant_open_promise_status=!1,a.create("danger",t.data.error.message)})},e.add_template=function(){var e=n.open({animation:!1,size:"lg",templateUrl:"assets/js/apps/shop/templates/model_add.html",controller:"promiseModelEditCtrl",resolve:{data:function(){return""}}});e.result.then(function(e){e.status&&i()})},e.edit_template=function(e){var t=n.open({animation:!1,size:"lg",templateUrl:"assets/js/apps/shop/templates/model_add.html",controller:"promiseModelEditCtrl",resolve:{data:function(){return e}}});t.result.then(function(e){e.status&&i()})},e.promiseDetele=function(e){o.del({id:e},function(e){e.success?(a.create("success"," 删除成功！"),i()):a.create("danger","删除失败！")})},e.is_valid=function(e){var t={id:e.id,status:1==e.status?0:1};e.btn_status2=!0,o.update_status(t,function(o){e.btn_status2=!1,o.success?(e.status=t.status,a.create("success"," 操作成功！")):a.create("danger","操作失败！")})},e.open_close=function(e){var t={id:e.id,is_enabled:1==e.is_enabled?0:1};e.btn_status=!0,o.update_status(t,function(o){e.btn_status=!1,o.success?(e.is_enabled=t.is_enabled,a.create("success"," 操作成功！")):a.create("danger","操作失败！")})}}]).controller("promiseModelEditCtrl",["$scope","$modalInstance","data","settingprimiseResource","Flash","$state",function(e,t,a,o,s,n){e.title="新增服务",a?(e.title="修改服务",e.info={id:a.id,title:a.title,logo:a.logo,content:a.content,status:a.status}):e.info={title:"",logo:"",content:"",status:""},e.cancel=function(){t.dismiss("cancel")},e.open_peerpay_status=!1,e.open_peerpay=function(){e.info.status=1==e.info.status?1:0,e.open_peerpay_status=!0,o.update(e.info,function(t){e.open_peerpay_status=!1,s.create("success"," 保存成功！")},function(t){e.open_peerpay_status=!1,s.create("danger",t.data.error.message)})},e.btn_text="保存",e.submitForm=function(n){if(n.$valid){if(""==e.info.logo)return s.create("danger","请上传LOOG"),!1;e.btn_text="保存中...",e.form.$invalid=!0,a?o.update(e.info,function(a){e.btn_text="保存",e.form.$invalid=!1,a.success?(s.create("success","编辑成功！"),t.close({status:!0})):s.create("danger","编辑失败！")}):o.add(e.info,function(a){e.btn_text="保存",e.form.$invalid=!1,a.success?(s.create("success","添加成功！"),t.close({status:!0})):s.create("danger","添加失败！")})}}}])}),define("apps/shop/controllers/shop.setting.address",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.address",["$scope","Flash","$modal","settingAddressResource","merchantSettingResource",function(e,t,a,o,s){e.allAddress=[];var n={},r=[];o.get(function(t){e.selectAddress=t.region,n=angular.copy(t.region);for(var a=e.selectAddress.region.map(function(e){return e.id}),o=(e.selectAddress.region,t.data),s=0;s<o.length;s++){var i=a.indexOf(o[s].id);i==-1&&e.allAddress.push(o[s])}r=angular.copy(e.allAddress)}),e.nowAddSelectAddress={id:"",name:""},e.nowDelSelectAddress={id:"",name:""},e.balanceClick=function(t,a,o){var s=$(t.target),n=s.hasClass("active");n?(s.siblings("li").removeClass("active"),s.removeClass("active"),0==o&&(e.nowAddSelectAddress.id="",e.nowAddSelectAddress.name=""),1==o&&(e.nowDelSelectAddress.id="",e.nowDelSelectAddress.name="")):(s.siblings("li").removeClass("active"),s.addClass("active"),0==o&&(e.nowAddSelectAddress.id=a.id,e.nowAddSelectAddress.name=a.name),1==o&&(e.nowDelSelectAddress.id=a.id,e.nowDelSelectAddress.name=a.name))},e.addAddressSave=function(a){var o=$(a.target),r=o.hasClass("disabled");if(r||""==e.nowAddSelectAddress.id)t.create("danger","请选择区域");else{var i=angular.copy(e.nowAddSelectAddress);e.nowAddSelectAddress.id="",e.nowAddSelectAddress.name="",n.region.push(i),s.update(n,function(a){if(a.success){t.create("success"," 操作成功！"),e.selectAddress=angular.copy(n);for(var o=0;o<e.allAddress.length;o++)e.allAddress[o].id==i.id&&e.allAddress.splice(o,1);
$(".balanceList-left ul li").removeClass("active")}else t.create("danger"," 操作失败！"),e.nowAddSelectAddress.id=i.id,e.nowAddSelectAddress.name=i.name})}},e.delAddressSave=function(a){var o=$(a.target),r=o.hasClass("disabled");if(r||""==e.nowDelSelectAddress.id||e.nowDelSelectAddress.id==e.selectAddress.default_region.id)""==e.nowDelSelectAddress.id||r?t.create("danger","请选择区域"):e.nowDelSelectAddress.id==e.selectAddress.default_region.id&&t.create("danger","默认国家不可以删除!");else{var i=angular.copy(e.nowDelSelectAddress);e.nowDelSelectAddress.id="",e.nowDelSelectAddress.name="",angular.forEach(e.selectAddress.region,function(e,t){e.id==i.id&&n.region.splice(t,1)}),s.update(n,function(a){a.success?(t.create("success"," 操作成功！"),e.selectAddress=angular.copy(n),e.allAddress.push(i),$(".balanceList-right ul li").removeClass("active")):(t.create("danger"," 操作失败！"),e.nowDelSelectAddress.id=i.id,e.nowDelSelectAddress.name=i.name)})}},e.setDefaultRegion=function(){var t=a.open({animation:!1,templateUrl:"assets/js/apps/shop/templates/setting.address.modal.html",controller:"setAddressModal",resolve:{data:function(){return e.selectAddress}}});t.result.then(function(t){t&&(e.selectAddress=t,n=t)})}}]),e.controller("setAddressModal",["$scope","$modalInstance","data","Flash","merchantSettingResource",function(e,t,a,o,s){e.data=a,e.but={text:"提交",status:!1},e.confirm=function(){angular.forEach(e.data.region,function(t,a){if(t.id==e.data.default_region.id)return void(e.data.default_region.name=t.name)}),e.but.text="提交中",e.but.status=!0,s.update(e.data,function(a){a.success?(o.create("success"," 操作成功！"),t.close(e.data)):o.create("danger","操作失败！"),e.but.text="提交",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/shop/controllers/shop.setting.recommend",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.recommend",["$scope","Flash","$modal","shop",function(e,t,a,o){e.shop_info={item_recommend_detail:0,item_recommend_pay:0},o.get("",function(t){e.shop_info=t}),e.btn_text="保存",e.submitForm=function(a){a&&(e.btn_text="保存中...",e.form.$invalid=!0,o.update(e.shop_info,function(a){e.btn_text="保存",t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/shop/controllers/shop.setting.dynamics",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.dynamics",["$scope","shop","Flash","$stateParams",function(e,t,a,o){e.shop_info=t.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,t.update(e.shop_info,function(o){e.shop_info=t.get(),e.btn_text="保存",a.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}))}}])}),define("apps/shop/controllers/shop.setting.fastbus.form",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.fastbus.form",["$scope","settingKefuResource","Flash","$stateParams","KefuMerInfoResource","$modalInstance",function(e,t,a,o,s,n){e.data={api_regist:!0,type:3,pwText:"登录密码",pwcheckText:"确认密码",title:"创建快商通账号",add:!0,submitText:"保存",submitDisabled:!1};var r=function(){s.get("",function(t){0==t.status&&(e.data.company=t.merchantInfo.company,e.data.compAddr=t.merchantInfo.address,e.data.linkman=t.merchantInfo.contact,e.data.phone=t.merchantInfo.mobile,e.data.weburl=t.merchantInfo.shop_url,e.data.username=t.user.username,e.data.email=t.user.email,e.data.mobile=t.user.mobile)})};r(),e.cancel=function(){n.dismiss("cancel")},e.save=function(){e.data.submitText="保存中...",e.data.submitDisabled=!0,t.post(e.data,function(t){t.success?(a.create("success"," 保存成功！"),n.close(t)):(t.msg?a.create("danger",t.msg):a.create("danger",t.msg),e.data.submitText="保存",e.data.submitDisabled=!1)},function(t){a.create("danger",t.msg),e.data.submitText="保存",e.data.submitDisabled=!1})}}])}),define("apps/shop/controllers/shop.layout",["apps/common/controllers/controllers"],function(e){e.controller("shop.layout",["$scope","$state","HotelBaseConfig","$rootScope","updateLog","getAdvUrl","$modal",function(e,t,a,o,s,n,r){e.$state=t,e.layouthotel=function(){a.post()},s.get(function(t){e.years=t.data[0].year,e.date=t.data[0].data[0].log_date}),n.get(function(t){1==t.status?e.advsurl=t.url:e.advsurl="javascript:;"})}])}),define("apps/shop/controllers/shop.setting.log",["apps/common/controllers/controllers"],function(e){e.controller("shop.setting.log",["$scope","$state","updateLog","Flash","$modal","$sce",function(e,t,a,o,s,n){e.reloadRoute=function(){a.get(function(t){e.years=t.data,angular.forEach(t.data,function(a,o){e.log=t.data[o],e.years[o].img=!0,angular.forEach(e.years[o].data,function(t,a){o===e.years.length-1&&a===e.years[o].data.length-1?e.years[o].data[a].img="h5C":e.years[o].data[a].img="";var s=e.years[o].data[a].des.replace(/\n/g,"<br />");e.years[o].data[a].des=n.trustAsHtml(s)}),0===o?(e.years[o].myVar=!0,e.years[o].img1=!0,e.years[o].img2=!1):(e.years[o].myVar=!1,e.years[o].img1=!1,e.years[o].img2=!0)})})},e.reloadRoute(),e.toggle=function(t){for(var a=0;a<e.years.length;a++)e.years[a].year==t&&(e.years[a].erji?(e.years[a].erji=!1,e.years[a].img=""):a===e.years.length-1?(e.years[a].img="border: none;",e.years[a].erji=!0):(e.years[a].img="",e.years[a].erji=!0))}}])}),define("apps/shop/controllers/_base",["apps/shop/controllers/main","apps/shop/controllers/shop.setting","apps/shop/controllers/shop.setting.kefu","apps/shop/controllers/shop.setting.promise","apps/shop/controllers/shop.setting.address","apps/shop/controllers/shop.setting.recommend","apps/shop/controllers/shop.setting.dynamics","apps/shop/controllers/shop.setting.fastbus.form","apps/shop/controllers/shop.layout","apps/shop/controllers/shop.setting.log"],function(){}),define("apps/shop/services/shop",["apps/common/services/services"],function(e){e.factory("shop",["$resource",function(e){return e("/shop.json",{},{update:{method:"PUT"}})}])}),define("apps/shop/services/main",["apps/common/services/services"],function(e){e.factory("shopResource",["$resource",function(e){return e("/stat/order/day.json",{},{update:{method:"PUT"},query:{method:"GET",isArray:!0}})}]),e.factory("baseinfoResource",["$resource",function(e){return e("/stat/shop/baseinfo.json",{},{update:{method:"PUT"}})}]),e.factory("topSalesResource",["$resource",function(e){return e("/shop/top_sales.json",{},{update:{method:"PUT"}})}]),e.factory("qrcodeResource",["$resource",function(e){return e("/shop/qrcode.json",{},{})}]),e.factory("getAdvUrl",["$resource",function(e){return e("/shop/get_advs.json",{},{})}])}),define("apps/shop/services/setting.kefu",["apps/common/services/services"],function(e){e.factory("settingKefuResource",["$resource",function(e){return e("/kefu.json",{},{post:{method:"POST",url:"/kefu.json"}})}]),e.factory("KefuMerInfoResource",["$resource",function(e){return e("/kefu_merchant_info.json",{},{get:{method:"GET",url:"/kefu_merchant_info.json"}})}])}),define("apps/shop/services/setting.promise",["apps/common/services/services"],function(e){e.factory("settingprimiseResource",["$resource",function(e){return e("/serve/servelabel/:id.json",{id:"@id"},{get:{method:"GET",url:"/serve/servelabel.json"},add:{method:"POST",url:"/serve/servelabel.json"},update:{method:"PUT",url:"/serve/servelabel/:id.json"},update_status:{method:"PUT",url:"/serve/servelabelstatus/:id.json"},del:{method:"delete",url:"/serve/servelabel/:id.json"}})}])}),define("apps/shop/services/setting.address",["apps/common/services/services"],function(e){e.factory("settingAddressResource",["$resource",function(e){return e("/region.json",{},{get:{method:"GET"}})}])}),define("apps/shop/services/mechat",["apps/common/services/services"],function(e){e.factory("mechatResource",["$resource",function(e){return e("/kefu/mechat.json",{},{update:{method:"PUT"}})}]),e.factory("mechatKefuResource",["$resource",function(e){return e("/kefu/mechat_kefu.json",{},{update:{method:"PUT"},delete:{method:"DELETE",url:"/kefu/mechat_kefu/:id.json"}})}])}),define("apps/shop/services/setting.log",["apps/common/services/services"],function(e){e.factory("updateLog",["$resource",function(e){return e("rrdlogs/logs.json",{id:"@id"},{get:{method:"GET"},add:{method:"POST",url:"merchant/rrdlogs/logs.json"},delete:{method:"DELETE",url:"merchant/rrdlogs/:id.json"},update:{method:"PUT",url:"merchant/rrdlogs/:id.json"},code:{method:"GET",url:"merchant/rrdlogs/:id.json"}})}])}),define("apps/shop/services/_base",["apps/shop/services/shop","apps/shop/services/main","apps/shop/services/setting.kefu","apps/shop/services/setting.promise","apps/shop/services/setting.address","apps/shop/services/mechat","apps/shop/services/setting.log"],function(){}),define("apps/shop/directives/mechat",["apps/common/directives/directives"],function(e){e.directive("mechatSetting",["$modal","settingKefuResource","mechatKefuResource","Flash",function(e,t,a,o){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/shop/templates/mechat.html",require:"ngModel",scope:{info:"=ngModel"},link:function(t,s,n,r){var i=!1;t.openAddModal=function(){var a=e.open({animation:i,templateUrl:"assets/js/apps/shop/templates/mechat.form.html",controller:"mechat.create",size:"big"});a.result.then(function(e){t.info.base=e,r.$setViewValue(t.info)})},t.openEditModal=function(){var a=e.open({animation:i,templateUrl:"assets/js/apps/shop/templates/mechat.form.html",controller:"mechat.edit",size:"big",resolve:{mechatData:function(){return{id:t.info.base.id,mechat_username:t.info.base.mechat_username,mechat_nickname:t.info.base.mechat_nickname}}}});a.result.then(function(e){t.info.base.mechat_nickname=e.mechat_nickname,r.$setViewValue(t.info)})},t.info.base||t.openAddModal(),t.createMechatKefu=function(){var a=e.open({animation:i,templateUrl:"assets/js/apps/shop/templates/mechat.kefu.form.html",controller:"mechat.kefu.create",size:"big",resolve:{mechat_id:function(){return t.info.base.id}}});a.result.then(function(e){t.info.kefu.push(e),r.$setViewValue(t.info)})},t.editMechatKefu=function(a,o){var s=e.open({animation:i,templateUrl:"assets/js/apps/shop/templates/mechat.kefu.form.html",controller:"mechat.kefu.edit",size:"big",resolve:{kefuData:function(){return{id:a.id,kefu_username:a.kefu_username,kefu_nickname:a.kefu_nickname}}}});s.result.then(function(e){t.info.kefu[o]=e,r.$setViewValue(t.info)})},t.deleteKefu=function(e,s){a.delete({id:e},function(e){e.status?(t.info.kefu.splice(s,1),r.$setViewValue(t.info)):e.errmsg?o.create("danger",e.errmsg):o.create("danger",e.msg)})}}}}]).controller("mechat.create",["$scope","$modalInstance","mechatResource","Flash",function(e,t,a,o){e.init={title:"创建美洽账号",add:!0,pwText:"登录密码",submitText:"保存",submitDisabled:!1},e.cancel=function(){t.dismiss("cancel")},e.save=function(){e.init.submitText="保存中...",e.init.submitDisabled=!0,a.save(e.data,function(a){a.status?(o.create("success"," 保存成功！"),t.close(a.data)):(a.errmsg?o.create("danger",a.errmsg):o.create("danger",a.msg),e.init.submitText="保存",e.init.submitDisabled=!1)},function(t){o.create("danger",t.data.error.message),e.init.submitText="保存",e.init.submitDisabled=!1})}}]).controller("mechat.edit",["$scope","$modalInstance","mechatResource","Flash","mechatData",function(e,t,a,o,s){e.data=s,e.init={title:"编辑美洽账号",edit:!0,pwText:"新密码",submitText:"保存",submitDisabled:!1},e.cancel=function(){t.dismiss("cancel")},e.save=function(){e.data.mechat_password||delete e.data.mechat_password,e.init.submitText="保存中...",e.init.submitDisabled=!0,a.update(e.data,function(a){a.status?(o.create("success"," 保存成功！"),t.close(e.data)):(a.errmsg?o.create("danger",a.errmsg):o.create("danger",a.msg),e.init.submitText="保存",e.init.submitDisabled=!1)},function(t){o.create("danger",t.data.error.message),e.init.submitText="保存",e.init.submitDisabled=!1})}}]).controller("mechat.kefu.create",["$scope","$modalInstance","mechatKefuResource","Flash","mechat_id",function(e,t,a,o,s){e.data={mechat_id:s},e.init={title:"创建客服账号",add:!0,pwText:"登录密码",submitText:"保存",submitDisabled:!1},e.cancel=function(){t.dismiss("cancel")},e.save=function(){e.init.submitText="保存中...",e.init.submitDisabled=!0,a.save(e.data,function(a){a.status?(o.create("success"," 保存成功！"),t.close(a.data)):(a.errmsg?o.create("danger",a.errmsg):o.create("danger",a.msg),e.init.submitText="保存",e.init.submitDisabled=!1)})}}]).controller("mechat.kefu.edit",["$scope","$modalInstance","mechatKefuResource","Flash","kefuData",function(e,t,a,o,s){e.data=s,e.init={title:"编辑客服账号",edit:!0,pwText:"新密码",submitText:"保存",submitDisabled:!1},e.cancel=function(){t.dismiss("cancel")},e.save=function(){e.data.kefu_password||delete e.data.kefu_password,e.init.submitText="保存中...",e.init.submitDisabled=!0,a.update(e.data,function(a){a.status?(o.create("success"," 修改成功！"),t.close(a.data)):(a.errmsg?o.create("danger",a.errmsg):o.create("danger",a.msg),e.init.submitText="保存",e.init.submitDisabled=!1)})}}])}),define("apps/shop/directives/_base",["apps/shop/directives/mechat"],function(){}),define("apps/shop/main",["apps/shop/states/_base","apps/shop/controllers/_base","apps/shop/services/_base","apps/shop/directives/_base"],function(){}),define("apps/goods/states/auction",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods",{url:"/goods",templateUrl:"assets/js/apps/goods/templates/layout.html"}).state("shop.goods.auction",{abstract:!0,url:"/auction",template:"<div ui-view></div>"}).state("shop.goods.auction.list",{url:"?callback",templateUrl:"assets/js/apps/goods/templates/auction.html",controller:"shop.goods.auction"}).state("shop.goods.auction.comments",{url:"/add",templateUrl:"assets/js/apps/goods/templates/comments.add.html",controller:"shop.goods.auction.comments.add"}).state("shop.goods.auction.edit",{url:"/edit",templateUrl:"assets/js/apps/goods/templates/comments.edit.html",controller:"shop.goods.auction.comments.edit"})}])}),define("apps/goods/states/add",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods.add",{abstract:!0,url:"/add",template:"<div ui-view></div>"}).state("shop.goods.add.step",{controller:"shop.goods.form",url:"/step/:step",templateUrl:"assets/js/apps/goods/templates/form.html"})}])}),define("apps/goods/states/edit",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods.edit",{abstract:!0,url:"/edit",template:"<div ui-view></div>"}).state("shop.goods.edit.step",{controller:"shop.goods.form",url:"/:id/step/:step?type",templateUrl:"assets/js/apps/goods/templates/form.html"})}])}),define("apps/goods/states/forsale",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods.forsale",{abstract:!0,url:"/forsale",template:"<div ui-view></div>"}).state("shop.goods.forsale.list",{url:"?callback",templateUrl:"assets/js/apps/goods/templates/forsale.html",controller:"shop.goods.forsale"})}])}),define("apps/goods/states/material",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods.material",{abstract:!0,url:"/material",template:"<div ui-view></div>"}).state("shop.goods.material.list",{url:"/:type",controller:"shop.goods.material",templateUrl:"assets/js/apps/goods/templates/material.html"}).state("shop.goods.material.edit",{url:"/edit/:id/step/:step",controller:"shop.goods.material.edit",templateUrl:"assets/js/apps/goods/templates/material.edit.html"})}])}),define("apps/goods/states/soldout",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods.soldout",{abstract:!0,url:"/soldout",template:"<div ui-view></div>"}).state("shop.goods.soldout.list",{url:"?callback",templateUrl:"assets/js/apps/goods/templates/soldout.html",controller:"shop.goods.soldout"})}])}),define("apps/goods/states/onekeyremove",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.goods.onekeyremove",{abstract:!0,url:"/onekeyremove",template:"<div ui-view></div>"}).state("shop.goods.onekeyremove.step",{url:"/step/:step",templateUrl:"assets/js/apps/goods/templates/onekeyremove.html",controller:"onekeyremoveCtrl"})}])}),define("apps/goods/states/_base",["apps/goods/states/auction","apps/goods/states/add","apps/goods/states/edit","apps/goods/states/forsale","apps/goods/states/material","apps/goods/states/soldout","apps/goods/states/onekeyremove"],function(){}),define("apps/goods/controllers/auction",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.auction",["$scope","$stateParams","$filter","ngPopover","Flash","goodsResource","tagResource","$modal","listBackParams",function(e,t,a,o,s,n,r,i,c){var l=10,d=!1;e.params={offset:0,limit:l,title:"",sale:1,column:"created_at",direction:"desc"},e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){o.close()},e.cancel=function(){o.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var o={id:a};o[e]=t,n.editField(o,function(e){e.success?s.create("success","保存成功"):s.create("danger",e.error)})},e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.setting={},e.setting.is_discount=1,e.$watch("search.params",function(t){t&&!d&&(1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1)},!0),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),p()},e.confirmDelete=function(e){n.delete({id:e},function(e){e.success?p():s.create("danger","删除失败")})},e.confirmBatchDelete=function(){n.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(p(),e.goods.checkedAll=!1):s.create("danger","删除失败")})},e.confirmBatchOffSale=function(){n.batchToggleSale({ids:e.selectedIds,sale:0},function(t){t.success?(p(),e.goods.checkedAll=!1):s.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){n.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),o.close(),s.create("success","分组成功")):s.create("danger","分组失败"),e.selectedTagIds=[]})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){n.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","区域设置成功")):s.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){n.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","设置成功")):s.create("danger","设置失败")}),o.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]});var p=function(){if(e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.search.params){e.params.goods_tag_id=e.search.params.tag.id;for(var t in e.search.params.types)delete e.params[e.search.params.types[t]];e.search.params.input&&(e.params[e.search.params.type.type]=e.search.params.input)}c.set({page:e.paginationConf.currentPage,search:e.search},"GoodsAuction"),n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data}),d=!1};if(e.$watch("paginationConf.currentPage",p),"1"==t.callback){d=!0;var u=c.get("GoodsAuction");e.search=u&&u.search?u.search:{},e.paginationConf={itemsPerPage:l,currentPage:u?u.page:1}}else e.paginationConf={itemsPerPage:l,currentPage:1},e.search={};e.setArea=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"},region_id:function(){},old_region:function(){}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/goods_tpl.html",controller:"shop.goods.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/price_tpl.html",controller:"shop.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){p()})},e.setProductStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/stock_tpl.html",controller:"shop.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){p()})},e.showQrcode=function(t){n.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){o.close(),s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/goods/controllers/auction.comments.add",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.auction.comments.add",["$scope","Flash","$location","setComments","$timeout","$stateParams","goodsPropsList",function(e,t,a,o,s,n,r){e.access=!1,e.param={content:"好评，非常棒！！！"},e.images={},o.get({id:a.search().id},function(t){e.virtual_info=t}),r.get({id:a.search().id},function(t){e.goods_info=t}),e.selectPorps=function(e,t){$(".props-list[data-id="+e+"] button").each(function(e){$(this).css({"border-color":"#ccc"}),$(this).removeClass("select")}),$(".btn-props[data-id="+t+"]").css({"border-color":"#FB5300",background:"#fff"}),$(".btn-props[data-id="+t+"]").addClass("select")},e.setTextarea=function(){"好评，非常棒！！！"==e.param.content&&(e.param.content="")},e.backTextarea=function(){e.param.content||(e.param.content="好评，非常棒！！！"),e.param.content.length>200&&(t.create("danger","评论内容不能超过200字！"),e.param.content=e.param.content.substr(0,200))},e.star=function(t){e.param.score=t;var a=angular.element(document.getElementById("showb"));a.css({width:24*t})},e.star(5),e.submitForm=function(){e.param.images=[];for(var n in e.images)e.param.images.push(e.images[n]);if(e.param.id=a.search().id,e.param.add="add",!e.selected)return void t.create("danger"," 请选择虚拟人物");e.param.nick_id=e.selected.id;var r=[],i=[];for(prop in e.goods_info.props)i.push(prop);if(1==e.goods_info.is_sku&&$("button.select").length<i.length)return void t.create("danger"," 请选择商品属性");if($("button.select").each(function(e){r.push($(this).text())}),e.param.props=r.join(":"),e.param.is_sku=e.goods_info.is_sku,!e.param.created_at)return void t.create("danger","请选择评论时间");var c=new Date(e.param.created_at).getTime(),l=(new Date).getTime();return c>l?(t.create("danger","评论时间应早于当前时间"),void $("input[name=created_at]").focus()):(e.access=!0,void o.post(e.param,function(o){o.status?(t.create("success"," 保存成功！"),s(function(){_global.shop.supplier_id>0?0==_global.shop.supplier_level?a.path("/distributor/auction/list"):a.path("/supplier/auction"):a.path("/shop/goods/auction")},1500)):(t.create("danger"," 保存失败！"),e.access=!1)},function(a){t.create("danger"," 保存失败！"),e.access=!1}))}}])}),define("apps/goods/controllers/auction.comments.edit",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.auction.comments.edit",["$scope","Flash","$location","setComments","$timeout","$stateParams","goodsPropsList","goodsCommentsList","updateCommentsList","$state",function(e,t,a,o,s,n,r,i,c,l){var d,p=a.search();e.access=!1,e.param={},e.selectPorps=function(e,t){$(".props-list[data-id="+e+"] button").each(function(e){$(this).css({"border-color":"#ccc"}),$(this).removeClass("select")}),$(".btn-props[data-id="+t+"]").css({"border-color":"#FB5300",background:"#fff"}),$(".btn-props[data-id="+t+"]").addClass("select")},e.backTextarea=function(){e.param.content||(e.param.content="好评，非常棒！！！"),e.param.content.length>200&&(t.create("danger","评论内容不能超过200字！"),e.param.content=e.param.content.substr(0,200))},e.star=function(t){e.param.score=t;var a=angular.element(document.getElementById("showb"));a.css({width:24*t})},r.get({id:p.goodsid},function(t){e.goods_info=t,i.get({id:p.id,goodsid:p.goodsid},function(t){d=t.data.member,e.param.content=t.data[0].content,e.param.created_at=t.data[0].created_at,e.param.image=[],e.star(t.data[0].score);for(var a=t.data[0].props,s=a.split(":"),n=0;n<s.length;n++)$(".props-list[data-num="+n+"] button").each(function(e){$(this).text()==s[n]&&$(this).addClass("select").css({"border-color":"#FB5300",background:"#fff"})});for(var n=0;n<t.img.length;n++)e.param.image.push(t.img[n]);o.get({id:p.goodsid},function(t){e.virtual_info=t;for(var a=0;a<t.virtual.length;a++)t.virtual[a].id==d.id&&(e.selected=t.virtual[a])})})}),e.submitForm=function(){e.param.id=p.id,e.param.goodsid=p.goodsid,e.param.edit="edit",e.param.nick_id=e.selected.id;var a=[];$("button.select").each(function(e){a.push($(this).text())}),e.param.props=a.join(":");var o=new Date(e.param.created_at).getTime(),n=(new Date).getTime();return o>n?(t.create("danger","评论时间应早于当前时间"),void $("input[name=created_at]").focus()):(e.access=!0,void c.put(e.param,function(a){a.status?(t.create("success"," 保存成功！"),s(function(){history.go(-1)},1500)):(t.create("danger"," 保存失败！"),e.access=!1)},function(a){t.create("danger"," 保存失败！"),e.access=!1}))}}])}),define("apps/goods/controllers/forsale",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.forsale",["$scope","$stateParams","$filter","ngPopover","Flash","goodsResource","tagResource","$modal","listBackParams",function(e,t,a,o,s,n,r,i,c){var l=10,d=!1;e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){o.close()},e.cancel=function(){o.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var o={id:a};o[e]=t,n.editField(o,function(e){e.success?s.create("success","保存成功"):s.create("danger",e.error)})},e.goods={checkedAll:!1},e.tab=0,e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.setting={},e.setting.is_discount=1,e.params={offset:0,limit:l,title:"",sale:0,column:"created_at",direction:"desc"},e.$watch("search.params",function(t){t&&!d&&(1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1)},!0),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),p()},e.confirmDelete=function(e){n.delete({id:e},function(e){e.success?p():s.create("danger","删除失败")})},e.confirmOnSale=function(e){n.onSale({id:e,sale:1},function(e){e.success?p():s.create("danger","上架失败")})},e.confirmBatchDelete=function(){n.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(p(),e.goods.checkedAll=!1):s.create("danger","删除失败")})},e.confirmBatchOnSale=function(){n.batchToggleSale({ids:e.selectedIds,sale:1},function(t){t.success?(p(),e.goods.checkedAll=!1):s.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){n.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(p(),e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),o.close(),s.create("success","分组成功")):s.create("danger","分组失败"),e.selectedTagIds=[]})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){n.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","区域设置成功")):s.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){n.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","设置成功")):s.create("danger","设置失败")}),o.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]}),e.toggleTab=function(t){e.tab=t,1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1};var p=function(){if(e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.search.params){e.params.goods_tag_id=e.search.params.tag.id;for(var t in e.search.params.types)delete e.params[e.search.params.types[t]];e.search.params.input&&(e.params[e.search.params.type.type]=e.search.params.input)}0==e.tab?(delete e.params.stock,delete e.params.onsale_type):1==e.tab?(delete e.params.onsale_type,e.params.stock=0):2==e.tab&&(delete e.params.stock,e.params.onsale_type=1),c.set({page:e.paginationConf.currentPage,search:e.search},"GoodsForsale"),n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data}),d=!1};if(e.search=function(){1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),"1"==t.callback){d=!0;var u=c.get("GoodsForsale");e.search=u&&u.search?u.search:{},e.paginationConf={itemsPerPage:l,currentPage:u?u.page:1}}else e.paginationConf={itemsPerPage:l,currentPage:1},e.search={};e.setArea=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"},region_id:function(){},old_region:function(){}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/goods_tpl.html",controller:"shop.goods.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/price_tpl.html",controller:"shop.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){p()})},e.setProductStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/stock_tpl.html",controller:"shop.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){p()})}}])}),define("apps/goods/controllers/soldout",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.soldout",["$scope","$stateParams","$filter","ngPopover","Flash","goodsResource","merchantSettingResource","tagResource","$modal","listBackParams",function(e,t,a,o,s,n,r,i,c,l){var d=10,p=!1;e.title="库存紧张商品",e.setting={},e.setting.warningStock=10,e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.setting={},e.setting.is_discount=1,e.params={offset:0,limit:d,title:"",stock:e.setting.warningStock,sale:1,column:"created_at",direction:"desc"},e.$watch("search.params",function(t){t&&!p&&(1==e.paginationConf.currentPage?u():e.paginationConf.currentPage=1)},!0),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),u()},e.confirmDelete=function(e){n.delete({id:e},function(e){e.success?u():s.create("danger","删除失败")})},e.confirmBatchDelete=function(){n.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(u(),e.goods.checkedAll=!1):s.create("danger","删除失败")})},e.confirmBatchOffSale=function(){n.batchToggleSale({ids:e.selectedIds,sale:0},function(t){t.success?(u(),e.goods.checkedAll=!1):s.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){n.batchTag({tag_ids:e.selectedTagIds,
goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),o.close(),s.create("success","分组成功")):s.create("danger","分组失败"),e.selectedTagIds=[]})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){n.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","区域设置成功")):s.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){n.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","设置成功")):s.create("danger","设置失败")}),o.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]}),e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var o={id:a};o[e]=t,n.editField(o,function(e){e.success?s.create("success","保存成功"):s.create("danger",e.error)})},e.save=function(){r.save({warning_stock:e.setting.warningStock},function(e){e.success?(u(),s.create("success","设置成功"),l.set({page:1,search:null},"GoodsSoldout")):s.create("danger","设置失败")}),o.close()},e.cancel=function(){o.close()},e.setting.warningStock=_global.setting?_global.setting.warning_stock:10;var u=function(){if(e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.search.params){e.params.goods_tag_id=e.search.params.tag.id;for(var t in e.search.params.types)delete e.params[e.search.params.types[t]];e.search.params.input&&(e.params[e.search.params.type.type]=e.search.params.input)}e.params.stock=e.setting.warningStock,_global.setting.warning_stock=e.setting.warningStock,l.set({page:e.paginationConf.currentPage,search:e.search},"GoodsSoldout"),n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data}),p=!1};if(e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",u),"1"==t.callback){p=!0;var m=l.get("GoodsSoldout");e.search=m&&m.search?m.search:{},e.paginationConf={itemsPerPage:d,currentPage:m?m.page:1}}else e.paginationConf={itemsPerPage:d,currentPage:1},e.search={};e.search=function(){1==e.paginationConf.currentPage?u():e.paginationConf.currentPage=1},e.setArea=function(){var t=c.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"},region_id:function(){},old_region:function(){}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=c.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/goods_tpl.html",controller:"shop.goods.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/price_tpl.html",controller:"shop.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.setProductStock=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/stock_tpl.html",controller:"shop.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.showQrcode=function(t){n.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){o.close(),s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/goods/controllers/form",["apps/common/controllers/controllers"],function(controllers){controllers.controller("shop.goods.form",["$location","$scope","$stateParams","$compile","$state","Flash","$modal","ngPopover","GoodsData","shopServerData","catResource","propResource","propValueResource","tagResource","shipmentResource","goodsResource","designData","designGoodsRes","$timeout","designValidate",function($location,$scope,$stateParams,$compile,$state,Flash,$modal,ngPopover,GoodsData,shopServerData,catResource,propResource,propValueResource,tagResource,shipmentResource,goodsResource,designData,designGoodsRes,$timeout,designValidate){$scope.setNoDeliveryArea=function(){var e=$modal.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"设置不可配送地区"},region_id:function(){return vm.goodsData.noDeliveryArea.region_ids.join(",")},old_region:function(){}}});e.result.then(function(e){vm.goodsData.noDeliveryArea.region_ids=""!=e.region_id?e.region_id.split(","):[],vm.goodsData.noDeliveryArea.region_names=e.region_name})};var shopServer=shopServerData.get();shopServer.then(function(e){$scope.shopServerData=e});var vm=$scope.vm={},step=$stateParams.step;switch(vm.cates=[],vm.activeTab=step,$scope.isGetProp=!1,$scope.isShow=!1,$scope.isVirtual=!1,vm.goodsData=GoodsData,angular.isDefined($stateParams.id)?(vm.is_edit=!!$stateParams.id,vm.goodsData.isStep||(angular.forEach(GoodsData.init(),function(e,t){vm.goodsData[t]=e}),goodsResource.get({id:$stateParams.id},function(e){e.regions&&(angular.forEach(e.regions,function(e,t){vm.goodsData.noDeliveryArea.region_ids.push(e.id),vm.goodsData.noDeliveryArea.region_names+=e.name+","}),vm.goodsData.noDeliveryArea.region_names=vm.goodsData.noDeliveryArea.region_names.substr(0,vm.goodsData.noDeliveryArea.region_names.length-1)),$scope.cateData={},$scope.cateData.mall_category_id=e.mall_category_id,$scope.cateData.mall_cat_name=e.mall_cat_name,vm.goodsData.cate[0]={},vm.goodsData.cate[0].data={},vm.goodsData.isCateSelect=!0,vm.goodsData.cate[0].data.id=e.goods_cat_id,vm.goodsData.cate[0].data.is_virtual=e.is_virtual,vm.goodsData.cate[0].data.is_hexiao=e.is_hexiao,vm.goodsData.cate[0].data.name=e.cat_name,$scope.isGetProp||$scope.getProp();var t=$scope.$watch("vm.goodsData.prop",function(a,o){a.length>0&&(t(),angular.forEach(e.props,function(e,t){for(var a in vm.goodsData.prop){var o=vm.goodsData.prop[a];if(e.id==o.id)return vm.goodsData.props[a]={id:e.prop_vid,merchant_id:e.merchant_id,prop_id:e.id,value:e.prop_value},!1}}))},!0);vm.goodsData.title=e.title,angular.forEach(e.imgs,function(e,t){vm.goodsData.imgs[t]={id:e.id,url:e.img}}),vm.goodsData.selectedGoodsTags=angular.copy(e.tags),vm.goodsData.serve_label=e.serve_label,vm.goodsData.label_ids=e.label_ids;for(var a=0;a<e.label_ids.length;a++)for(var o=0;o<$scope.shopServerData.length;o++)e.label_ids[a]==$scope.shopServerData[o].id&&($scope.shopServerData[o].checked=!0);if(vm.goodsData.is_sku=e.is_sku,vm.goodsData.is_discount=e.is_discount||0,vm.goodsData.is_givecredit=e.is_givecredit||1,vm.goodsData.goods_sn=e.goods_sn,vm.goodsData.barcode=e.barcode,vm.goodsData.is_virtual=e.is_virtual,vm.goodsData.virtual_card_type=e.virtual_card_type,vm.goodsData.is_autosend=e.is_autosend,vm.goodsData.is_verify_card=e.is_verify_card,vm.goodsData.is_hexiao=e.is_hexiao,vm.goodsData.hx_type=e.goods_hexiao_data.hx_type,vm.goodsData.hx_store_type=e.goods_hexiao_data.hx_store_type,vm.goodsData.hx_store=e.goods_hexiao_data.hx_store,vm.goodsData.hx_code_type=e.goods_hexiao_data.hx_code_type,vm.goodsData.hx_code_time=e.goods_hexiao_data.hx_code_time||"",vm.goodsData.hx_intro=e.goods_hexiao_data.hx_intro,$timeout(function(){var t=e.goods_hexiao_data.hx_stime,a=e.goods_hexiao_data.hx_etime,o=""+t+"/"+a;$('input[name="hx_time"]').attr("value",o)},300),1==e.goods_hexiao_data.hx_store_type&&(vm.goodsData.hx_store=e.goods_hexiao_data.hx_store,vm.goodsData.hx_store_name=e.goods_hexiao_data.hx_store_name),e.is_sku){var s=e.products[0].props.split(";").length,n=[];vm.goodsData.skuStock[s]={},angular.forEach(e.products,function(e,t){var a=e.props;vm.goodsData.skuStock[s][a]={id:e.id,img:e.img,price:e.price,stock:e.stock,product_sn:e.product_sn,barcode:e.barcode},vm.goodsData.skuStock[s][a].str=e.porps_str;var o="";angular.forEach(a.split(";"),function(e,t){o+=e.split(":").join("")}),vm.goodsData.skuStock[s][a].sn=o,n.push(e.props)});var r=n.join(";")+";",i=[],c=$scope.$watch("vm.goodsData.skus",function(e,t){e.length>0&&c(),angular.forEach(vm.goodsData.skus,function(e,t){i=[],angular.forEach(e.prop_values,function(t,a){r.indexOf(e.id+":"+t.id+";")!=-1&&(t.checked=!0,i.push(t))}),i.length>0&&vm.goodsData.skuData.push(i)})},!0)}else vm.goodsData.price=e.price,vm.goodsData.stock=e.stock,vm.goodsData.old_stock=e.stock;if(vm.goodsData.old_products=e.products,vm.goodsData.old_props=e.props,vm.goodsData.original_price=e.original_price,vm.goodsData.shipmentType=0!=e.shipment_id?1:0,vm.goodsData.shipmentType){var l=$scope.$watch("vm.goodsData.shipments",function(t,a){angular.forEach(t,function(t,a){t.id==e.shipment_id&&(vm.goodsData.shipment=t,l())})});vm.goodsData.weight=e.weight,vm.goodsData.volume=e.volume}else vm.goodsData.postage=e.postage;vm.goodsData.stockType=e.stock_type,angular.forEach(e.collect_fields,function(e,t){vm.goodsData.collect_fields.push({name:e.name,type:e.type,multiple:!!e.multiple,required:!!e.required})}),vm.goodsData.intro=e.intro,vm.goodsData.components_data=e.components_data,vm.goodsData.designGoodsTpl=e.design_goods_id,vm.goodsData.onsale_type=e.onsale_type,vm.goodsData.onsale_type&&(vm.goodsData.onsale_at=e.onsale_at),vm.goodsData.cquota=e.cquota,vm.goodsData.base_csale=e.base_csale},function(e){}))):(1==$stateParams.step&&(vm.goodsData.virtual_card_type=1,vm.goodsData.is_autosend=0,vm.goodsData.is_verify_card=0),vm.goodsData.isStep||angular.forEach(GoodsData.init(),function(e,t){vm.goodsData[t]=e})),vm.goodsData.isStep=!1,vm.click={addProp:!1,addPropValue:!1,addSku:!1,editSku:!1},vm.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],$scope.shopServerClick=function(e){var t=vm.goodsData.label_ids.indexOf(e.id);t>-1?(vm.goodsData.label_ids.splice(t,1),e.checked=!1):(vm.goodsData.label_ids.push(e.id),e.checked=!0)},$scope.ngPopoverClose=function(){ngPopover.close()},$scope.nextStep=function(e){switch(vm.goodsData.isStep=!0,e){case 1:angular.isUndefined($stateParams.id)?$state.go("shop.goods.add.step",{step:e}):Flash.create("danger","商品编辑暂不支持修改类目");break;case 2:$scope.saveValidity(1)&&(angular.isDefined($stateParams.id)?(goodsResource.get({id:$stateParams.id},function(e){$scope.cateData={},$scope.cateData.mall_category_id=e.mall_category_id,$scope.cateData.mall_cat_name=e.mall_cat_name},function(e){}),$state.go("shop.goods.edit.step",{id:$stateParams.id,step:e})):($state.go("shop.goods.add.step",{step:e}),1==vm.goodsData.cate[0].data.is_virtual&&($scope.isVirtual=!0),1==vm.goodsData.cate[0].data.is_hexiao&&($scope.is_hexiao=!0)));break;case 3:$scope.saveValidity(2)&&(angular.isDefined($stateParams.id)?$state.go("shop.goods.edit.step",{id:$stateParams.id,step:e}):$state.go("shop.goods.add.step",{step:e}))}},$scope.getProp=function(){$scope.isGetProp=!0,propResource.get({goods_cat_id:vm.goodsData.cate[vm.goodsData.cate.length-1].data.id},function(e,t){if(Object.keys(e).length>2)for(var a=0;a<Object.keys(e).length-2;a++)0==e[a].type?vm.goodsData.prop.push(e[a]):vm.goodsData.skus.push(e[a])})},$scope.showAdd=function(e){$(".input-"+e+"-name").val(""),vm.showValue[e]=!vm.showValue[e]},$scope.addProp=function(e){if(GoodsData.cate.length>0){var t=$.trim($("#input-addProp-name").val()),a=$.trim($("#input-addProp-value").val());""!=t?""!=a?(vm.click.addProp=!0,$(e.currentTarget).addClass("btn-submiting-sm"),propResource.save({name:t,input_value:a,goods_cat_id:GoodsData.cate[GoodsData.cate.length-1].data.id,type:0},function(t){Flash.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),t.inputValues=t.input_values,t.input_values=[],t.input_values.push(t.inputValues),GoodsData.prop.push(t),vm.goodsData.prop=GoodsData.prop,vm.goodsData.props[vm.goodsData.prop.length-1]=t.inputValues,vm.showValue.addProp=!1,vm.click.addProp=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addProp=!1})):Flash.create("warning","请填写属性值"):Flash.create("warning","请填写属性名称")}else Flash.create("warning","请先选择品类")},$scope.deleteProp=function(){vm.deletePropID?propResource.delete({id:vm.deletePropID},function(e){if(e.success){Flash.create("success","删除成功"),vm.goodsData.prop.splice(vm.deletePropIndex,1);for(var t=vm.deletePropIndex+1;t<vm.goodsData.prop.length+1;t++)vm.goodsData.props[t]&&(vm.goodsData.props[t-1]=vm.goodsData.props[t]);$scope.ngPopoverClose()}else Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","无法获取到属性ID")},$scope.addPropValue=function(e){var t=$.trim($("#input-addProp-name-pop").val());""!=t?vm.addPropValueID?($(e.currentTarget).addClass("btn-submiting-sm"),vm.click.addPropValue=!0,propValueResource.save({value:t,prop_id:vm.addPropValueID},function(e){vm.goodsData.prop[vm.addPropValueIndex].input_values.push(e),vm.goodsData.props[vm.addPropValueIndex]=e,$scope.ngPopoverClose(),vm.click.addPropValue=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addPropValue=!1})):Flash.create("warning","无法获取到属性ID"):Flash.create("warning","请填写属性值内容")},$scope.deletePropValue=function(e,t,a){t.stopPropagation(),propValueResource.delete({id:e},function(t){t.success?angular.forEach(vm.goodsData.prop,function(t,o){if(t.id==a)return angular.forEach(t.input_values,function(t,a){if(t.id==e)return vm.goodsData.prop[o].input_values.splice(a,1),"undefined"!=typeof vm.goodsData.props[o]&&vm.goodsData.props[o].id==e&&delete vm.goodsData.props[o],!1}),!1}):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)})},$scope.getTags=function(){tagResource.get({},function(e){e._count>0?angular.forEach(e.data,function(e,t){GoodsData.tags.push(e)}):GoodsData.tags=[],vm.goodsData.tags=GoodsData.tags},function(e){Flash.create("danger",e.data.error.message)})},$scope.addTag=function(){var e=$.trim($("#input-addTag-name-pop").val());""!=e?tagResource.save({name:e},function(e){Flash.create("success","操作成功"),vm.goodsData.tags.push(e),vm.goodsData.selectedGoodsTags.push(e),$scope.ngPopoverClose()},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","请填写分组名称")},$scope.addTempSkuValue=function(e,t){if(t&&13!=e.keyCode)return!1;var a=$.trim($("#input-addSku-value").val()),o=!1;""!=a?(angular.forEach(vm.skuValueTemp,function(e,t){if(e==a)return o=!0,!1}),o?Flash.create("danger","输入的规格值已存在"):(vm.skuValueTemp.push(a),$("#input-addSku-value").val(""))):Flash.create("warning","规格值名称不能为空")},$scope.deleteTempSkuValue=function(e){vm.skuValueTemp.splice(e,1)},$scope.addSku=function(e){if(GoodsData.cate.length>0){var t={name:$.trim($("#input-addSku-name").val()),goods_cat_id:GoodsData.cate[GoodsData.cate.length-1].data.id,prop_value:vm.skuValueTemp,type:1};""!=t.name?t.prop_value.length>0?(vm.click.addSku=!0,propResource.save(t,function(e){vm.goodsData.skus.push(e),vm.showValue.addSku=!1,vm.click.addSku=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addSku=!1})):Flash.create("warning","至少添加一个规格值"):Flash.create("warning","规格名称不能为空")}else Flash.create("warning","请先选择品类")},$scope.openEditSku=function(e){vm.skuEditTemp[e]=jQuery.extend(!0,{},vm.goodsData.skus[e])},$scope.editAddTempSkuValue=function(e,t,a){if(a&&13!=t.keyCode)return!1;var o=$.trim($("#input-editAddSku-value-"+e).val()),s=!1;""!=o?(angular.forEach(vm.skuEditTemp[e].prop_values,function(e,t){if(e.name==o)return s=!0,!1}),s?Flash.create("danger","输入的规格值已存在"):(vm.skuEditTemp[e].prop_values.push({name:o}),$("#input-editAddSku-value-"+e).val(""))):Flash.create("warning","规格值名称不能为空")},$scope.deleteEditTempSkuValue=function(e,t){var a=$(t.currentTarget).parent("label").data("pid");vm.skuEditTemp[a].prop_values[e].id&&(vm.skuEditTemp[a].is_del=vm.skuEditTemp[a].is_del?++vm.skuEditTemp[a].is_del:1),vm.skuEditTemp[a].prop_values.splice(e,1)},$scope.editSku=function(e,t){var a="";if(a=0!=vm.skuEditTemp[t].merchant_id?vm.skuEditTemp[t].name=$.trim($("#input-editSku-name-"+vm.skuEditTemp[t].id).val()):vm.skuEditTemp[t].name,vm.skuEditTemp[t].is_del){var o=Utils.confirm("您删除的已有属性值将可能影响到店铺中的其他商品规格");if(!o)return}$(e.currentTarget).addClass("btn-submiting-sm"),vm.click.editSku=!0,propResource.update({id:vm.skuEditTemp[t].id,name:a,prop_values:vm.skuEditTemp[t].prop_values},function(o){o.success?(Flash.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),vm.showValue.editSku[t]=!1,vm.goodsData.skus[t].name=a,angular.forEach(o.data,function(e,a){angular.forEach(vm.goodsData.skus[t].prop_values,function(t,a){e.id==t.id&&t.checked&&(e.checked=!0)})}),vm.goodsData.skus[t].prop_values=o.data):Flash.create("danger",o.error),vm.click.editSku=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.editSku=!1})},$scope.deleteSku=function(){vm.deleteSkuID?propResource.delete({id:vm.deleteSkuID},function(e){e.success?(vm.goodsData.skus.splice(vm.deleteSkuIndex,1),$scope.ngPopoverClose(),$(".sku-list").eq(vm.deleteSkuIndex).remove(),$scope.skuSelect()):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","无法获取到属性ID")},$scope.$watch("vm.goodsData.skus",function(e,t){if(e.length>0){vm.goodsData.skuData=[],vm.goodsData.skuThead=[],$(".sku-list").each(function(){var e=[],t=$(this).index();$(this).children(".sku-tree").children("li").each(function(){$(this).children(".checkbox").children("label").children("input[type='checkbox']").is(":checked")&&e.push(vm.goodsData.skus[t].prop_values[$(this).index()])}),e.length>0&&(vm.goodsData.skuData.push(e),vm.goodsData.skuThead.push(vm.goodsData.skus[t]))}),angular.forEach(vm.goodsData.skuStock[vm.goodsData.skuData.length],function(e,t){e.checked=!1});var a=$scope.renderTable(),o=$(".js-sku-table");o.html(a),$compile(o)($scope)}},!0),$scope.renderTable=function(){var e="";return e+=$scope.renderHeader(),e+=$scope.renderBody(),e+=$scope.renderFooter(),e},$scope.renderHeader=function(){var e="";return angular.forEach(vm.goodsData.skuThead,function(t,a){e+="<td>"+t.name+"</td>"}),"<thead><tr>"+e+'<td>商品图片</td></td><td>价格</td><td>库存</td><td>商家编码</td><td>条形码</td><td width="80">批量操作</td></tr></thead>'},$scope.renderBody=function(){return vm.combine=$scope.calcCombine(vm.goodsData.skuData),$scope.generateRows()},$scope.renderFooter=function(){return""},$scope.calcCombine=function(e){for(var t=[],a=e.length,o=0;a>o;o++){t[o]=1;for(var s=o+1;a>s;s++)t[o]=t[o]*e[s].length}return t},$scope.generateRows=function(){return vm.tableHtml="<tbody>",vm.outputTrTag=0,vm.trIndex=0,vm.skuStringArr=[],vm.skuStringArrNum=[],vm.skuStringArrStr=[],$scope.printRow(0,vm.outputTrTag),vm.tableHtml+"</tbody>"},$scope.printRow=function(e,t){var a=vm.goodsData.skuData,o=a.length;return e!==o&&void(a[e]&&angular.forEach(a[e],function(a,s){if(vm.skuStringArr[e]=a.prop_id+":"+a.id,vm.skuStringArrNum[e]=a.prop_id.toString()+a.id.toString(),vm.skuStringArrStr[e]=a.name,t||(vm.tableHtml+="<tr class='js-sku-content'>",t=1),vm.tableHtml+='<td data-atom-id="'+a.id+'" rowspan="'+vm.combine[e]+'">'+a.name+"</td>",e==o-1){var n=vm.skuStringArr.join(";"),r=vm.skuStringArrNum.join(""),i=vm.skuStringArrStr.join(":"),c=$scope.getAtomStockData(o,n);vm.tableHtml+='<td data-atom-id="'+a.id+'"><div class="thumbnail no-margin" style="width: 80px;height: 80px;" choice-image src="vm.goodsData.skuStock[\''+vm.goodsData.skuData.length+"']['"+n+"'].img\"></div></td>",vm.tableHtml+=$scope.tdTemplate(c,n,r)+"</tr>",vm.trIndex+=1,t=0,"undefined"==typeof vm.goodsData.skuStock[o]&&(vm.goodsData.skuStock[o]={}),"undefined"==typeof vm.goodsData.skuStock[o][n]?vm.goodsData.skuStock[o][n]={id:0,img:"",price:"",stock:"",product_sn:"",sn:r,barcode:"",str:i}:vm.goodsData.skuStock[o][n].str=i,vm.goodsData.skuStock[o][n].checked=!0}var l=e+1;$scope.printRow(l,t)}))},$scope.getAtomStockData=function(e,t){return angular.isUndefined(vm.goodsData.skuStock[e])||angular.isUndefined(vm.goodsData.skuStock[e][t])?{id:0,price:"",stock:"",product_sn:"",barcode:"",str:""}:vm.goodsData.skuStock[e][t]},$scope.tdTemplate=function(e,t,a){var o=vm.goodsData.skuData.length,s="has-error";return'<td><div class="validator-form" ng-class="{\''+s+"': form.sku_price_"+a+".$invalid && form.sku_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm sku-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].price" type="text" name="sku_price_'+a+'" value="'+e.price+'" /></div></td><td><div class="validator-form" ng-class="{\''+s+"': form.sku_stock_"+a+".$invalid && form.sku_stock_"+a+'.$dirty}"><input custom-number class="form-control input-sm sku-stock-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].stock" type="text" name="sku_stock_'+a+'" value="'+e.stock+'" /></div></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].product_sn" type="text" name="sku_product_sn" value="'+e.product_sn+'" /></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].barcode" type="text" name="sku_barcode" value="'+e.barcode+'" /></td><td class="setting"><a data-ids="'+t+'" ng-click="openSkuBatch(\''+t+'\')" ng-popover="skuBatch.html" placement="bottom" maximize="true"><i class="fa fa-cog"></i></a></td>'},$scope.openSkuBatch=function(e){var t=vm.goodsData.skuData.length;vm.openSkuBatchString=e,vm.isOpenBatchPrice=!("undefined"!=typeof vm.goodsData.skuStock[t][e].price&&""!=vm.goodsData.skuStock[t][e].price),vm.isOpenBatchStock=!("undefined"!=typeof vm.goodsData.skuStock[t][e].stock&&""!=vm.goodsData.skuStock[t][e].stock),vm.isOpenBatchImg=!("undefined"!=typeof vm.goodsData.skuStock[t][e].img&&""!=vm.goodsData.skuStock[t][e].img)},$scope.skuBatch=function(e,t){var a=vm.openSkuBatchString.split(";"),o=vm.goodsData.skuData.length;angular.forEach(vm.goodsData.skuStock[o],function(s,n){if(n.indexOf(a[t])!=-1)switch(e){case"price":vm.goodsData.skuStock[o][n][e]=parseFloat(vm.goodsData.skuStock[o][vm.openSkuBatchString][e]).toFixed(2);break;default:vm.goodsData.skuStock[o][n][e]=vm.goodsData.skuStock[o][vm.openSkuBatchString][e]}})},$scope.getShipment=function(e){("undefined"==typeof vm.shipments||e)&&shipmentResource.get({},function(e){vm.goodsData.shipments=e.data})},$scope.addCollectFields=function(){var e={name:"",type:"text",multiple:!1,required:!0};vm.goodsData.collect_fields.push(e)},$scope.deleteCollectFields=function(e){vm.goodsData.collect_fields.splice(e,1)},$scope.showCate=function(){var e=$modal.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/mall.cates.html",controller:"mall.cates.form",resolve:{}});e.result.then(function(e){e&&($scope.cateData=e,$scope.isShow=!0,vm.goodsData.mall_category_id=e.mall_category_id)})},$scope.save=function(){var e=$scope.saveValidity(0);if(!e)return!1;var t=[],a={};vm.goodsData.products=vm.goodsData.skuStock[vm.goodsData.skuData.length],angular.forEach(vm.goodsData.props,function(e,o){a={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.value},t.push(a)}),angular.forEach(vm.goodsData.skuData,function(e,o){angular.forEach(e,function(e,o){a={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.name},t.push(a)})});var o={barcode:vm.goodsData.barcode||"",goods_cat_id:vm.goodsData.cate[vm.goodsData.cate.length-1].data.id,mall_category_id:vm.goodsData.mall_category_id,goods_sn:vm.goodsData.goods_sn||"",img:vm.goodsData.imgs[0].url,imgs:vm.goodsData.imgs,tags:[],postage:vm.goodsData.postage||0,original_price:vm.goodsData.original_price||0,price:vm.goodsData.price||0,serve_label:vm.goodsData.serve_label,label_ids:vm.goodsData.label_ids,is_sku:vm.goodsData.is_sku,is_discount:vm.goodsData.is_discount,is_givecredit:vm.goodsData.is_givecredit,region_ids:vm.goodsData.noDeliveryArea.region_ids,products:{},props:t,shipment_id:null!=vm.goodsData.shipment?vm.goodsData.shipment.id:0,stock:vm.goodsData.stock||0,stock_type:vm.goodsData.stockType,title:vm.goodsData.title,volume:vm.goodsData.volume||0,weight:vm.goodsData.weight||0,intro:vm.goodsData.intro,design_goods_id:vm.goodsData.designGoodsTpl,onsale_type:vm.goodsData.onsale_type,cquota:vm.goodsData.cquota,base_csale:vm.goodsData.base_csale,is_virtual:vm.goodsData.cate[vm.goodsData.cate.length-1].data.is_virtual,virtual_card_type:vm.goodsData.virtual_card_type,is_autosend:vm.goodsData.is_autosend,is_verify_card:vm.goodsData.is_verify_card,old_products:vm.goodsData.old_products,old_props:vm.goodsData.old_props,old_stock:vm.goodsData.old_stock,is_hexiao:vm.goodsData.cate[0].data.is_hexiao,hx_stime:vm.goodsData.hx_stime,hx_etime:vm.goodsData.hx_etime,hx_store:vm.goodsData.hx_store,hx_store_type:vm.goodsData.hx_store_type,hx_type:vm.goodsData.hx_type,hx_code_type:vm.goodsData.hx_code_type,hx_code_time:vm.goodsData.hx_code_time,hx_intro:vm.goodsData.hx_intro};o.component_data=[];var s=angular.copy($scope.slices);for(var n in s){var r=designValidate[s[n].type](s[n].content);if(r)return $scope.editSlice(s[n],r),!1}angular.forEach(s,function(e,t){"goods_head"!=e.type&&o.component_data.push({type:e.type,content:e.content||""})}),o.is_sku&&angular.forEach(vm.goodsData.products,function(e,t){e.checked&&(o.products[t]={id:e.id,img:e.img,price:e.price,stock:e.stock,props_str:e.str,product_sn:e.product_sn,barcode:e.barcode})}),vm.goodsData.collect_fields&&(o.collect_fields=[],angular.forEach(vm.goodsData.collect_fields,function(e,t){o.collect_fields.push({name:e.name,type:e.type,required:e.required?1:0})})),vm.goodsData.selectedGoodsTags.length>0&&angular.forEach(vm.goodsData.selectedGoodsTags,function(e,t){o.tags.push(e.id)}),vm.goodsData.shipmentType||(o.shipment_id=0),vm.goodsData.onsale_type&&(o.onsale_at=vm.goodsData.onsale_at),$scope.save.disabled=!0,angular.isDefined($stateParams.id)?(o.id=$stateParams.id,goodsResource.update(o,function(e){e.error?(Flash.create("danger",e.error),$scope.save.disabled=!1):(Flash.create("success","保存成功"),$state.go("shop.goods."+$stateParams.type+".list",{callback:1}))},function(e){$scope.save.disabled=!1})):($scope.catesHistory(),goodsResource.save(o,function(e){e.error?(Flash.create("danger",e.error),$scope.save.disabled=!1):(Flash.create("success","添加成功"),"0"==o.onsale_type?$state.go("shop.goods.auction.list"):$state.go("shop.goods.forsale.list"))},function(e){$scope.save.disabled=!1}))},$scope.catesHistory=function(){var catesHistory=localStorage.getItem("catesHistory"),currentCates=[],currentIds=[];catesHistory=catesHistory?eval("("+catesHistory+")"):[],angular.forEach(vm.goodsData.cate,function(e,t){currentCates.push({id:e.data.id,name:e.data.name,parent_id:e.data.parent_id,cchild:e.data.cchild,is_virtual:e.data.is_virtual,is_hexiao:e.data.is_hexiao}),currentIds.push(e.data.id)});var distinct=!1,tempIds=[];for(var i in catesHistory)if(tempIds=[],angular.forEach(catesHistory[i],function(e,t){tempIds.push(e.id)}),currentIds.join(",")==tempIds.join(",")){distinct=!0;break}distinct||(catesHistory.length>=5&&catesHistory.splice(4,catesHistory.length-4),catesHistory.unshift(currentCates),localStorage.setItem("catesHistory",JSON.stringify(catesHistory)))},$scope.saveValidity=function(e){var t=$scope.form;if(!vm.goodsData.isCateSelect)return Flash.create("danger","请选择商品类目"),!1;if(2==e){if(_global.is_mall_shop&&!$scope.isShow&&!vm.is_edit)return Flash.create("danger","请选择商品类别"),!1;if(t.goods_title.$invalid)return t.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(0==vm.goodsData.imgs.length)return Flash.create("danger","请至少上传一张商品图片"),!1;if(!vm.goodsData.is_sku){if(t.goods_price.$invalid)return t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1;if(t.goods_stock.$invalid)return t.goods_stock.$dirty=!0,$("input[name='goods_stock']").focus(),!1}if(vm.goodsData.is_sku){var a=!1,o=vm.goodsData.skuData.length;if(0==o)return Flash.create("danger","请至少选择一个商品规格"),!1;for(var s in vm.goodsData.skuStock[o]){var n=vm.goodsData.skuStock[o][s];if(n.checked){var r="sku_price_"+n.sn,e="sku_stock_"+n.sn;if(t[r].$invalid)return t[r].$dirty=!0,$("input[name='"+r+"']").focus(),a=!0,!1;if(t[e].$invalid)return t[e].$dirty=!0,$("input[name='"+e+"']").focus(),a=!0,!1}}if(a)return!1}if(1==vm.goodsData.cate[0].data.is_hexiao){if(vm.goodsData.shipmentType||t.shipping_price.$invalid&&(t.shipping_price.$dirty=!1),""==$scope.vm.goodsData.time_scope)return Flash.create("danger","请选择核销时间范围"),!1;if(2==vm.goodsData.hx_type){var i=$('input[name="hx_time"]').val(),c=i.split("/");if(""==i)return Flash.create("danger","请选择核销的时间"),!1;$scope.vm.goodsData.hx_stime=c[0],$scope.vm.goodsData.hx_etime=c[1]}if(null==$scope.vm.goodsData.hx_store_type)return Flash.create("danger","请选择核销的门店"),!1;var l=$(".storeList").find("dd").attr("data-id");if($scope.vm.goodsData.hx_store=l,1==$scope.vm.goodsData.hx_store_type&&""==$scope.vm.goodsData.hx_store)return Flash.create("danger","请选择你要核销的门店"),!1;if(null==$scope.vm.goodsData.hx_code_type)return Flash.create("danger","请选择生成核销码的时间"),!1;if(2==$scope.vm.goodsData.hx_code_type&&(null==$scope.vm.goodsData.hx_code_time||$scope.vm.goodsData.hx_code_time<1))return Flash.create("danger","请填写几小时后核销"),$("input[name='hxtime']").focus(),!1}else if(0==vm.goodsData.cate[0].data.is_virtual&&!vm.goodsData.shipmentType&&t.shipping_price.$invalid)return t.shipping_price.$dirty=!0,$("input[name='shipping_price']").focus(),!1;if(vm.goodsData.shipmentType){if(null==vm.goodsData.shipment)return Flash.create("danger","请选择运费模版"),!1;if(t.weight.$invalid)return t.weight.$dirty=!0,$("input[name='weight']").focus(),!1;if(t.volume.$invalid)return t.volume.$dirty=!0,$("input[name='volume']").focus(),!1}if(t.base_csale.$invalid)return t.base_csale.$dirty=!0,$("input[name='base_csale']").focus(),!1;if(1==vm.goodsData.onsale_type&&("000-00-00 00:00:00"==vm.goodsData.onsale_at||""==vm.goodsData.onsale_at))return Flash.create("danger","请选择上架时间"),!1;if(vm.goodsData.collect_fields){var d=!1;if(angular.forEach(vm.goodsData.collect_fields,function(e,a){var o="collectFieldsName"+a;if(t[o].$invalid)return t[o].$dirty=!0,$('input[name="'+o+'"]').focus(),d=!0,!1}),d)return!1}}if(0==e||3==e){if(t.goods_title.$invalid)return t.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(0==vm.goodsData.imgs.length)return Flash.create("danger","请至少上传一张商品图片"),!1;if(!vm.goodsData.is_sku){if(t.goods_price.$invalid)return t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1;if(t.goods_stock.$invalid)return t.goods_stock.$dirty=!0,$("input[name='goods_stock']").focus(),!1}if(vm.goodsData.is_sku){var a=!1,o=vm.goodsData.skuData.length;if(0==o)return Flash.create("danger","请至少选择一个商品规格"),!1;for(var s in vm.goodsData.skuStock[o]){var n=vm.goodsData.skuStock[o][s];if(n.checked){var r="sku_price_"+n.sn,e="sku_stock_"+n.sn;if(t[r].$invalid)return t[r].$dirty=!0,$("input[name='"+r+"']").focus(),a=!0,!1;if(t[e].$invalid)return t[e].$dirty=!0,$("input[name='"+e+"']").focus(),a=!0,!1}}if(a)return!1}if(1==vm.goodsData.cate[0].data.is_hexiao){if(vm.goodsData.shipmentType||t.shipping_price.$invalid&&(t.shipping_price.$dirty=!1),""==$scope.vm.goodsData.time_scope)return Flash.create("danger","请选择核销时间范围"),!1;if(null==$scope.vm.goodsData.hx_store_type)return Flash.create("danger","请选择核销的门店"),!1;if(null==$scope.vm.goodsData.hx_code_type)return Flash.create("danger","请选择生成核销码的时间"),!1;if(2==$scope.vm.goodsData.hx_code_type&&(null==$scope.vm.goodsData.hx_code_time||$scope.vm.goodsData.hx_code_time<1))return Flash.create("danger","请填写几小时后核销"),$("input[name='hxtime']").focus(),!1}else if(0==vm.goodsData.cate[0].data.is_virtual&&!vm.goodsData.shipmentType&&t.shipping_price.$invalid)return t.shipping_price.$dirty=!0,$("input[name='shipping_price']").focus(),!1;if(vm.goodsData.shipmentType){if(null==vm.goodsData.shipment)return Flash.create("danger","请选择运费模版"),!1;if(t.weight.$invalid)return t.weight.$dirty=!0,$("input[name='weight']").focus(),
!1;if(t.volume.$invalid)return t.volume.$dirty=!0,$("input[name='volume']").focus(),!1}if(1==vm.goodsData.onsale_type&&("000-00-00 00:00:00"==vm.goodsData.onsale_at||""==vm.goodsData.onsale_at))return Flash.create("danger","请选择上架时间"),!1;if(vm.goodsData.collect_fields){var d=!1;if(angular.forEach(vm.goodsData.collect_fields,function(e,a){var o="collectFieldsName"+a;if(t[o].$invalid)return t[o].$dirty=!0,$('input[name="'+o+'"]').focus(),d=!0,!1}),d)return!1}}return!0},$scope.catesHistoryChange=function(e){for(var t in e){t=parseInt(t);var a=e[t];angular.isUndefined(vm.goodsData.cate[t])&&(vm.goodsData.cate[t]={}),$scope.SelectCate(a.id,a.cchild,t,1,a,1)}},step){case"1":var catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),vm.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),vm.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),vm.catesHistoryList.unshift({ids:-1,strs:"请选择"}),vm.catesHistorySelect=-1,$scope.$watch("vm.catesHistorySelect",function(e,t){if(e!=-1)for(var a in vm.catesHistoryList){var o=vm.catesHistoryList[a];e==o.ids&&$scope.catesHistoryChange(catesHistory[a-1])}}),$scope.SelectCate=function(e,t,a,o,s,n){var r=vm.cates.length,i=a+1;t>0?catResource.get({parent_id:e},function(e){o?(vm.goodsData.cate[a].data=s,e._count>0?(angular.isUndefined(vm.goodsData.cate[i])&&(vm.goodsData.cate[i]={}),vm.goodsData.cate[i].collections=vm.cates[i]=e.data,vm.cates.splice(i+1,r-i-1),n||(vm.goodsData.isCateSelect=!1)):(vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)):(vm.goodsData.cate[a]={},vm.goodsData.cate[a].collections=vm.cates[a]=e.data)},function(e){}):(vm.goodsData.cate[a].data=s,vm.goodsData.cate.splice(i,vm.goodsData.cate.length-i),vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)},$scope.$watch("vm.goodsData.cate",function(e,t){e.length>0&&(vm.goodsData.props={})},!0),0==vm.goodsData.cate.length?$scope.SelectCate(0,1,0,0):(angular.forEach(vm.goodsData.cate,function(e,t){vm.cates[t]=e.collections}),vm.goodsData.isCateSelect=!0);break;case"2":vm.goodsData.tags=[],vm.skuValueTemp=[],vm.skuEditTemp=[],vm.showValue={addProp:!1,addSku:!1,editSku:!1},vm.skuSelectObject={},vm.isSkuSelect=!1,vm.skuType=0;var cateLn=vm.goodsData.cate.length;cateLn>0&&(0==vm.goodsData.skus.length||vm.goodsData.skus.length>0&&vm.goodsData.cate[cateLn-1].data.id!=vm.goodsData.skus[0].goods_cat_id)&&(vm.goodsData.prop=[],vm.goodsData.skus=[],vm.goodsData.skuStock={},$scope.getProp()),$scope.getTags(),$scope.$watch("vm.goodsData.shipmentType",function(e,t){1==e&&0==vm.goodsData.shipments.length&&$scope.getShipment()}),$scope.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},$scope.nowFormatDate=$scope.getNowFormatDate();break;case"3":$scope.save.disabled=!1,designGoodsRes.get({},function(e){vm.designGoodsList=angular.copy(e.data),vm.designGoodsList.unshift({id:0,title:"普通版"})}),$scope.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],$scope.$watch("vm.goodsData.components_data",function(e,t){if(e.length>0){$scope.slices=e,"goods_head"!=$scope.slices[0].type&&$scope.slices.unshift({type:"goods_head"});for(var a in $scope.slices)"goods_info"==$scope.slices[a].type&&($scope.slices[a].class=!0,$scope.editSlice($scope.slices[a]))}}),$scope.config={},$scope.icon_list=designData.concat(),$scope.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,t){t.item.sortable.droptarget&&e.target!=t.item.sortable.droptarget[0]&&($scope.icon_list=designData.concat(),"mouseup"==e.handleObj.type&&$scope.editSlice(t.item.sortable.moved))}},$scope.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},$scope.goods_info=function(e){"goods_info"==e.type&&($scope.design={type:"text"})},$scope.removeSlice=function(e){$scope.slices.splice(e,1),$scope.design=!1},$scope.editSlice=function(e,t){"goods_head"!=e.type&&($scope.design=e,angular.forEach($scope.slices,function(e,t){e.class=!1}),e.class=!0,$timeout(function(){$scope.$broadcast("design_data",e),angular.isUndefined(t)||$scope.$broadcast("design_dirty",t)},200))},$scope.editSlice($scope.slices[1])}$scope.choose_store=function(){var e=$location.search().type,t=$modal.open({animation:!1,templateUrl:"assets/js/apps/order/templates/choose_store.html",controller:"storeCtrl",resolve:{shopCheck:function(){if("auction"==e){var t={hx_store:vm.goodsData.hx_store,hx_store_name:vm.goodsData.hx_store_name};return t||""}if(vm.goodsData.hx_store)var t={hx_store:vm.goodsData.hx_store,hx_store_name:vm.goodsData.hx_store_name};else var t=!1;return t||""}}});t.result.then(function(e){e&&(vm.goodsData.hx_store=e.hx_store,vm.goodsData.hx_store_name=e.hx_store_name)},function(e){})},$scope.$watch("vm.goodsData.hx_code_type",function(){1!=$scope.vm.goodsData.hx_code_type&&3!=$scope.vm.goodsData.hx_code_type||($scope.vm.goodsData.hx_code_time="")})}])}),define("apps/goods/controllers/material",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.material",["$document","$scope","$stateParams","goodsExternalResource","Flash",function(e,t,a,o,s){switch(a.type){case"taobao":t.type=0;break;case"shop":t.type=1;break;default:t.type=0}t.toggleTab=function(e){t.type!=e&&(t.type=e,t.searchTitle="",delete t.params.title,i())};var n=function(e){var t=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w\- .\/?%&=]*)?/,a=new RegExp(t);return a.test(e)||(e=_global.url.ms+e),e},r=function(){t.params.offset=(t.paginationConf.currentPage-1)*t.paginationConf.itemsPerPage,t.params.limit=t.paginationConf.itemsPerPage,t.params.status=t.status,t.params.sorts=t.sorts,t.params.type=t.type,0==Object.keys(t.selectGoodses).length&&(t.selectGoodses[-1]=""),o.gets(t.params,function(e,a){t.paginationConf.totalItems=e._count,t.goodsList=e.data,angular.forEach(t.selectGoodses,function(e,a){var o=!1;angular.forEach(t.goodsList,function(e,s){a==e.id&&(t.goodsList[s].checked=!0,o=!0),t.type&&(t.goodsList[s].img=n(e.img))}),o||delete t.selectGoodses[a]})})};t.paginationConf={currentPage:1,itemsPerPage:10},t.params={offset:(t.paginationConf.currentPage-1)*t.paginationConf.itemsPerPage,limit:t.paginationConf.itemsPerPage,column:"created_at",direction:"desc"},t.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",function(){t.selectGoodses={},r()});var i=function(e){t.checkedAll=!1,1==t.paginationConf.currentPage?r():e?r():t.paginationConf.currentPage=1};t.paginationInit=function(){i()},t.$watch("uploadStatus",function(e,a){e&&(i(),t.uploadStatus=!1)}),t.sorting={price:"",stock:"",created_at:""},t.sortChange=function(e){t.params.column==e?t.params.direction="desc"==t.params.direction?"asc":"desc":(t.params.column=e,t.params.direction="desc"),i()},t.$watch("params.direction + params.column",function(e,a){"undefined"!=typeof e&&angular.forEach(t.sorting,function(e,a){a==t.params.column?t.sorting[a]="sorting-"+t.params.direction:t.sorting[a]=""})}),t.selectGoodses={},t.selectLength=0,t.selectGoods=function(e,a){a?t.selectGoodses[e]=a:delete t.selectGoodses[e]},t.checkedAll=!1,t.$watch("checkedAll",function(e,a){e&&angular.forEach(t.goodsList,function(e,a){t.goodsList[a].checked=!0,t.selectGoodses[e.id]=!0})}),t.$watch("selectGoodses",function(e,a){t.selectLength=Object.keys(e).length,t.selectLength<t.paginationConf.itemsPerPage&&t.paginationConf.totalItems!=t.selectLength&&(t.checkedAll=!1)},!0),t.batchDelete=function(){o.BatchDelete({ids:Object.keys(t.selectGoodses).join(",")},function(e,a){e.success?(t.selectGoodses={},s.create("success","删除成功"),i(t.paginationConf.currentPage)):s.create("danger","删除失败")})},t.goodsDelete=function(e){o.Delete({id:e},function(a,o){a.success?(delete t.selectGoodses[e],s.create("success","删除成功"),i(t.paginationConf.currentPage)):s.create("danger","删除失败")})},t.searchTitle="",t.search=function(){""!=t.searchTitle?t.params.title=t.searchTitle:delete t.params.title,i()}}])}),define("apps/goods/controllers/material.edit",["apps/common/controllers/controllers"],function(controllers){controllers.controller("shop.goods.material.edit",["$scope","$state","$stateParams","GoodsData","goodsExternalResource","fromPropResource","tagResource","Flash","designValidate","$modal",function($scope,$state,$stateParams,GoodsData,goodsExternalResource,fromPropResource,tagResource,Flash,designValidate,$modal){$scope.step=$stateParams.step,$scope.goodsData=GoodsData,$scope.isShow=!1,"undefined"==typeof $scope.goodsData.isStep||$scope.goodsData.isStep||angular.forEach(GoodsData.init(),function(e,t){$scope.goodsData[t]=e}),$scope.nextStep=function(e){switch($scope.goodsData.isStep=!0,e){case 1:$scope.goodsData.external_type?Flash.create("danger","店铺互导不支持修改商品品类"):$state.go("shop.goods.material.edit",{id:$stateParams.id,step:e});break;case 2:saveValidity(1)&&$state.go("shop.goods.material.edit",{id:$stateParams.id,step:e});break;case 3:saveValidity(2)&&$state.go("shop.goods.material.edit",{id:$stateParams.id,step:e})}};var getGoodsExternal=function(){goodsExternalResource.get({id:$stateParams.id},function(e,t){$scope.goodsData.has_get=!0,goodsAssign(e)})},goodsAssign=function(e){$scope.goodsData.external_id=$stateParams.id,$scope.goodsData.external_type=e.type,$scope.goodsData.goods_cat_id=e.goods_cat_id||0,e.goods_cat_id>0&&($scope.goodsData.cate[0]={},$scope.goodsData.cate[0].data={id:e.goods_cat_id,name:e.cat_name}),$scope.goodsData.prop=e.props;$scope.$watch("catsProps",function(t){if(t&&t.length>0)for(var a in t){$scope.goodsData.props[a]={};var o=!1;for(var s in e.props){var n=e.props[s];if(t[a].id==n.id){$scope.goodsData.props[a].id=n.prop_vid,$scope.goodsData.props[a].merchant_id=n.merchant_id,$scope.goodsData.props[a].prop_id=n.id,$scope.goodsData.props[a].value=n.prop_value,o=!0;break}}o||delete $scope.goodsData.props[a]}},!0);if($scope.goodsData.title=e.title,$scope.goodsData.tags=[],$scope.goodsData.is_sku=e.is_sku,e.is_sku){var t=e.products[0].props.split(";").length,a=[];$scope.goodsData.skuStock[t]={},angular.forEach(e.products,function(e,o){var s=e.props;$scope.goodsData.skuStock[t][s]={id:e.id,price:e.price,stock:e.stock,product_sn:e.product_sn,barcode:e.barcode},$scope.goodsData.skuStock[t][s].str=e.porps_str;var n="";angular.forEach(s.split(";"),function(e,t){n+=e.split(":").join("")}),$scope.goodsData.skuStock[t][s].sn=n,a.push(e.props)});var o=a.join(";")+";",s=[];$scope.$watch("goodsData.skus",function(e,t){angular.forEach($scope.goodsData.skus,function(e,t){s=[],angular.forEach(e.prop_values,function(t,a){o.indexOf(e.id+":"+t.id+";")!=-1&&(t.checked=!0,s.push(t))}),s.length>0&&$scope.goodsData.skuData.push(s)})},!0)}if($scope.goodsData.price=e.price,$scope.goodsData.stock=e.stock,$scope.goodsData.products=e.products,$scope.goodsData.barcode=e.barcode,$scope.goodsData.goods_sn=e.goods_sn,$scope.goodsData.postage=e.postage,$scope.goodsData.shipments=[],$scope.goodsData.shipment_type=0!=e.shipment_id?1:0,$scope.goodsData.shipment_id=e.shipment_id,$scope.goodsData.shipment_type){$scope.$watch("goodsData.shipments",function(t){angular.forEach(t,function(t,a){t.id==e.shipment_id&&($scope.goodsData.shipment=t)})})}$scope.goodsData.weight=e.weight,$scope.goodsData.volume=e.volume,$scope.goodsData.collect_fields=e.collect_fields||[],$scope.goodsData.stock_type=e.stock_type,$scope.goodsData.onsale_type=e.onsale_type,$scope.goodsData.onsale_at=e.onsale_at,$scope.goodsData.cquota=e.cquota,$scope.goodsData.skuThead=[],$scope.goodsData.intro=e.intro||"",$scope.goodsData.description=e.description||"",$scope.goodsData.external_type&&angular.forEach(e.components_data,function(e,t){"goods_info"==e.type&&$scope.goodsData.components_data.push(e)}),$scope.goodsData.merchant_id=e.merchant_id,$scope.goodsData.shop_id=e.shop_id,$scope.goodsData.imgs=[],angular.forEach(e.imgs,function(e,t){""!=e&&$scope.goodsData.imgs.push({url:e})})},getProp=function(e){$scope.catsProps=[],fromPropResource.get({goods_cat_id:e,merchant_id:$scope.goodsData.merchant_id,shop_id:$scope.goodsData.shop_id},function(e,t){angular.forEach(e,function(e,t){if(0==e.type&&$scope.catsProps.push(e),1==e.type){var a=!1;for(var o in $scope.goodsData.skus)if($scope.goodsData.skus[o].id==e.id){a=!0;break}a||$scope.goodsData.skus.push(e)}})})},getTags=function(){$scope.shopTags=[],tagResource.get("",function(e,t){e._count>0&&angular.forEach(e.data,function(e,t){$scope.shopTags.push(e)})})},getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},createCatesHistory=function(){var catesHistory=localStorage.getItem("catesHistory"),currentCates=[],currentIds=[];catesHistory=catesHistory?eval("("+catesHistory+")"):[],angular.forEach($scope.goodsData.cate,function(e,t){currentCates.push({id:e.data.id,name:e.data.name,parent_id:e.data.parent_id,cchild:e.data.cchild}),currentIds.push(e.data.id)});var distinct=!1,tempIds=[];for(var i in catesHistory)if(tempIds=[],angular.forEach(catesHistory[i],function(e,t){tempIds.push(e.id)}),currentIds.join(",")==tempIds.join(",")){distinct=!0;break}distinct||(catesHistory.length>=5&&catesHistory.splice(4,catesHistory.length-4),catesHistory.unshift(currentCates),localStorage.setItem("catesHistory",JSON.stringify(catesHistory)))};$scope.addTagInit={name:{name:"分组名称",value:""}},$scope.addTagFun=function(){var e=$scope.addTagInit.name.value;""!=e?tagResource.save({name:e},function(e,t){Flash.create("success","操作成功"),$scope.shopTags.push(e),$scope.goodsData.tags.push(e)},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","请填写分组名称")},$scope.showCate=function(){var e=$modal.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/mall.cates.html",controller:"mall.cates.form",resolve:{}});e.result.then(function(e){e&&($scope.cateData=e,$scope.isShow=!0,$scope.goodsData.mall_category_id=e.mall_category_id)})};var saveValidity=function(e){var t=$scope.form;if(0==$scope.goodsData.goods_cat_id)return Flash.create("danger","请选择商品类目"),!1;if(2==e&&_global.is_mall_shop&&!$scope.isShow)return Flash.create("danger","请选择商品类别"),!1;if(0==e||2==e||3==e){if(t.goods_title.$invalid)return t.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(0==$scope.goodsData.imgs.length)return Flash.create("danger","请至少上传一张商品图片"),!1;if(!$scope.goodsData.is_sku){if(t.goods_price.$invalid)return t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1;if(t.goods_stock.$invalid)return t.goods_stock.$dirty=!0,$("input[name='goods_stock']").focus(),!1}if($scope.goodsData.is_sku){var a=!1,o=$scope.goodsData.skuData.length;if(0==o)return Flash.create("danger","请至少选择一个商品规格"),!1;for(var s in $scope.goodsData.skuStock[o]){var n=$scope.goodsData.skuStock[o][s];if(n.checked){var r="sku_price_"+n.sn,e="sku_stock_"+n.sn;if(t[r].$invalid)return t[r].$dirty=!0,$("input[name='"+r+"']").focus(),a=!0,!1;if(t[e].$invalid)return t[e].$dirty=!0,$("input[name='"+e+"']").focus(),a=!0,!1}}if(a)return!1}if(!$scope.goodsData.shipment_type&&t.shipping_price.$invalid)return t.shipping_price.$dirty=!0,$("input[name='shipping_price']").focus(),!1;if($scope.goodsData.shipment_type){if(null==$scope.goodsData.shipment)return Flash.create("danger","请选择运费模版"),!1;if(t.weight.$invalid)return t.weight.$dirty=!0,$("input[name='weight']").focus(),!1;if(t.volume.$invalid)return t.volume.$dirty=!0,$("input[name='volume']").focus(),!1}if(1==$scope.goodsData.onsale_type&&("000-00-00 00:00:00"==$scope.goodsData.onsale_at||""==$scope.goodsData.onsale_at))return Flash.create("danger","请选择上架时间"),!1;if($scope.goodsData.collect_fields){var i=!1;if(angular.forEach($scope.goodsData.collect_fields,function(e,a){var o="collectFieldsName"+a;if(t[o].$invalid)return t[o].$dirty=!0,$('input[name="'+o+'"]').focus(),i=!0,!1}),i)return!1}}return!0};switch($scope.save=function(e){var t=saveValidity(0);if(!t)return!1;var a=[],o={};$scope.goodsData.products=$scope.goodsData.skuStock[$scope.goodsData.skuData.length],angular.forEach($scope.goodsData.props,function(e,t){o={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.value},a.push(o)}),angular.forEach($scope.goodsData.skuData,function(e,t){angular.forEach(e,function(e,t){o={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.name},a.push(o)})});var s={external_id:$scope.goodsData.external_id,barcode:$scope.goodsData.barcode||"",goods_cat_id:$scope.goodsData.goods_cat_id,mall_category_id:$scope.goodsData.mall_category_id,goods_sn:$scope.goodsData.goods_sn||"",tags:[],img:$scope.goodsData.imgs[0].url,imgs:$scope.goodsData.imgs,postage:$scope.goodsData.postage||0,price:$scope.goodsData.price||0,is_sku:$scope.goodsData.is_sku,products:{},props:a,shipment_id:null!=$scope.goodsData.shipment?$scope.goodsData.shipment.id:0,stock:$scope.goodsData.stock||0,stock_type:$scope.goodsData.stock_type,title:$scope.goodsData.title,volume:$scope.goodsData.volume||0,weight:$scope.goodsData.weight||0,intro:$scope.goodsData.intro,design_goods_id:$scope.goodsData.designGoodsTpl,onsale_type:$scope.goodsData.onsale_type,cquota:$scope.goodsData.cquota};s.component_data=[];var n=angular.copy($scope.goodsData.slices);for(var r in n){var i=designValidate[n[r].type](n[r].content);if(i)return $scope.editSlice(n[r],i),!1}angular.forEach(n,function(e,t){"goods_head"!=e.type&&s.component_data.push({type:e.type,content:e.content||""})}),s.is_sku&&angular.forEach($scope.goodsData.products,function(e,t){e.checked&&(s.products[t]={id:e.id,price:e.price,stock:e.stock,props_str:e.str,product_sn:e.product_sn,barcode:e.barcode})}),$scope.goodsData.collect_fields&&(s.collect_fields=$scope.goodsData.collect_fields),$scope.goodsData.tags.length>0&&angular.forEach($scope.goodsData.tags,function(e,t){s.tags.push(e.id)}),$scope.goodsData.shipment_type||(s.shipment_id=0),$scope.goodsData.onsale_type&&(s.onsale_at=$scope.goodsData.onsale_at),createCatesHistory(),$(e.currentTarget).addClass("btn-submiting-sm"),$scope.save.disabled=!0,goodsExternalResource.save(s,function(e,t){"0"==s.onsale_type?$state.go("shop.goods.auction.list"):$state.go("shop.goods.forsale.list")},function(t,a){Flash.create("danger","编辑失败"),$(e.currentTarget).removeClass("btn-submiting-sm"),$scope.save.disabled=!1})},$scope.goodsData.isStep&&$scope.goodsData.has_get||getGoodsExternal(),$scope.step){case"1":$scope.is_next=!1,$scope.$watch("goodsData.goods_cat_id",function(e){0==e?$scope.is_next=!1:$scope.is_next=!0});break;case"2":$scope.$watch("goodsData.goods_cat_id",function(e){0!=e&&getProp($scope.goodsData.goods_cat_id)}),getTags(),$scope.nowFormatDate=getNowFormatDate();break;case"3":$scope.save.disabled=!1}$scope.goodsData.isStep=!1}])}),define("apps/goods/controllers/goods_tpl",["apps/common/controllers/controllers"],function(e){e.controller("shop.goods.tpl",["$scope","Flash","designGoodsRes","goodsResource","selectedIds","$modalInstance",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",column:"created_at",direction:"desc"},e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),r()},e.cancel=function(){n.dismiss("cancel")},e.useTpl=function(e){o.batchDesignGoods({design_goods_id:e,goods_ids:s},function(e){e.success?(t.create("success","设置模板成功"),n.close()):t.create("danger","设置模板失败")})};var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goodsTpls=t.data,e.isSearch=!1},function(){e.isSearch=!1})};e.isSearch=!1,e.search=function(){e.isSearch=!0,r()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r)}])}),define("apps/goods/controllers/price_tpl",["apps/common/controllers/controllers"],function(e){e.controller("shop.price.tpl",["$scope","Flash","productResource","goodsId","$modalInstance",function(e,t,a,o,s){function n(){a.get({id:o,field:"price"},function(t){e.products=t})}e.products=[],e.cancel=function(){s.dismiss("cancel")},e.saveProductPrice=function(){a.update({id:o,products:e.products},function(e){e.success?(t.create("success","保存成功"),s.close()):t.create("danger","保存失败")})},n()}])}),define("apps/goods/controllers/stock_tpl",["apps/common/controllers/controllers"],function(e){e.controller("shop.stock.tpl",["$scope","Flash","productResource","goodsId","$modalInstance",function(e,t,a,o,s){function n(){a.get({id:o,field:"stock"},function(t){e.products=t})}e.products=[],e.cancel=function(){s.dismiss("cancel")},e.saveProductStock=function(){a.update({id:o,products:e.products},function(e){e.success?(t.create("success","保存成功"),s.close()):t.create("danger",e.error)})},n()}])}),define("apps/goods/controllers/mall.cates",["apps/common/controllers/controllers"],function(controllers){controllers.controller("mall.cates.form",["$location","$scope","$modal","$modalInstance","mall_deleteMallcat","$stateParams","$compile","$state","Flash","ngPopover","mall_GoodsData","mall_catResource","designGoodsRes","$timeout",function($location,$scope,$modal,$modalInstance,mall_deleteMallcat,$stateParams,$compile,$state,Flash,ngPopover,mall_GoodsData,mall_catResource,designGoodsRes,$timeout){var vm=$scope.vm={},cson=[],step=$stateParams.step,cateSelectid,cateSelectname;step=1,vm.cates=[],vm.activeTab=step,$scope.isGetProp=!1,vm.goodsData=mall_GoodsData;var catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),vm.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),vm.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),vm.catesHistoryList.unshift({ids:-1,strs:"请选择"}),vm.catesHistorySelect=-1;var partent_id=0;$scope.infoindex=1,$scope.parentObject={},$scope.showinfoindex=!1,$scope.newcchild=1,$scope.default_level=0,$scope.SelectCate=function(e,t,a,o,s,n){s&&(cateSelectid=s.id,cateSelectname=s.name),cson.push(t),$scope.default_level=a,o&&a<2&&($scope.parentObject=s);var r=vm.cates.length,i=a+1;3!=i&&(partent_id=e),1==i&&(partent_id=0),$scope.infoindex=e,$scope.newcchild=t,vm.goodsData.cate[a]={},vm.goodsData.cate[a].data=s,vm.goodsData.cate.splice(i,vm.goodsData.cate.length-i),t>0?mall_catResource.get({partent_id:e},function(e){o?e._count>0?(angular.isUndefined(vm.goodsData.cate[i])&&(vm.goodsData.cate[i]={}),vm.goodsData.cate[a].collections=vm.cates[i]=e.data,vm.cates.splice(i+1,r-i-1),n||(vm.goodsData.isCateSelect=!1)):(vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0):vm.goodsData.cate[a].collections=vm.cates[a]=e.data},function(e){}):(a<2&&0==t&&($scope.showinfoindex=!0),a<2&&0==cson[cson.length-1]&&($scope.showinfoindex=!0),vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)},$scope.$watch("vm.goodsData.cate",function(e){e.length>0&&(vm.goodsData.props={})},!0),$scope.$watch("newcchild",function(e){e>0&&($scope.showinfoindex=!1)}),0==vm.goodsData.cate.length?$scope.SelectCate(0,1,0,0):($scope.SelectCate(0,1,0,0),angular.forEach(vm.goodsData.cate,function(e,t){vm.cates[t]=e.collections}),vm.goodsData.isCateSelect=!0),$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.selectOk=function(){var e={};e.mall_category_id=cateSelectid,e.name=cateSelectname,$modalInstance.close(e)}}])}),define("apps/goods/controllers/set_cates",["apps/common/controllers/controllers"],function(e){e.controller("catsModalCtrl",["$scope","$modalInstance","Flash","$state","catResource","$modal","items",function(e,t,a,o,s,n,r){e.btn_status=!0,e.custom={},e.custom.num="",e.cates=[],e.SelectCate=function(t,a,o,n,r,i){var c=e.cates.length,l=o+1;a>0?s.get({parent_id:t},function(t){n?(e.goodsData.cate[o].data=r,t._count>0?(angular.isUndefined(e.goodsData.cate[l])&&(e.goodsData.cate[l]={}),e.goodsData.cate[l].collections=e.cates[l]=t.data,e.cates.splice(l+1,c-l-1),i||(e.goodsData.isCateSelect=!1)):(e.cates.splice(l,c-l),e.goodsData.isCateSelect=!0)):(e.goodsData.cate[o]={},e.goodsData.cate[o].collections=e.cates[o]=t.data)},function(e){}):(e.goodsData.cate[o].data=r,e.goodsData.cate.splice(l,e.goodsData.cate.length-l),e.cates.splice(l,c-l),e.goodsData.isCateSelect=!0)},r?(e.goodsData=r,angular.forEach(e.goodsData.cate,function(t,a){e.cates[a]=t.collections})):(e.goodsData={cate:[],isCateSelect:!1},e.goodsData.cate[0]={},e.SelectCate(0,1,0,0)),e.$watch("goodsData.isCateSelect",function(t){e.goodsData.isCateSelect?e.btn_status=!1:e.btn_status=!0}),e.ok=function(){e.goodsData.isCateSelect?t.close(e.goodsData):a.create("danger","未选择商品分类！")},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/goods/controllers/set_freight",["apps/common/controllers/controllers"],function(e){e.controller("freightModalCtrl",["$scope","$modalInstance","Flash","$state","catResource","$modal","shipmentResource","items",function(e,t,a,o,s,n,r,i){e.btn_status=!0,e.goodsData={postage:"",shipment:"",weight:"",volume:""},e.goodsData.shipments=[],i?(e.btn_status=!1,0==i.shipmentType?(e.goodsData.shipmentType=i.shipmentType,e.goodsData.postage=i.postage):1==i.shipmentType&&(e.goodsData.shipmentType=i.shipmentType,e.goodsData.weight=i.weight,e.goodsData.volume=i.volume)):(e.btn_status=!0,e.goodsData.shipmentType=0),e.getShipment=function(){r.get({},function(t){e.goodsData.shipments=t.data,t._count&&i&&angular.forEach(e.goodsData.shipments,function(t,a){t.id==i.shipment_id&&(e.goodsData.shipment=t)})})},e.reGetShipments=function(){r.get({},function(t){e.goodsData.shipments=t.data})},e.$watch("goodsData.shipmentType",function(t,a){e.getShipment()}),e.watchInput=function(){0==e.goodsData.shipmentType?e.goodsData.postage?e.btn_status=!1:e.btn_status=!0:e.goodsData.shipment&&e.goodsData.weight&&e.goodsData.volume?e.btn_status=!1:e.btn_status=!0},e.ok=function(){var o={};0==e.goodsData.shipmentType?(o={shipmentType:e.goodsData.shipmentType,postage:e.goodsData.postage},o.postage?t.close(o):a.create("danger","请设置统一运费！")):(o={shipmentType:e.goodsData.shipmentType,shipment_id:e.goodsData.shipment.id,shipment_name:e.goodsData.shipment.name,weight:e.goodsData.weight,volume:e.goodsData.volume},o.shipment_id?o.weight?o.volume?t.close(o):a.create("danger","请设置体积！"):a.create("danger","请设置重量！"):a.create("danger","请选择运费模板！"))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/goods/controllers/onekeyremove",["apps/common/controllers/controllers"],function(e){e.controller("onekeyremoveCtrl",["$document","$scope","$stateParams","propResource","$state","$location","$modal","onekeyremoveList","catResource","$interval","$timeout","Flash","catfreisData",function(e,t,a,o,s,n,r,i,c,l,d,p,u){t.activeStep=a.step;var m=t.activeStep;if(1==m)t.firstHide=!1,i.getMovingStatus(function(e){e.error?(p.create("danger",e.error),t.activeStep=m=5,t.nextStep(m)):(t.firstHide=!0,t.plats=[{id:"null",name:"请选择所属平台"},{id:"youzan",name:"有赞"},{id:"taobao",name:"淘宝"},{id:"tmall",name:"天猫"},{id:"jd",name:"京东"},{id:"weidian",name:"微店"}],t.selectedPlat="null",t.btn_status=!0,t.btn_text1="下一步",t.changePlat=function(e){"youzan"==e?(t.btn_status=!1,t.btn_text1="下一步"):"null"==e?(t.btn_status=!0,t.btn_text1="下一步"):(t.btn_status=!0,t.btn_text1="敬请期待")})});else if(2==m)t.user={fill_app_id:u.fill_app_id||"",fill_app_secret:u.fill_app_secret||""},t.signUpForm={},t.btn_text2="下一步",t.submitForm=function(e){e&&(t.signUpForm.$invalid=!0,u.fill_app_id=t.user.fill_app_id,u.fill_app_secret=t.user.fill_app_secret,i.yzLogin(t.user,function(e){e.success?t.nextStep(3):(t.signUpForm.$invalid=!1,p.create("danger",e.error))}))};else if(3==m)t.btn_text3="下一步",t.btn_status=!1,t.checked_btn_status=!1,t.oneKeyGoodsData={},t.allIds=[],t.checkedIds=[],t.checkedGoodsList={},t.searchInfo={},t.onekeyremove={checkedAll:!1},t.paginationConf={currentPage:1,itemsPerPage:10},u.goodsData={},t.reGetGoodsList=function(){t.searchInfo.page=t.paginationConf.currentPage,t.searchInfo.page_size=t.paginationConf.itemsPerPage,t.searchInfo.step=3,i.getGoodsList(t.searchInfo,function(e){t.checkedIds=[],t.goodsList=e.items,t.paginationConf.totalItems=e.total_results,t.onekeyremove.checkedAll=!1;for(var a=0;a<e.items.length;a++)""!=t.oneKeyGoodsData[e.items[a].num_iid]&&t.oneKeyGoodsData[e.items[a].num_iid]?t.checkedGoodsList[e.items[a].num_iid]=t.oneKeyGoodsData[e.items[a].num_iid].isCommit:(t.oneKeyGoodsData[e.items[a].num_iid]={num_iid:e.items[a].num_iid,cat_id:"",cat_name:"",freight:"",catResult:"",freightResult:"",isCommit:!1},t.allIds.push(e.items[a].num_iid),t.checkedGoodsList[e.items[a].num_iid]=!1),t.checkedIds[a]=e.items[a].num_iid;t.setBtnStatus()})},t.$watch("paginationConf.currentPage",t.reGetGoodsList),t.checkedAllGoodsList=function(){if(t.onekeyremove.checkedAll)for(var e=0;e<t.checkedIds.length;e++)t.checkedGoodsList[t.checkedIds[e]]=!0,t.oneKeyGoodsData[t.checkedIds[e]].isCommit=!0;else for(var e=0;e<t.checkedIds.length;e++)t.checkedGoodsList[t.checkedIds[e]]=!1,t.oneKeyGoodsData[t.checkedIds[e]].isCommit=!1;t.setBtnStatus()},t.search=function(){1==t.paginationConf.currentPage?t.reGetGoodsList():t.paginationConf.currentPage=1},t.toggleSelection=function(e){t.checkedGoodsList[e]?(t.checkedGoodsList[e]=!0,t.oneKeyGoodsData[e].isCommit=!0):(t.checkedGoodsList[e]=!1,t.oneKeyGoodsData[e].isCommit=!1),t.setBtnStatus()},t.setBtnStatus=function(){for(var e=0,a=0,o=0;o<t.checkedIds.length;o++)t.checkedGoodsList[t.checkedIds[o]]&&e++;for(var o=0;o<t.allIds.length;o++)t.checkedGoodsList[t.allIds[o]]&&a++;e?t.checked_btn_status=!1:t.checked_btn_status=!0,a?t.btn_status=!1:t.btn_status=!0},t.toFourStep=function(e){var a=!0,o=0;u.goodsData={};for(var s=0;s<t.allIds.length;s++)t.checkedGoodsList[t.allIds[s]]&&t.oneKeyGoodsData[t.allIds[s]].isCommit&&(u.goodsData[t.allIds[s]]={cat_name:t.oneKeyGoodsData[t.allIds[s]].cat_name,cat_id:t.oneKeyGoodsData[t.allIds[s]].cat_id,isCommit:t.oneKeyGoodsData[t.allIds[s]].isCommit},o++,t.oneKeyGoodsData[t.allIds[s]].cat_name||(a=!1));if(t.checkedIds.length)if(a){var n={goodsData:u.goodsData,step:4};i.getGoodsList(n,function(e){e&&t.nextStep(4)})}else p.create("danger","请设置已选商品的分类！");else p.create("danger","请选择商品！")},t.set_goods_cat=function(e,a){var o=r.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/onekeyremove.cates.html",controller:"catsModalCtrl",resolve:{items:function(){return a}}});o.result.then(function(a){if(e.length<=1)t.oneKeyGoodsData[e[0]].cat_id=a.cate[a.cate.length-1].data.id,t.oneKeyGoodsData[e[0]].cat_name=a.cate[a.cate.length-1].data.name,t.oneKeyGoodsData[e[0]].catResult=a;else for(var o=0;o<e.length;o++)t.checkedGoodsList[e[o]]&&(t.oneKeyGoodsData[e[o]].cat_id=a.cate[a.cate.length-1].data.id,t.oneKeyGoodsData[e[o]].cat_name=a.cate[a.cate.length-1].data.name,t.oneKeyGoodsData[e[o]].catResult=a)},function(e){})};else if(4==m)t.btn_text4="下一步",t.btn_status=!1,t.checked_btn_status=!1,t.oneKeyGoodsData={},t.allIds=[],t.checkedIds=[],t.checkedGoodsList={},t.searchInfo={},t.onekeyremove={checkedAll:!1},t.paginationConf={currentPage:1,itemsPerPage:10},t.reGetGoodsList=function(){t.searchInfo.page=t.paginationConf.currentPage,t.searchInfo.page_size=t.paginationConf.itemsPerPage,t.searchInfo.step=4,i.getGoodsList(t.searchInfo,function(e){t.checkedIds=[],t.goodsList=e.items,t.paginationConf.totalItems=e.total_results,t.onekeyremove.checkedAll=!1;for(var a=0;a<e.items.length;a++)""!=t.oneKeyGoodsData[e.items[a].num_iid]&&t.oneKeyGoodsData[e.items[a].num_iid]?t.checkedGoodsList[e.items[a].num_iid]=t.oneKeyGoodsData[e.items[a].num_iid].isCommit:(t.oneKeyGoodsData[e.items[a].num_iid]={num_iid:e.items[a].num_iid,cat_id:"",cat_name:"",freight:"",catResult:"",freightResult:"",
isCommit:!1},t.allIds.push(e.items[a].num_iid),t.checkedGoodsList[e.items[a].num_iid]=!1),t.checkedIds[a]=e.items[a].num_iid;t.setBtnStatus()})},t.$watch("paginationConf.currentPage",t.reGetGoodsList),t.checkedAllGoodsList=function(){if(t.onekeyremove.checkedAll)for(var e=0;e<t.checkedIds.length;e++)t.checkedGoodsList[t.checkedIds[e]]=!0,t.oneKeyGoodsData[t.checkedIds[e]].isCommit=!0;else for(var e=0;e<t.checkedIds.length;e++)t.checkedGoodsList[t.checkedIds[e]]=!1,t.oneKeyGoodsData[t.checkedIds[e]].isCommit=!1;t.setBtnStatus()},t.search=function(){1==t.paginationConf.currentPage?t.reGetGoodsList():t.paginationConf.currentPage=1},t.toggleSelection=function(e){t.checkedGoodsList[e]?(t.checkedGoodsList[e]=!0,t.oneKeyGoodsData[e].isCommit=!0):(t.checkedGoodsList[e]=!1,t.oneKeyGoodsData[e].isCommit=!1),t.setBtnStatus()},t.setBtnStatus=function(){for(var e=0,a=0,o=0;o<t.checkedIds.length;o++)t.checkedGoodsList[t.checkedIds[o]]&&e++;for(var o=0;o<t.allIds.length;o++)t.checkedGoodsList[t.allIds[o]]&&a++;e?t.checked_btn_status=!1:t.checked_btn_status=!0,a?t.btn_status=!1:t.btn_status=!0},t.toFourStep=function(e){for(var a=!0,o={goodsData:{}},s=0;s<t.allIds.length;s++)t.checkedGoodsList[t.allIds[s]]&&t.oneKeyGoodsData[t.allIds[s]].isCommit&&(o.goodsData[t.allIds[s]]={cat_id:u.goodsData[t.allIds[s]].cat_id,freight:t.oneKeyGoodsData[t.allIds[s]].freight,isCommit:t.oneKeyGoodsData[t.allIds[s]].isCommit},t.oneKeyGoodsData[t.allIds[s]].freight||(a=!1));t.checkedIds.length?a?(u.goodsData=o.goodsData,i.importGoodsData(o,function(e){e.error?p.create("danger",e.error):t.nextStep(5)})):p.create("danger","请设置已选商品的运费！"):p.create("danger","请选择商品！")},t.set_freight=function(e,a){var o=r.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/onekeyremove.freight.html",controller:"freightModalCtrl",resolve:{items:function(){return a}}});o.result.then(function(a){if(e.length<=1)t.oneKeyGoodsData[e[0]].freight=a,t.oneKeyGoodsData[e[0]].freightResult=a;else for(var o=0;o<e.length;o++)t.checkedGoodsList[e[o]]&&(t.oneKeyGoodsData[e[o]].freight=a,t.oneKeyGoodsData[e[o]].freightResult=a)},function(e){})};else if(5==m)var g=l(function(){i.getMovingStatus(function(e){e.error||(l.cancel(g),t.nextStep(6))})},1e4);else 6==m&&(t.succeeUpload="",t.errorUpload="",i.importGoodsNum(function(e){e&&(t.succeeUpload=e.successNum,t.errorUpload=e.failNum)}));t.nextStep=function(e){s.go("shop.goods.onekeyremove.step",{step:e})}}])}),define("apps/goods/controllers/choose_store",["apps/common/controllers/controllers"],function(e){e.controller("storeCtrl",["$scope","$modal","$modalInstance","storeResource","$timeout","$state","Flash","shopCheck","$location",function(e,t,a,o,s,n,r,i,c){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={name:"",id:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var l=[],d=[],p={};e.checkedList={},e.hxStore={hx_store:"",hx_store_name:""},i&&(e.hxStore.hx_store=i.hx_store+",",e.hxStore.hx_store_name=i.hx_store_name+"、");var u=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,l=[],d=[],o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data;for(var a=0;a<t.data.length;a++)l[a]=t.data[a].id,d[a]=t.data[a].name,p[a]=t.data[a]})};if(i){var m=e.hxStore.hx_store.split(",");if(angular.isArray(m))for(var g=0;g<m.length;g++)e.checkedList[m[g]]=!0}e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",u),e.allFn=function(t){if(t)for(var a=0;a<l.length;a++)e.checkedList[l[a]]||(e.hxStore.hx_store=e.hxStore.hx_store+l[a]+",",e.hxStore.hx_store_name=e.hxStore.hx_store_name+d[a]+"、"),e.checkedList[l[a]]=!0;else for(var a=0;a<l.length;a++)e.checkedList[l[a]]&&(e.hxStore.hx_store=e.hxStore.hx_store.replace(l[a]+",",""),e.hxStore.hx_store_name=e.hxStore.hx_store_name.replace(d[a]+"、","")),e.checkedList[l[a]]=!1},e.singleFn=function(t,a){if(a)for(var o=0;o<l.length;o++)l[o]==t&&(e.hxStore.hx_store=e.hxStore.hx_store+l[o]+",",e.hxStore.hx_store_name=e.hxStore.hx_store_name+d[o]+"、");else for(var o=0;o<l.length;o++)l[o]==t&&(e.hxStore.hx_store=e.hxStore.hx_store.replace(l[o]+",",""),e.hxStore.hx_store_name=e.hxStore.hx_store_name.replace(d[o]+"、",""))},e.selectStore=function(){var t=e.hxStore,o=c.search().type,s=i.hx_store;0!=t.hx_store.length||0!=t.hx_store_name.length?("auction"==o&&""==s?(t.hx_store=t.hx_store.substr(1,t.hx_store.length-2),t.hx_store_name=t.hx_store_name.substr(1,t.hx_store_name.length-2)):(t.hx_store=t.hx_store.substr(0,t.hx_store.length-1),t.hx_store_name=t.hx_store_name.substr(0,t.hx_store_name.length-1)),a.close(t)):r.create("danger","请选择核销门店")},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/goods/controllers/_base",["apps/goods/controllers/auction","apps/goods/controllers/auction.comments.add","apps/goods/controllers/auction.comments.edit","apps/goods/controllers/forsale","apps/goods/controllers/soldout","apps/goods/controllers/form","apps/goods/controllers/material","apps/goods/controllers/material.edit","apps/goods/controllers/goods_tpl","apps/goods/controllers/price_tpl","apps/goods/controllers/stock_tpl","apps/goods/controllers/mall.cates","apps/goods/controllers/set_cates","apps/goods/controllers/set_freight","apps/goods/controllers/onekeyremove","apps/goods/controllers/choose_store"],function(){}),define("apps/goods/directives/edit_title",["apps/common/directives/directives"],function(e){e.directive("editTitle",[function(){return{restrict:"AE",replace:!0,scope:{title:"@",class:"@"},template:'<div ng-init="edittype=true"><p ng-show="edittype" class="inline-edit {{class}}" ng-click="edit()">{{title}}</p><p class="edit-title-box" ng-show="!edittype"><textarea class="form-control input-sm" type="text" ng-model="title"></textarea><button ng-click="save()" class="btn btn-sm btn-primary pull-right">保存</button></p></div>',link:function(e,t,a){e.edit=function(){e.edittype=!e.edittype},e.save=function(){e.edittype=!e.edittype}}}}])}),define("apps/goods/directives/goods.material.upload",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("goodsMaterialUpload",["$modal",function(e){return{restrict:"AE",replace:!0,scope:{size:"@",type:"="},require:"^?ngModel",template:'<div class="goods-material-upload"><a class="btn btn-primary btn-sm" ng-click="openModal(size)" style="margin-right: 10px;" ><i class="fa fa-upload"></i> 导入商品素材</a></div>',link:function(t,a,o,s){t.animationsEnabled=!1,t.openModal=function(a){var o=e.open({animation:t.animationsEnabled,controller:"goods.material.upload.modal",templateUrl:"assets/js/apps/goods/templates/goods.material.upload.html",size:a,resolve:{type:function(){return t.type},paginationInit:function(){return t.$parent.paginationInit}}});o.result.then(function(e){s.$setViewValue(e)})}}}}]),t.controller("goods.material.upload.modal",["$scope","$modalInstance","Flash","type","paginationInit","shopUpladFactory","shopImportResource","$modal",function(e,t,a,o,s,n,r,i){e.type=o,e._global=_global;var c=function(){e.shop.offset<e.shop.total?e.dynamic=parseFloat(e.shop.offset/e.shop.total*100).toFixed(2):e.dynamic=100};1==e.type&&(e.shop=n,e.shop.status&&c()),e.csvfileInfo={status:!1,name:"",size:0},e.mall_category_id=0,e.ok=function(){if(!e.csvfileInfo.status)return void a.create("danger","请选择一个CSV文件");if(e.csvfile.size>1048576)return void a.create("danger","文件大小不能超过1MB");var o=e.csvfile.name.substr(e.csvfile.name.toLowerCase().lastIndexOf(".")+1);if("csv"!=o)return void a.create("danger","请选择一个CSV文件。");var s=new FormData($("#csvFileUpload")[0]);$.ajax({url:"goods/import_taobao.json",method:"POST",data:s,processData:!1,contentType:!1}).done(function(e){e.success?(a.create("success",e.msg),t.close(e.success)):a.create("danger","导入失败，请重新检查文件")}).fail(function(e){a.create("danger","导入失败，请重新检查文件")})};var l=function(){r.save(e.shop,function(t,o){t.success?(e.shop.status=!0,e.shop.total=t.count,e.shop.exist+=t.exist,e.shop.imported+=t.imported,e.shop.offset=t.offset,e.dynamic=0,c(),e.dynamic<100?l():(e.shop.is_finish=!0,s())):a.create("danger",t.msg)})};e.shopImport=function(){return""==e.shop.username?(a.create("danger","请输入用户名"),!1):""==e.shop.password?(a.create("danger","请输入用户密码"),!1):void l()},e.shopImportReset=function(){angular.forEach(n.init(),function(t,a){e.shop[a]=t}),e.dynamic=0},e.cancel=function(){t.dismiss("cancel")},e.selectCsvFile=function(t){e.$apply(function(a){e.csvfile=t.files[0],e.csvfileInfo.status=!0,e.csvfileInfo.name=e.csvfile.name,e.csvfileInfo.size=parseFloat(e.csvfile.size/1024).toFixed(2)})}}])}),define("apps/goods/directives/prop.setting",["apps/common/directives/directives"],function(e){e.directive("goodsPropSetting",["propResource","propValueResource","Flash",function(e,t,a){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/prop.setting.html",link:function(o,s,n){o.prop={name:"",input_value:"",disabled:!0},o.goods={addPropForm:!1},o.addProp=function(t){o.goodsData.goods_cat_id>0?($(t.currentTarget).addClass("btn-submiting-sm"),e.save({name:o.prop.name,input_value:o.prop.input_value,goods_cat_id:o.goodsData.goods_cat_id,type:0},function(e,s){a.create("success","操作成功"),$(t.currentTarget).removeClass("btn-submiting-sm"),e.inputValues=e.input_values,e.input_values=[],e.input_values.push(e.inputValues),o.catsProps.push(e),o.goodsData.props[o.catsProps.length-1]=e.inputValues,o.goods.addPropForm=!1,o.prop.name="",o.prop.input_value=""},function(e){a.create("danger",e.data.error.message)})):a.create("warning","请先选择品类")},o.deleteProp=function(t,s){"undefined"!=typeof t&&0!=t?e.delete({id:t},function(e,t){if(e.success){a.create("success","删除成功"),o.catsProps.splice(s,1);for(var n=s+1;n<o.catsProps.length+1;n++)o.goodsData.props[n]&&(o.goodsData.props[n-1]=o.goodsData.props[n])}else a.create("danger","删除失败")},function(e){a.create("danger",e.data.error.message)}):a.create("warning","无法获取到属性ID")},o.$watch("prop.name + prop.input_value",function(e,t){""!=o.prop.name&&""!=o.prop.input_value?o.prop.disabled=!1:o.prop.disabled=!0}),o.addPropValue={value:{name:"属性值",value:""}},o.addPropValueFun=function(e,s){""!=o.addPropValue.value.value?"undefined"!=typeof e&&0!=e?t.save({value:o.addPropValue.value.value,prop_id:e},function(e,t){o.catsProps[s].input_values.push(e),o.goodsData.props[s]=e},function(e){a.create("danger",e.data.error.message)}):a.create("warning","无法获取到属性ID"):a.create("warning","请填写属性值内容")},o.deletePropValue=function(e,s,n){e.stopPropagation(),t.delete({id:s},function(e){e.success?angular.forEach(o.catsProps,function(e,t){if(e.id==n)return angular.forEach(e.input_values,function(e,a){if(e.id==s)return o.catsProps[t].input_values.splice(a,1),"undefined"!=typeof o.goodsData.props[t]&&o.goodsData.props[t].id==s&&delete o.goodsData.props[t],!1}),!1}):a.create("danger","删除失败")},function(e){a.create("danger",e.data.error.message)})}}}}])}),define("apps/goods/directives/sku.setting",["apps/common/directives/directives"],function(e){e.directive("goodsSkuSetting",["propResource","Flash","$compile",function(e,t,a){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/sku.setting.html",link:function(o,s,n){o.skuEditTemp=[],o.skuEditTemp.prop_values=[],o.showValue={},o.showValue.editSku={},o.deleteSku=function(a,s){"undefined"!=typeof a&&0!=a?e.delete({id:a},function(e){e.success?o.goodsData.skus.splice(s,1):t.create("danger","删除失败")},function(e){t.create("danger",e.data.error.message)}):t.create("warning","无法获取到属性ID")},o.openEditSku=function(e){o.skuEditTemp.tempVal="",o.skuEditTemp.disabled=!0,o.showValue.editSku[e]=!0,o.skuEditTemp=jQuery.extend(!0,{},o.goodsData.skus[e])},o.deleteEditTempSkuValue=function(e){o.skuEditTemp.prop_values.splice(e,1)},o.editAddTempSkuValue=function(e,a){if(a&&13!=e.keyCode)return!1;var s=o.skuEditTemp.tempVal,n=!1;""!=s?(angular.forEach(o.skuEditTemp.prop_values,function(e,t){if(e.name==s)return n=!0,!1}),n?t.create("danger","输入的规格值已存在"):(o.skuEditTemp.prop_values.push({name:s}),o.skuEditTemp.tempVal="")):t.create("warning","规格值名称不能为空")},o.editSku=function(a,s){var n=o.skuEditTemp.name;$(a.currentTarget).addClass("btn-submiting-sm"),e.update({id:o.skuEditTemp.id,name:n,prop_values:o.skuEditTemp.prop_values},function(e){e.success?(t.create("success","操作成功"),$(a.currentTarget).removeClass("btn-submiting-sm"),o.showValue.editSku[s]=!1,o.goodsData.skus[s].name=n,o.goodsData.skus[s].prop_values=e.data):t.create("danger",e.error)},function(e){t.create("danger",e.data.error.message)})},o.$watch("skuEditTemp.name + skuEditTemp.prop_values",function(e){""!=o.skuEditTemp.name&&o.skuEditTemp.prop_values.length>0?o.skuEditTemp.disabled=!1:o.skuEditTemp.disabled=!0}),o.vm={};var r=o.vm;r.calcCombine=function(e){for(var t=[],a=e.length,o=0;a>o;o++){t[o]=1;for(var s=o+1;a>s;s++)t[o]=t[o]*e[s].length}return t},r.printRow=function(e,t){var a=o.goodsData.skuData,s=a.length;return e!==s&&void(a[e]&&angular.forEach(a[e],function(a,n){if(r.skuStringArr[e]=a.prop_id+":"+a.id,r.skuStringArrNum[e]=a.prop_id.toString()+a.id.toString(),r.skuStringArrStr[e]=a.name,t||(r.tableHtml+="<tr class='js-sku-content'>",t=1),r.tableHtml+='<td data-atom-id="'+a.id+'" rowspan="'+r.combine[e]+'">'+a.name+"</td>",e==s-1){var i=r.skuStringArr.join(";"),c=r.skuStringArrNum.join(""),l=r.skuStringArrStr.join(":"),d=r.getAtomStockData(s,i);r.tableHtml+=r.tdTemplate(d,i,c)+"</tr>",r.trIndex+=1,t=0,"undefined"==typeof o.goodsData.skuStock[s]&&(o.goodsData.skuStock[s]={}),"undefined"==typeof o.goodsData.skuStock[s][i]?o.goodsData.skuStock[s][i]={id:0,price:"",stock:"",product_sn:"",sn:c,barcode:"",str:l}:o.goodsData.skuStock[s][i].str=l,o.goodsData.skuStock[s][i].checked=!0}var p=e+1;r.printRow(p,t)}))},r.generateRows=function(){return r.tableHtml="<tbody>",r.outputTrTag=0,r.trIndex=0,r.skuStringArr=[],r.skuStringArrNum=[],r.skuStringArrStr=[],r.printRow(0,r.outputTrTag),r.tableHtml+"</tbody>"},r.renderFooter=function(){return""},r.renderBody=function(){return r.combine=r.calcCombine(o.goodsData.skuData),r.generateRows()},r.renderHeader=function(){var e="";return angular.forEach(o.goodsData.skuThead,function(t,a){e+="<td>"+t.name+"</td>"}),"<thead><tr>"+e+'<td>价格</td><td>库存</td><td>商家编码</td><td>条形码</td><td width="80">批量操作</td></tr></thead>'},r.renderTable=function(){var e="";return e+=r.renderHeader(),e+=r.renderBody(),e+=r.renderFooter(),e},r.getAtomStockData=function(e,t){return angular.isUndefined(o.goodsData.skuStock[e])||angular.isUndefined(o.goodsData.skuStock[e][t])?{id:0,price:"",stock:"",product_sn:"",barcode:"",str:""}:o.goodsData.skuStock[e][t]},r.tdTemplate=function(e,t,a){var s=o.goodsData.skuData.length,n="has-error";return'<td><div class="validator-form" ng-class="{\''+n+"': form.sku_price_"+a+".$invalid && form.sku_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm sku-price-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].price" type="text" name="sku_price_'+a+'" value="'+e.price+'" /></div></td><td><div class="validator-form" ng-class="{\''+n+"': form.sku_stock_"+a+".$invalid && form.sku_stock_"+a+'.$dirty}"><input custom-number class="form-control input-sm sku-stock-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].stock" type="text" name="sku_stock_'+a+'" value="'+e.stock+'" /></div></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].product_sn" type="text" name="sku_product_sn" value="'+e.product_sn+'" /></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].barcode" type="text" name="sku_barcode" value="'+e.barcode+'" /></td><td class="setting"><a data-ids="'+t+'" ng-click="openSkuBatch(\''+t+'\')" ng-popover="skuBatch.html" placement="bottom" maximize="true"><i class="fa fa-cog"></i></a></td>'},o.$watch("goodsData.skus",function(e,t){if(o.goodsData.skuData=[],o.goodsData.skuThead=[],e.length>0){$(".sku-list").each(function(){var e=[],t=$(this).index();$(this).children(".sku-tree").children("li").each(function(){$(this).children(".checkbox").children("label").children("input[type='checkbox']").is(":checked")&&"undefined"!=typeof o.goodsData.skus[t]&&e.push(o.goodsData.skus[t].prop_values[$(this).index()])}),e.length>0&&(o.goodsData.skuData.push(e),o.goodsData.skuThead.push(o.goodsData.skus[t]))}),angular.forEach(o.goodsData.skuStock[o.goodsData.skuData.length],function(e,t){e.checked=!1});var s=r.renderTable(),n=$(".js-sku-table");n.html(s),a(n)(o)}},!0),o.openSkuBatch=function(e){var t=o.goodsData.skuData.length;r.openSkuBatchString=e,r.isOpenBatchPrice=!("undefined"!=typeof o.goodsData.skuStock[t][e].price&&""!=o.goodsData.skuStock[t][e].price),r.isOpenBatchStock=!("undefined"!=typeof o.goodsData.skuStock[t][e].stock&&""!=o.goodsData.skuStock[t][e].stock)},o.skuBatch=function(e,t){var a=r.openSkuBatchString.split(";"),s=o.goodsData.skuData.length;angular.forEach(o.goodsData.skuStock[s],function(n,i){i.indexOf(a[t])!=-1&&("price"==e?o.goodsData.skuStock[s][i][e]=parseFloat(o.goodsData.skuStock[s][r.openSkuBatchString][e]).toFixed(2):o.goodsData.skuStock[s][i][e]=o.goodsData.skuStock[s][r.openSkuBatchString][e])})}}}}]).directive("skuCreate",["Flash","propResource",function(e,t){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/sku.create.html",link:function(a,o,s){a.createSkuForm=!1,a.createDisabled=!0,a.skuValueTemp=[],a.addTempSkuValue=function(t,o){if(o&&13!=t.keyCode)return!1;var s=a.skuTempName,n=!1;""!=s?(angular.forEach(a.skuValueTemp,function(e,t){if(e==s)return n=!0,!1}),n?e.create("danger","输入的规格值已存在"):(a.skuValueTemp.push(s),a.skuTempName="")):e.create("warning","规格值名称不能为空")},a.deleteTempSkuValue=function(e){a.skuValueTemp.splice(e,1)},a.$watch("createSkuForm",function(e,t){e&&(a.skuValueTemp=[],a.skuName="")}),a.addSku=function(){if(a.$parent.goodsData.goods_cat_id>0){var o={name:a.skuName,goods_cat_id:a.$parent.goodsData.goods_cat_id,prop_value:a.skuValueTemp,type:1};""!=o.name?o.prop_value.length>0?t.save(o,function(e){a.$parent.goodsData.skus.push(e),a.createSkuForm=!1},function(t){e.create("danger",t.data.error.message)}):e.create("warning","至少添加一个规格值"):e.create("warning","规格名称不能为空")}else e.create("warning","请先选择品类")},a.$watch("skuName + skuValueTemp",function(e){""!=a.skuName&&a.skuValueTemp.length>0?a.createDisabled=!1:a.createDisabled=!0})}}}])}),define("apps/goods/directives/shipment.setting",["apps/common/directives/directives"],function(e){e.directive("goodsShipment",["fromShipmentResource",function(e){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/shipment.setting.html",link:function(t,a,o){var s=function(){e.get({shop_id:t.goodsData.shop_id},function(e,a){t.goodsData.shipments=e.data})};t.$watch("goodsData.shipment_type",function(e,a){1==e&&0==t.goodsData.shipments.length&&s()})}}}])}),define("apps/goods/directives/collectFields.setting",["apps/common/directives/directives"],function(e){e.directive("goodsCollectFields",[function(){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/collectFields.setting.html",link:function(e,t,a){e.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],e.addCollectFields=function(){var t={name:"",type:"text",required:1};e.goodsData.collect_fields.push(t)},e.deleteCollectFields=function(t){e.goodsData.collect_fields.splice(t,1)}}}}])}),define("apps/goods/directives/cates.select",["apps/common/directives/directives"],function(directives){directives.directive("goodsCatesSelect",["catResource",function(catResource){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/cates.select.html",link:function(scope,elem,attrs){scope.cates=[],scope.goodsData=scope.$parent.goodsData;var catesHistoryChange=function(e){for(var t in e){t=parseInt(t);var a=e[t];angular.isUndefined(scope.goodsData.cate[t])&&(scope.goodsData.cate[t]={}),scope.SelectCate(a.id,a.cchild,t,1,a,1)}},getCates=function(e,t,a,o,s){var n=scope.cates.length,r=e+1;catResource.get({parent_id:t},function(t,i){a?(scope.goodsData.cate[e].data=o,t._count>0?(angular.isUndefined(scope.goodsData.cate[r])&&(scope.goodsData.cate[r]={}),scope.goodsData.cate[r].collections=scope.cates[r]=t.data,scope.cates.splice(r+1,n-r-1),s||(scope.goodsData.goods_cat_id=0)):(scope.cates.splice(r,n-r),scope.goodsData.goods_cat_id=o.id)):(scope.goodsData.cate[e]={},scope.goodsData.cate[e].collections=scope.cates[e]=t.data)},function(e){})},catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),scope.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),scope.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),scope.catesHistoryList.unshift({ids:-1,strs:"请选择"}),scope.catesHistorySelect=-1,scope.$watch("catesHistorySelect",function(e,t){if(e!=-1)for(var a in scope.catesHistoryList){var o=scope.catesHistoryList[a];e==o.ids&&catesHistoryChange(catesHistory[a-1])}}),scope.SelectCate=function(e,t,a,o,s,n){var r=scope.cates.length,i=a+1;t>0?getCates(a,e,o,s,n):(scope.goodsData.cate[a].data=s,scope.goodsData.cate.splice(i,scope.goodsData.cate.length-i),scope.cates.splice(i,r-i),scope.goodsData.goods_cat_id=s.id)},0==scope.goodsData.goods_cat_id?scope.SelectCate(0,1,0,0):angular.forEach(scope.goodsData.cate,function(e,t){scope.cates[t]=e.collections})}}}])}),define("apps/goods/directives/detail.design",["apps/common/directives/directives"],function(e){e.directive("goodsDetailDesign",["$timeout","designData","designGoodsRes",function(e,t,a){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/goods/templates/detail.design.html",link:function(o,s,n){a.get({},function(e){o.designGoodsList=angular.copy(e.data),o.designGoodsList.unshift({id:0,title:"普通版"})}),0==o.goodsData.slices.length&&(o.goodsData.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],o.$watch("goodsData.description",function(e){o.goodsData.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0,text:e},class:!0}],o.editSlice(o.goodsData.slices[1])})),o.$watch("goodsData.components_data",function(e,t){if(e.length>0){o.goodsData.slices=e,"goods_head"!=o.goodsData.slices[0].type&&o.goodsData.slices.unshift({type:"goods_head"});for(var a in o.goodsData.slices)"goods_info"==o.goodsData.slices[a].type&&(o.goodsData.slices[a].class=!0,o.editSlice(o.goodsData.slices[a]))}}),o.config={},o.icon_list=t.concat(),o.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,a){a.item.sortable.droptarget&&e.target!=a.item.sortable.droptarget[0]&&(o.icon_list=t.concat(),"mouseup"==e.handleObj.type&&o.editSlice(a.item.sortable.moved))}},o.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},o.goods_info=function(e){"goods_info"==e.type&&($scope.design={type:"text"})},o.removeSlice=function(e){o.goodsData.slices.splice(e,1),o.design=!1},o.$parent.editSlice=o.editSlice=function(t,a){"goods_head"!=t.type&&(o.design=t,angular.forEach(o.goodsData.slices,function(e,t){e.class=!1}),t.class=!0,e(function(){o.$broadcast("design_data",t),angular.isUndefined(a)||o.$broadcast("design_dirty",a)},200))},o.editSlice(o.goodsData.slices[1])}}}])}),define("apps/goods/directives/goods.list.search",["apps/common/directives/directives"],function(e){e.directive("goodsListSearch",["tagResource",function(e){return{restrict:"AE",replace:!0,scope:{returnTags:"=",defaultTypes:"=",ngModel:"="},require:"?^ngModel",templateUrl:"assets/js/apps/goods/templates/goods.list.search.html",link:function(t,a,o,s){function n(){e.get({},function(e){t.tags=e.data,t.returnTags=e.data,t.tags.unshift(r)})}var r={id:0,name:"所有分组"};t.defaultTypes?(t.types=[],angular.forEach(t.defaultTypes,function(e,a){"tags"!=e.type?t.types.push(e):n()})):(t.types=[{type:"title",name:"商品标题"},{type:"goods_sn",name:"商品货号"}],n()),t.param={tag:t.ngModel&&t.ngModel.tag?t.ngModel.tag:r,type:t.ngModel&&t.ngModel.type?t.ngModel.type:t.types[0],input:t.ngModel&&t.ngModel.input?t.ngModel.input:""},t.searchParam={types:t.types.map(function(e){return e.type})},t.search=function(){angular.forEach(t.param,function(e,a){t.searchParam[a]=e}),s.$setViewValue(t.searchParam)}}}}])}),define("apps/goods/directives/_base",["apps/goods/directives/edit_title","apps/goods/directives/goods.material.upload","apps/goods/directives/prop.setting","apps/goods/directives/sku.setting","apps/goods/directives/shipment.setting","apps/goods/directives/collectFields.setting","apps/goods/directives/cates.select","apps/goods/directives/detail.design","apps/goods/directives/goods.list.search"],function(){}),define("apps/goods/services/goods",["apps/common/services/services"],function(e){e.factory("goodsResource",["$resource",function(e){return e("goods.json",{id:"@id"},{get:{method:"GET",url:"goods/:id.json"},update:{method:"PUT",url:"goods/:id.json"},delete:{method:"DELETE",url:"goods/:id.json"},onSale:{method:"PUT",url:"goods/sale/:id.json"},batchDelete:{method:"DELETE",url:"goods/batch.json"},batchToggleSale:{method:"PUT",url:"goods/batch_sale.json"},batchTag:{method:"PUT",url:"goods/batch_tag.json"},batchRegion:{method:"PUT",url:"goods/batch_region.json"},batchDesignGoods:{method:"PUT",url:"goods/batch_design_goods.json"},batchDiscount:{method:"PUT",url:"goods/batch_discount.json"},editField:{method:"PUT",url:"goods/field/:id.json"},editProductField:{method:"PUT",url:"goods/product_field/:id.json"},getProducts:{method:"GET",url:"goods/products/:id.json"},getGuiderGoods:{method:"GET",url:"goods_guider.json"},getGuiderRepurchaseGoods:{method:"GET",url:"goods_repurchase.json"},getQrcodeInfo:{method:"GET",url:"goods/qrcode_info/:id.json"}})}]),e.factory("shopServerList",["$resource",function(e){return e("/serve/label.json",{},{get:{method:"GET"}})}]),e.factory("storeResource",["$resource",function(e){return e("/store.json",{},{get:{method:"GET"}})}]),e.factory("shopServerData",["shopServerList","$q",function(e,t){return{get:function(){var a=t.defer();return e.get(function(e){for(var t=0;t<e.data.length;t++)e.data[t].checked=!1;a.resolve(e.data)}),a.promise}}}]),e.factory("GoodsData",[function(){var e={selectedGoodsTags:[],cate:[],isCateSelect:!1,goods_cat_id:0,prop:[],props:{},title:"",imgs:[],serve_label:0,label_ids:[],is_sku:0,is_discount:0,is_givecredit:1,noDeliveryArea:{region_ids:[],region_names:""},skus:[],skuData:[],skuStock:[],products:{},tags:[],original_price:null,price:null,stock:null,goods_sn:null,barcode:null,shipment_type:0,shipmentType:0,shipments:[],shipment:null,postage:null,weight:null,volume:null,stockType:0,stock_type:0,onsale_type:0,onsale_at:"",collect_fields:[],intro:"",components_data:[],designGoodsTpl:0,cquota:0,slices:[],description:"",external_type:0,base_csale:0,hx_store:"",hx_store_name:"",hx_store_type:0,hx_type:1,hx_code_type:1,hx_code_time:null,hx_intro:null,is_hexiao:null,is_virtual:null},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t.isStep=!1,t}])}),define("apps/goods/services/prop",["apps/common/services/services"],function(e){e.factory("propResource",["$resource",function(e){return e("goods/prop.json",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",url:"goods/prop/:id.json"},delete:{method:"DELETE",url:"goods/prop/:id.json"}})}]),e.factory("fromPropResource",["$resource",function(e){return e("goods/from_prop.json",{id:"@id"},{get:{method:"GET",isArray:!0}})}])}),define("apps/goods/services/propValue",["apps/common/services/services"],function(e){e.factory("propValueResource",["$resource",function(e){return e("goods/prop/input_value.json",{id:"@id"},{delete:{method:"DELETE",url:"goods/prop/input_value/:id.json"}})}])}),define("apps/goods/services/tag",["apps/common/services/services"],function(e){e.factory("tagResource",["$resource",function(e){return e("goods/tag.json",{id:"@id"},{get:{method:"GET",url:"goods/tag/:id.json"},update:{method:"PUT",url:"goods/tag/:id.json"},delete:{method:"DELETE",url:"goods/tag/:id.json"}})}])}),define("apps/goods/services/comments",["apps/common/services/services"],function(e){e.factory("setComments",["$resource",function(e){return e("/order/comment/preinstall.json",{id:"@id"},{get:{method:"GET"},update:{method:"PUT"},post:{method:"POST"}})}]),e.factory("goodsPropsList",["$resource",function(e){return e("/order/comment/goods_props.json",{id:"@id"},{get:{method:"GET"}})}]),e.factory("goodsCommentsList",["$resource",function(e){return e("/order/comment/preinstalls.json",{id:"@id"},{get:{method:"GET"}})}]),e.factory("updateCommentsList",["$resource",function(e){return e("/order/comment/preinstalls.json",{id:"@id"},{put:{method:"PUT"}})}])}),define("apps/goods/services/cat",["apps/common/services/services"],function(e){e.factory("catResource",["$resource",function(e){return e("goods/cat.json",{id:"@id"},{})}])}),define("apps/goods/services/product",["apps/common/services/services"],function(e){e.factory("productResource",["$resource",function(e){return e("goods/products.json",{id:"@id"},{get:{method:"GET",url:"goods/products/:id.json",isArray:!0},update:{method:"PUT",url:"goods/products/:id.json"}})}])}),define("apps/goods/services/external",["apps/common/services/services"],function(e){e.factory("goodsExternalResource",["$resource",function(e){return e("goods/external/:id.json",{id:"@id"},{save:{method:"POST",url:"goods/external.json"},gets:{method:"GET",url:"goods/external.json"},Delete:{method:"DELETE",url:"goods/external/:id.json"},BatchDelete:{method:"DELETE",url:"goods/external_batch.json"}})}])}),define("apps/goods/services/shop.upload",["apps/common/services/services"],function(e){e.factory("shopUpladFactory",[function(){var e={username:"",password:"",offset:0,limit:10,imported:0,exist:0,status:!1,is_finish:!1},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t}])}),define("apps/goods/services/shop.import",["apps/common/services/services"],function(e){e.factory("shopImportResource",["$resource",function(e){return e("goods/import_shop.json",{id:"@id"},{})}])}),define("apps/goods/services/onekeyremove",["apps/common/services/services"],function(e){e.factory("onekeyremoveList",["$resource",function(e){return e("goods/get_import_goods.json",{},{getGoodsList:{method:"POST",url:"goods/get_import_goods.json"},importGoodsData:{method:"POST",url:"goods/import_goods.json"},yzLogin:{method:"POST",url:"goods/yz_login.json"},importGoodsNum:{method:"POST",url:"goods/get_import_num.json"},getMovingStatus:{method:"POST",url:"goods/get_moving_status.json"}})}]),e.factory("catfreisData",[function(){var e={selectedPlat:"youzan",goodsData:{},succeeUpload:0,errorUpload:0,fill_app_id:"",fill_app_secret:""},t=angular.copy(e);return t}])}),define("apps/goods/services/_base",["apps/goods/services/goods","apps/goods/services/prop","apps/goods/services/propValue","apps/goods/services/tag","apps/goods/services/comments","apps/goods/services/cat","apps/goods/services/product","apps/goods/services/external","apps/goods/services/shop.upload","apps/goods/services/shop.import","apps/goods/services/onekeyremove"],function(){}),define("apps/goods/main",["apps/goods/states/_base","apps/goods/controllers/_base","apps/goods/directives/_base","apps/goods/services/_base"],function(){}),define("apps/design/states/feature",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design",{url:"/design",templateUrl:"assets/js/apps/design/templates/layout.html"}).state("shop.design.feature",{abstract:!0,url:"/feature",template:'<div ui-view class="design-page"></div>'}).state("shop.design.feature.list",{url:"",templateUrl:"assets/js/apps/design/templates/feature.list.html",
controller:"shop.design.feature.list"}).state("shop.design.feature.add",{url:"/add/:id",templateUrl:"assets/js/apps/design/templates/feature.info.html",controller:"shop.design.feature.info"}).state("shop.design.feature.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/design/templates/feature.info.html",controller:"shop.design.feature.info"})}])}),define("apps/design/states/tag",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.tag",{abstract:!0,url:"/tag",template:'<div ui-view class="design-page"></div>'}).state("shop.design.tag.list",{url:"",templateUrl:"assets/js/apps/design/templates/tag.list.html",controller:"shop.design.tag.list"}).state("shop.design.tag.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/design/templates/tag.info.html",controller:"shop.design.tag.info"})}])}),define("apps/design/states/goods",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.goods",{abstract:!0,url:"/goods",template:'<div ui-view class="design-page"></div>'}).state("shop.design.goods.list",{url:"",templateUrl:"assets/js/apps/design/templates/goods.list.html",controller:"shop.design.goods.list"}).state("shop.design.goods.add",{url:"/add",templateUrl:"assets/js/apps/design/templates/goods.info.html",controller:"shop.design.goods.info"}).state("shop.design.goods.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/design/templates/goods.info.html",controller:"shop.design.goods.info"})}])}),define("apps/design/states/component",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.component",{abstract:!0,url:"/component",template:'<div ui-view class="design-page"></div>'}).state("shop.design.component.list",{url:"",templateUrl:"assets/js/apps/design/templates/component.list.html",controller:"shop.design.component.list"}).state("shop.design.component.add",{url:"/add",templateUrl:"assets/js/apps/design/templates/component.info.html",controller:"shop.design.component.info"}).state("shop.design.component.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/design/templates/component.info.html",controller:"shop.design.component.info"})}])}),define("apps/design/states/nav",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.nav",{url:"/nav",templateUrl:"assets/js/apps/design/templates/nav.html",controller:"shop.design.nav"})}])}),define("apps/design/states/widget",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.widget",{url:"/widget",templateUrl:"assets/js/apps/design/templates/widget.html",controller:"shop.design.widget"})}])}),define("apps/design/states/bottomNav",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.bottomNav",{url:"/bottomNav",templateUrl:"assets/js/apps/design/templates/bottom.nav.html",controller:"shop.design.bottomNav"})}])}),define("apps/design/states/trip_type",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.design.trip_type",{url:"/trip_type",templateUrl:"assets/js/apps/design/templates/trip_type.html",controller:"shop.design.trip_type"})}])}),define("apps/design/states/_base",["apps/design/states/feature","apps/design/states/tag","apps/design/states/goods","apps/design/states/component","apps/design/states/nav","apps/design/states/widget","apps/design/states/bottomNav","apps/design/states/trip_type"],function(){}),define("apps/design/services/design.data",["apps/common/services/services"],function(e){e.factory("designData",[function(){var e=[{type:"banner",icon:"fa fa-bookmark",name:"店招",content:{guider_style:"user",style:1,active_color:"#dd2727"}},{type:"nav",icon:"fa fa-bars",name:"导航",content:{style:"nav",display_icon:"",item_list:[{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"}]}},{type:"search",icon:"fa fa-search",name:"搜索框",content:{style:1,bg_color:"#f63",active_color:"#e64514"}},{type:"goods",icon:"fa fa-thumbs-o-up",name:"推荐商品",content:{size:"small",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0}},{type:"goods_tag",icon:"fa fa-tasks",name:"商品分组",content:{selected_tag:[{id:0,name:"所有分组"}],size:"small",number:6,sort:"created_at",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0}},{type:"tag_list",icon:"fa fa-list",name:"分组分类",content:{pageHeightType:0,pageHeight:"0",current_tag:"0",nav_list:[{title:"分组",imgstyle:0,display_icon:"",icon_size:"30",style:"nav",img_list:[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}],item_list:[{title:"导航1",img:"image/tag-icon.png"},{title:"导航1",img:"image/tag-icon.png"},{title:"导航1",img:"image/tag-icon.png"},{title:"导航1",img:"image/tag-icon.png"}]}]}},{type:"goods",icon:"fa fa-cubes",name:"搭配",content:{style:1}},{type:"slide",icon:"fa fa-file-image-o",name:"图片模板",content:{style:0,item_list:[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}]}},{type:"image",icon:"fa fa-picture-o",name:"图片组合",content:{item_list:[]}},{type:"text",icon:"fa fa-font",name:"富文本",content:{}},{type:"title",icon:"fa fa-bold",name:"标题",content:{}},{type:"video",icon:"fa fa-film",name:"视频",content:{}},{type:"voice",icon:"fa fa-volume-up",name:"语音",content:{style:1,align:1,play:1}},{type:"notice",icon:"fa fa-bullhorn",name:"公告",content:{}},{type:"phone",icon:"fa fa-phone",name:"客服电话",content:{}},{type:"white",icon:"fa fa-square-o",name:"辅助空白",content:{height:30}},{type:"seckill",icon:"fa fa-clock-o",name:"秒杀",content:{}},{type:"component",icon:"fa fa-puzzle-piece",name:"自定义",content:{}}];if(2==_global.shop.type)for(var t=e.length-1;t>-1;t--)"seckill"===e[t].type&&e.splice(t,1);return e}])}),define("apps/design/services/design.validate",["apps/common/services/services"],function(e){e.factory("designValidate",["$stateParams",function(e){var t={banner:function(e){return!1},nav:function(e){return e.item_list.length<1&&"nav"},trip_type:function(e){return e.trip_type.length<1&&"trip_type"},trip_search:function(e){return!1},trip_tag:function(e){return!!(angular.isUndefined(e.selected_tag)||e.selected_tag.length<1)&&"trip_tags"},search:function(e){return!1},notice:function(e){return!(!angular.isUndefined(e.notice)&&""!=e.notice)&&"notice"},goods:function(e){if("smart"===e.recommend)return delete e.goods,!1;var t;switch(angular.isUndefined(e.goods)&&angular.isUndefined(e.comboGoods)?t="goodserror":!angular.isUndefined(e.goods)&&angular.isUndefined(e.comboGoods)?t="goods":angular.isUndefined(e.goods)&&!angular.isUndefined(e.comboGoods)?t="comboGoods":angular.isUndefined(e.goods)||angular.isUndefined(e.comboGoods)||(""==e.goods&&""==e.comboGoods?t="goodserror":""!=e.comboGoods&&""==e.goods?t="comboGoods":""!=e.goods&&""==e.comboGoods&&(t="goods")),t){case"goods":return angular.isUndefined(e.goods)||e.goods==[]?"goods":(e.goods=e.goods.map(function(e){return e.id}),!1);case"comboGoods":return angular.isUndefined(e.comboGoods)||e.comboGoods==[]?"comboGoods":(e.comboGoods=e.comboGoods.map(function(e){return e.id}),!1);default:return"goodserror"}},goods_tag:function(e){return!!(angular.isUndefined(e.selected_tag)||e.selected_tag.length<1)&&"tags"},slide:function(e){return e.item_list.length<1&&"image"},tag_list:function(e){return!!(angular.isUndefined(e.nav_list)||e.nav_list.length<1)&&"tag_list"},scene:function(e){return e.item_list.length<1&&"image"},image:function(e){return!1},text:function(e){return!(!angular.isUndefined(e.text)&&""!=e.text)&&"text"},title:function(e){return!(!angular.isUndefined(e.title)&&""!=e.title)&&"title"},tuiwen_title:function(e,t){return 2!=e.date_type||e.date?2==e.date_type&&e.date&&(e.date=moment(e.date).format("YYYY-MM-DD")):e.date=moment().format("YYYY-MM-DD"),2!=e.title_type||e.title?1==e.title_type&&(e.title=t,!1):"title"},phone:function(e){return!(!angular.isUndefined(e.phone)&&""!=e.phone)&&"phone"},voice:function(e){return!!angular.isUndefined(e.voice_audio)&&"voice_audio"},video:function(e){return!(!angular.isUndefined(e.code)&&""!=e.code)&&"code"},component:function(e){return!(!angular.isUndefined(e.selected)&&""!=e.selected)&&"selected"},goods_head:function(e){return!1},goods_info:function(e){},white:function(e){return!1},guider_head:function(e){return!1},guider_nav:function(e){return!1},guider_banner:function(e){return!1},guider_apply:function(e){return!1},guider_text:function(e){return!1},snatch_nav:function(e){return!1},snatch_goods:function(e){return!1},collect_list:function(e){return!1},partner_banner:function(){return!1},partner_apply:function(){return!1},partner_intro:function(){return!1},partner_head:function(){return!1},partner_account:function(){return!1},partner_navs:function(){return!1},team_banner:function(){return!1},team_apply:function(){return!1},team_intro:function(){return!1},team_head:function(){return!1},team_account:function(){return!1},team_navs:function(){return!1},credit_head:function(){return!1},credit_goods:function(){return!1},seckill:function(e){return!(!angular.isUndefined(e.seckills)&&e.seckills!=[])&&"seckills"},sign:function(){return!1},sign_rule:function(){return!1},calendar:function(){return!1}};return t}])}),define("apps/design/services/link.data",["apps/common/services/services"],function(e){e.factory("linkData",[function(){var e=[{type:"feature",title:"微页面",url:""},{type:"tag",title:"商品分组页",url:""},{type:"goods",title:"商品页",url:""},{type:"cart",title:"购物车",url:"/trade/cart"},{type:"buy",title:"直接购买",url:""},{type:"home",title:"店铺主页",url:"/"},{type:"ucenter",title:"个人中心",url:"/user"},{type:"list",title:"列表页",url:"/list"},{type:"guider",title:"推客中心",url:"/guider"},{type:"guide",title:"推客小店",url:"/guide"},{type:"snatch",title:"人人夺宝",url:"/snatch"},{type:"collect",title:"人人众筹",url:"/collect"},{type:"dynamics",title:"店铺动态",url:"/dynamics"},{type:"spread",title:"推广页面",url:"/guider/spread"},{type:"partner",title:"合伙人中心",url:"/partner"},{type:"team",title:"战队中心",url:"/team"},{type:"credit",title:"积分商城",url:"/credit/mall"},{type:"custom",title:"自定义外链",url:""},{type:"integral",title:"积分卡兑换",url:"/credit/exchange"}],t={0:["team","partner","spread","guide","guider"],2:["custom","team","partner","spread","collect","snatch","guide","guider"]};if(t[_global.shop.type+""])for(var a=e.length-1;a>-1;a--)t[_global.shop.type+""].indexOf(e[a].type)!==-1&&e.splice(a,1);return e}])}),define("apps/design/services/feature",["apps/common/services/services"],function(e){e.factory("feature",["$resource",function(e){return e("/design/feature.json",{id:"@id"},{get:{method:"GET",url:"/design/feature/:id.json"},update:{method:"PUT",url:"/design/feature/:id.json"},delete:{method:"DELETE",url:"/design/feature/:id.json"}})}])}),define("apps/design/services/template",["apps/common/services/services"],function(e){e.factory("templateResource",["$resource",function(e){return e("/design/template/:id.json",{id:"@id"},{})}])}),define("apps/design/services/design.component",["apps/common/services/services"],function(e){e.factory("designComponentRes",["$resource",function(e){return e("/design/component.json",{id:"@id"},{get:{method:"GET",url:"/design/component/:id.json"},update:{method:"PUT",url:"/design/component/:id.json"},delete:{method:"DELETE",url:"/design/component/:id.json"}})}])}),define("apps/design/services/design.goods",["apps/common/services/services"],function(e){e.factory("designGoodsRes",["$resource",function(e){return e("/design/goods.json",{id:"@id"},{get:{method:"GET",url:"/design/goods/:id.json"},update:{method:"PUT",url:"/design/goods/:id.json"},delete:{method:"DELETE",url:"/design/goods/:id.json"}})}])}),define("apps/design/services/nav",["apps/common/services/services"],function(e){e.factory("nav",["$resource",function(e){return e("/design/nav.json",{},{get:{method:"GET",url:"/design/nav.json"},add:{method:"PUT",url:"/design/nav.json"},update:{method:"POST",url:"/design/nav.json"},delete:{method:"DELETE",url:"/design/nav/:id.json"},navEnabled:{method:"PUT",url:"/design/nav_enabled/:id.json"}})}])}),define("apps/design/services/bottom.nav",["apps/common/services/services"],function(e){e.factory("bottomNav",["$resource",function(e){return e("/design/bottom_nav.json",{},{get:{method:"GET"},update:{method:"POST"},getGuider:{method:"GET",isArray:!1,url:"/guider/setting.json"}})}])}),define("apps/design/services/design.widget",["apps/common/services/services"],function(e){e.factory("designWidget",["$resource",function(e){return e("/design/widget.json",{},{create:{method:"POST",url:"/design/widget.json"}})}])}),define("apps/design/services/trip_type",["apps/common/services/services"],function(e){e.factory("TripTypeRes",["$resource",function(e){return e("/trip/type/list.json",{},{get:{method:"GET",url:"/trip/type/list.json"}})}])}),define("apps/design/services/_base",["apps/design/services/design.data","apps/design/services/design.validate","apps/design/services/link.data","apps/design/services/feature","apps/design/services/template","apps/design/services/design.component","apps/design/services/design.goods","apps/design/services/nav","apps/design/services/bottom.nav","apps/design/services/design.widget","apps/design/services/trip_type"],function(){}),define("apps/design/controllers/feature.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.feature.info",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","feature","templateResource",function(e,t,a,o,s,n,r,i,c){function l(){e.disabledBtnStatus=!1,e.disabledBtnText="保存"}s.id?o.includes("shop.design.feature.add")?c.get({id:s.id},function(t){angular.forEach(t.data,function(t,a){if("image"==t.type){var o=t.content.tableContent,s=new RegExp("{url_ms}","g"),n=o.replace(s,e._global.url.ms);t.content.tableHtml=n}}),e.slices=t.data,e.config={type:t.type}}):i.get({id:s.id},function(t){angular.forEach(t.data,function(t,a){if("image"==t.type){var o=t.content.tableContent,s=new RegExp("{url_ms}","g"),n=o.replace(s,e._global.url.ms);t.content.tableHtml=n}}),e.slices=t.data,e.config={title:t.title,desc:t.description,side_pendant:t.side_pendant,top_pendant:t.top_pendant,bgcolor:t.bgcolor,type:t.type}}):(e.slices=[],e.config={}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),null!=t.content&&t.content!=[]||(t.content={}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},l(),e.save=function(){if(e.disabledBtnStatus=!0,e.disabledBtnText="保存中..",""==$.trim(e.config.title))return e.form.title.$dirty=!0,l(),!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),l(),!1;var a=angular.copy(e.slices);angular.forEach(a,function(e,t){"image"==e.type&&delete e.content.tableHtml});for(var n in a){var c=r[a[n].type](a[n].content);if(c)return e.editSlice(e.slices[n],c),l(),"goodserror"==c&&t.create("danger","请选择任意一个商品设置"),!1}e.config.data=a,s.id&&o.includes("shop.design.feature.edit")?(e.config.id=s.id,i.update(e.config,function(e){o.go("shop.design.feature.list"),t.create("success"," 修改成功！")},function(e){l(),t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("shop.design.feature.list"),t.create("success"," 添加成功！")},function(e){l(),t.create("danger",e.data.error.message)})}}])}),define("apps/design/controllers/feature.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.feature.list",["$scope","Flash","feature","$resource","ngPopover","$modal",function(e,t,a,o,s,n){var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",r()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,title:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})};var i=o("design/feature_copy/:id.json",{id:"@id"});e.copy=function(e){i.get({id:e},function(e){t.create("success"," 复制成功！"),r()},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),r()},function(e){t.create("danger",e.data.error.message)})};var c=o("design/feature/ishomepage.json");e.setHomePage=function(a){c.save({id:a.id},function(o){angular.forEach(e.data,function(e,t){e.is_homepage=0}),a.is_homepage=1,t.create("success"," 设置成功！")},function(e){t.create("danger",e.data.error.message)})},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){s.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.choose_template=function(){n.open({animation:!1,size:"lg",templateUrl:"assets/js/apps/design/templates/model_template.html",controller:"modelTemplateCtrl"})},e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}]).controller("modelTemplateCtrl",["$scope","$modalInstance","templateResource","Flash","$state",function(e,t,a,o,s){e._global=_global;var n=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.choose=function(e){t.dismiss("cancel"),s.go("shop.design.feature.add",{id:e})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/design/controllers/component.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.component.info",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","designComponentRes",function(e,t,a,o,s,n,r,i){function c(){e.disabledBtnStatus=!1,e.disabledBtnText="保存"}s.id?i.get({id:s.id},function(t){e.slices=t.data,e.config={title:t.title,desc:t.description}}):(e.slices=[],e.config={}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},c(),e.save=function(){if(e.disabledBtnStatus=!0,e.disabledBtnText="保存中..",""==$.trim(e.config.title))return e.form.title.$dirty=!0,c(),!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),c(),!1;var a=angular.copy(e.slices);for(var n in a){var l=r[a[n].type](a[n].content);if(l)return e.editSlice(e.slices[n],l),c(),!1}e.config.data=a,s.id?(e.config.id=s.id,i.update(e.config,function(e){o.go("shop.design.component.list"),t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message),c()})):i.save(e.config,function(e){o.go("shop.design.component.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message),c()})}}])}),define("apps/design/controllers/component.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.component.list",["$scope","Flash","designComponentRes","$resource",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",s()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,title:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,n){a.delete({id:n},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),s()},function(e){t.create("danger",e.data.error.message)})},e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/design/controllers/tag.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.tag.list",["$scope","Flash","tagResource","$resource","ngPopover",function(e,t,a,o,s){var n=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title,type:e.type},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",n()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,name:e,is_design_name:1},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),n()},function(e){t.create("danger",e.data.error.message)})},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){s.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1}}])}),define("apps/design/controllers/tag.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.tag.info",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","tagResource",function(e,t,a,o,s,n,r,i){function c(){e.disabledBtnStatus=!1,e.disabledBtnText="保存"}e.slices=[],e.config={content:{locked:!0,size:"small",sort:"created_at",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0}},s.id&&i.get({id:s.id},function(t){if(e.slices=t.goods_tag_components,e.config={name:t.name,description:t.description},""==t.content)e.config.content={locked:!0,size:"small",sort:"created_at",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0};else{e.config.content=t.content;var a=t.content;1==a.show_title&&(e.config.content.show_title=!0),1==a.show_cart&&(e.config.content.show_cart=!0),1==a.show_price&&(e.config.content.show_price=!0),1==a.show_csale&&(e.config.content.show_csale=!0)}}),e.icon_list=n.concat(),e.icon_list[0].type="banner",e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.editTagInfo=function(t){angular.forEach(e.slices,function(e,t){e.class=!1});var o={type:"goods_tag",content:t};e.design=o,a(function(){e.$broadcast("design_data",o)},200)},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},c(),e.save=function(){if(e.disabledBtnStatus=!0,e.disabledBtnText="保存中..",""==$.trim(e.config.name))return e.form.title.$dirty=!0,c(),!1;var a=angular.copy(e.slices);for(var n in a){var l=r[a[n].type](a[n].content);if(l)return e.editSlice(e.slices[n],l),c(),!1}e.config.data=a,s.id?(e.config.id=s.id,i.update(e.config,function(e){o.go("shop.design.tag.list"),t.create("success"," 修改成功！")},function(e){c(),t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("shop.design.tag.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message),c()})}}])}),define("apps/design/controllers/goods.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.goods.list",["$scope","Flash","designGoodsRes","$resource",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",s()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,title:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,n){a.delete({id:n},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),s()},function(e){t.create("danger",e.data.error.message)})},e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/design/controllers/goods.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.goods.info",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","designGoodsRes","designWidget",function(e,t,a,o,s,n,r,i,c){function l(){e.disabledBtnStatus=!1,e.disabledBtnText="保存"}s.id?i.get({id:s.id},function(t){e.slices=t.design_goods_components,e.config={title:t.title,top_pendant:angular.isDefined(t.top_pendant)?t.top_pendant:1,side_pendant:angular.isDefined(t.side_pendant)?t.side_pendant:1}}):(e.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!1}}],e.config={top_pendant:1,side_pendant:1}),c.get(function(t){e.widget=t}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},l(),e.save=function(){if(e.disabledBtnStatus=!0,e.disabledBtnText="保存中..",""==$.trim(e.config.title))return e.form.title.$dirty=!0,l(),!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),l(),!1;var a=angular.copy(e.slices);for(var n in a){var c=r[a[n].type](a[n].content);if(c)return e.editSlice(e.slices[n],c),l(),!1}e.config.data=a,s.id?(e.config.id=s.id,i.update(e.config,function(e){o.go("shop.design.goods.list"),t.create("success"," 修改成功！")},function(e){l(),t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("shop.design.goods.list"),t.create("success"," 添加成功！")},function(e){l(),t.create("danger",e.data.error.message)})}}])}),define("apps/design/controllers/design.banner.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designBannerCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.guider.banner.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGuiderBannerCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.guider.apply.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGuiderApplyCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.goods.tag.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGoodsTagCtrl",["$scope","tagResource","Flash",function(e,t,a){function o(){t.get({},function(t){e.tags=t.data,e.tags.unshift(e.defaultTag)})}e.content={selected_tag:[]},e.$on("design_data",function(t,a){e.content=a.content,a.content.valid=e.form.$valid}),e.defaultTag={id:0,name:"所有商品"},o(),e.$watch("content",function(e){angular.isUndefined(e.selected_tag)||e.selected_tag.length>4&&(e.selected_tag.splice(3,1),a.create("danger","最多只能选择四个分组"))},!0)}])}),define("apps/design/controllers/design.goods.info.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGoodsInfoCtrl",["$scope","tagResource","Flash",function(e,t,a){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGoodsCtrl",["$scope","$modal",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.sortableOptions={cursor:"move",zIndex:99999},e.remove=function(t){e.content.goods.splice(t.$index,1)},e.add_goods=function(){var a=t.open({animation:!1,templateUrl:"assets/js/apps/design/templates/model_goods_list.html",controller:"modelGoodsCtrl"});a.result.then(function(t){"undefined"==typeof e.content.goods?e.content.goods=t:e.content.goods=e.content.goods.concat(t),e.content.comboGoods.length=0})},e.add_combo_goods=function(){var a=t.open({animation:!1,templateUrl:"assets/js/apps/design/templates/combo_goods_list.html",controller:"comboGoodsCtrl"});a.result.then(function(t){if("undefined"==typeof e.content.comboGoods){var a=t;angular.forEach(a,function(t){e.content.comboGoods=t.goods,e.content.title=t.combo_name})}else{var a=t;angular.forEach(a,function(t){e.content.comboGoods=t.goods,e.content.title=t.combo_name})}e.content.goods.length=0})}}]).controller("modelGoodsCtrl",["$scope","$modalInstance","goodsResource","tagResource","Flash",function(e,t,a,o,s){function n(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},n();var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.comboGoods=t.data})};e.search=function(){
r()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",r()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}]).controller("comboGoodsCtrl",["$scope","$modalInstance","comboResource","Flash",function(e,t,a,o){e._global=_global,e.comboGoods={checkedAll:!1},e.selected=[],e.c_paginationConf={currentPage:1,itemsPerPage:5},e.c_params={offset:(e.c_paginationConf.currentPage-1)*e.c_paginationConf.itemsPerPage,limit:e.c_paginationConf.itemsPerPage,keywords:"",sale:1,column:"price",direction:"desc"};var s=function(){e.c_params.offset=(e.c_paginationConf.currentPage-1)*e.c_paginationConf.itemsPerPage,e.c_params.limit=e.c_paginationConf.itemsPerPage,a.designGoods(e.c_params,function(t){e.c_paginationConf.totalItems=t._count,e.comboGoods=t.data})};e.search=function(){1==e.c_paginationConf.currentPage?s():e.c_paginationConf.currentPage=1},e.$watch("c_paginationConf.currentPage + c_paginationConf.itemsPerPage",s),e.c_sortClass=function(t,a){return e.c_params.column==t&&e.c_params.direction==a},e.c_sort=function(t){e.c_params.column=t,e.c_params.direction="desc"==e.c_params.direction?"asc":"desc",s()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("comboGoods.checkedAll",function(t){t?e.selected=e.comboGoods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/design/controllers/design.image.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designImageCtrl",["$scope","$modal","$timeout","linkData",function(e,t,a,o){function s(e){for(var t={layout_width:4,layout_height:4},a=new Array(t.layout_width),o=[],s=0;s<t.layout_height;s++)o.push(angular.copy(a));return angular.forEach(e,function(e,t){e.index=t;for(var a=e.y;a<e.height+e.y;a++)for(var s=e.x;s<e.width+e.x;s++)o[a][s]=e}),o}function n(t){for(var a={layout_width:4,layout_height:4},o=s(t),n=[],r=0;r<a.layout_height;r++){n.push("<tr>");for(var i=0;i<a.layout_width;i++){var c=o[r][i];if(c){if(r===c.y&&i===c.x){var l=0;e.content.border_width>0&&(l=e.content.border_width);var d='<td style="border-width:'+l+'px" class="not-empty cols-'+c.width+" rows-"+c.height+'" colspan="'+c.width+'" rowspan="'+c.height+'">';if(""!=c.image_url)d+=""!=c.link_url?"buy"==c.link_type?'<a href="javascript:window.openCart('+c.data.cart_id+')"><img width="100%" src="{url_ms}'+c.image_url+'"></a>':'<a href="'+c.link_url+'"><img width="100%" src="{url_ms}'+c.image_url+'"></a>':'<img width="100%" src="{url_ms}'+c.image_url+'">';else{var p=160*c.width,u=160*c.height;d+="<span>"+p+"x"+u+"</span>"}d+="</td>",n.push(d)}}else n.push('<td style="border-width:'+e.content.border_width+'px" class="empty" data-x="'+i+'" data-y="'+r+'"></td>')}n.push("</tr>")}var m=n.join(""),g=new RegExp("{url_ms}","g"),f=m.replace(g,e._global.url.ms);e.content.tableContent=n.join(""),e.content.tableHtml=f,$("#layout-table").html(f)}function r(e,t,a,o){for(var s in e)if(e[s].rows===t-a.y&&e[s].cols===o-a.x+1)return e[s]}e.$on("design_data",function(t,a){e.content=a.content,e.content.tableHtml="",e.entry=e.content.item_list}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.select_link=angular.copy(o),e.$watch("content",function(e){angular.isUndefined(e)||n(e.item_list)},!0),e.cube_selection={type:"cube_selection",title:"",image_url:"",link_type:"",link_title:"",link_url:""},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)},$("#layout-table").on("click",".empty",function(){var o=$(this),n=angular.copy(e.cube_selection);n.x=o.data("x"),n.y=o.data("y");for(var i=s(e.entry),c=n,l=[],d=[],p=c.y;p<i.length;p++){for(var u=c.x;u<i[p].length;u++){var m=i[p][u];if(m&&(c.x!==m.x||c.y!==m.y))break;if(p-c.y>0){var g=r(l,p,c,u);if(!g)break}d.push({cols:u-c.x+1,rows:p-c.y+1})}if(!d.length)break;l=l.concat(d),d=[]}if(1==l.length)n.width=1,n.height=1,a(function(){e.entry.push(n)},0);else{var f=t.open({animation:!1,templateUrl:"assets/js/apps/design/templates/design/model.table.html",controller:"choiceModelCtrl",size:"sm",resolve:{option:function(){return n},position:function(){return l}}});f.result.then(function(t){e.entry.push(t)})}})}]).controller("choiceModelCtrl",["$scope","option","position","$modalInstance",function(e,t,a,o){for(var s=[],n=0;n<a.length;n++)s[a[n].cols]=a[n].rows;var r=[];angular.forEach(s,function(e,t){r.push(e)}),e.result=r,e.add=function(e){var a=angular.element(e.currentTarget);t.width=a.data("cols"),t.height=a.data("rows"),o.close(t)},e.enter_li=function(e){var t=angular.element(e.currentTarget),a=+t.data("cols"),o=+t.data("rows");$(".layout-table li").removeClass("selected").filter(function(e,t){return selected=$(t),+selected.data("cols")<=a&&+selected.data("rows")<=o}).addClass("selected")},e.cancel=function(){o.dismiss("cancel")},e.getNumber=function(e){return new Array(e)}}])}),define("apps/design/controllers/design.nav.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designNavCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content,void 0==e.content.icon_size&&(e.content.icon_size=30)}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_nav=function(e){e.item_list.push({img:"image/tag-icon.png"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)}}])}),define("apps/design/controllers/design.phone.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designPhoneCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.search.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSearchCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/design.slide.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSlideCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_image=function(){e.content.item_list.push({img:"/image/placehold/image.png"})},e.set_style=function(t){switch(t){case 2:e.content.item_list=[{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X300.png"}];break;case 3:e.content.item_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"}];break;case 4:e.content.item_list=[{img:"/image/placehold/300X320.png"},{img:"/image/placehold/300X150.png"},{img:"/image/placehold/300X150.png"}];break;case 5:e.content.item_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/400X200.png"},{img:"/image/placehold/400X200.png"},{img:"/image/placehold/200X200.png"}];break;case 6:e.content.item_list=[{img:"/image/placehold/300X150.png"},{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X150.png"}];break;case 7:e.content.item_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X420.png"}];break;default:e.content.item_list=[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}]}e.content.style=t},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)},e.select_link=angular.copy(t)}])}),define("apps/design/controllers/design.scene.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSceneCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_image=function(){e.content.item_list.push({img:"image/placehold/640X1010.png"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)},e.select_link=angular.copy(t)}])}),define("apps/design/controllers/design.text.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTextCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.video.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designVideoCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content,void 0!=e.content.code&&""!=e.content.code||(e.content.code='<iframe frameborder="0" width="100%" height="200" src="https://v.qq.com/iframe/player.html?vid=n0341nmmg98&tiny=0&auto=0" style="z-index: 1; "></iframe>')}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.voice.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designVoiceCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.notice.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designNoticeCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content,e.content.bgcolor||(e.content.bgcolor="#ffc")}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.select_link=angular.copy(t)}])}),define("apps/design/controllers/design.conpoment.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designComponentCtrl",["$scope","designComponentRes",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),t.get(function(t){e.data=t.data})}])}),define("apps/design/controllers/design.white.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designWhiteCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/design.guider.nav.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGuiderNavCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_nav=function(e){e.item_list.push({img:"image/tag-icon.png"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)}}])}),define("apps/design/controllers/nav",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.nav",["$scope","nav","Flash","$timeout","$modal","linkData",function(e,t,a,o,s,n){function r(){var o=s.open({animation:!1,templateUrl:"assets/js/apps/design/templates/design/navlist.html",controller:"getNavType"});o.result.then(function(o){var s={},n=["home","ucenter","tag","feature","list"];switch(1==_global.shop.type&&n.splice(4,0,"guider_home"),o){case 1:s={id:"",name:"新加方案",style:1,scope:n,enabled:0,data:[{name:"新加导航",link_title:"",link_type:"",link_url:"",sub_button:[{link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}}]},{name:"新加导航",link_title:"",link_type:"",link_url:"",sub_button:[{link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}}]},{name:"新加导航",link_title:"",link_type:"",link_url:"",sub_button:[{link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}}]}]};break;case 2:s={id:"",name:"新加方案",style:2,scope:n,enabled:0,data:{bgcolor:"#eee",fontColor:"#999",fontHoverColor:"#333",list:[{bgimg:"",bghoverimg:"",data:{},link_title:"",link_type:"",link_url:"",name:"新加菜单"},{bgimg:"",bghoverimg:"",data:{},link_title:"",link_type:"",link_url:"",name:"新加菜单"},{bgimg:"",bghoverimg:"",data:{},link_title:"",link_type:"",link_url:"",name:"新加菜单"}]}};break;case 3:}0==e.navList.plans.length&&(s.enabled=1),t.add({data:s},function(t){1==t.success?(a.create("success","添加成功"),s.id=t.data,e.navList.plans.push(s),i=s.id,e.$broadcast("eidtNav_data",e.navList.plans[e.navList.plans.length-1])):a.create("warning",t.error)})})}e.select_link=angular.copy(n),e.navList=t.get();var i="";e.showMenuList=function(e){var t=$(e.target),a=t.parent();enentPars=t.parents("ul"),"block"==a.find(".submenu").css("display")?a.find(".submenu").css("display","none"):(enentPars.find("li .submenu").css("display","none"),a.find(".submenu").css("display","block"))},e.shopNavOpenStatus=!1,e.shopNavOpen=function(){var o=0;o=0==e.navList.enabled?1:0,e.shopNavOpenStatus=!0,t.navEnabled({type:o},function(t){e.shopNavOpenStatus=!1,e.navList.enabled=o},function(t){e.shopNavOpenStatus=!1,a.create("warning",t.error)}),0==e.navList.plans.length&&r()},e.navOpen=function(o){t.navEnabled({id:o},function(){angular.forEach(e.navList.plans,function(e,t){o==e.id?e.enabled=1:e.enabled=0})},function(e){a.create("warning",e.error)})},e.navEdit=function(t){o(function(){i=t.id,e.$broadcast("eidtNav_data",t)},100)},e.navDelete=function(o,s){t.delete({id:o},function(t){1==t.success?(o==i&&e.$broadcast("eidtNav_data",void 0),e.navList.plans.splice(s,1)):a.create("warning","删除失败")})},e.save_btn_status=!1,e.saveNav=function(){e.save_btn_status=!0,1!=_global.shop.type&&angular.forEach(e.navList.plans,function(t,a){e.navList.plans[a].scope=$.grep(t.scope,function(e){return["guider_home","guider","partner"].indexOf(e)==-1})}),t.update({data:e.navList},function(t){e.save_btn_status=!1,1==t.success?(e.$broadcast("eidtNav_data",void 0),a.create("success","修改成功")):a.create("warning",t.error)})},e.showNavList=function(){r()}}]),e.controller("getNavType",["$scope","$modalInstance",function(e,t){e.navType={type:""},e.saveNavType=function(){t.close(e.navType.type)},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("editNav",["$scope","Flash",function(e,t){e.$on("eidtNav_data",function(t,a){e.eidtNavData=a}),e.sortableOptions={handle:".menu-stor",cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.toggleSelection=function(t){var a=e.eidtNavData.scope.indexOf(t);a>-1?e.eidtNavData.scope.splice(a,1):e.eidtNavData.scope.push(t)},e.addStyleNav=function(){if(1==e.eidtNavData.style){var a={name:"新加菜单",link_url:"",link_type:"",link_title:"",data:{},sub_button:[]};e.eidtNavData.data.length>=3?t.create("danger","此类型最多只能添加3个一级菜单"):e.eidtNavData.data.push(a)}if(2==e.eidtNavData.style)if(e.eidtNavData.data.list.length>=5)t.create("danger","此类型最多只能添加5个一级菜单");else{var a={name:"新加菜单",link_url:"",link_type:"",link_title:"",data:{},bgimg:"",bghoverimg:""};e.eidtNavData.data.list.push(a)}},e.addStyleOneNavB=function(e){if(e.sub_button.length>=5)t.create("danger","最多只能添加5个子菜单");else{var a={link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}};e.sub_button.push(a)}},e.firstNavDelete=function(a,o){1==o&&(0==e.eidtNavData.data[a].sub_button?(e.eidtNavData.data.splice(a,1),t.create("success","删除成功")):t.create("danger","当前导航拥有二级导航，不能删除！")),2==o&&(e.eidtNavData.data.list.splice(a,1),t.create("success","删除成功"))},e.twoNavDelete=function(e,t){e.sub_button.splice(t,1)}}])});define("apps/design/controllers/design.title.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTitleCtrl",["$scope","$modal","$timeout","linkData",function(e,t,a,o){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.select_link=angular.copy(o)}])});define("apps/design/controllers/design.goods_head.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGoodsHeadCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/design/controllers/design.snatch.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSnatchGoodsCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/design.collect.list.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designCollectListCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/design.partner.nav.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designPartnerNavCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){a.content.navName=a.content.navName||"自定义菜单",e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_nav=function(e){e.itemList.push({icon:"if-plus-o icon-gray",title:"标题"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.itemList.splice(a,1)}}])}),define("apps/design/controllers/design.teamer.nav.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTeamerNavCtrl",["$scope","linkData",function(e,t){e.$on("design_data",function(t,a){a.content.navName=a.content.navName||"自定义菜单",e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_nav=function(e){e.itemList.push({icon:"if-plus-o icon-gray",title:"标题"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.itemList.splice(a,1)}}])}),define("apps/design/controllers/bottom.nav",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.bottomNav",["$scope","nav","bottomNav","Flash","$timeout","$modal","linkData",function(e,t,a,o,s,n,r){e._nav_length=1==_global.shop.type?4:2,e.config={bgcolor:""},e.select_link=angular.copy(r),a.get(function(t){var a=t.color||"#f8f8f8",t=t.data;e.bottomNavList=t,e.bottomNavIsShow(),e.bottomNavListStatic=t.slice(0,e._nav_length),e.config.bgcolor=a,1==_global.shop.type&&(e.bottomNavListStatic[3].link_type=e.bottomNavListStatic[2].link_type),e.bottomNavListCustom=t.length>e._nav_length?t.slice(e._nav_length):[]}),e.bottomNavEdit=function(t){s(function(){e.$broadcast("eidtNav_data",t)},100)},e.saveClick=!1,e.saveBottomNav=function(){s(function(){e.saveClick=!0;var t={data:e.bottomNavList,color:e.config.bgcolor};a.update(t,function(t){e.saveClick=!1,1==t.status?(e.$broadcast("eidtNav_data",void 0),o.create("success","修改成功")):o.create("warning",t.msg)})})},e.bottomNavIsShow=function(){for(var t=0;t<e.bottomNavList.length;t++){if(parseInt(e.bottomNavList[t].link_status)>0)return void(e.remindAdd=1);e.remindAdd=0}}}]),e.controller("editBottomNav",["$scope","Flash",function(e,t){e.$on("eidtNav_data",function(t,a){e.eidtNavData=a}),e.addStyleNav=function(){if(e.bottomNavListCustom.length>=8-e._nav_length)t.create("danger","最多只能添加8个菜单");else{var a={name:"新加菜单",link_url:"",link_type:"",link_title:"",link_status:"1"};e.bottomNavListCustom.push(a),e.bottomNavList.push(a),e.bottomNavIsShow()}},e.deleteBottomNav=function(a){e.bottomNavListCustom.splice(a,1),e.bottomNavList.splice(a+e._nav_length,1),e.bottomNavIsShow(),t.create("success","删除成功")}}])}),define("apps/design/controllers/widget",["apps/common/controllers/controllers"],function(e){e.controller("shop.design.widget",["$scope","designWidget","Flash",function(e,t,a){t.get(function(t){e.widget=t,e.widget.home.target=e.widget.home.target||0,1!=_global.shop.type&&(e.widget.home.target=0)}),e.text="保存",e.isdisabled=!1,e.save=function(){e.text="保存中...",e.isdisabled=!0,t.create(e.widget,function(t){t.success?a.create("success","修改成功"):a.create("error",t.msg),e.text="保存",e.isdisabled=!1},function(t){a.create("error","系统错误"),e.isdisabled=!1})}}])}),define("apps/design/controllers/design.tag.list.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTagListCtrl",["$scope","$modal","$timeout","linkData",function(e,t,a,o){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(e,t){}),e.add_nav=function(t){e.content.nav_list[e.content.current_tag].item_list?e.content.nav_list[e.content.current_tag].item_list.push({img:"image/tag-icon.png"}):(e.content.nav_list[e.content.current_tag].display_icon="",e.content.nav_list[e.content.current_tag].style="nav",e.content.nav_list[e.content.current_tag].item_list=[{title:"导航",img:"image/tag-icon.png"}])},e.add_tag_list=function(e){e.nav_list.push({title:"分组"})},e.remove_tag_list=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.nav_list.splice(a,1)},e.input_click_nav=function(){},e.edit_nav=function(t){e.content.current_tag=t},e.add_image=function(){e.content.nav_list[e.content.current_tag].img_list?e.content.nav_list[e.content.current_tag].img_list.push({img:"/image/placehold/image.png"}):(e.content.nav_list[e.content.current_tag].imgstyle=0,e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}])},e.set_style=function(t){switch(t){case 2:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X300.png"}];break;case 3:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"}];break;case 4:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/300X320.png"},{img:"/image/placehold/300X150.png"},{img:"/image/placehold/300X150.png"}];break;case 5:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/400X200.png"},{img:"/image/placehold/400X200.png"},{img:"/image/placehold/200X200.png"}];break;case 6:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/300X150.png"},{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X150.png"}];break;case 7:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X420.png"}];break;default:e.content.nav_list[e.content.current_tag].img_list=[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}]}e.content.nav_list[e.content.current_tag].imgstyle=t},e.removeimgSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.nav_list[e.content.current_tag].img_list.splice(a,1)},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(o),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.nav_list[e.content.current_tag].item_list.splice(a,1)}}])}),define("apps/design/controllers/design.seckill.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSeckillCtrl",["$scope","$modal",function(e,t){e.childData="child",e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.sortableOptions={cursor:"move",zIndex:99999,axis:"x"},e.remove=function(t){e.content.seckills.splice(t.$index,1)},e.add_seckills=function(){var a=t.open({animation:!1,templateUrl:"assets/js/apps/design/templates/model_seckill_list.html",controller:"modelSeckillCtrl"});a.result.then(function(t){"undefined"==typeof e.content.seckills?e.content.seckills=t:e.content.seckills=e.content.seckills.concat(t)})}}]).controller("modelSeckillCtrl",["$scope","$modalInstance","seckillResource","Flash",function(e,t,a,o){e._global=_global,e.seckills={checkedAll:!1},e.selected=[],e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",status:4,column:"created_at",direction:"desc"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.seckills=t.data})};e.search=function(){s()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",s()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("seckills.checkedAll",function(t){t?e.selected=e.seckills.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/design/controllers/design.trip_type.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTripTypeCtrl",["$scope","linkData","TripTypeRes",function(e,t,a){a.get({},function(t){e.tripdrops=t.data}),e.$on("design_data",function(t,a){e.content=a.content,void 0==e.content.icon_size&&(e.content.icon_size=30)}),e.toreRoutes={icon:""},e.abc=function(t){var a=e.content.trip_type,o=new Array;for(var s in a)o.push(a[s].id)},e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_TripType=function(e){$(".TripLi").size();e.trip_type.push({icon:"image/tag-icon.png",title:"类型",id:""})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.trip_type.splice(a,1)}}])}),define("apps/design/controllers/design.trip.tag.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTripTagCtrl",["$scope","tagResource","Flash",function(e,t,a){function o(){t.get({type:1},function(t){e.tags=t.data,e.tags.unshift(e.defaultTag)})}e.content={selected_tag:[]},e.$on("design_data",function(t,a){e.content=a.content,a.content.valid=e.form.$valid}),e.defaultTag={id:0,name:"所有商品"},o(),e.$watch("content",function(e){angular.isUndefined(e.selected_tag)||e.selected_tag.length>4&&(e.selected_tag.splice(3,1),a.create("danger","最多只能选择四个分组"))},!0)}])}),define("apps/design/controllers/design.tuiwen.title.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designTuiwenTitleCtrl",["$scope","$modal","$timeout",function(e,t,a){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.options={applyClass:"btn-green",singleDatePicker:!0,locale:{format:"YYYY-MM-DD"},ranges:{}},e.remove=function(e){e.pic&&(e.pic="")}}])}),define("apps/design/controllers/design.calendar.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designCalendarCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/design.sign.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSignCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/design.calendar.des.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designCalendarDesCtrl",["$scope",function(e){var t=function(e){return e%4==0||e%100==0&&e%400==0},a=function(e,a){var o=new Array(12);return o[0]=31,o[1]=t(a)?29:28,o[2]=31,o[3]=30,o[4]=31,o[5]=30,o[6]=31,o[7]=31,o[8]=30,o[9]=31,o[10]=30,o[11]=31,o[e]},o=function(e){var t=new Array(12);return t[0]="1月",t[1]="2月",t[2]="3月",t[3]="4月",t[4]="5月",t[5]="6月",t[6]="7月",t[7]="8月",t[8]="9月",t[9]="10月",t[10]="11月",t[11]="12月",t[e]},s=function(e,t){return Math.ceil((t+e)/7)},n=function(t,n){var r=t&&n?new Date(t,n):new Date,t=r.getFullYear(),n=r.getMonth();e.monForDisplay=o(n),e.curMon=o((new Date).getMonth()),e.today=(new Date).getDate(),e.first=new Date(t,n,1).getDay(),e.days=a(n,t),e.weeks=s(e.first,e.days);for(var i=0;i<e.first;i++)e.kongDaylist.push(i);for(var i=0;i<7-e.first;i++)e.daylist.push(i+1);for(var i=0;i<e.weeks;i++)e.weeklist.push(i)},r=function(){var t=(new Date).getFullYear(),a=parseInt(e.monForDisplay[0]);1===a&&n(t-1,11),n(t,a-2)},i=function(){var t=(new Date).getFullYear(),a=parseInt(e.monForDisplay[0]);12===a&&n(t+1,0),n(t,a)},c=function(t){return t===e.today&&e.curMon===e.monForDisplay};e.goToPre=r,e.goToNext=i,e.isToday=c;var l=function(){e.kongDaylist=[],e.daylist=[],e.weeklist=[],e.curMon="",e.today="",e.monForDisplay="",e.first=0,e.days=0,e.weeks=0,n()};l()}])}),define("apps/design/controllers/design.sign.rule.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designSignRuleCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/design/controllers/_base",["apps/design/controllers/feature.info","apps/design/controllers/feature.list","apps/design/controllers/component.info","apps/design/controllers/component.list","apps/design/controllers/tag.list","apps/design/controllers/tag.info","apps/design/controllers/goods.list","apps/design/controllers/goods.info","apps/design/controllers/design.banner.ctrl","apps/design/controllers/design.guider.banner.ctrl","apps/design/controllers/design.guider.apply.ctrl","apps/design/controllers/design.goods.tag.ctrl","apps/design/controllers/design.goods.info.ctrl","apps/design/controllers/design.goods.ctrl","apps/design/controllers/design.image.ctrl","apps/design/controllers/design.nav.ctrl","apps/design/controllers/design.phone.ctrl","apps/design/controllers/design.search.ctrl","apps/design/controllers/design.slide.ctrl","apps/design/controllers/design.scene.ctrl","apps/design/controllers/design.text.ctrl","apps/design/controllers/design.video.ctrl","apps/design/controllers/design.voice.ctrl","apps/design/controllers/design.notice.ctrl","apps/design/controllers/design.conpoment.ctrl","apps/design/controllers/design.white.ctrl","apps/design/controllers/design.guider.nav.ctrl","apps/design/controllers/nav","apps/design/controllers/design.title.ctrl","apps/design/controllers/design.goods_head.ctrl","apps/design/controllers/design.snatch.goods.ctrl","apps/design/controllers/design.collect.list.ctrl","apps/design/controllers/design.partner.nav.ctrl","apps/design/controllers/design.teamer.nav.ctrl","apps/design/controllers/bottom.nav","apps/design/controllers/widget","apps/design/controllers/design.tag.list.ctrl","apps/design/controllers/design.seckill.ctrl","apps/design/controllers/design.trip_type.ctrl","apps/design/controllers/design.trip.tag.ctrl","apps/design/controllers/design.tuiwen.title.ctrl","apps/design/controllers/design.calendar.ctrl","apps/design/controllers/design.sign.ctrl","apps/design/controllers/design.calendar.des.ctrl","apps/design/controllers/design.sign.rule.ctrl"],function(){}),define("apps/design/directives/inputrange",["apps/common/directives/directives"],function(e){e.directive("inputRange",[function(){return{restrict:"AE",require:"?ngModel",scope:{value:"=ngModel"},link:function(e,t,a,o){var s=1;e.$watch("value",function(n){angular.isUndefined(n)||1!=s||(s++,t.slider({range:"max",min:parseInt(a.min),max:parseInt(a.max),value:e.value,slide:function(e,t){o.$setViewValue(t.value)}}))})}}}])}),define("apps/design/directives/_base",["apps/design/directives/inputrange"],function(){}),define("apps/design/main",["apps/design/states/_base","apps/design/services/_base","apps/design/controllers/_base","apps/design/directives/_base"],function(){}),define("apps/order/states/order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){
e.state("shop.order",{url:"/order",templateUrl:"assets/js/apps/order/templates/layout.html"}).state("shop.order.all",{abstract:!0,url:"",template:"<div ui-view></div>"}).state("shop.order.all.list",{url:"/list/:type",templateUrl:"assets/js/apps/order/templates/order.list.html",controller:"shop.order.list"}).state("shop.order.all.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/order/templates/order.detail.html",controller:"shop.order.detail"}).state("shop.order.feedback",{url:"/feedback/:id",templateUrl:"assets/js/apps/order/templates/order.feedback.html",controller:"shop.order.feedback"}).state("shop.order.setting",{url:"/setting",templateUrl:"assets/js/apps/order/templates/order.setting.html",controller:"shop.order.setting"}).state("shop.order.deadline",{url:"/deadline",templateUrl:"assets/js/apps/order/templates/order.setting.deadline.html",controller:"shop.order.setting.deadline"}).state("shop.order.message",{url:"/message",templateUrl:"assets/js/apps/order/templates/order.setting.message.html",controller:"shop.order.setting.message"}).state("shop.order.orderShare",{url:"/orderShare",templateUrl:"assets/js/apps/order/templates/order.setting.orderShare.html",controller:"shop.order.setting.orderShare",controllerAs:"vm"}).state("shop.order.delivery",{url:"/delivery",templateUrl:"assets/js/apps/order/templates/order.batch_delivery.html",controller:"shop.order.batch_delivery"}).state("shop.order.verification",{url:"/verification",template:"<div ui-view></div>"}).state("shop.order.verification.validate",{url:"/validate",templateUrl:"assets/js/apps/order/templates/order.validate.html",controller:"shop.order.validate"}).state("shop.order.verification.fetchlog",{url:"/fetchlog",templateUrl:"assets/js/apps/order/templates/order.fetchlog.html",controller:"shop.order.fetchlog"}).state("shop.order.verification.virtual",{url:"/virtual",templateUrl:"assets/js/apps/order/templates/order.virtual.goods.html",controller:"shop.order.virtual.goods"}).state("shop.order.verification.underline",{url:"/underline",templateUrl:"assets/js/apps/order/templates/order.underline.html",controller:"shop.order.underline"}).state("shop.order.reports",{url:"/reports",templateUrl:"assets/js/apps/order/templates/order.reports.html",controller:"shop.order.reports"})}])}),define("apps/order/states/comment",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.order.comment",{abstract:!0,url:"/comment",template:"<div ui-view></div>"}).state("shop.order.comment.list",{url:"/list",templateUrl:"assets/js/apps/order/templates/comment.list.html",controller:"shop.order.comment.list"}).state("shop.order.comment.setting",{url:"/setting",templateUrl:"assets/js/apps/order/templates/comment.setting.html",controller:"shop.order.comment.setting"})}])}),define("apps/order/states/_base",["apps/order/states/order","apps/order/states/comment"],function(){}),define("apps/order/controllers/list",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.list",["$scope","$resource","order","ngPopover","saveDeliver","reviseprice","$stateParams","$modal","Flash","videoAddress",function(e,t,a,o,s,n,r,i,c,l){e.videoAddress=l,e.paginationConf={currentPage:1,itemsPerPage:10},e.limit={limit_from:0,limit_to:3e3},e.isGetted=!0,e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",order_type:"0"},e.searchParams={goods_name:"",payment_sn:"",buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",order_type:"0",store_id:"0"};var d={goods_name:"",order_no:"",buy_way:"all",type:"all",consignee:"",mobile:"",express_type:"all",user_name:"",feedback:0,order_type:0};switch(r.type){case"tosend":e.tabs=1,e.params.type="tosend",e.searchParams.type="tosend";break;case"topay":e.tabs=1,e.params.type="topay",e.searchParams.type="topay";break;case"codpay":e.tabs=2,e.params.buy_way="codpay",e.searchParams.buy_way="codpay";break;case"selffetch":e.tabs=3,e.params.express_type="selffetch",e.searchParams.express_type="selffetch";break;case"peerpay":e.tabs=2,e.params.buy_way="peerpay",e.searchParams.buy_way="peerpay";break;case"feedback":e.tabs=4,e.params.feedback="all",e.searchParams.feedback="all";break;case"star":e.tabs=5,e.params.star="star",e.searchParams.star="star";break;default:e.tabs=1,e.params.type="all",e.searchParams.type="all"}e.type="all";var p=function(){if(delete e.params.startDate,delete e.params.endDate,delete e.params.startFinishDate,delete e.params.endFinishDate,e.dates&&$('input[name="created_range"]').val()){var t=$('input[name="created_range"]').val(),o=t.split("/");e.params.startDate=o[0],e.params.endDate=o[1]}if(e.finish_dates&&$('input[name="finish_range"]').val()){var s=$('input[name="finish_range"]').val(),n=s.split("/");e.params.startFinishDate=n[0],e.params.endFinishDate=n[1]}e.type=e.params.type,e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.isGetted=!0,e.selectedIds=[],e.paginationConf.totalItems=t._count,e.isCustom=_global.shop.customs,e.data=t.data;var a={id:"0",name:"全部"};t.store_list.unshift(a),e.storeList=t.store_list,$(".check-box").attr("checked",!1),u()})},u=function(){e.isCustom?(e.opsRowSpan=3,e.headerRowSpan=7):(e.opsRowSpan=2,e.headerRowSpan=6)};e.saveCustom=function(t,o){a.postCustom({id:t.id},function(t){t.status?(e.data[o].custom_state=t.custom_state,e.data[o].custom_code=t.custom_code,c.create("success","报关成功")):c.create("danger","报关失败")})},e.getCustomStatus=function(t,o){a.resetCustom({id:t.id},function(t){t.status?(e.data[o].custom_state=t.custom_state,e.data[o].custom_code=t.custom_code,c.create("success","刷新成功,"+t.custom_state)):c.create("danger","刷新失败")})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),e.search=function(){e.searchParams.province=e.ctrl.selected[0]?e.ctrl.selected[0].id:"",e.searchParams.city=e.ctrl.selected[1]?e.ctrl.selected[1].id:"",e.searchParams.district=e.ctrl.selected[2]?e.ctrl.selected[2].id:"",angular.forEach(e.searchParams,function(t,a){e.params[a]=e.searchParams[a]}),1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:(e.isGetted=!1,p())},e.formatnum=function(t){t=parseInt(t),t<0||!t&&0!=t?(e.limit.limit_from=0,c.create("danger","开始行数最小为0")):e.limit.limit_from=t},e.limitnum=function(t){t=parseInt(t),t<=0||t>3e3||!t?(c.create("danger","导出行数最小为1,最大为3000"),e.limit.limit_to=3e3):e.limit.limit_to=t},e.export_btn="生成报表",e.isGetted_export=!0,e.exports_is=!1,e.export=function(){if(e.export_btn="生成中",e.selectedIds.length)var a=e.selectedIds.join(","),o="/order/export?ids="+a+"&export=yes";else{e.searchParams.province=e.ctrl.selected[0]?e.ctrl.selected[0].id:"",e.searchParams.city=e.ctrl.selected[1]?e.ctrl.selected[1].id:"",e.searchParams.district=e.ctrl.selected[2]?e.ctrl.selected[2].id:"";var o="/order/export?";if(angular.forEach(e.searchParams,function(e,t){e&&(o+=t+"="+e+"&")}),$('input[name="created_range"]').val()){var s=$('input[name="created_range"]').val(),n=s.split("/");o+="startDate="+n[0]+"&endDate="+n[1]+"&"}if($('input[name="finish_range"]').val()){var r=$('input[name="finish_range"]').val(),i=r.split("/");o+="startFinishDate="+i[0]+"&endFinishDate="+i[1]+"&"}o+="export=yes"}var l=t(o,{});l.get(function(t){1==t.status?(e.isGetted_export=!0,e.exports_is=!0,e.export_btn="生成报表",c.create("success",t.msg)):(e.export_btn="生成报表",c.create("danger",t.msg),e.exports_is=!1,e.isGetted_export=!0)})};var m=function(t){angular.forEach(d,function(a,o){g(o,t)||(e.params[o]=a,e.searchParams[o]=a)})},g=function(e,t){var a=!1;for(var o in t)if(t[o]==e){a=!0;break}return a},f=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:p()};e.set_type=function(t){e.params.type=t,e.searchParams.type=t,m(["type"]),f()},e.set_buy_way=function(t){e.params.buy_way="codpay",e.params.type=t,e.searchParams.type=t,m(["type","buy_way"]),f()},e.set_express_type=function(t){e.params.express_type="selffetch",e.params.type=t,e.searchParams.type=t,m(["type","express_type"]),f()},e.set_feedback=function(t){e.params.feedback=t,e.searchParams.feedback=t,m(["feedback"]),f()},e.sort=function(t){"asc"==t?e.params.sort="desc":e.params.sort="asc",p()},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.set_star=function(e,t){e.star=t,a.setStar({id:e.id,star:t})},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a},e.remorkF={btn_text:"保存",btn_status:!1},e.set_remark=function(t){t&&(e.remorkF.btn_status=!0,e.remorkF.btn_text="保存中...",a.setRemarks({id:e.remarkInfo.id,memo:e.remarkInfo.text},function(t){e.remorkF.btn_status=!1,e.remorkF.btn_text="保存",t.status?(c.create("success","提交成功"),o.close(),e.data[e.remarkInfo.index].remarks=e.remarkInfo.text):c.create("danger","提交失败")}))},e.cancel=function(){o.close(),e.remarkInfo={id:"",text:""}},e.saveListDelivery=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return e.order_sn},isList:function(){return!0}}});a.result.then(function(e){e&&p()})},e.reviseListPrice=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.reviseprice.html",controller:"revisePrice",resolve:{data:function(){return e.order_sn},isList:function(){return!0}}});a.result.then(function(t){t&&(e.goodslist=t.data.goodslist,e.amount=t.data.amount,e.shipment_fee=t.data.shipment_fee)})},e.checkedAll=!1,e.selectedIds=[],e.$watch("checkedAll",function(t){t?e.selectedIds=e.data.map(function(e){return e.id}):e.selectedIds=[]}),e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.print_waybill=function(){i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/choose_waybill_tpl.html",controller:"printWaybillCtrl",resolve:{order_ids:function(){return e.selectedIds}}})},e.printDevivery=function(){var t=$("#print_order_form"),a=e.selectedIds.join(",");$("#print_order_form input[name='ids']").val(a),t.submit()}}]),e.controller("printWaybillCtrl",["$scope","$modalInstance","order_ids","waybillResource","Flash",function(e,t,a,o,s){e.order_ids=a.join(","),e.myWaybills=0,o.get(function(t){e.waybills=t.data,e.waybills.unshift({id:0,name:"请选择"})}),e.px2mm=function(e){$("body").append("<div id='mm2px' style='width:1mm;height:1mm;display:none;'></div>");var t={};return t[0]=e/$("#mm2px").width(),t[1]=e/$("#mm2px").height(),$("#inch2px").remove(),t},e.pixels=JSON.stringify(e.px2mm(1)),e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/detail",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.detail",["$scope","order","saveDeliver","reviseprice","hexiao","orderpick","$resource","$stateParams","$modal","$http","Flash","orderQureyPay","$state",function(e,t,a,o,s,n,r,i,c,l,d,p,u){function m(t){switch(0==t.is_selffetch_type&&(e.orderType="cod"==t.payment_code?2:1,1==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="买家付款",e.step[1].at=t.pay_at,e.step[2].title="发货",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at),2==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="货到付款",e.step[1].at=t.created_at,e.step[2].title="发货",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at),40==t.status&&(e.step[3].title="预计完成时间")),1==t.is_selffetch_type&&(e.orderType="cod"==t.payment_code?4:3,3==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="买家付款",e.step[1].at=t.pay_at,e.step[2].title=1==t.is_virtual?"系统发货 ":"买家自提",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at,40==t.status&&(e.step[3].title="预计完成时间")),4==e.orderType&&(e.step[0].at=t.created_at,e.step[2].title="买家自提",e.step[2].at=t.finished_at,e.step[3].at=t.finished_at,40==t.status&&(e.step[3].title="预计完成时间"),e.step.splice(1,1))),e.isButShow={price:!1,address:!1,store:!1,delivery:!1,extend:!1,pick:!1,close:!1},t.status){case 10:e.orderStatus={title:"订单关闭",text:"自动过期;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"自动过期"};break;case 11:e.orderStatus={title:"订单关闭",text:"买家取消订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"买家取消订单"};break;case 12:e.orderStatus={title:"订单关闭",text:"订单关闭原因："+e.orderdetail.explain,style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"商家关闭订单"};break;case 13:e.orderStatus={title:"订单关闭",text:"维权完成关闭订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"维权完成关闭订单"};break;case 19:e.orderStatus={title:"买家已下单",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,1==t.is_valid&&(e.isButShow.close=!0),e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 20:e.orderStatus={title:"待付款",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,1==t.is_valid&&(e.isButShow.close=!0),e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 30:e.orderStatus={title:"待发货",text:"买家已付款，请尽快发货，否则买家有权申请退款;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.price=!1,e.isButShow.pick=!1,e.isButShow.close=!1;break;case 31:e.orderStatus={title:"货到付款 待发货",text:"买家选择了货到付款，请尽快发货;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,1==t.is_valid&&(e.isButShow.close=!0),e.isButShow.price=!1,e.isButShow.pick=!1;break;case 32:e.orderStatus={title:"针对上门自提，待取货",text:"买家已选择上门自提，等待买家上门自提;",style:"success",icon:"fa-clock-o",statusInfo:"待买家上门自提"},e.step[0].type=!0,e.step[1].type=!0,1==t.is_selffetch_type?e.isButShow.pick=!0:e.isButShow.pick=!1,"cod"==t.payment_code&&1==t.is_valid?e.isButShow.close=!0:e.isButShow.close=!1,e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1;break;case 40:e.orderStatus={title:"商家发货 买家待收货",text:"买家如在 发货后7天内 没有申请退款，交易将自动完成；",style:"success",icon:"fa-clock-o",statusInfo:"待收货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type&&(e.step[2].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.extend=!0,e.isButShow.close=!1;break;case 50:e.orderStatus={title:"已完成",text:"交易成功",style:"success",icon:"fa-check-circle-o",statusInfo:"已完成"},e.step[0].type=!0,e.step[1].type=!0,e.step[2].type=!0,4!=e.orderType&&(e.step[3].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.close=!1}}e.paginationConf={currentPage:1,itemsPerPage:8},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_sn:i.id};var g=r("/order/getCardInfo.json",{order_sn:"@id"},{}),f=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,g.get(e.searchInfo,function(t){e.paginationConf.totalItems=t.data.totalCount,e.cardsdetail=t.data.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",f),e.searchlog=function(){1==e.paginationConf.currentPage?f():e.paginationConf.currentPage=1};var h=r("/order/:id.json",{id:"@id"},{});e.step=[{type:!1,title:"买家下单",at:""},{type:!1,title:"",at:""},{type:!1,title:"",at:""},{type:!1,title:"订单完成",at:""}],h.get({id:i.id},function(t){e.orderdetail=t,m(t),e.valilist=t.hexiao_data}),e.hexiao=function(t){s.save({id:t},function(t){return 1!=t.status?(d.create("danger",t.msg),!1):(d.create("success","核销验证成功"),void h.get({id:i.id},function(t){e.valilist=t.hexiao_data}))})},e.refund=function(e){t.refund({order_id:e.order_id,payment_sn:e.payment_sn},function(t){t.success?(e.status=3,d.create("success","申请退款成功")):d.create("danger","申请退款失败")})},l.get("/regions.json").success(function(t){e.cityInfo=t}),e.updateAddress=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.address.html",controller:"updateAddress",resolve:{data:function(){return t},cityData:function(){return e.cityInfo}}});a.result.then(function(t){t&&(e.orderdetail.province=t.province,e.orderdetail.province_name=t.province_name,e.orderdetail.city=t.city,e.orderdetail.city_name=t.city_name,e.orderdetail.district=t.district,e.orderdetail.district_name=t.district_name,e.orderdetail.address=t.address,e.orderdetail.zipcode=t.zipcode,e.orderdetail.consignee=t.consignee,e.orderdetail.mobile=t.mobile,t.store_name&&e.orderdetail.store_manage.name&&(e.orderdetail.store_manage.name=t.store_name))})},e.updateStore=function(e){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.store.html",controller:"updateStore",resolve:{data:function(){return e}}});a.result.then(function(a){t.setStore({order_id:e.id,store_id:a.id},function(t){t.success?(d.create("success","修改成功"),e.selffetch_store=angular.copy(a)):d.create("danger","修改失败")})})},e.revisePrice=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.reviseprice.html",controller:"revisePrice",resolve:{data:function(){return t},isList:function(){return!1}}});a.result.then(function(a){a&&(e.orderdetail=a.data,m(t))})},e.saveDelivery=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return t},isList:function(){return!1}}});a.result.then(function(t){t&&(e.orderdetail=t.data,f(),m(e.orderdetail))})},e.setDelivery=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.setdelivery.html",controller:"setDelivery",resolve:{data:function(){return t},order_id:function(){return e.orderdetail.id}}});a.result.then(function(e){e&&(t.logis_name=e.name,t.logis_no=e.number)})},e.closeOrder=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.close.html",controller:"closeOrder",resolve:{data:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,m(e.orderdetail))})},e.expressSet=function(t,a,o){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},p.save(e.orderQureyData,function(e){if(e.status){c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return o}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})},e.orderPick=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.pick.html",controller:"orderPickCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,m(e.orderdetail))})},e.resetStore=function(t,a){var o=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.resetStore.html",controller:"resetStore",resolve:{store_list:function(){return t},order_id:function(){return a}}});o.result.then(function(t){e.orderdetail.store_manage.name=t.store_name})},e.orderExtend=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.extend.html",controller:"orderExtendCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail.finished_at=t,m(e.orderdetail))})}}]),e.controller("expressOrder",["$scope","$http","$modalInstance","data","logis_code","Flash","getexpress",function(e,t,a,o,s,n,r){r.get({logis_code:s,logis_no:o},function(t){e.expressData=t.data}),e.cancel=function(){a.dismiss("cancel")}}]),e.controller("orderPickCont",["$scope","$modalInstance","orderpick","id","Flash",function(e,t,a,o,s){e.but={text:"确定",status:!1},e.confirm=function(){e.but.text="提交中",e.but.status=!0,a.update({id:o},function(a){1==a.success?(s.create("success","设置成功"),t.close(a)):s.create("danger",a.error.msg),e.but.text="确定",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("setDelivery",["$scope","$modalInstance","getDelivery","order","data","order_id","Flash",function(e,t,a,o,s,n,r){e.oldModalData=s,e.modalData=angular.copy(s),a.get({id:n},function(t){e.deliveryList=t.deliveryInfo,e.address=t.addressInfo.province_name+t.addressInfo.city_name+t.addressInfo.district_name+t.addressInfo.address+" , "+t.addressInfo.consignee+" , "+t.addressInfo.mobile}),e.deliveryInfo={isOther:0,id:e.modalData.id,name:e.modalData.logis_name,otherName:e.modalData.logis_name,code:e.modalData.logis_code,number:e.modalData.logis_no},1==e.modalData.type&&(e.deliveryInfo.isOther=1,e.deliveryInfo.otherName="其他物流"),e.set_delivery=function(t,a,o){e.deliveryInfo.isOther=t,e.deliveryInfo.otherName=a,0==t?(e.deliveryInfo.name=a,e.deliveryInfo.code=o):(e.deliveryInfo.name="",e.deliveryInfo.code="")},e.but={text:"修改",status:!1},e.confirm=function(){var a=/^[0-9a-zA-Z]+$/,s=!1;0==e.deliveryInfo.isOther?""!=e.deliveryInfo.number?a.test(e.deliveryInfo.number)?s=!0:(r.create("danger","请输入正确的物流单号"),s=!1):(r.create("danger","请填写物流信息"),s=!1):""!=e.deliveryInfo.name&&""!=e.deliveryInfo.number?a.test(e.deliveryInfo.number)?s=!0:(r.create("danger","请输入正确的物流单号"),s=!1):""==e.deliveryInfo.name?(r.create("danger","请填写物流公司名称"),s=!1):""==e.deliveryInfo.number&&(r.create("danger","请填写物流单号"),s=!1),s&&(e.but.text="提交中",e.but.status=!0,o.setDelivery(e.deliveryInfo,function(a){1==a.success?(r.create("success","修改成功"),t.close(e.deliveryInfo)):r.create("danger",a.error),e.but.text="修改",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("orderExtendCont",["$scope","$modalInstance","order","id","Flash",function(e,t,a,o,s){e.but={text:"提交",status:!1},e.saveInfo={day:"3"},e.confirm=function(){e.but.text="提交中",e.but.status=!0,a.extend({id:o,day:e.saveInfo.day},function(a){1==a.success?(s.create("success","修改成功"),t.close(a.data)):s.create("danger",a.error),e.but.text="提交",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("resetStore",["$scope","$modalInstance","store_list","order_id","Flash","resetStore",function(e,t,a,o,s,n){e.but={text:"提交",status:!1},n.get({id:o},function(t){e.data=t,e.data.store_list=a}),e.saveResetStore=function(){e.but.text="提交中",e.but.status=!0,n.put({order_id:o,store_id:e.data.store_id},function(a){a.status?(s.create("success",a.msg),t.close(a)):s.create("danger",a.msg),e.but.text="提交",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/comment.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.comment.list",["$scope","Flash","commentList","$stateParams","$location","$modal","videoAddress",function(e,t,a,o,s,n,r){e.videoAddress=r,e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var i=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage;var t=s.search();t.order_sn&&(e.searchInfo.order_sn=t.order_sn),t.goods_id&&(e.searchInfo.goods_id=t.goods_id),a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data},function(t){e.data=[]})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.searchlog=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.open_close_status=!1,e.open_close=function(o){var s="";s=o.is_show?"open":"close",e.open_close_status=!0,a.update({id:o.id,goodsid:o.goods_id,ordersn:o.order_sn,orderid:o.order_id,isshow:s},function(a){e.open_close_status=!1,a.status?t.create("success","修改成功！"):(t.create("danger","修改失败！"),o.is_show=!o.is_show)})},e.setreply=function(e){var t=n.open({animation:!1,templateUrl:"assets/js/apps/order/templates/setreply.html",controller:"shop.order.comment.setreply",resolve:{order_id:function(){return e.id},goods_id:function(){return e.goods_id}}});t.result.then(function(e){i()})}}]),e.controller("shop.order.comment.setreply",["$scope","$modalInstance","commentReply","order_id","goods_id","Flash",function(e,t,a,o,s,n){e.isZero=!1,a.get({id:o,goodsid:s},function(t){e.data=t,t.data&&(e.isZero=!0)}),e.cancel=function(){t.dismiss("cancel")},e.btn_text="保存",e.editPwdClick=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,e.isZero?a.put({id:e.data.id,reply:e.data.data,amend:"amend"},function(a){e.form.$invalid=!1,a.status?(n.create("success",a.msg),t.close(1)):(n.create("danger",a.msg),t.close(0))}):a.post({id:e.data.id,reply:e.data.data,add:"add"},function(a){e.form.$invalid=!1,a.status?(n.create("success",a.msg),t.close(1)):(n.create("danger",a.msg),t.close(0))}))}}])}),define("apps/order/controllers/comment.setting",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.comment.setting",["$scope","Flash","commentStatus",function(e,t,a){a.get(function(t){e.data=t}),e.open_close_status=!1,e.open_close=function(){var t=angular.element(document.getElementById("status"))[0].checked;e.open_close_status=!0,t?a.update({is_open:"open"},function(t){e.open_close_status=!1,t.status&&(e.data=t)}):a.update({is_open:"close"},function(t){e.open_close_status=!1,e.data=t})},e.setcomment=function(){1==e.data.type?a.update({type:"evaluate"}):a.update({type:"audit"})}}])}),define("apps/order/controllers/feedback",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.feedback",["$scope","feedback","$stateParams","$modal","Flash","orderQureyPay",function(e,t,a,o,s,n){function r(t){if(0==t.refund_info.type&&(e.refundItem=[{title:"申请退款中",at:t.refund_info.created_at,type:!1},{title:"商家处理退款申请",at:t.refund_info.operated_at,type:!1},{title:"退款已完成",at:t.refund_info.finished_at,type:!1}],1==t.refund_info.feedback)){var a={title:"第三方退款中",at:t.refund_info.applyed_at,type:!1};e.refundItem.splice(2,0,a)}if(1==t.refund_info.type&&(e.refundItem=[{title:"买家申请退款中",at:t.refund_info.created_at,type:!1},{title:"商家同意退款,等待买家退货",at:t.refund_info.operated_at,type:!1},{title:"买家货物已寄出,等待商家确认",at:t.refund_info.shipmented_at,type:!1},{title:"退款已完成",at:t.refund_info.finished_at,type:!1}],1==t.refund_info.feedback)){var a={title:"第三方退款中",at:t.refund_info.applyed_at,type:!1};e.refundItem.splice(3,0,a)}switch(e.feedbackState={title:"",titleIcon:"",titleInfo:"",bottonAgreeText:"",bottonAgreeStatus:!1,bottonRejectText:"",bottonRejectStatus:!1},t.refund_info.status){case 10:e.feedbackState.title="等待商家处理退款申请",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 11:e.feedbackState.title="买家再次申请退款，等待商家处理退款申请",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 12:e.feedbackState.title="系统申请退款中",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 20:0==t.refund_info.type?(e.feedbackState.title="商家同意退款",e.feedbackState.titleInfo="商家同意退款",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.title="商家已同意退款,请退货给商家",e.feedbackState.titleInfo="您已同意退款协议，请等待买家处理。",e.feedbackState.bottonAgreeText="已收到货，同意退款",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0,e.refundItem[1].type=!0;break;case 21:e.feedbackState={title:"商家不同意退款申请",titleIcon:"",titleInfo:"您已拒绝本次退款申请，买家修改退款申请后，需要您重新处理。",bottonAgreeText:"",bottonRejectText:""},0==t.refund_info.type?e.feedbackState.bottonAgreeText="同意退款给买家":e.feedbackState.bottonAgreeText="同意退货,发送退货地址";break;case 22:e.feedbackState={title:"已退货，等待商家确认收货",titleIcon:"",titleInfo:"买家已退货，请关注退货信息!",bottonAgreeText:"已收到货，同意退款",bottonRejectText:"拒绝退货申请"},e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!1,e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0;break;case 30:e.feedbackState={title:"第三方退款中",titleIcon:"",titleInfo:"退款金额:￥"+e.feedbackData.refund_info.refund_amount,bottonAgreeText:"",bottonRejectText:""},e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0,1==t.refund_info.feedback&&1==t.refund_info.type&&(e.refundItem[3].type=!0);break;case 31:e.feedbackState={title:"退款成功"+(1==t.refund_info.supplier_act_status?"(等待厂家打款)":""),titleIcon:"",titleInfo:"退款金额:￥"+t.refund_info.refund_amount,bottonAgreeText:"",bottonRejectText:""},e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0,1==t.refund_info.feedback&&(0==t.refund_info.type&&(e.refundItem[3].type=!0),1==t.refund_info.type&&(e.refundItem[3].type=!0,e.refundItem[4].type=!0)),0==t.refund_info.feedback&&1==t.refund_info.type&&(e.refundItem[3].type=!0);break;case 40:e.feedbackState={title:"已关闭",titleIcon:"",titleInfo:"申请已经关闭",bottonAgreeText:"",bottonRejectText:""};break;case 41:e.feedbackState={title:"用户已关闭",titleIcon:"",titleInfo:"申请已经关闭",bottonAgreeText:"",bottonRejectText:""}}}e.angular=angular,e.refundItem=[],t.get({id:a.id},function(t){e.feedbackData=t,r(t)}),e.agreeFeedback=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.feedback.agree.html",controller:"agreeFeedback",resolve:{data:function(){var t=e.feedbackData;return t}}});t.result.then(function(t){t&&(e.feedbackData=t.data,r(t.data))})},e.rejectFeedback=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.feedback.reject.html",controller:"rejectFeedback",resolve:{data:function(){var t=e.feedbackData;return t}}});t.result.then(function(t){t&&(e.feedbackData=t.data,r(t.data))})},e.expressSet=function(t,a,s){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},n.save(e.orderQureyData,function(e){if(e.status){o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return s}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})}}]),e.controller("agreeFeedback",["$scope","$modalInstance","data","feedback","Flash",function(e,t,a,o,s){e.agreeData=a,e.returnInfo={id:a.refund_info.refund_id,refundtype:a.refund_info.type,status:a.refund_info.status,order_goods_id:a.goods_info.order_goods_id,address:""},0==e.agreeData.refund_info.type&&(e.bottonText="同意"),1==e.agreeData.refund_info.type&&(10!=e.agreeData.refund_info.status&&11!=e.agreeData.refund_info.status&&12!=e.agreeData.refund_info.status&&21!=e.agreeData.refund_info.status||(e.bottonText="同意"),
20!=e.agreeData.refund_info.status&&22!=e.agreeData.refund_info.status||(e.bottonText="确认收到货,并退款给买家")),e.butStatus=!1,e.confirm=function(){if(""!=e.returnInfo.address||1!=a.refund_info.type||10!=a.refund_info.status&&11!=a.refund_info.status&&12!=a.refund_info.status&&21!=a.refund_info.status)if(1==e.returnInfo.refundtype){if(10==e.returnInfo.status||11==e.returnInfo.status||12==e.returnInfo.status||21==e.returnInfo.status){var n={id:e.returnInfo.id,type:1,address:e.returnInfo.address,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.update(n,function(a){1==a.success?(t.close(a),s.create("success","您已同意买家的退款"),e.cancel()):s.create("danger",a.error),e.butStatus=!1})}if(20==e.returnInfo.status||22==e.returnInfo.status){var n={id:e.returnInfo.id,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.refund(n,function(a){if(1==a.success)if(angular.isUndefined(a.data.feedback_url))t.close(a),s.create("success","您已同意买家的退款"),e.cancel();else{window.open(a.data.feedback_url),e.cancel();$modal.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return a.data.feedback_url}}})}else s.create("danger",a.error);e.butStatus=!1})}}else{var n={id:e.returnInfo.id,type:1,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.update(n,function(a){if(1==a.success)if(angular.isUndefined(a.data.feedback_url))t.close(a),s.create("success","您已同意买家的退款"),e.cancel();else{window.open(a.data.feedback_url),e.cancel();$modal.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return a.data.feedback_url}}})}else s.create("danger",a.error);e.butStatus=!1})}else s.create("danger","请填写退货地址")},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("rejectFeedback",["$scope","$modalInstance","data","feedback","Flash",function(e,t,a,o,s){e.rejectData=a,e.rejectInfo={id:a.refund_info.refund_id,refundtype:a.refund_info.type,status:a.refund_info.status,order_goods_id:a.goods_info.order_goods_id,reason:""},e.butStatus=!1,e.confirm=function(){""==e.rejectInfo.reason?s.create("danger","请填写拒绝理由"):(e.butStatus=!0,o.update({id:e.rejectInfo.id,reason:e.rejectInfo.reason,type:"2",order_goods_id:e.rejectInfo.order_goods_id},function(a){1==a.success?(t.close(a),s.create("success","提交成功"),e.cancel()):s.create("danger","提交失败"),e.butStatus=!1}))},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("modalFeedback",["$scope","$state","$modalInstance","url",function(e,t,a,o){e.goUrl=o,e.refresh=function(){a.close(),t.reload()}}])}),define("apps/order/controllers/setting",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.setting",["$scope","Flash","merchantSettingResource",function(e,t,a){e.data=a.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.update(e.data,function(o){e.merchant_info=a.get(),e.btn_text="保存",e.form.$invalid=!1,t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/order/controllers/setting.deadline",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.setting.deadline",["$scope","Flash","orderDeadline","merchantSettingResource",function(e,t,a,o){o.get(function(t){e.data=t.minutes,e.day=t.auto_finished_time}),e.btn_text="保存",e.btn_status=!1,e.submitForm=function(o){var s=/^[1-9]\d*$/;if(!s.test(e.data))return t.create("danger","请输入正确的数字"),o.input_deadline.$dirty=!0,o.input_deadline.$invalid=!0,$("input[name='input_deadline']").focus(),!1;var n=parseInt(e.data);if(n<20)return t.create("danger","请输入大于20的正整数"),o.input_deadline.$dirty=!0,o.input_deadline.$invalid=!0,$("input[name='input_deadline']").focus(),!1;var r=parseInt(e.day);return s.test(e.data)?r<7?(t.create("danger","请输入不小于7的正整数"),o.input_confirm.$dirty=!0,o.input_confirm.$invalid=!0,$("input[name='input_confirm']").focus(),!1):(e.btn_text="保存中...",e.btn_status=!0,void a.get({time:e.data,day:e.day},function(a){1==a.status?t.create("success"," 保存成功！"):(e.form.$invalid=!1,t.create("danger",a.msg)),e.btn_text="保存",e.btn_status=!1})):(t.create("danger","请输入正确的数字"),o.input_confirm.$dirty=!0,o.input_confirm.$invalid=!0,$("input[name='input_confirm']").focus(),!1)}}])}),define("apps/order/controllers/setting.message",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.setting.message",["$scope","Flash","merchantSettingResource",function(e,t,a){e.data=a.get(function(t){e.data.new_fields=[],angular.forEach(t.fields,function(t,a){e.data.new_fields.push({name:t.name,type:t.type,multiple:!!t.multiple,required:!!t.required})}),e.data.fields=e.data.new_fields}),e.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"num",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"},{name:"image",title:"图片"}],e.addCollectFields=function(){var t={name:"",type:"text",multiple:!1,required:!0};e.data.fields.push(t)},e.deleteCollectFields=function(t){e.data.fields.splice(t,1)},e.btn_text="保存",e.submitForm=function(o){if(o){var s=e.form;if(e.btn_text="保存中...",e.data.fields){var n=!1;if(angular.forEach(e.data.fields,function(e,t){var a="collectFieldsName"+t;if(s[a].$invalid)return s[a].$dirty=!0,$('input[name="'+a+'"]').focus(),n=!0,!1}),n)return!1;angular.forEach(e.data.fields,function(t,a){e.data.fields[a].name=t.name,e.data.fields[a].type=t.type,e.data.fields[a].required=t.required?1:0,delete e.data.fields[a].multiple})}e.form.$invalid=!0,a.update(e.data,function(o){e.data=a.get(function(e){e.new_fields=[],angular.forEach(e.fields,function(t,a){e.new_fields.push({name:t.name,type:t.type,multiple:!!t.multiple,required:!!t.required})}),e.fields=e.new_fields}),e.btn_text="保存",e.form.$invalid=!1,t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)})}}}])}),define("apps/order/controllers/setting.orderShare",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.setting.orderShare",["$scope","orderShareResource","$modal","Flash",function(e,t,a,o){var s=this,n=function(){var e={offset:s.paginationConf.currentPage,limit:s.paginationConf.itemsPerPage};return t.get({offset:(e.offset-1)*e.limit,limit:e.limit},function(e){s.paginationConf.totalItems=e._total,s.data=e.data})},r=function(){1!=s.paginationConf.currentPage?s.paginationConf.currentPage=1:n()},i=function(e){a.open({templateUrl:"assets/js/apps/order/templates/order.setting.orderShare.modal.html",controller:"shop.order.setting.orderShare.modal",controllerAs:"vm",resolve:{item:function(){return e}}}).result.then(function(){n()})},c=function(e){a.open({templateUrl:"assets/js/apps/order/templates/order.setting.orderShare.modal.html",controller:"shop.order.setting.orderShare.modal",controllerAs:"vm",resolve:{item:function(){return e}}})},l=function(e){t.delete({id:e},function(e){e.status&&(o.create("success","删除成功"),r())},function(e){o.create("danger",e.data.error.message)})},d=function(){s.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",n)};s.new_built=i,s.edit=c,s.getPage=n,s.confirmDelete=l,d()}])}),define("apps/order/controllers/setting.orderShare.modal",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.setting.orderShare.modal",["$scope","orderShareResource","$modalInstance","item","Flash",function(e,t,a,o,s){var n=this;n.data=o;var r=function(e){e&&(form.$invalid=!0,n.btn_text="保存中...",o?(n.btn_text="修改中...",t.update(n.data,function(e){return form.$invalid=!1,n.btn_text="修改",e.status?(s.create("success",e.msg||"修改成功！"),void a.close(1)):(s.create("danger",e.msg||"修改失败"),!1)},function(e){form.$invalid=!1,n.btn_text="修改",s.create("danger",e.data.error.message),a.dismiss("cancel")})):t.save(n.data,function(e){return form.$invalid=!1,n.btn_text="保存",e.status?(s.create("success",e.msg||" 添加成功！"),void a.close(1)):(s.create("danger",e.msg||"添加失败"),!1)},function(e){form.$invalid=!1,n.btn_text="保存",s.create("danger",e.data.error.message),a.dismiss("cancel")}))},i=function(){a.dismiss("cancel")},c=function(){n.btn_text="保存",null!=o&&(n.btn_text="修改")};n.saveShare=r,n.cancel=i,c()}])}),define("apps/order/controllers/order.address",["apps/common/controllers/controllers"],function(e){e.controller("updateAddress",["$scope","$modalInstance","order","data","cityData","Flash",function(e,t,a,o,s,n){e.modalData=angular.copy(o),e.cityInfo={data:s};var r=e.city=this;r.regions={country:1,province:e.modalData.province,city:e.modalData.city,district:e.modalData.district},r.start="province",r.end="district",e.but={text:"修改",status:!1},e.saveOrderAddr=function(o){if(r.selected&&(e.modalData.province=r.selected[0].id,e.modalData.city=r.selected[1].id,e.modalData.district=r.selected[2].id),e.addressInfo={id:e.modalData.id,province:r.selected[0].id,province_name:r.selected[0].name,city:r.selected[1].id,city_name:r.selected[1].name,district:r.selected[2].id,district_name:r.selected[2].name,address:e.modalData.address,zipcode:e.modalData.zipcode,consignee:e.modalData.consignee,mobile:e.modalData.mobile},o.input_address.$invalid)return o.input_address.$dirty=!0,$("input[name='input_address']").focus(),!1;if(o.input_zipcpde.$invalid)return o.input_zipcpde.$dirty=!0,$("input[name='input_zipcpde']").focus(),!1;if(o.input_consignee.$invalid)return o.input_consignee.$dirty=!0,$("input[name='input_consignee']").focus(),!1;if(o.input_mobile.$invalid)return o.input_mobile.$dirty=!0,$("input[name='input_mobile']").focus(),!1;var s=/^\d+(\.\d+)?$/;s.test(e.addressInfo.mobile)?(e.but.text="提交中",e.form.$invalid=!0,a.setAddress(e.addressInfo,function(a){1==a.success?(n.create("success","修改成功"),e.addressInfo.store_name=a.store_name,t.close(e.addressInfo)):n.create("danger","修改失败"),e.but.text="修改",e.form.$invalid=!1})):s.test(e.addressInfo.mobile)||n.create("danger","请填写正确的手机号码")},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/order.close",["apps/common/controllers/controllers"],function(e){e.controller("closeOrder",["$scope","$modalInstance","order","data","Flash",function(e,t,a,o,s){e.modalData=angular.copy(o),e.closeReason={id:o.id,close_reason:""},e.but={text:"确定"},e.saveCloseInfo=function(o){o&&(e.but.text="提交中...",e.form.$invalid=!0,a.close(e.closeReason,function(a){e.form.$invalid=!1,1==a.success?(s.create("success","修改成功"),t.close(a)):s.create("danger","修改失败"),e.but.text="确定"}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/order.delivery",["apps/common/controllers/controllers"],function(e){e.controller("saveDelivery",["$scope","$modalInstance","data","isList","order","saveDeliver","getDelivery","getCardStock","Flash",function(e,t,a,o,s,n,r,i,c){function l(){if(e.isShow=!0,"goodslist"in e.modalData.goodslist&&1==e.modalData.goodslist[0].is_virtual&&(e.deliveryInfo.card_type=1),1==e.modalData.is_virtual){i.get({id:e.modalData.goodslist[0].id},function(t){e.CardStock=t.card_num}),e.modalData.goodslist[0].quantity||(e.CardStock=0);for(var t=e.modalData.goodslist[0].quantity,a=0;a<t;a++){var o={card_text:"",index:a};e.virtual_oper_area.push(o)}}r.get({id:e.modalData.id},function(t){e.deliveryList=t.deliveryInfo,e.addressInfo=t.addressInfo,e.sn_is_hexiao=t.sn_is_hexiao,1==e.sn_is_hexiao&&(e.deliveryInfo.type=1)}),e.$watch("delivery.checkedAll",function(t){if(t)for(var a=0;a<e.modalData.goodslist.length;a++)e.modalData.goodslist[a].unbilled_quantity>0&&e.checkboxIds.push(e.modalData.goodslist[a].id);else e.checkboxIds=[]})}e.virtual_oper_area=[],e.deliveryInfo={type:0,isOther:0,id:"",name:"",otherName:"",code:"",number:""},e.delivery={checkedAll:!0},e.checkboxIds=[],e.isShow=!1,o?s.get({id:a},function(t){e.modalData=t,l()}):(e.modalData=angular.copy(a),l()),e.toggleSelection=function(t){var a=e.checkboxIds.indexOf(t);a>-1?e.checkboxIds.splice(a,1):e.checkboxIds.push(t)},e.inputBlur=function(e){var t=/^[0-9]+.?[0-9]*$/;t.test(e.delivery_quantity)?(parseInt(e.delivery_quantity)>parseInt(e.unbilled_quantity)||parseInt(e.delivery_quantity)<1)&&(c.create("danger","请填写正确的发货数量"),e.delivery_quantity=e.unbilled_quantity):(c.create("danger","请输入数字"),e.delivery_quantity=e.unbilled_quantity)},e.set_delivery=function(t,a,o,s){e.deliveryInfo.isOther=t,e.deliveryInfo.otherName=o,0==t?(e.deliveryInfo.id=a,e.deliveryInfo.name=o,e.deliveryInfo.code=s):(e.deliveryInfo.id="",e.deliveryInfo.name="",e.deliveryInfo.code="")},e.but={text:"确定",status:!1},e.areaitem={card_text:""},e.saveOrderDelivery=function(){var a=e.modalData.goodslist,o=e.checkboxIds,s=!1,r={order_id:e.modalData.id,goods:[],deliveryInfo:e.deliveryInfo};if(o.length>0){if(1==e.modalData.goodslist[0].is_virtual){for(var i=0;i<a.length;i++)for(var l=0;l<o.length;l++)if(a[i].id==o[l]){var d={id:a[i].id,sum:a[i].delivery_quantity};r.goods.push(d)}if(r.card_type=e.deliveryInfo.card_type,r.is_virtual=e.modalData.goodslist[0].is_virtual,delete r.deliveryInfo,s=!0,2==e.deliveryInfo.card_type?e.virtual_oper_area&&(r.card_codes=[],angular.forEach(e.virtual_oper_area,function(e,t){""==e.card_text&&(c.create("danger","请填写所有商品卡密"),s=!1),r.card_codes.push(e.card_text)})):e.CardStock<e.modalData.goodslist[0].quantity&&(c.create("danger","卡密库存不足"),s=!1),1==s){var p=/^[0-9a-zA-Z]+$/,u=!1;e.but.text="发货中",e.but.status=!0,n.save(r,function(a){1==a.success?(c.create("success","发货成功"),t.close(a)):c.create("danger",a.error),e.but.text="确定",e.but.status=!1})}return!1}if(0==e.modalData.goodslist[0].is_virtual)if(0==e.deliveryInfo.type){var p=/^[0-9a-zA-Z]+$/,u=!1;if(0==e.deliveryInfo.isOther?""!=e.deliveryInfo.id&&""!=e.deliveryInfo.number?p.test(e.deliveryInfo.number)?u=!0:(c.create("danger","请输入正确的物流单号"),u=!1):(c.create("danger","请填写物流信息"),u=!1):""!=e.deliveryInfo.name&&""!=e.deliveryInfo.number?u=!0:""==e.deliveryInfo.name?(c.create("danger","请填写物流公司名称"),u=!1):""==e.deliveryInfo.number&&(c.create("danger","请填写物流单号"),u=!1),u){for(var i=0;i<a.length;i++)for(var l=0;l<o.length;l++)if(a[i].id==o[l]){var d={id:a[i].id,sum:a[i].delivery_quantity};r.goods.push(d)}s=!0}}else if(1==e.deliveryInfo.type){for(var i=0;i<a.length;i++)for(var l=0;l<o.length;l++)if(a[i].id==o[l]){var d={id:a[i].id,sum:a[i].delivery_quantity};r.goods.push(d)}s=!0}else c.create("danger","请填写物流信息"),s=!1}else s=!1,c.create("danger","请选择要发货的商品");1==s&&(e.but.text="发货中",e.but.status=!0,n.save(r,function(a){1==a.success?(c.create("success","发货成功"),t.close(a)):c.create("danger",a.error),e.but.text="确定",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/order.setprice",["apps/common/controllers/controllers"],function(e){e.controller("revisePrice",["$scope","$modalInstance","data","isList","order","reviseprice","Flash",function(e,t,a,o,s,n,r){function i(){for(var t=e.modalData.goodslist,a=0,o=0,s=0,n=0,r=0;r<t.length;r++)a+=void 0!=_global.shop.supplier_id?parseFloat(t[r].price)*parseFloat(t[r].original_quantity):parseFloat(t[r].price)*parseFloat(t[r].quantity),o+=parseFloat(t[r].shipcost),s+=parseFloat(t[r].favorable);o>=0?e.price.set="+ "+o.toFixed(2):e.price.set=" "+o.toFixed(2),n=a+o+parseFloat(e.modalData.shipment_fee)-s,e.price.cost=a.toFixed(2),e.price.favo=s.toFixed(2),e.price.total=n.toFixed(2)}e.price={cost:0,set:0,favo:0,total:0};var c=/^([+-]?[0-9][\d]{0,3}|0)([.]?[\d]{1,2})?$/;o?s.get({id:a},function(t){e.modalData=t,i()}):(e.modalData=angular.copy(a),i()),e.priceSet=function(e,t,a){c.test($(t.target).val())?i():(r.create("danger","请输入正确的价格"),$(t.target).focus())},e.freightSet=function(e){return c.test($(e.target).val())?void($(e.target).val()>=0?i():(r.create("danger","邮费不能小于0"),$(e.target).focus())):($(e.target).focus(),r.create("danger","请输入正确的价格"),!1)},e.spareFreight=function(){e.modalData.shipment_fee=parseFloat(0).toFixed(2),i()},e.but={text:"确定",status:!1},e.saverevisePrice=function(){var a={order_id:e.modalData.id,goods:[],shipment_fee:e.modalData.shipment_fee},o=!0,s=e.modalData.goodslist;a.shipment_fee<0&&(o=!1,r.create("danger","邮费不能小于0"));for(var i=0;i<s.length;i++){var c=0;if(c=void 0!=_global.shop.supplier_id?parseFloat(s[i].price)*parseFloat(s[i].original_quantity)+parseFloat(s[i].shipcost)-parseFloat(s[i].favorable):parseFloat(s[i].price)*parseFloat(s[i].quantity)+parseFloat(s[i].shipcost)-parseFloat(s[i].favorable),c<0){o=!1,r.create("danger","单个商品总价不能小于0");break}var l={id:s[i].id,price:s[i].shipcost};a.goods.push(l)}o&&(e.but.text="提交中",e.but.status=!0,n.update(a,function(a){1==a.success?(r.create("success","修改成功"),t.close(a)):r.create("danger",a.error),e.but.text="确定",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/order.store",["apps/common/controllers/controllers"],function(e){e.controller("updateStore",["$scope","$modalInstance","data","storeSrv",function(e,t,a,o){e.modalData=angular.copy(a),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={type:1,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var s=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.query(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.store=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.selectStore=function(a){t.close(a),e.cancel()},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/controllers/order.fetchlog",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.fetchlog",["$scope","$state","Flash","orderFetchCheckLog","ngPopover","$modal","$location",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",limit_from:0,limit_to:3e3};var i=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data},function(t){e.data=[],a.create("danger",t.data.error)})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.searchlog=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1};var c=function(e,t){var a="";for(var o in t){var s=t[o];a+=encodeURIComponent(o)+"="+encodeURIComponent(s)+"&"}return a.length>0&&(a=a.substring(0,a.length-1),e=e+"?"+a),e};e.export=function(){e.searchInfo.export="yes";var t="/order/user_check_store_order_log.json";t=c(t,e.searchInfo),window.location.href=t,a.create("success","正在导出,请等待..."),delete e.searchInfo.export}}])}),define("apps/order/controllers/order.virtual.goods",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.virtual.goods",["$scope","$state","Flash","orderVirtualGoodsLog","ngPopover","$modal","$location","videoAddress",function(e,t,a,o,s,n,r,i){e.videoAddress=i,e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",limit_from:0,limit_to:3e3};var c=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data},function(t){e.data=[],a.create("danger",t.data.error)})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.searchlog=function(){1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1};var l=function(e,t){var a="";for(var o in t){var s=t[o];a+=encodeURIComponent(o)+"="+encodeURIComponent(s)+"&"}return a.length>0&&(a=a.substring(0,a.length-1),e=e+"?"+a),e};e.export=function(){e.searchInfo.export="yes";var t="/virtualgoods/cardslog.json";t=l(t,e.searchInfo),window.location.href=t,a.create("success","正在导出,请等待..."),delete e.searchInfo.export}}])}),define("apps/order/controllers/order.batch_delivery",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.batch_delivery",["$scope","orderBatchDelivery","Flash",function(e,t,a){e.paginationConf={currentPage:1,itemsPerPage:10},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.searchInfo={order_sn:"",deliverynumber:"",status:"all",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var o=function(){if(delete e.searchInfo.delivery_at_start,delete e.searchInfo.delivery_at_end,e.dates&&$('input[name="created_range"]').val()){var a=$('input[name="created_range"]').val(),o=a.split("/");e.searchInfo.delivery_at_start=o[0],e.searchInfo.delivery_at_end=o[1]}e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.list=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.search=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1},e.downTpl=function(){window.location.href="http://7xmw65.com2.z0.glb.qiniucdn.com/%E6%89%B9%E9%87%8F%E5%8F%91%E8%B4%A7%E6%A8%A1%E6%9D%BF_20160129.csv"},e.$watch("uploadStatus",function(t,a){t&&(e.uploadStatus=!1,1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1)})}])}),define("apps/order/controllers/order.reports",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.reports",["$scope","$state","Flash","reportsDownload",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:"desc"};var s=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data},function(t){e.data=[],a.create("danger",t.data.error)})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.searchlog=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1};e.reports=function(e){var t=e;window.location.href=t,a.create("success","正在下载,请等待...")}}])}),define("apps/order/controllers/order.validate",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.validate",["$scope","$state","hexiao","hexiaoSrh","Flash","$stateParams","$location",function(e,t,a,o,s,n,r){e.showData=!1,e.searchHexiao=function(){e.$watch("$scope.srhHexiao",function(){null==e.srhHexiao?s.create("danger","请输入核销码验证"):o.search({id:e.srhHexiao},function(t){1==t.status&&(e.hexiaoSrh=t.hexiao_info,e.showData=!0,e.timeScope=t.hexiao_info.hx_type,e.hexiaoStatus=t.hexiao_info.hx_status_name),10001==t.status&&s.create("danger","查询不到该核销码")})})},e.hexiao=function(e){a.save({id:e},function(e){return 1!=e.status?(s.create("danger",e.msg),!1):void s.create("success","核销验证成功")})}}])}),define("apps/order/controllers/order.underline",["apps/common/controllers/controllers"],function(e){e.controller("shop.order.underline",["$scope","$state","Flash","$modal","$location","storeResource","hexiaoSizeResource",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={order_hexiao_sn:"",verify_name:"",store_id:"0",status:"0",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},e.sortClass=function(t){return 2==e.searchInfo.verify_at_orderby&&1==t||1==e.searchInfo.verify_at_orderby&&2==t};var i=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,r.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.hexiaolist=t.data})};e.sort=function(t){1==e.searchInfo.verify_at_orderby?e.searchInfo.verify_at_orderby=2:2==e.searchInfo.verify_at_orderby?e.searchInfo.verify_at_orderby=0:e.searchInfo.verify_at_orderby=1,i()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),n.get(function(t){e.storeList=t.data}),r.get(function(t){e.hexiaolist=t.data}),e.searchList=function(t){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.export=function(){var t="/hexiao/hexiaolist.json?export=1";angular.forEach(e.searchInfo,function(e,a){e&&(t+="&"+a+"="+e)}),window.location.href=t,a.create("success","正在导出,请等待...")}}])}),define("apps/order/controllers/_base",["apps/order/controllers/list","apps/order/controllers/detail","apps/order/controllers/comment.list","apps/order/controllers/comment.setting","apps/order/controllers/feedback","apps/order/controllers/setting","apps/order/controllers/setting.deadline","apps/order/controllers/setting.message","apps/order/controllers/setting.orderShare","apps/order/controllers/setting.orderShare.modal","apps/order/controllers/order.address","apps/order/controllers/order.close","apps/order/controllers/order.delivery","apps/order/controllers/order.setprice","apps/order/controllers/order.store","apps/order/controllers/order.fetchlog","apps/order/controllers/order.virtual.goods","apps/order/controllers/order.batch_delivery","apps/order/controllers/order.reports","apps/order/controllers/order.batch_delivery","apps/order/controllers/order.validate","apps/order/controllers/order.underline"],function(){}),define("apps/order/services/order",["apps/common/services/services"],function(e){e.factory("order",["$resource",function(e){return e("/order/:id.json",{id:"@id"},{save:{method:"POST",url:"/order/.json"},setAddress:{method:"PUT",url:"/order/address.json"},setStar:{method:"PUT",url:"/order/star/set.json"},close:{method:"PUT",url:"/order/close_order/:id.json"},setDelivery:{method:"PUT",url:"/order/logistics/:id.json"},setRemarks:{method:"PUT",url:"/order/remarks.json"},setStore:{method:"POST",url:"/order/deliveryPlace.json"},extend:{method:"PUT",url:"/order/extend/:id.json"},postCustom:{method:"POST",url:"/order/declareOrder/:id.json"},resetCustom:{method:"GET",url:"/order/declareQuery/:id.json"},refund:{method:"POST",url:"/order/exceed_refund.json"}})}]),e.factory("hexiao",["$resource",function(e){return e("/hexiao/verifyhexiao/:id.json",{id:"@id"},{save:{method:"POST",url:"/hexiao/verifyhexiao/:id.json"}})}]),e.factory("hexiaoSrh",["$resource",function(e){return e("/hexiao/hexiaoinfo/:id.json",{id:"@id"},{search:{method:"GET",url:"/hexiao/hexiaoinfo/:id.json"}})}]),e.factory("hexiaoSizeResource",["$resource",function(e){return e("/hexiao/hexiaolist.json",{},{get:{method:"GET"}})}]),e.factory("storeResource",["$resource",function(e){return e("/store.json",{},{get:{method:"GET"}})}]),e.factory("getDelivery",["$resource",function(e){return e("/order/delivery/:id.json",{id:"@id"},{query:{method:"GET",url:"/order/delivery/:id.json"}})}]),e.factory("saveDeliver",["$resource",function(e){return e("/order/shipments.json",{},{save:{method:"POST",url:"/order/shipments.json"}})}]),e.factory("feedback",["$resource",function(e){return e("/order/refund_details.json",{},{get:{method:"GET",url:"/order/refund_details.json"},update:{method:"PUT",url:"/order/set/goods_refund.json"},refund:{method:"PUT",url:"/order/goods_refund_receipt.json"}})}]),e.factory("reviseprice",["$resource",function(e){return e("/order/set/order_price.json",{},{update:{method:"PUT",url:"/order/set/order_price.json"}})}]),e.factory("getexpress",["$resource",function(e){return e("/order/searchLogistics.json",{},{get:{method:"GET",url:"/order/searchLogistics.json"}})}]),e.factory("orderpick",["$resource",function(e){return e("/order/order_pick/:id.json",{id:"@id"},{update:{method:"PUT",url:"/order/order_pick/:id.json"}})}]),e.factory("orderpick",["$resource",function(e){return e("/order/order_pick/:id.json",{id:"@id"},{update:{method:"PUT",url:"/order/order_pick/:id.json"}})}]),e.factory("orderDeadline",["$resource",function(e){return e("/expiration_time.json",{},{get:{method:"PUT"}})}]),e.factory("orderShareResource",["$resource",function(e){return e("/shareorder/shareorder/:id.json",{id:"@id"},{get:{method:"GET",url:"/shareorder/shareorders.json"},update:{method:"PUT",url:"/shareorder/shareorder/:id.json"},delete:{method:"DELETE",url:"shareorder/shareorder/:id.json"},save:{method:"POST",url:"/shareorder/shareorder.json"}})}]),e.factory("orderBatchDelivery",["$resource",function(e){return e("/order/batchShippingLog.json",{},{get:{method:"GET"}})}]),e.factory("orderFetchCheckLog",["$resource",function(e){return e("/order/user_check_store_order_log.json",{},{get:{method:"GET"}})}]),e.factory("orderVirtualGoodsLog",["$resource",function(e){return e("/virtualgoods/cardslog.json",{},{get:{method:"GET"}})}]),e.factory("getCardStock",["$resource",function(e){return e("/order/getCardStock.json",{id:"@id"},{get:{method:"GET",url:"/order/getCardStock.json?order_goods_id=:id"}})}]),e.factory("orderQureyPay",["$resource",function(e){return e("/service_account/check_delivery.json",{})}]),e.factory("resetStore",["$resource",function(e){return e("/store/store_manage/:id.json",{id:"@id"},{get:{method:"GET"},put:{method:"PUT",url:"/store/store_manage.json"}})}]),e.factory("reportsDownload",["$resource",function(e){return e("/order/download.json",{},{get:{method:"GET"}})}])}),define("apps/order/services/comment",["apps/common/services/services"],function(e){e.factory("comment",["$resource",function(e){return e("/order/comment.json",{},{update:{method:"PUT"}})}]),e.factory("commentList",["$resource",function(e){return e("/order/comments.json",{},{update:{method:"PUT"},get:{method:"GET"}})}]),e.factory("commentStatus",["$resource",function(e){return e("/order/comment/comments.json",{},{update:{method:"PUT"},get:{method:"GET"}})}]),e.factory("commentReply",["$resource",function(e){return e("/order/sellerreply.json",{},{put:{method:"PUT"},post:{method:"POST"},get:{method:"GET"}})}])}),define("apps/order/services/_base",["apps/order/services/order","apps/order/services/comment"],function(){}),define("apps/order/directives/delivery.upload",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("deliveryUpload",["$modal",function(e){return{restrict:"AE",replace:!0,scope:{size:"@"},require:"^?ngModel",link:function(t,a,o,s){t.animationsEnabled=!1,a.bind("click",function(){n()});var n=function(a){var o=e.open({animation:t.animationsEnabled,controller:"delivery.upload.modal",templateUrl:"assets/js/apps/order/templates/delivery.upload.html",size:a,resolve:{type:function(){return t.type}}});o.result.then(function(e){s.$setViewValue(e)})}}}}]),t.controller("delivery.upload.modal",["$scope","$modalInstance","Flash",function(e,t,a){e.csvfileInfo={status:!1,name:"",size:0},e.butInfo={text:"确认上传",status:!1},e.ok=function(){if(!e.csvfileInfo.status)return a.create("danger","请选择一个CSV文件"),!1;if(e.csvfile.size>1048576)return a.create("danger","文件大小不能超过1MB"),!1;var o=e.csvfile.name.substr(e.csvfile.name.toLowerCase().lastIndexOf(".")+1);if("csv"!=o)return a.create("danger","请选择一个CSV文件。"),!1;var s=new FormData($("#csvFileUpload")[0]);$.ajax({url:"order/batchShipping.json",method:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(){e.butInfo.text="批量发货中..",e.butInfo.status=!0}}).done(function(o){o.status?(a.create("success",o.msg),t.close(o.status)):a.create("danger",o.msg||"导入失败，请重新检查文件"),e.butInfo.text="确认上传",e.butInfo.status=!1}).fail(function(t){a.create("danger","导入失败，请重新检查文件"),e.butInfo.text="确认上传",e.butInfo.status=!1})},e.selectCsvFile=function(t){
e.$apply(function(a){e.csvfile=t.files[0],e.csvfileInfo.status=!0,e.csvfileInfo.name=e.csvfile.name,e.csvfileInfo.size=parseFloat(e.csvfile.size/1024).toFixed(2)})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/order/directives/areaselect",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("areaSelect",[function(){return{restrict:"AE",replace:!0,scope:!1,templateUrl:"assets/js/apps/order/templates/area.select.html",controller:"areaSelectCtrl",link:function(e,t,a,o){}}}]),t.controller("areaSelectCtrl",["$scope","$http","$resource",function(e,t,a){var o;$.ajax({url:"/regions.json",type:"GET",dateType:"json",async:!1}).done(function(e){o=e});var s=e.ctrl=this;s.open=!1,s.tab=[{keyword:"province",name:"省份",class:!1},{keyword:"city",name:"城市",class:!1},{keyword:"district",name:"县区",class:!1}],s.start_name="province",s.level=s.tab.length,s.regions={},s.changeIds=[],s.selected=[],s.print="请选择收货地址","world"==s.start_name?s.num=0:"province"==s.start_name?s.num=1:angular.forEach(s.regions,function(e,t){t==s.start_name&&(s.num=e)}),s.areadata=o[s.num],s.changeIds=s.changeIds.concat(s.num),s.selectTab=function(e){angular.forEach(s.areadata,function(e,t){e.class=!1}),e.class=!0,s.selected.splice(s.changeIds.length-1,4);var t=s.selected.length;s.selected=s.selected.concat(e),t<s.level-1?(angular.forEach(s.tab,function(e,t){e.class=!1}),s.tab[t+1].class=!0,s.changeIds=s.changeIds.concat(e.id),s.areadata=o[e.id]):s.open=!1,s.city=[],angular.forEach(s.selected,function(e,t){s.city=s.city.concat(e.name)})},s.changeTab=function(e){"undefined"!=typeof s.changeIds[e]&&(angular.forEach(s.tab,function(e,t){e.class=!1}),s.tab[e].class=!0,s.changeIds.splice(e+1,4),s.selected.splice(s.changeIds.length-1,4),s.areadata=o[s.changeIds[e]])},e.$watch("ctrl.city",function(){if(angular.isArray(s.city)){var e="";angular.forEach(s.city,function(t,a){0==a?e=t:e+=" - "+t}),s.print=e}})}])}),define("apps/order/directives/_base",["apps/order/directives/delivery.upload","apps/order/directives/areaselect"],function(){}),define("apps/order/main",["apps/order/states/_base","apps/order/controllers/_base","apps/order/services/_base","apps/order/directives/_base"],function(){}),define("apps/delivery/states/company",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.delivery",{url:"/delivery",templateUrl:"assets/js/apps/delivery/templates/layout.html"}).state("shop.delivery.company",{abstract:!0,url:"/company",template:"<div ui-view></div>"}).state("shop.delivery.company.list",{url:"",templateUrl:"assets/js/apps/delivery/templates/company.list.html",controller:"delivery.company"})}])}),define("apps/delivery/states/shipments",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.delivery.shipments",{abstract:!0,url:"/shipments",template:"<div ui-view></div>"}).state("shop.delivery.shipments.list",{url:"",templateUrl:"assets/js/apps/delivery/templates/shipments.list.html",controller:"shipments.list"}).state("shop.delivery.shipments.add",{url:"/add",templateUrl:"assets/js/apps/delivery/templates/shipments.info.html",controller:"shipments.info"}).state("shop.delivery.shipments.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/delivery/templates/shipments.info.html",controller:"shipments.info"})}])}),define("apps/delivery/states/selffetch",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.delivery.selffetch",{abstract:!0,url:"/selffetch",template:"<div ui-view></div>"}).state("shop.delivery.selffetch.list",{url:"",templateUrl:"assets/js/apps/delivery/templates/selffetch.list.html",controller:"selffetch.list"})}])}),define("apps/delivery/states/waybill",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.delivery.waybill",{abstract:!0,url:"/waybill",template:"<div ui-view></div>"}).state("shop.delivery.waybill.list",{url:"",templateUrl:"assets/js/apps/delivery/templates/waybill.list.html",controller:"waybill.list"}).state("shop.delivery.waybill.add",{url:"/add",templateUrl:"assets/js/apps/delivery/templates/waybill.info.html",controller:"waybill.info",resolve:{deliveryLoader:["deliveryLoader",function(e){return e()}],storeLoader:["storeList",function(e){return e()}]}}).state("shop.delivery.waybill.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/delivery/templates/waybill.info.html",controller:"waybill.info",resolve:{deliveryLoader:["deliveryLoader",function(e){return e()}],waybillLoader:["waybillLoader","$stateParams",function(e,t){return e(t)}],storeLoader:["storeList",function(e){return e()}]}})}])}),define("apps/delivery/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.delivery.setting",{abstract:!0,url:"/setting",template:"<div ui-view></div>"}).state("shop.delivery.setting.main",{url:"",templateUrl:"assets/js/apps/delivery/templates/setting.html",controller:"delivery.setting"})}])}),define("apps/delivery/states/_base",["apps/delivery/states/company","apps/delivery/states/shipments","apps/delivery/states/selffetch","apps/delivery/states/waybill","apps/delivery/states/setting"],function(){}),define("apps/delivery/services/shipment",["apps/common/services/services"],function(e){e.factory("shipmentResource",["$resource",function(e){return e("/delivery/shipment.json",{id:"@id"},{get:{method:"GET",url:"/delivery/shipment/:id.json"},update:{method:"PUT",url:"/delivery/shipment/:id.json"},delete:{method:"DELETE",url:"/delivery/shipment/:id.json"}})}]),e.factory("fromShipmentResource",["$resource",function(e){return e("delivery/shop_shipments/:shop_id.json",{shop_id:"@shop_id"},{})}])}),define("apps/delivery/services/city",["apps/common/services/services"],function(e){e.factory("cityData",["$resource",function(e){var t=e("/regions.json"),a=!1;return a?a:a=t.get()}]),e.factory("cityData2",["$resource",function(e){return e("/regions.json")}])}),define("apps/delivery/services/waybill",["apps/common/services/services"],function(e){e.factory("waybillResource",["$resource",function(e){return e("/delivery/waybill/:id.json",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1}})}]),e.factory("waybillLoader",["waybillResource","$q",function(e,t){return function(a){var o=t.defer();return e.get({id:a.id},function(e){o.resolve(e)}),o.promise}}])}),define("apps/delivery/services/delivery",["apps/common/services/services"],function(e){e.factory("deliveryResource",["$resource",function(e){return e("/delivery.json",{},{remove:{method:"delete",url:"/delivery/:id.json"}})}]),e.factory("deliveryLoader",["deliveryResource","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}])}),define("apps/delivery/services/waybill.items",["apps/common/services/services"],function(e){e.factory("waybillItems",[function(){return[{id:"orderId",show:!1,type:"normal",text:"orderId",name:"订单编号",width:"",height:"",left:"",top:""},{id:"senderName",show:!1,type:"normal",text:"senderName",name:"发件人姓名",width:"",height:"",left:"",top:""},{id:"senderAddress",show:!1,type:"normal",text:"senderAddress",name:"发件人地址",width:"",height:"",left:"",top:""},{id:"senderTel",show:!1,type:"normal",text:"senderTel",name:"发件人电话",width:"",height:"",left:"",top:""},{id:"senderCompanyName",show:!1,type:"normal",text:"senderCompanyName",name:"发件人公司",width:"",height:"",left:"",top:""},{id:"receiverName",show:!1,type:"normal",text:"receiverName",name:"收件人姓名",width:"",height:"",left:"",top:""},{id:"receiverCity",show:!1,type:"normal",text:"receiverCity",name:"收件人目的地",width:"",height:"",left:"",top:""},{id:"receiverAddress",show:!1,type:"normal",text:"receiverAddress",name:"收件人地址",width:"",height:"",left:"",top:""},{id:"receiverPostCode",show:!1,type:"normal",text:"receiverPostCode",name:"收件人邮编",width:"",height:"",left:"",top:""},{id:"receiverTel",show:!1,type:"normal",text:"receiverTel",name:"收件人电话",width:"",height:"",left:"",top:""},{id:"orderProps",show:!1,type:"normal",text:"orderProps",name:"货号+属性+数量",width:"",height:"",left:"",top:""},{id:"userDefine",show:!1,type:"custom",text:"userDefine",name:"买家备注",width:"",height:"",left:"",top:""},{id:"merchantDefine",show:!1,type:"normal",text:"merchantDefine",name:"商家备注",width:"",height:"",left:"",top:""},{id:"sendDefine",show:!1,type:"normal",text:"",name:"发货备注",width:"",height:"",left:"",top:""},{id:"printTime",show:!1,type:"normal",text:"",name:"打印时间",width:"",height:"",left:"",top:""}]}])}),define("apps/delivery/services/setting",["apps/common/services/services"],function(e){e.factory("deliverySetting",["$resource",function(e){return e("delivery_selffetch_alias.json",{},{get:{method:"GET"},put:{method:"PUT"}})}])}),define("apps/delivery/services/_base",["apps/delivery/services/shipment","apps/delivery/services/city","apps/delivery/services/waybill","apps/delivery/services/delivery","apps/delivery/services/waybill.items","apps/delivery/services/setting"],function(){}),define("apps/delivery/controllers/shipments.list",["apps/common/controllers/controllers"],function(e){e.controller("shipments.list",["$scope","$resource","shipmentResource","merchantSettingResource","Flash",function(e,t,a,o,s){var n=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:5},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n);var r=t("/delivery/copy_shipment/:id.json",{id:"@id"});e.copy=function(e){r.save({id:e.id},function(){n()})},o.get(function(t){e.enabled=1==t.delivery_enabled}),e.merchant_open_shipments_status=!1,e.merchant_open_shipments=function(){var t=1==e.enabled?1:0;e.merchant_open_shipments_status=!0,o.save({delivery_enabled:t},function(a){e.merchant_open_shipments_status=!1,a.success?(s.create("success"," 操作成功！"),e.enabled=1==t):(s.create("danger",a.msg),e.enabled=1!=t)},function(t){e.merchant_open_shipments_status=!1,s.create("danger",res.data.error.message)})},e.remove=function(t,o){a.delete({id:o},function(a){e.data.splice(t,1),s.create("success"," 删除成功！")},function(e){s.create("danger",e.data.error.message)})}}])}),define("apps/delivery/controllers/shipments.info",["apps/common/controllers/controllers"],function(e){e.controller("shipments.info",["$scope","$stateParams","$state","$modal","shipmentResource","cityData","Flash",function(e,t,a,o,s,n,r){t.id?(e.title="编辑配送方式",e.data=s.get({id:t.id},function(t){e.oldRegions={},angular.forEach(t.areas,function(t,a){var o=t.regions.region_id.split(",");angular.forEach(o,function(t,a){e.oldRegions[t]=!0})})})):(e.title="新增配送方式",e.data={}),e.change_area=function(t){var a=o.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择区域"},region_id:function(){if(t)return t.regions.region_id},old_region:function(){if(e.oldRegions)return e.oldRegions}}});angular.isUndefined(e.data.areas)&&(e.data.areas=[]),a.result.then(function(a){angular.isUndefined(t)?e.data.areas.push({regions:a}):t.regions=a})},e.remove_area=function(e,t){e.splice(t,1)},e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,t.id?s.update({id:t.id},e.data,function(t){a.go("shop.delivery.shipments.list"),e.btn_text="保存",r.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,r.create("danger",t.data.error.message)}):s.save(e.data,function(t){a.go("shop.delivery.shipments.list"),e.btn_text="保存",r.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,r.create("danger",t.data.error.message)}))}}]).controller("areaModalCtrl",["$scope","cityData","$modalInstance","title","region_id","old_region",function(e,t,a,o,s,n){if(e.data=angular.copy(t),e.title=o,angular.isUndefined(n)&&(n={}),e.selectCity={},angular.isUndefined(s))e.mate=function(t,a,o){switch(a){case"prov":angular.isDefined(n[t.id])&&(t.disabled=!0,angular.forEach(e.data[t.id],function(a,o){e.data[t.id][o].disabled=!0}));break;case"city":angular.isDefined(n[t.id])&&(e.data[1][o].disabled=!0,t.disabled=!0)}};else{var r=s.split(","),i={},c={};angular.forEach(e.data[1],function(e,t){i[e.id]=t}),angular.forEach(r,function(e,t){c[e]=!0}),e.mate=function(t,a,o){switch(a){case"prov":if(angular.isDefined(c[t.id])){t.checked=!0;var s={};angular.forEach(e.data[t.id],function(a,o){e.data[t.id][o].checked=!0,s[a.id]=e.data[t.id][o]}),e.selectCity[t.id]={status:!0,val:e.data[1][o],item:s}}else angular.isDefined(n[t.id])&&(t.disabled=!0,angular.forEach(e.data[t.id],function(a,o){e.data[t.id][o].disabled=!0}));break;case"city":angular.isDefined(c[t.id])?(t.checked=!0,angular.isUndefined(e.selectCity[t.parent_id])&&(e.selectCity[t.parent_id]={status:!1,val:e.data[1][o],item:{}}),e.selectCity[t.parent_id].item[t.id]=t):angular.isDefined(n[t.id])&&(e.data[1][o].disabled=!0,t.disabled=!0)}}}e.checked_length=function(e){var t=0;return angular.forEach(e,function(e,a){e.checked&&t++}),t},e.choose=function(t,a,o){switch(a){case"prov":t.checked?e.selectCity[t.id]={status:!0,val:t,item:{}}:delete e.selectCity[t.id],angular.forEach(e.data[t.id],function(a,s){angular.isDefined(a.disabled)&&a.disabled?(e.data[1][o].checked=!1,e.selectCity[t.id]&&(e.selectCity[t.id].status=!1)):(a.checked=t.checked,t.checked&&(e.selectCity[t.id].item[a.id]=a))});break;case"city":var s=t.parent_id;angular.isUndefined(e.selectCity[t.parent_id])&&(e.selectCity[s]={},e.selectCity[s].item={},e.selectCity[s].val=e.data[1][o]),t.checked?e.selectCity[s].item[t.id]=t:delete e.selectCity[s].item[t.id],Object.keys(e.selectCity[s].item).length==e.data[s].length?(e.data[1][o].checked=!0,e.selectCity[s].status=!0):(e.data[1][o].checked=!1,e.selectCity[s].status=!1),0==Object.keys(e.selectCity[s].item).length&&delete e.selectCity[s]}},e.ok=function(){e.selectedItem={region_id:[],region_name:[]},angular.isDefined(c)&&angular.forEach(c,function(e,t){delete n[t]}),angular.forEach(e.selectCity,function(t,a){t.status?(n[t.val.id]=!0,e.selectedItem.region_id.push(t.val.id),e.selectedItem.region_name.push(t.val.name)):angular.forEach(t.item,function(t,a){n[t.id]=!0,e.selectedItem.region_id.push(t.id),e.selectedItem.region_name.push(t.name)})}),e.selectedItem.region_id=e.selectedItem.region_id.join(","),e.selectedItem.region_name=e.selectedItem.region_name.join("、"),angular.isUndefined(e.selectedItem)?a.dismiss("cancel"):a.close(e.selectedItem)},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/delivery/controllers/delivery.company",["apps/common/controllers/controllers"],function(e){e.controller("delivery.company",["$scope","deliveryResource","Flash",function(e,t,a){e.delivery=t.get(),e.choose_item=function(o){var s=1;angular.forEach(e.delivery.onDelivery,function(e,t){o.id==e.id&&(s=0)}),s?(e.delivery.onDelivery.push(o),t.save(o)):a.create("warning","你已经选择了该物流！")},e.delete_item=function(a,o){e.delivery.onDelivery.splice(o,1),t.remove({id:a.id})}}])}),define("apps/delivery/controllers/selffetch.list",["apps/common/controllers/controllers"],function(e){e.controller("selffetch.list",["$scope","storeSrv","Flash","merchantSettingResource","videoAddress",function(e,t,a,o,s){e.videoAddress=s,e.paginationConf={currentPage:1,itemsPerPage:12},e.searchInfo={search:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.store=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),o.get(function(t){e.enabled=1==t.store_enabled,e.member_info=1==t.store_member_info}),e.open_store_status=!1,e.open_store=function(o){var s={id:o.id};0==o.enabled?s.enabled=1:s.enabled=0,e.open_store_status=!0,t.enabled(s,function(t){o.enabled=s.enabled,e.open_store_status=!1,a.create("success"," 操作成功！")},function(t){e.open_store_status=!1,a.create("danger",t.data.error.message)})},e.merchant_open_store_status=!1,e.merchant_open_store=function(){var t=1==e.enabled?1:0;e.merchant_open_store_status=!0,o.save({store_enabled:t},function(o){o.success?(e.merchant_open_store_status=!1,a.create("success"," 操作成功！"),e.enabled=1==t):(e.merchant_open_store_status=!1,a.create("danger",o.msg),e.enabled=1!=t)},function(t){e.merchant_open_store_status=!1,a.create("danger",res.data.error.message)})},e.merchant_open_orderInfo_status=!1,e.merchant_open_orderInfo=function(){var t=1==e.member_info?1:0;e.merchant_open_orderInfo_status=!0,o.save({store_member_info:t},function(o){e.merchant_open_orderInfo_status=!1,o.success?(a.create("success"," 操作成功！"),e.member_info=1==t):(a.create("danger",o.msg),e.member_info=1!=t)},function(t){e.merchant_open_orderInfo_status=!1,a.create("danger",res.data.error.message)})}}])}),define("apps/delivery/controllers/waybill.info",["apps/common/controllers/controllers"],function(e){e.controller("waybill.info",["$scope","$stateParams","$state","waybillResource","waybillLoader","deliveryLoader","storeLoader","waybillItems","Flash",function(e,t,a,o,s,n,r,i,c){t.id?(e.title="编辑运单模板",e.data=s):(e.title="新增运单模板",e.data={},e.data.print_items=angular.copy(i)),e.delivery_company=n.onDelivery,e.store=r.data,e.btn_text="保存",e.checkAllModel={},e.set_delivery=function(t,a){a.delivery_company_id=t.id,a.company=t.name,a.img=t.waybill_bg,a.width=t.waybill_width,a.height=t.waybill_height,a.print_items=t.print_default?angular.fromJson(t.print_default):[];for(var o=0;o<a.print_items.length;o++)if(!a.print_items[o].show){e.checkAllModel.select=!1;break}},e.init_store_name=function(t,a){t.id==a&&(e.store_name=t.name)},e.set_store=function(t,a){a.store_id=t.id,e.store_name=t.name},e.checkAll=function(t){angular.forEach(e.data.print_items,function(e){e.show=t})},e.$watch("data",function(){var t=e.data.width;height=e.data.height,pixels={},pixels=e.px2mm(1),0!=t&&0!=height?($("#express_bg").css({width:t/pixels[0]+"px",height:height/pixels[1]+"px"}),$(".change-express").css("min-width",t/pixels[0]+"px")):($("#express_bg").css({width:229/pixels[0]+"px",height:126/pixels[1]+"px"}),$(".change-express").css("min-width",229/pixels[0]+"px"))},!0),e.$watch("upload",function(t){angular.isUndefined(t)||(e.data.img=t[t.length-1].url)}),e.px2mm=function(e){$("body").append("<div id='mm2px' style='width:1mm;height:1mm;display:none;'></div>");var t={};return t[0]=e/$("#mm2px").width(),t[1]=e/$("#mm2px").height(),$("#mm2px").remove(),t},e.submitForm=function(s){if(s){var n=e.data.print_items;for(var r in n)$(".shift-btn").each(function(){var e=$(this).data("vid");if(r==e)return n[r].left=parseInt($(this).css("left")),n[r].top=parseInt($(this).css("top")),n[r].width=parseInt($(this).css("width")),n[r].height=parseInt($(this).css("height")),!1});e.btn_text="保存中...",e.form.$invalid=!0,t.id?o.update({id:t.id},e.data,function(t){a.go("shop.delivery.waybill.list"),e.btn_text="保存",c.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,c.create("danger",t.data.error.message)}):o.save(e.data,function(t){a.go("shop.delivery.waybill.list"),e.btn_text="保存",c.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,c.create("danger",t.data.error.message)})}}}])}),define("apps/delivery/controllers/waybill.list",["apps/common/controllers/controllers"],function(e){e.controller("waybill.list",["$scope","$resource","waybillResource","Flash",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.deleteWaybill=function(t,s){a.delete({id:s},function(a){e.data.splice(t,1),o.create("success"," 删除成功！")},function(e){o.create("danger",e.data.error.message)})}}])}),define("apps/delivery/controllers/setting",["apps/common/controllers/controllers"],function(e){e.controller("delivery.setting",["$scope","Flash","deliverySetting",function(e,t,a){e.data=a.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.put(e.data,function(a){a.status?t.create("success"," 修改成功！"):t.create("danger",a.msg),e.btn_text="保存",e.form.$invalid=!1}))}}])}),define("apps/delivery/controllers/_base",["apps/delivery/controllers/shipments.list","apps/delivery/controllers/shipments.info","apps/delivery/controllers/delivery.company","apps/delivery/controllers/selffetch.list","apps/delivery/controllers/waybill.info","apps/delivery/controllers/waybill.list","apps/delivery/controllers/setting"],function(){}),define("apps/delivery/directives/_base",[],function(){}),define("apps/delivery/main",["apps/delivery/states/_base","apps/delivery/services/_base","apps/delivery/controllers/_base","apps/delivery/directives/_base"],function(){}),define("apps/ump/states/coupon",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump",{url:"/ump",templateUrl:"assets/js/apps/ump/templates/layout.html"}).state("shop.ump.coupon",{abstract:!0,url:"/coupon",template:"<div ui-view></div>"}).state("shop.ump.coupon.list",{url:"",templateUrl:"assets/js/apps/ump/templates/coupon.html",controller:"shop.ump.coupon.list"}).state("shop.ump.coupon.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/coupon.info.html",controller:"shop.ump.coupon.info"}).state("shop.ump.coupon.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/ump/templates/coupon.info.html",controller:"shop.ump.coupon.info"}).state("shop.ump.coupon.code",{url:"/code/:id",templateUrl:"assets/js/apps/ump/templates/coupon.code.html",controller:"shop.ump.coupon.code"}).state("shop.ump.coupon.data",{url:"/data/:id",templateUrl:"assets/js/apps/ump/templates/coupon.data.html",controller:"shop.ump.coupon.data"})}])}),define("apps/ump/states/discount",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.discount",{abstract:!0,url:"/discount",template:"<div ui-view></div>"}).state("shop.ump.discount.list",{url:"/list",templateUrl:"assets/js/apps/ump/templates/discount.html",controller:"discount.list"}).state("shop.ump.discount.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/discount.info.html",controller:"shop.ump.discount.info"}).state("shop.ump.discount.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/ump/templates/discount.info.html",controller:"shop.ump.discount.info"}).state("shop.ump.discount.record",{url:"/record",templateUrl:"assets/js/apps/ump/templates/discount.record.html",controller:"shop.ump.discount.record"}),e.state("shop.ump.ordercount",{abstract:!0,url:"/ordercount",template:"<div ui-view></div>"}).state("shop.ump.ordercount.list",{url:"/list",templateUrl:"assets/js/apps/ump/templates/discount.html",controller:"discount.list"}).state("shop.ump.ordercount.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/discount.info.html",controller:"shop.ump.discount.info"}).state("shop.ump.ordercount.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/ump/templates/discount.info.html",controller:"shop.ump.discount.info"}).state("shop.ump.ordercount.record",{url:"/record",templateUrl:"assets/js/apps/ump/templates/discount.record.html",controller:"shop.ump.discount.record"})}])}),define("apps/ump/states/seckill",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.seckill",{abstract:!0,url:"/seckill",template:"<div ui-view></div>"}).state("shop.ump.seckill.list",{url:"/list/:status",templateUrl:"assets/js/apps/ump/templates/seckill.html",controller:"shop.ump.seckill.list"}).state("shop.ump.seckill.add",{url:"/add/:goods_id",templateUrl:"assets/js/apps/ump/templates/seckill.info.html",controller:"shop.ump.seckill.info"}).state("shop.ump.seckill.edit",{url:"/edit/:id/:goods_id",templateUrl:"assets/js/apps/ump/templates/seckill.info.html",controller:"shop.ump.seckill.info"})}])}),define("apps/ump/states/fcoupon",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.fcoupon",{abstract:!0,url:"/fcoupon",template:"<div ui-view></div>"}).state("shop.ump.fcoupon.list",{url:"",templateUrl:"assets/js/apps/ump/templates/friend.coupon.html",controller:"shop.ump.fcoupon.list"}).state("shop.ump.fcoupon.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/friend.coupon.info.html",controller:"shop.ump.fcoupon.info"}).state("shop.ump.fcoupon.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/ump/templates/friend.coupon.info.html",controller:"shop.ump.fcoupon.info"}).state("shop.ump.fcoupon.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/ump/templates/friend.coupon.detail.html",controller:"shop.ump.fcoupon.detail"})}])}),define("apps/ump/states/bangmian",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.bangmian",{abstract:!0,url:"/bangmian",template:"<div ui-view></div>"}).state("shop.ump.bangmian.list",{url:"/list/:status",templateUrl:"assets/js/apps/ump/templates/bangmian/bangmian.html",controller:"shop.ump.bangmian.list"}).state("shop.ump.bangmian.add",{url:"/add/:id/:goods_id",templateUrl:"assets/js/apps/ump/templates/bangmian/bangmian.info.html",controller:"shop.ump.bangmian.info"}).state("shop.ump.bangmian.edit",{url:"/edit/:id/:goods_id",templateUrl:"assets/js/apps/ump/templates/bangmian/bangmian.info.html",controller:"shop.ump.bangmian.info"}).state("shop.ump.bangmian.starts",{url:"/starts/:bangmian_id/:bangmian_name",templateUrl:"assets/js/apps/ump/templates/bangmian/bangmian.starts.html",controller:"shop.ump.bangmian.starts"}).state("shop.ump.bangmian.records",{url:"/records/:id",templateUrl:"assets/js/apps/ump/templates/bangmian/bangmian.records.html",controller:"shop.ump.bangmian.records"}).state("shop.ump.bangmian.configs",{url:"/configs",templateUrl:"assets/js/apps/ump/templates/bangmian/bangmian.configs.html",controller:"shop.ump.bangmian.configs"})}])}),define("apps/ump/states/setmeal",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.setmeal",{abstract:!0,url:"/setmeal",template:"<div ui-view></div>"}).state("shop.ump.setmeal.list",{url:"/list",templateUrl:"assets/js/apps/ump/templates/setmeal.html",controller:"shop.ump.setmeal.list"}).state("shop.ump.setmeal.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/setmeal.info.html",controller:"shop.ump.setmeal.info"}).state("shop.ump.setmeal.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/ump/templates/setmeal.info.html",controller:"shop.ump.setmeal.info"}).state("shop.ump.setmeal.records",{url:"/records/:id",templateUrl:"assets/js/apps/ump/templates/setmeal.records.html",controller:"shop.ump.setmeal.records"}).state("shop.ump.setmeal.details",{url:"/details/:order_sn",templateUrl:"assets/js/apps/ump/templates/setmeal.details.html",controller:"shop.ump.setmeal.details"}).state("shop.ump.setmeal.configs",{url:"/configs",templateUrl:"assets/js/apps/ump/templates/setmeal.configs.html",controller:"shop.ump.setmeal.configs"})}])}),define("apps/ump/states/dynamics",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.dynamics",{abstract:!0,url:"/dynamics",template:"<div ui-view></div>"}).state("shop.ump.dynamics.list",{url:"/list",templateUrl:"assets/js/apps/ump/templates/dynamics.html",controller:"dynamics.list"}).state("shop.ump.dynamics.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/dynamics.info.html",controller:"shop.ump.dynamics.info"}).state("shop.ump.dynamics.edit",{url:"/edit/:id/:e_name",templateUrl:"assets/js/apps/ump/templates/dynamics.info.html",controller:"shop.ump.dynamics.info"})}])}),define("apps/ump/states/repurchase",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.repurchase",{abstract:!0,url:"/repurchase",templateUrl:"assets/js/apps/ump/templates/repurchase.tab.html"}).state("shop.ump.repurchase.list",{url:"/list",templateUrl:"assets/js/apps/ump/templates/repurchase.html",controller:"shop.ump.repurchase.list"}).state("shop.ump.repurchase.setting",{url:"/setting",templateUrl:"assets/js/apps/ump/templates/repurchase.setting.html",controller:"shop.ump.repurchase.setting"})}])}),define("apps/ump/states/sharered",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.sharered",{abstract:!0,url:"/sharered",template:'<div class="sharered-wrapper" ui-view></div>'}).state("shop.ump.sharered.list",{url:"/list",templateUrl:"assets/js/apps/ump/templates/sharered.html",controller:"shop.ump.sharered.list",controllerAs:"vm"}).state("shop.ump.sharered.add",{url:"/add",templateUrl:"assets/js/apps/ump/templates/sharered.info.html",controller:"shop.ump.sharered.manage",controllerAs:"vm"}).state("shop.ump.sharered.edit",{url:"/edit/:id/:type",templateUrl:"assets/js/apps/ump/templates/sharered.info.html",controller:"shop.ump.sharered.manage",controllerAs:"vm"}).state("shop.ump.sharered.sub",{abstract:!0,url:"/sub",templateUrl:"assets/js/apps/ump/templates/sharered.sub.html",controller:"sharered.sub.ctrl"}).state("shop.ump.sharered.sub.stat",{url:"/stat?id",templateUrl:"assets/js/apps/ump/templates/sharered.sub.stat.html",controller:"shop.ump.sharered.stat",controllerAs:"vm"}).state("shop.ump.sharered.sub.receivedetails",{url:"/receivedetails?name&id&aid",templateUrl:"assets/js/apps/ump/templates/sharered.sub.receivedetails.html",controller:"shop.ump.sharered.receivedetails",controllerAs:"vm"}).state("shop.ump.sharered.othersub",{url:"/othersub",templateUrl:"assets/js/apps/ump/templates/sharered.othersub.html"}).state("shop.ump.sharered.othersub.operationlog",{url:"/operationlog/:id",templateUrl:"assets/js/apps/ump/templates/sharered.othersub.operationlog.html",controller:"shop.ump.sharered.operationlog",controllerAs:"vm"})}])}),define("apps/ump/states/sign",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ump.sign",{abstract:!0,url:"/sign",templateUrl:"assets/js/apps/ump/templates/sign.html"}).state("shop.ump.sign.setting",{url:"/setting",templateUrl:"assets/js/apps/ump/templates/sign.setting.html",controller:"shop.ump.sign.setting.ctrl",controllerAs:"vm"}).state("shop.ump.sign.record",{url:"/record",templateUrl:"assets/js/apps/ump/templates/sign.record.html",controller:"shop.ump.sign.record.ctrl",controllerAs:"vm"}).state("shop.ump.sign.design",{url:"/design",templateUrl:"assets/js/apps/ump/templates/sign.design.html",controller:"shop.ump.sign.design.ctrl",controllerAs:""}).state("shop.ump.sign.order",{url:"/order",templateUrl:"assets/js/apps/ump/templates/sign.order.html",controller:"shop.ump.sign.order.ctrl",controllerAs:"vm"})}])}),define("apps/ump/states/_base",["apps/ump/states/coupon","apps/ump/states/discount","apps/ump/states/seckill","apps/ump/states/fcoupon","apps/ump/states/bangmian","apps/ump/states/setmeal","apps/ump/states/dynamics","apps/ump/states/repurchase","apps/ump/states/sharered","apps/ump/states/sign"],function(){}),define("apps/ump/services/coupon",["apps/common/services/services"],function(e){e.factory("couponResource",["$resource",function(e){return e("/marketing/coupon/:id.json",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1},getCouponQrcode:{method:"GET",url:"marketing/coupon_qrcode/:id.json"}})}]),e.factory("chartResource",["$resource",function(e){return e("/stat/coupon/day.json")}]),e.factory("couponRecordsResource",["$resource",function(e){return e("/marketing/coupon_records/:id.json",{id:"@id"})}]),e.factory("codeResource",["$resource",function(e){return e("/marketing/coupon.code.json",{id:"@id"},{delete:{method:"DELETE",url:"/marketing/coupon.code/:id.json"
},single_code:{method:"POST",url:"/marketing/coupon.single_code.json"},batch_code:{method:"POST",url:"/marketing/coupon.batch_code.json"}})}])}),define("apps/ump/services/discount",["apps/common/services/services"],function(e){e.factory("discountResource",["$resource",function(e){return e("/marketing/discount/:id.json",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1}})}]),e.factory("recordsResource",["$resource",function(e){return e("/marketing/records.json")}]),e.factory("discountCheckRes",["$resource",function(e){return e("/marketing/discount_check.json")}]),e.factory("discountGoodsRes",["$resource",function(e){return e("/marketing/discount_goods.json")}])}),define("apps/ump/services/seckill",["apps/common/services/services"],function(e){e.factory("seckillResource",["$resource",function(e){return e("/marketing/seckill/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT"},delete:{method:"DELETE"},forbid:{method:"DELETE"}})}]),e.factory("seckillGoodsResource",["$resource",function(e){return e("/marketing/seckill_goods/:id.json",{id:"@id"},{})}]),e.factory("seckillFinishResource",["$resource",function(e){return e("/marketing/seckill/:id/finish.json",{id:"@id"},{finish:{method:"PUT",isArray:!1}})}])}),define("apps/ump/services/friend.coupon",["apps/common/services/services"],function(e){e.factory("getFriendCoupon",["$resource",function(e){return e("/marketing/pcoupon/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},get:{method:"GET"},delete:{method:"DELETE"},save:{method:"POST"}})}]),e.factory("upmImgUpLoading",["$resource",function(e){return e("/marketing/uploadimg.json",{},{save:{method:"POST"}})}]),e.factory("getUpmStore",["$resource",function(e){return e("/marketing/getpoilist.json",{},{get:{method:"GET"}})}]),e.factory("getShowQrcode",["$resource",function(e){return e("/marketing/create_qrcode.json",{},{get:{method:"GET"}})}]),e.factory("friendCouponData",[function(){var e={info:{name:"",logo:{wxImg:"",qnImg:""},color:{name:"Color010",value:"#55bd47"},money:"",validity:{vali:!1,vali_text:"",start:"",end:""},time:{type:0,part:[]}},introduce:{phone:"",service:[]},discount:{synopsis:"",covers:{wxImg:"",qnImg:""},isCovers:!1,notice:"",isMedia:!1,media:[]},store:{type:"",storeList:[]},custom:{isOpen:!1,name:"",guideName:"",clickType:"",click_media:"",click_rack:"",click_url:""},useSet:{type:"",get_limit:{type:1,content:1}},ticketSet:{enabled:0,type:0,otherInfo:{}}},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t}])}),define("apps/ump/services/bangmian",["apps/common/services/services"],function(e){e.factory("bangmianResource",["$resource",function(e){return e("/marketing/bangmian/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT"},delete:{method:"DELETE"}})}]),e.factory("bangmianDetailResource",["$resource",function(e){return e("/marketing/bangmianDetail/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},forbid:{method:"PUT"}})}]),e.factory("bangmianGoodsResource",["$resource",function(e){return e("/marketing/bangmian_goods/:id.json",{id:"@id"},{})}]),e.factory("bangmianGoodsResource",["$resource",function(e){return e("/marketing/bangmian_goods/:id.json",{id:"@id"},{})}]),e.factory("bangmianFinishResource",["$resource",function(e){return e("/marketing/bangmian/:id/finish.json",{id:"@id"},{finish:{method:"PUT",isArray:!1}})}])}),define("apps/ump/services/setmeal",["apps/common/services/services"],function(e){e.factory("setmealResource",["$resource",function(e){return e("/marketing/combo/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},save:{method:"POST"},delete:{method:"DELETE"},forbid:{method:"DELETE"}})}]),e.factory("setmealupdateResource",["$resource",function(e){return e("/marketing/combo.json",{id:"@id"},{update:{method:"PUT"}})}]),e.factory("combogoodsdeleteResource",["$resource",function(e){return e("/marketing/combogoods/:id.json",{id:"@id"},{delete:{method:"DELETE"}})}]),e.factory("setmealFinishResource",["$resource",function(e){return e("/marketing/combo_end/:id.json",{id:"@id"},{finish:{method:"PUT",isArray:!1}})}]),e.factory("setmealRecordsResource",["$resource",function(e){return e("/marketing/combo_order/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1}})}]),e.factory("setmealDetailResource",["$resource",function(e){return e("/order/:order_sn.json",{},{query:{method:"GET",isArray:!1}})}]),e.factory("setmealGoodsResource",["$resource",function(e){return e("/marketing/pintuan/:id/isPintuan.json",{id:"@id"},{})}]),e.factory("setmealConfigsResource",["$resource",function(e){return e("/marketing/pintuan_set/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}])}),define("apps/ump/services/dynamics",["apps/common/services/services"],function(e){e.factory("dynamicsResource",["$resource",function(e){return e("/dynamic/postDynamic/:id.json",{id:"@id"},{update:{method:"PUT"},save:{method:"POST"},query:{method:"GET",isArray:!1}})}]),e.factory("dynamicslistResource",["$resource",function(e){return e("/dynamic/getDynamic/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1}})}]),e.factory("dynamicsgetResource",["$resource",function(e){return e("/dynamic/getGoodsByDynamicId.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("dynamicseditResource",["$resource",function(e){return e("/dynamic/editGoodsByDynamicId.json",{id:"@id"},{update:{method:"PUT"}})}]),e.factory("dynamicsdelResource",["$resource",function(e){return e("/dynamic/deleteDynamic/:id.json",{id:"@id"},{delete:{method:"DELETE"}})}]),e.factory("dynamicsGoodsRes",["$resource",function(e){return e("/dynamic/getDynamicGoods.json")}])}),define("apps/ump/services/repurchase",["apps/common/services/services"],function(e){e.factory("repuchaseResource",["$resource",function(e){return e("marketing/repurchase_list.json",{goods_id:"@goods_id"},{query:{method:"GET",isArray:!1,url:"marketing/repurchase_list.json"},getUnAttend:{method:"GET",url:"marketing/repurchase_goods/:goods_id.json"},get:{method:"GET",url:"marketing/repurchase/:goods_id.json"},update:{method:"PUT",url:"marketing/repurchase/:goods_id.json"},add:{method:"POST",url:"marketing/repurchase.json"},delete:{method:"DELETE",url:"marketing/repurchase/:goods_id.json"}})}])}),define("apps/ump/services/merchant.setting",["apps/common/services/services"],function(e){e.factory("merchantSettingResource",["$resource",function(e){return e("merchant_setting.json",{},{update:{method:"POST"},get:{method:"GET"}})}])}),define("apps/ump/services/sharered",["apps/common/services/services"],function(e){e.factory("shareredResource",["$resource",function(e){return e("/marketing/redpacket_list.json",{id:"@id"},{query:{method:"GET",isArray:!1},pauseActivity:{method:"get",url:"/marketing/redpacket_stop/:id.json"},startActivity:{method:"get",url:"/marketing/redpacket_start/:id.json"},deleteActivity:{method:"DELETE",url:"/marketing/redpacket_delete/:id.json"}})}]),e.factory("shareredManageResource",["$resource",function(e){return e("/marketing/redpacket_save.json",{id:"@id"},{get:{method:"GET",isArray:!1,url:"/marketing/redpacket_get/:id.json"},save:{method:"POST"},update:{method:"put",url:"/marketing/redpacket_edit.json"}})}]),e.factory("shareredOperationlogResource",["$resource",function(e){return e("marketing/redpacket_log.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("shareredReceivedetailsResource",["$resource",function(e){return e("marketing/redpacket_get_detail.json",{id:"@id"},{getReceiveDetailList:{method:"GET",isArray:!1}})}]),e.factory("shareredStatResource",["$resource",function(e){return e("marketing/redpacket_get_list.json",{id:"@id"},{getDetailList:{method:"GET",isArray:!1},getStatData:{method:"GET",isArray:!1,url:"marketing/redpacket_day.json"}})}]),e.factory("redStorage",function(){var e={},t=function(t){t.id&&(e.id=t.id)},a=function(){return e},o={setRed:t,getRed:a};return o})}),define("apps/ump/services/sign.service",["apps/common/services/services"],function(e){e.factory("signSettingService",["$resource",function(e){return e("/marketing/sign_activity_edit.json",{id:"@id"},{update:{method:"PUT"},getDetail:{method:"GET",isArray:!1,url:"/marketing/sign_activity_detail.json"},getCouponList:{method:"GET",isArray:!1,url:"/marketing/sign_coupon_getlist.json"},getSignStatus:{method:"GET",isArray:!1,url:"/marketing/sign_activity_status.json"},setSignStart:{method:"GET",isArray:!1,url:"/marketing/sign_activity_start/:id.json"},editSignStatus:{method:"PUT",url:"/marketing/sign_activity_status_edit.json"}})}]),e.factory("signRecordService",["$resource",function(e){return e("/marketing/signin_get_list.json",{id:"@id"},{getList:{method:"GET",isArray:!1},getLineData:{method:"GET",isArray:!1,url:"/marketing/signin_day.json"}})}]),e.factory("signDesignService",["$resource",function(e){return e("/marketing/sign_design.json",{id:"@id"},{getSignDesinContent:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT"}})}]),e.factory("signOrderService",["$resource",function(e){return e("/marketing/signin_goods_get_list.json",{},{getList:{method:"GET",isArray:!1},updateRemark:{method:"PUT",url:"/marketing/signin_up_desc.json"},deliverGoods:{method:"PUT",url:"/marketing/batchup.json"}})}]),e.factory("signDesignData",[function(){var e=[{type:"banner",icon:"fa fa-bookmark",name:"店招",content:{guider_style:"user",style:1,active_color:"#dd2727"}},{type:"nav",icon:"fa fa-bars",name:"导航",content:{style:"nav",display_icon:"",item_list:[{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"}]}},{type:"search",icon:"fa fa-search",name:"搜索框",content:{style:1,bg_color:"#f63",active_color:"#e64514"}},{type:"goods",icon:"fa fa-thumbs-o-up",name:"推荐商品",content:{size:"small",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0}},{type:"goods_tag",icon:"fa fa-tasks",name:"商品分组",content:{selected_tag:[{id:0,name:"所有分组"}],size:"small",number:6,sort:"created_at",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0}},{type:"tag_list",icon:"fa fa-list",name:"分组分类",content:{pageHeightType:0,pageHeight:"0",current_tag:"0",nav_list:[{title:"分组",imgstyle:0,display_icon:"",icon_size:"30",style:"nav",img_list:[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}],item_list:[{title:"导航1",img:"image/tag-icon.png"},{title:"导航1",img:"image/tag-icon.png"},{title:"导航1",img:"image/tag-icon.png"},{title:"导航1",img:"image/tag-icon.png"}]}]}},{type:"goods",icon:"fa fa-cubes",name:"搭配",content:{style:1}},{type:"slide",icon:"fa fa-file-image-o",name:"图片模板",content:{style:0,item_list:[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}]}},{type:"image",icon:"fa fa-picture-o",name:"图片组合",content:{item_list:[]}},{type:"text",icon:"fa fa-font",name:"富文本",content:{}},{type:"title",icon:"fa fa-bold",name:"标题",content:{}},{type:"video",icon:"fa fa-film",name:"视频",content:{}},{type:"voice",icon:"fa fa-volume-up",name:"语音",content:{style:1,align:1,play:1}},{type:"notice",icon:"fa fa-bullhorn",name:"公告",content:{}},{type:"phone",icon:"fa fa-phone",name:"客服电话",content:{}},{type:"white",icon:"fa fa-square-o",name:"辅助空白",content:{height:30}},{type:"seckill",icon:"fa fa-clock-o",name:"秒杀",content:{}},{type:"component",icon:"fa fa-puzzle-piece",name:"自定义",content:{}},{type:"calendar",icon:"fa fa-calendar",name:"日历",content:{bg_color:"#ff5845",wrap_color:"#ea412c"}},{type:"sign",icon:"fa fa-pencil-square-o",name:"签到",content:{bg_pic:""}},{type:"sign_rule",icon:"fa fa-file-text-o",name:"签到规则",content:{wrap_color:"#ff5845",inside_color:"#ea412c"}}];if(2==_global.shop.type)for(var t=e.length-1;t>-1;t--)"seckill"===e[t].type&&e.splice(t,1);return e}])}),define("apps/ump/services/_base",["apps/ump/services/coupon","apps/ump/services/discount","apps/ump/services/seckill","apps/ump/services/friend.coupon","apps/ump/services/bangmian","apps/ump/services/setmeal","apps/ump/services/dynamics","apps/ump/services/repurchase","apps/ump/services/merchant.setting","apps/ump/services/sharered","apps/ump/services/sign.service"],function(){}),define("apps/ump/controllers/coupon.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.coupon.list",["$scope","ngPopover","$resource","couponResource","Flash","videoAddress",function(e,t,a,o,s,n){e.videoAddress=n,e.status="all";var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,status:e.status,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.open_close=function(e){var t=a("/marketing/coupon_close/:id.json",{id:"@id"},{update:{method:"PUT"}});e.btn_status=!0,t.update({id:e.id},function(t){e.btn_status=!1,s.create("success"," 操作成功！")},function(t){e.btn_status=!1,s.create("danger",t.data.error.message)})},e.showQrcode=function(t){o.getCouponQrcode({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){t.close(),s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.sort=function(t){"asc"==t?e.sorts="desc":e.sorts="asc",r()},e.remove=function(t,a){o.delete({id:a},function(a){e.data.splice(t,1),s.create("success"," 删除成功！")},function(e){s.create("danger",e.data.error.message)})},e.export=function(){var t="marketing/coupon.json?export=yes";e.keywords&&(t+="&keywords="+e.keywords),e.status&&(t+="&status="+e.status),e.sorts&&(t+="&sort="+e.sorts),window.location.href=t}}])}),define("apps/ump/controllers/coupon.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.coupon.info",["$scope","$http","couponResource","$stateParams","Flash","$state","$modal","$timeout","levelNameVirtual",function(e,t,a,o,s,n,r,i,c){function l(e){var t=[],a={};return angular.forEach(e,function(e,o){a[e]||(t.push(e),a[e]=!0)}),t}e.colors=[{value:"#55bd47",name:"Color010"},{value:"#10ad61",name:"Color020"},{value:"#35a4de",name:"Color030"},{value:"#9058cb",name:"Color050"},{value:"#de9c33",name:"Color060"},{value:"#ebac16",name:"Color070"},{value:"#f9861f",name:"Color080"},{value:"#f08500",name:"Color081"},{value:"#a9d92d",name:"Color082"},{value:"#e75735",name:"Color090"},{value:"#d54036",name:"Color100"},{value:"#cf3e36",name:"Color101"}],e.ranges={"今天":[moment(),moment()],"明天":[moment().add("days",1),moment().add("days",1)],"未来7天":[moment(),moment().add("days",6)],"未来15天":[moment(),moment().add("days",15)],"本月":[moment(),moment().endOf("month")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)]},c.get(function(t){e.vipList=t}),o.id?(e.title="修改优惠劵",a.get({id:o.id},function(t){e.data=t,angular.forEach(e.colors,function(t,a){t.value==e.data.card_color&&(e.card_bg=t.value)}),e.data.vipcard?(e.vip=e.data.vipcard,e.data.vipcard=1,angular.forEach(e.vipList,function(t,a){angular.forEach(e.vip,function(e,a){t.level_id==e&&(t.selected=!0)})})):e.data.vipcard=0,i(function(){$('input[name="created_range"]').val(t.dt_validity_begin+"/"+t.dt_validity_end)},20),e.is_edit=1})):(e.title="新增优惠劵",e.data={content_type:1,is_condition:0,time_type:1,is_preference:0,rang_goods:0,get_type:1,wx_card:0,is_give:0,vipcard:0}),e.changedown=function(){e.data.content_type=1,e.data.coupon_val=""},e.changecut=function(){e.data.content_type=2,e.data.coupon_val=""},e.cardBgColorClick=function(t){e.data.card_color=t.value,e.card_bg=t.value},e.remove=function(t){e.data.goods.splice(t.$index,1)},e.customGoods=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/coupon.model.goods.html",controller:"coupon.model.goods.ctrl",resolve:{goodsList:function(){return e.data.goods}}});t.result.then(function(t){"undefined"==typeof e.data.goods?e.data.goods=t:e.data.goods=e.data.goods.concat(t)})},e.btn_text="保存",e.submitForm=function(t){if(t){if(isNaN(Number(e.data.coupon_val))||Number(e.data.coupon_val)<=0){if(1==e.data.content_type)return $("input[name='coupon_val']").focus(),void s.create("danger","输入正确的减价金额");if(2==e.data.content_type)return $("input[name='coupon_val']").focus(),void s.create("danger","输入正确的打折数")}if(2==e.data.content_type&&Number(e.data.coupon_val)>=10)return $("input[name='coupon_val']").focus(),void s.create("danger","输入正确的打折数");if(1==e.data.time_type){var r=$('input[name="created_range"]').val();if(""==r)return s.create("danger","请先选择时间"),!1;r=r.split("/"),e.data.dt_validity_begin=r[0],e.data.dt_validity_end=r[1]}if(1==e.data.rang_goods&&(e.data.goods_ids=[],angular.forEach(e.data.goods,function(t,a){e.data.goods_ids.push(t.id)}),e.data.goods_ids=l(e.data.goods_ids).join(","),""==e.data.goods_ids))return s.create("danger","请添加商品"),!1;if(1==e.data.vipcard&&(e.data.vipcard=[],angular.forEach(e.vipList,function(t,a){t.selected&&e.data.vipcard.push(t.level_id)}),""==e.data.vipcard))return e.data.vipcard=1,s.create("danger","请选择部分会员"),!1;e.btn_text="保存中...",e.form.$invalid=!0,o.id?a.update({id:o.id},e.data,function(t){n.go("shop.ump.coupon.list"),e.btn_text="保存",s.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.error.message)}):a.save(e.data,function(t){n.go("shop.ump.coupon.list"),e.btn_text="保存",s.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.error.message)})}}}])}),define("apps/ump/controllers/coupon.code",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.coupon.code",["$scope","codeResource","Flash","$stateParams","$modal",function(e,t,a,o,s){e.sorts="desc";var n=function(){var s={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage},n={offset:(s.offset-1)*s.limit,limit:s.limit,coupon_id:o.id,sort:e.sorts,date:$('input[name="created_range"]').val()};t.get(n,function(t){return t.msg?void a.create("danger",t.msg):(e.paginationConf.totalItems=t._count,void(e.data=t.data))})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.sort=function(t){"asc"==t?e.sorts="desc":e.sorts="asc",n()},e.export=function(){var e="marketing/coupon.code.json?coupon_id="+o.id+"&sort=desc&export=yes";window.location.href=e},e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.createCode=function(){var e=s.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/create.code.html",controller:"create.code",windowClass:"modal-open",resolve:{coupon_id:function(){return o.id}}});e.result.then(function(e){n()})},e.sendCode=function(e){var t=s.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/coupon.code.send.html",controller:"coupon.code.send",windowClass:"modal-open",resolve:{coupon_id:function(){return 0},code_id:function(){return e},type:function(){return 0}}});t.result.then(function(e){n()})},e.batchSendCode=function(){var e=s.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/coupon.code.send.html",controller:"coupon.code.send",windowClass:"modal-open",resolve:{coupon_id:function(){return o.id},code_id:function(){return 0},type:function(){return 1}}});e.result.then(function(e){n()})},e.remove=function(o,s){t.delete({id:s},function(t){e.data.splice(o,1),a.create("success"," 删除成功！"),n()},function(e){a.create("danger",e.data.error.message)})}}])}),define("apps/ump/controllers/coupon.data",["apps/common/controllers/controllers","echarts","echarts/chart/line","echarts/chart/bar"],function(e,t){e.controller("shop.ump.coupon.data",["$scope","$stateParams","chartResource","couponRecordsResource",function(e,a,o,s){function n(e,a,o,s,n){var r=t.init(document.getElementById(e)),i={tooltip:{trigger:"axis"},legend:{data:a},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},toolbox:{show:!1},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:o}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:a[0],type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:s},{name:a[1],type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:n}]};r.setOption(i)}var r=[],i=[],c=[],l=[],d=[];o.get({coupon_id:a.id},function(e){angular.forEach(e.data,function(e,t){r.push(e.date),i.push(e.get_count),c.push(e.get_count_user),l.push(e.use_count),d.push(e.use_count_user)}),n("data_one",["领取量","使用量"],r,i,l),n("data_two",["领取人数","使用人数"],r,c,d)});var p=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};s.get({offset:(t.offset-1)*t.limit,limit:t.limit,id:a.id},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),e.export=function(){window.location.href="marketing/coupon_records/"+a.id+".json?export=1"}}])}),define("apps/ump/controllers/discount.list",["apps/common/controllers/controllers"],function(e){e.controller("discount.list",["$scope","$state","discountResource","Flash","videoAddress",function(e,t,a,o,s){e.videoAddress=s,t.includes("shop.ump.ordercount")?e.type=1:e.type=0;var n=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.query({offset:(t.offset-1)*t.limit,limit:t.limit,type:e.type,keywords:e.keywords},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.remove=function(t,s){a.delete({id:s},function(a){e.data.splice(t,1),o.create("success"," 删除成功！")},function(e){o.create("danger",e.data.error.message)})}}])}),define("apps/ump/controllers/discount.info",["apps/common/controllers/controllers","echarts","echarts/chart/line","echarts/chart/bar"],function(e,t){e.controller("shop.ump.discount.info",["$scope","discountResource","$stateParams","Flash","$state","$modal","discountCheckRes","tagResource","discountGoodsRes","cityData",function(e,t,a,o,s,n,r,i,c){function l(){var t=$('input[name="created_range"]').val();""!=t&&(t=t.split("/"),e.data.start_time=t[0],e.data.end_time=t[1],r.get({start_time:t[0],end_time:t[1]},function(t){t.status?(u(),e.data.goods=[],1==t.range?(e.range=1,e.data.range=1):"all"==t.range&&(e.range=2,e.data.range=2)):(o.create("danger",t.error),e.range=0,e.data.range=0)}))}function d(){e.$watch("dates",function(e){l()})}function p(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),o=t.getMonth()+1,s=t.getDate();return a+"-"+o+"-"+s}function u(t){function a(){i.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},t?e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"csale",sort:"desc",discount_id:t}:e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"csale",sort:"desc",start_time:e.data.start_time,end_time:e.data.end_time},a();var o=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id),c.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){o()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.sort="desc"==e.params.sort?"asc":"desc",o()},e.in_goods=function(t){t.selected=0,angular.forEach(e.data.goods,function(e,a){e.id==t.id&&(t.selected=1)})},e.batch_add=function(){angular.forEach(e.goods,function(t,a){t.type||t.selected||(t.selected=1,e.data.goods.push(t))})},e.checkAll=function(){angular.forEach(e.data.goods,function(e,t){e.checked=!0})},e.batch_cancel=function(){angular.forEach(e.goods,function(t,a){t.checked&&e.data.goods.splice(a,1)})},e.add_goods=function(t){t.selected=1,e.data.goods.push(t)},e.cancel_goods=function(t){angular.forEach(e.data.goods,function(a,o){t.id==a.id&&(e.data.goods.splice(o,1),t.selected=0)})}}e.dates="",e.blurDates=function(e){setTimeout(function(){l()},100)},e.minDate=p(0),e.addItem=function(){e.data.items[0].is_noceiling=0,e.data.items.length<5&&e.data.items.push({num:e.data.items.length+1})},e.closeItem=function(t){e.data.items.splice(t,1)},a.id?(e.title="修改活动",e.is_edit=1,t.get({id:a.id},function(t){e.data=t,u(a.id),$('input[name="created_range"]').val(t.start_time+"/"+t.end_time)})):(e.title="新增活动",e.data={type:0,items:[{num:1}],goods:[],is_preference:0,is_share:0},s.includes("shop.ump.ordercount")?e.data.type=1:e.data.type=0,d()),e.change_area=function(e){var t=n.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"不配送区域"},region_id:function(){if(e.regions)return e.regions.region_id},old_region:function(){return!1}}});t.result.then(function(t){if(a.id){e.regions={region_id:t.region_id,areaRegion:[]};for(var o=t.region_id.split(","),s=t.region_name.split("、"),n=0;n<o.length;n++){var r={region_id:"",region_name:""};r.region_id=o[n],r.region_name=s[n],e.regions.areaRegion.push(r)}}else e.regions=t})},e.btn_text="保存",e.submitForm=function(n){if(n){if(0==e.data.type)for(d=0;d<e.data.items.length;d++){var r=e.data.items[d];if(!r.cash&&!r.gift&&!r.pinkage)return o.create("danger","请选择优惠方式"),!1;if(r.cash&&!r.cash_val)return o.create("danger","请填写优惠方式"),!1;if(r.gift&&!r.remark)return o.create("danger","请填写优惠方式"),!1;if(1==r.cash&&parseFloat(r.cash_val)-parseFloat(r.condition)>0)return o.create("danger","减现金必须小于满减金额"),!1;0==r.cash&&(r.cash_val=0)}else for(d=0;d<e.data.items.length;d++){var r=e.data.items[d];0==r.cash&&(r.cash_val=0)}var i=$('input[name="created_range"]').val();if(""!=i&&(i=i.split("/"),e.data.start_time=i[0],e.data.end_time=i[1]),e.data.goods_ids=[],angular.forEach(e.data.goods,function(t,a){e.data.goods_ids.push(t.id)}),e.data.goods_ids=e.data.goods_ids.join(","),!e.data.range)return o.create("danger","当前活动有效期内有其它正在进行的活动，不得重复创建"),!1;if(1==e.data.range&&""==e.data.goods_ids)return o.create("danger","至少选择一个商品"),!1;var c=new Array;angular.forEach(e.data.items,function(e,t){return/^([+-]?[1-9][\d]{0,3}|0)([.]?[\d]{1,2})?$/.test(""+e.condition)?void c.push(e.condition):(o.create("danger","优惠金额格式不正确"),!1)});for(var l=c.sort(),d=0;d<c.length;d++)if(l[d]==l[d+1])return o.create("danger","多个优惠条件不能重复"),!1;e.btn_text="保存中...",e.form.$invalid=!0,a.id?t.update({id:a.id},e.data,function(t){1==e.data.type?s.go("shop.ump.ordercount.list"):s.go("shop.ump.discount.list"),o.create("success"," 保存成功！"),e.btn_text="保存",o.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}):t.save(e.data,function(t){1==e.data.type?s.go("shop.ump.ordercount.list"):s.go("shop.ump.discount.list"),e.btn_text="保存",o.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)})}}}])}),define("apps/ump/controllers/discount.record",["apps/common/controllers/controllers","echarts","echarts/chart/line","echarts/chart/bar"],function(e,t){e.controller("shop.ump.discount.record",["$scope","$state","recordsResource",function(e,t,a){t.includes("shop.ump.ordercount")?e.type=1:e.type=0;var o=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,type:e.type},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o)}])}),define("apps/ump/controllers/create.code",["apps/common/controllers/controllers"],function(e){e.controller("create.code",["$scope","codeResource","$stateParams","Flash","coupon_id","$modalInstance",function(e,t,a,o,s,n){e.cancel=function(){n.dismiss("cancel")},e.data={coupon_id:s},e.chars=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var r=function(t){for(var a="",o=0;o<t;o++){var s=Math.ceil(61*Math.random());a+=e.chars[s]}return a};e.createCode=function(){var t=e.random_count;if("undefined"==typeof e.data.codes&&(e.data.codes=""),!isNaN(t)&&t>0&&t<=200)for(var a=0;a<t;a++)randNum=r(8),""!=e.data.codes&&"undefined"!=typeof e.data.codes?e.data.codes=e.data.codes+"\n"+randNum:e.data.codes=e.data.codes+randNum;else e.form.random_count.$invalid=!0,e.random_count_error=!0},e.btn_text="保存",e.submitForm=function(a){a&&(e.btn_text="保存中...",e.form.$invalid=!0,t.save(e.data,function(t){e.btn_text="保存",o.create("success"," 保存成功！"),n.close(1)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/ump/controllers/coupon.code.send",["apps/common/controllers/controllers"],function(e){e.controller("coupon.code.send",["$scope","codeResource","memberList","vipCardList","$modalInstance","Flash","code_id","type","coupon_id",function(e,t,a,o,s,n,r,i,c){e.paginationConf={currentPage:1,itemsPerPage:10},e.selectStatus=!1,e.cancel=function(){s.dismiss("cancel")},e.searchInfo={name:"",level_id:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var l=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.query(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.search=l,o.query(function(t){e.cardList=t.data}),e.type=i,e.choice=function(a){e.singleData={member_id:a.id,code_id:r},a.btn_status=!0,t.single_code(e.singleData,function(e){a.btn_status=!1,n.create("success"," 派发成功！"),s.close(1)},function(e){a.btn_status=!1,n.create("danger",e.data.error.message)})},e.selectAll=function(){e.selectStatus=!e.selectStatus,angular.forEach(e.data,function(t,a){t.checked=e.selectStatus})},e.batchSend_status=!1,e.batchSend=function(){e.members=[],angular.forEach(e.data,function(t,a){t.checked&&e.members.push(t.id)}),e.members.length>0?(e.batchData={member_ids:e.members.join(","),coupon_id:c},e.batchSend_status=!0,t.batch_code(e.batchData,function(t){e.batchSend_status=!1,n.create("success"," 派发成功！"),s.close(1)},function(t){e.batchSend_status=!1,n.create("danger",t.data.error.message)})):n.create("danger","请选择会员")}}])}),define("apps/ump/controllers/seckill.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.seckill.list",["$scope","ngPopover","$resource","seckillResource","Flash","$stateParams","$state","seckillFinishResource","videoAddress",function(e,t,a,o,s,n,r,i,c){e.videoAddress=c,e.status=n.status,e.params={title:"",start_at:"",end_at:""};var l=function(){delete e.params.start_at,delete e.params.end_at;var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};if($('input[name="created_range"]').val()){var a=$('input[name="created_range"]').val(),s=a.split("/");e.params.start_at=s[0],e.params.end_at=s[1]}o.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,status:e.status,title:e.params.title,start_at:e.params.start_at,end_at:e.params.end_at,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},
e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.over=function(e,t){t.status=3,i.finish({id:t.id},t,function(e){s.create("success","已关闭！"),r.go("shop.ump.seckill.list")},function(e){s.create("danger",e.error.message)})}}])}),define("apps/ump/controllers/seckill.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.seckill.info",["$scope","seckillResource","$stateParams","Flash","$state","goodsResource",function(e,t,a,o,s,n){a.id?(e.title="编辑活动",t.get({id:a.id},function(t){e.data=t.data}),e.is_disabled=!0):(e.title="新增活动",e.is_disabled=!1,e.data={finished_at_show:0,seckill_schedule_show:0}),a.goods_id&&n.get({id:a.goods_id},function(t){e.goods=[t],e.good=t}),e.$watch("data.created_at",function(t){$("input[name='finished_at']").calendar({format:"yyyy-MM-dd HH:mm:ss",minDate:t,minDateText:"结束时间不能小于开始时间",onSetDate:function(){e.data.finished_at=this.getDate("dateTime"),e.$apply()}})}),e.$watch("data.presale_at",function(t){$("input[name='created_at']").calendar({format:"yyyy-MM-dd HH:mm:ss",minDate:t,minDateText:"开始时间不能小于预热时间",onSetDate:function(){e.data.created_at=this.getDate("dateTime"),e.$apply()}})},!0),e.$watch("data.finished_at",function(t){$("input[name='created_at']").calendar({format:"yyyy-MM-dd HH:mm:ss",maxDate:t,maxDateText:"开始时间不能大于结束时间",onSetDate:function(){e.data.created_at=this.getDate("dateTime"),e.$apply()}})},!0),e.getNowFormatDate=function(){var e=new Date(new Date-864e5),t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.btn_text="保存",e.submitForm=function(n){n&&(e.goods&&e.goods.length>0&&(e.data.goods_id=e.goods[0].id,e.data.goods_img=e.goods[0].img,e.data.goods_title=e.goods[0].title),e.form.$invalid=!0,e.btn_text="保存中...",a.id?t.update({id:a.id},e.data,function(t){e.form.$invalid=!1,e.btn_text="保存",t.success&&(o.create("success"," 保存成功！"),s.go("shop.ump.seckill.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.form.$invalid=!1,e.btn_text="保存",o.create("danger",t.data.error.message)}):t.save(e.data,function(t){e.form.$invalid=!1,e.btn_text="保存",t.success&&(o.create("success"," 保存成功！"),s.go("shop.ump.seckill.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.form.$invalid=!1,e.btn_text="保存",o.create("danger",t.data.error.message)}))}}])}),define("apps/ump/controllers/fcoupon.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.fcoupon.info",["$scope","getFriendCoupon","upmImgUpLoading","getUpmStore","friendCouponData","$stateParams","$state","$http","$modal","Flash",function(e,t,a,o,s,n,r,i,c,l){function d(t,o){var s={url:"https"==_global.http_pref?"https://up.qbox.me":"http://up.qiniu.com",dataType:"json",add:function(t,a){return e.$apply(function(){0==o&&(e.imgUpLogo_text="正在上传.."),1==o&&(e.imgUpCovers_text="正在上传..")}),/\.(jpg|png|JPG|PNG)$/.test(a.files[0].name)?a.files[0].size>2097152?(l.create("danger","最大上传图片为2M"),e.$apply(function(){0==o&&(e.imgUpLogo_text="上传LOGO"),1==o&&(e.imgUpCovers_text="上传封面")}),!1):void a.submit():(l.create("danger","图片类型必须是*.jpg,*.png中的一种"),e.$apply(function(){0==o&&(e.imgUpLogo_text="上传LOGO"),1==o&&(e.imgUpCovers_text="上传封面")}),!1)},progressall:function(t,a){var s=parseInt(a.loaded/a.total*100,10);e.$apply(function(){0==o&&(e.imgUpLogo_text="已上传"+s+"%"),1==o&&(e.imgUpCovers_text="已上传"+s+"%")})},done:function(t,s){a.save({url:s.result.url},function(t){1==t.status&&(0==o&&(e.data.info.logo.wxImg=t.url.url,e.data.info.logo.qnImg=s.result.url),1==o&&(e.data.discount.covers.qnImg=s.result.url,e.data.discount.covers.wxImg=t.url.url,e.data.discount.isCovers=!1),2==o&&(e.mediaAddImg.qnImg=s.result.url,e.mediaAddImg.wxImg=t.url.url),l.create("success","上传成功")),e.imgUpLogo_text="上传LOGO",e.imgUpCovers_text="上传封面"})}};i.get("/attachment/qiniu_token").success(function(e){s.formData=function(t){return t.push({name:"token",value:e.token}),t.push({name:"x:merchant_id",value:_global.shop.merchant_id}),t},t.fileupload(s)})}function p(t){var a=!0;""==e.data.useSet.type&&(l.create("danger","请选择销券方式"),a=!1),e.data.custom.isOpen&&(""==e.data.custom.name&&(t.fcoupon_c_name.$dirty=!0,$("input[name='fcoupon_c_name']").focus(),a=!1),""==e.data.custom.click_url&&(t.fcoupon_customurl.$dirty=!0,$("input[name='fcoupon_customurl']").focus(),a=!1)),0==e.data.discount.media.length&&(e.data.discount.isMedia=!0,a=!1),""==e.data.discount.covers&&(e.data.discount.isCovers=!0,a=!1),""==e.data.discount.synopsis&&(t.fcoupon_synopsis.$dirty=!0,$("textarea[name='fcoupon_synopsis']").focus(),a=!1),""!=e.data.info.validity.start&&""!=e.data.info.validity.end&&1!=e.data.info.validity.vali||(e.data.info.validity.vali=!0,""!=e.data.info.validity.start&&""!=e.data.info.validity.end||(e.data.info.validity.vali_text="有效期不能为空"),a=!1);var o=/^([+]?[1-9][\d]{0,4})([.]?[\d]{1,2})?$/;return""!=e.data.info.money&&o.test(e.data.info.money)||(e.data.info.money="",t.fcoupon_money.$dirty=!0,$("input[name='fcoupon_money']").focus(),a=!1),""==e.data.info.name&&(t.fcoupon_shop_name.$dirty=!0,$("input[name='fcoupon_shop_name']").focus(),a=!1),a}e.colors=[{value:"#55bd47",name:"Color010"},{value:"#10ad61",name:"Color020"},{value:"#35a4de",name:"Color030"},{value:"#9058cb",name:"Color050"},{value:"#de9c33",name:"Color060"},{value:"#ebac16",name:"Color070"},{value:"#f9861f",name:"Color080"},{value:"#f08500",name:"Color081"},{value:"#a9d92d",name:"Color082"},{value:"#e75735",name:"Color090"},{value:"#d54036",name:"Color100"},{value:"#cf3e36",name:"Color101"}],e.storeData=o.get();var u=n.id;e.data=s,"undefined"==typeof e.data.isStep||e.data.isStep||angular.forEach(s.init(),function(t,a){e.data[a]=t}),n.id?(e.title="修改朋友的劵",t.get({id:u},function(e){})):e.title="新增朋友的劵",e.cardBgColorClick=function(t){e.data.info.color.name=t.name,e.data.info.color.value=t.value};var m=new Date,g=m.toISOString().split("T")[0],f=Date.parse(new Date(g));e.$watch("data.info.validity",function(t){var a="",o="";if(""!=t.start){var s=Date.parse(new Date(t.start));if(s<f)l.create("danger","开始时间不能小于今天"),e.data.info.validity.vali=!0,e.data.info.validity.vali_text="开始时间不能小于今天";else{var n=t.start.split(" "),r=n[0],i=(n[1],r.split("-")[0]),c=r.split("-")[1],d=r.split("-")[2],p=parseInt(i),u=parseInt(c)+3;u>12&&(p+=1,u-=12),a=p+"-"+u+"-"+d+" 23:59:59",o=Date.parse(new Date(a)),e.data.info.validity.vali=!1,e.data.info.validity.vali_text=""}}else var s="";if(""!=t.end)var m=Date.parse(new Date(t.end.split(" ")[0]));else var m="";""!=s&&""!=m&&(s>=f&&m<=o&&m>s?(e.data.info.validity.vali=!1,e.data.info.validity.vali_text=""):m<s?(l.create("danger","结束时间不能小于开始时间"),e.data.info.validity.vali=!0,e.data.info.validity.vali_text="结束时间不能小于开始时间"):m>o?(l.create("danger","有效期最长为3个月"),e.data.info.validity.vali=!0,e.data.info.validity.vali_text="有效期最长为3个月"):s>m&&(l.create("danger","结束时间不能小于开始时间"),e.data.info.validity.vali=!0,e.data.info.validity.vali_text="结束时间不能小于开始时间"))},!0),e.selectUseTimeClick=function(t){var a=e.data.info.time.part.indexOf(t);a>-1?e.data.info.time.part.splice(a,1):e.data.info.time.part.push(t)},e.selectShopServerClick=function(t){var a=e.data.introduce.service.indexOf(t);a>-1?e.data.introduce.service.splice(a,1):e.data.introduce.service.push(t)},e.upmImgupload=function(e,t){var a=$(e.target);d(a,t)},e.mediaAddImg={wxImg:"",qnImg:"",text:"",isInvalid:!1},e.showMediaCont={type:0,isEdit:!1,index:""},e.showMediaClick=function(){e.showMediaCont.type=1,e.showMediaCont.index=""},e.hideMediaClick=function(){e.showMediaCont.type=0,e.showMediaCont.isEdit=!1,e.mediaAddImg.wxImg="",e.mediaAddImg.qnImg="",e.mediaAddImg.text="",e.mediaAddImg.isInvalid=!1},e.mediaAdd=function(){if(""!=e.mediaAddImg.qnImg&&""!=e.mediaAddImg.text){var t={wxImg:e.mediaAddImg.wxImg,qnImg:e.mediaAddImg.qnImg,text:e.mediaAddImg.text},a=e.showMediaCont.isEdit,o=e.showMediaCont.index;e.data.discount.media.length<10?(a?(e.data.discount.media[o].wxImg=t.wxImg,e.data.discount.media[o].qnImg=t.qnImg,e.data.discount.media[o].text=t.text):e.data.discount.media.push(t),e.mediaAddImg.wxImg="",e.mediaAddImg.qnImg="",e.mediaAddImg.text="",e.showMediaCont.isEdit=!1,e.showMediaCont.index="",e.data.discount.isMedia=!1):l.create("danger","最多只能添加十条")}else e.mediaAddImg.isInvalid=!0},e.sortableOptions={handle:".media-move",cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.mediaEdit=function(t,a){e.mediaAddImg.wxImg=t.wxImg,e.mediaAddImg.qnImg=t.qnImg,e.mediaAddImg.text=t.text,e.showMediaCont.isEdit=!0,e.showMediaCont.index=a,e.showMediaCont.type=1},e.mediaDelete=function(t){e.data.discount.media.splice(t,1)},e.getFcouponStore=function(t){if("0"==t&&(e.data.store.type=0,angular.forEach(e.storeData.data,function(t,a){e.data.store.storeList.push(t.base_info.poi_id)})),"1"==t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/friend.coupon.store.html",controller:"shop.ump.fcoupon.store",resolve:{data:function(){return e.storeData}}});a.result.then(function(t){e.data.store.type=1,e.data.store.storeList=t})}},e.delFcouponStore=function(t){var a=e.data.store.storeList.indexOf(t);a>-1&&e.data.store.storeList.splice(a,1)},e.addCustom=function(){e.data.custom.isOpen=!0},e.deleteCustom=function(){e.data.custom.isOpen=!1},e.ticketSetOpen=function(){0==e.data.ticketSet.enabled?(e.data.ticketSet.enabled=1,e.data.ticketSet.type=""):(e.data.ticketSet.enabled=0,e.data.ticketSet.type=0)},e.saveForm=function(a){var o=p(a);o&&t.save(e.data,function(e){})},e.imgUpLogo_text="上传LOGO",e.imgUpCovers_text="上传封面",e.imgUpMedia_text=""}])}),define("apps/ump/controllers/fcoupon.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.fcoupon.list",["$scope","getFriendCoupon","getShowQrcode","ngPopover",function(e,t,a,o){e.status="all";var s=function(){var a={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};t.query({offset:(a.offset-1)*a.limit,limit:a.limit,keywords:e.keywords,status:e.status,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.showQrcode=function(t){a.get({card_id:t},function(t){e.qrcodeInfo=t})},e.remove=function(a,o){t.delete({id:o},function(t){e.data.splice(a,1),Flash.create("success"," 删除成功！")},function(e){Flash.create("danger",e.data.error.message)})}}])}),define("apps/ump/controllers/fcoupon.store",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.fcoupon.store",["$scope","$modalInstance","data","Flash",function(e,t,a,o){e.store=a,e.delivery={checkedAll:!1},e.checkboxIds=[],e.$watch("delivery.checkedAll",function(t){if(t)for(var a=0;a<e.store.data.length;a++)e.checkboxIds.push(e.store.data[a].base_info.poi_id);else e.checkboxIds=[]}),e.toggleSelection=function(t){var a=e.checkboxIds.indexOf(t);a>-1?e.checkboxIds.splice(a,1):e.checkboxIds.push(t)},e.pushStoreList=function(){0==e.checkboxIds.length?o.create("danger","请选择门店"):t.close(e.checkboxIds)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ump/controllers/fcoupon.detail",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.fcoupon.detail",["$scope","getFriendCoupon","getUpmStore","$stateParams","Flash",function(e,t,a,o,s){e.storeData=a.get();var n=o.id;e.title="朋友的劵详情",t.get({id:n},function(t){e.detailData=t,e.storeData.length==t.location_id_list.length?e.storeType=0:e.storeType=1,""==t.custom_url_name&&""==t.custom_url?e.customIsOpen=!1:e.customIsOpen=!0})}])}),define("apps/ump/controllers/setmeal.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.setmeal.list",["$scope","ngPopover","$resource","setmealResource","Flash","$stateParams","setmealFinishResource","$state",function(e,t,a,o,s,n,r,i){e.status="all";var c=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,status:e.status},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.search=function(){1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1},e.finish=function(e,t){r.finish({id:t.id},t,function(e){s.create("success","已结束！"),location.reload()},function(e){s.create("danger",e.error.message)})}}])}),define("apps/ump/controllers/setmeal.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.setmeal.info",["$scope","$modal","setmealResource","setmealupdateResource","combogoodsdeleteResource","$stateParams","Flash","$state","goodsResource",function(e,t,a,o,s,n,r,c,l){n.id?(e.title="编辑套餐",a.get({id:n.id},function(t){e.data=t.data,e.dataedit=1,e.contentgoods=t.data.combogoods})):e.title="新增套餐",e.$watch("contentgoods",function(t){e.contentgoods&&e.blur()},!0),e.remove=function(t,a){e.contentgoods.splice(a,1)},e.blur=function(){e.original_price=0,e.price=0;var t=0;for(i in e.contentgoods)void 0!=e.contentgoods[i].pay_price&&void 0!=e.contentgoods[i].stock||t++,e.original_price+=e.contentgoods[i].price*e.contentgoods[i].stock,e.price+=e.contentgoods[i].pay_price*e.contentgoods[i].stock;0!=t?e.data.price="":(e.data.original_price=e.original_price.toFixed(2),e.data.price=e.price.toFixed(2))},e.add_goods=function(a){e.contentgoods||(e.contentgoods=[]);var o=t.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/ump/templates/setmeal.goods.list.html",controller:"setmealGoodsModalCtrl"});o.contentgoods=a,o.result.then(function(t){e.combogood=[];for(i in t)item=t[i],e.combogood={goods_id:item.id,img:item.img,title:item.title,alias:item.alias,pay_price:0,price:item.price,is_hide:0,stock:1},e.contentgoods.push(e.combogood)})},e.submitForm=function(t){if(t){if(e.data.goods_num=e.contentgoods.length,e.contentgoods.length<1)return void r.create("danger","请添加套餐商品!");e.data.combogoods=JSON.stringify(e.contentgoods),e.form.$invalid=!0,n.id?o.update({id:n.id},e.data,function(t){t.success&&(r.create("success"," 保存成功！"),e.btn_text="保存",c.go("shop.ump.setmeal.list")),t.error&&r.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,r.create("danger",t.data.error.message)}):a.save(e.data,function(t){t.success&&(r.create("success"," 保存成功！"),e.btn_text="保存",c.go("shop.ump.setmeal.list")),t.error&&r.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,r.create("danger",t.data.error.message)})}}}])}),define("apps/ump/controllers/setmeal.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.setmeal.records",["$scope","ngPopover","$resource","setmealRecordsResource","Flash","$stateParams",function(e,t,a,o,s,n){e.id=n.id,e.status="";var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,name:e.name,order_sn:e.order_sn,status:e.status,id:e.id},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/ump/controllers/setmeal.details",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.setmeal.details",["$scope","ngPopover","$resource","setmealDetailResource","Flash","$stateParams",function(e,t,a,o,s,n){e.order_sn=n.order_sn,e.status="all";var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,name:e.name,order_sn:e.order_sn},function(t){e.paginationConf.totalItems=t._count,e.data=t})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/ump/controllers/setmeal.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("setmealGoodsModalCtrl",["$scope","$modalInstance","discountGoodsRes","tagResource","Flash","$state",function(e,t,a,o,s,n){function r(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,type:1,column:"csale",direction:"desc"},r();var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id),a.get(e.params,function(a){e.paginationConf.totalItems=a._count,e.goods=a.data;for(i in e.goods)for(j in t.contentgoods)e.goods[i].id==t.contentgoods[j].goods_id&&(e.goods[i].has_show=1)})};e.search=function(){c()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",c()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ump/controllers/bangmian/bangmian.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.bangmian.list",["$scope","ngPopover","$resource","bangmianResource","Flash","$stateParams","$state","bangmianFinishResource",function(e,t,a,o,s,n,r,i){e.status=n.status;var c=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,title:e.title,goods_title:e.goods_title,status:e.status,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.search=function(){1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1},e.over=function(e,t){t.status=2,i.finish({id:t.id},{status:t.status},function(e){s.create("success","已结束！"),r.go("shop.ump.bangmian.list")},function(e){s.create("danger",e.error.message)})}}])}),define("apps/ump/controllers/bangmian/bangmian.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.bangmian.info",["$scope","bangmianResource","$stateParams","Flash","$state","goodsResource",function(e,t,a,o,s,n){a.id?(e.title="编辑帮免活动",e.isEdit=!0,t.get({id:a.id},function(t){e.data=t})):(e.isEdit=!1,e.title="新增帮免活动"),a.goods_id&&n.get({id:a.goods_id},function(t){e.good=t,e.isEdit||(e.data={stock:t.stock,day_limit:0,hour_limit:0,minite_limit:0,second_limit:0,status:0})}),e.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate()-1;o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.submitForm=function(n){n&&(e.good&&(e.data.goods_id=e.good.id,e.data.goods_img=e.good.img,e.data.goods_title=e.good.title),e.form.$invalid=!0,a.id?t.update({id:a.id},e.data,function(t){t.success&&(o.create("success"," 保存成功！"),e.btn_text="保存",s.go("shop.ump.bangmian.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error)}):t.save(e.data,function(t){t.success&&(o.create("success"," 保存成功！"),e.btn_text="保存",s.go("shop.ump.bangmian.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/ump/controllers/bangmian/bangmian.starts",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.bangmian.starts",["$scope","ngPopover","$resource","bangmianDetailResource","Flash","$stateParams",function(e,t,a,o,s,n){e.bangmian_id=n.bangmian_id,e.bangmian_name=n.bangmian_name,e.status="all";var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,bangmian_id:e.bangmian_id,sort:e.sorts,status:e.status,name:e.name},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/ump/controllers/bangmian/bangmian.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.bangmian.records",["$scope","ngPopover","$resource","bangmianDetailResource","Flash","$stateParams",function(e,t,a,o,s,n){e.id=n.id;var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,id:e.id,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r)}])}),define("apps/ump/controllers/dynamics.list",["apps/common/controllers/controllers"],function(e){e.controller("dynamics.list",["$scope","$state","dynamicslistResource","dynamicsdelResource","Flash","videoAddress",function(e,t,a,o,s,n){e.videoAddress=n,t.includes("shop.ump.ordercount")?e.type=1:e.type=0;var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.query({offset:(t.offset-1)*t.limit,limit:t.limit,type:e.type,keywords:e.keywords},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.remove=function(t,a){o.delete({id:a},function(a){a.status?(e.data.splice(t,1),s.create("success"," 删除成功！")):s.create("danger",a.msg)},function(e){s.create("danger",e.data.error.message)})}}])}),define("apps/ump/controllers/dynamics.info",["apps/common/controllers/controllers","echarts","echarts/chart/line","echarts/chart/bar"],function(e,t){e.controller("shop.ump.dynamics.info",["$scope","dynamicsResource","dynamicsgetResource","dynamicseditResource","$stateParams","Flash","$state","$modal","$http",function(e,t,a,o,s,n,r,c,l){e.types=[],e.content_type=0,e.data=[],e.contentgoods=[],l({method:"GET",url:"/dynamic/getDynamicType.json"}).then(function(t){e.types=t.data},function(e){}),e.typechecked=function(t){e.content_type=t.type,e.data.type=t.type,e.active=t.e_name,e.contentgoods=[]},e.statuschecked=function(t){if(e.contentgoods.length>9){var a=0;for(i in e.contentgoods)1==e.contentgoods[i].status&&a++;if(9==a)for(i in e.contentgoods)1!=e.contentgoods[i].status&&(e.contentgoods[i].statushide=1);else for(i in e.contentgoods)e.contentgoods[i].statushide=0}},e.remove=function(t,a){e.contentgoods.splice(a,1),e.statuschecked()},e.add_goods=function(t){if(e.contentgoods||(e.contentgoods=[]),1==e.content_type)var a=c.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/ump/templates/dynamics.goods.list.html",controller:"dynamicsGoodsModalCtrl"});if(2==e.content_type)var a=c.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/ump/templates/dynamics.collect.list.html",controller:"dynamicsGoodsModalCtrl"});a.contentgoods=e.contentgoods,a.active=e.active,a.result.then(function(t){e.combogood=[];for(i in t)item=t[i],1==e.content_type&&(e.combogood={goods_id:item.id,img:item.img,title:item.title,price:item.price,stock:item.stock,status:0}),2==e.content_type&&(e.combogood={goods_id:item.id,pic:item.pic,name:item.name,amount:item.amount,publish_at:item.publish_at,over_at:item.over_at,status:0}),e.contentgoods.push(e.combogood)})},s.id?(e.title="修改动态",e.is_edit=1,a.get({dynamic_id:s.id,e_name:s.e_name},function(t){1!=t.type&&2!=t.type||(e.contentgoods=t.goods),3==t.type&&angular.forEach(t.imgs,function(e,a){t.imgs[a]={id:e.id,url:e.img}}),e.data=t,e.content_type=t.type,e.data.dynamic_id=s.id,e.active=s.e_name})):(e.title="新增动态",e.data={goods:[]}),e.btn_text="保存",e.submitForm=function(a){if(a){if(1!=e.data.type&&2!=e.data.type||(e.data.goods=e.contentgoods),e.contentgoods.length<1&&1==e.data.type)return void n.create("danger","请添加商品!");if(e.contentgoods.length<1&&2==e.data.type)return void n.create("danger","请添加众筹!");e.btn_text="保存中...",e.form.$invalid=!0,s.id?o.update({id:s.id},e.data,function(t){t.status?(n.create("success"," 保存成功！"),e.btn_text="保存",r.go("shop.ump.dynamics.list")):(n.create("danger",t.msg),e.btn_text="保存",e.form.$invalid=!1)},function(t){e.btn_text="保存",e.form.$invalid=!1,n.create("danger",t.data.error.message)}):t.save(e.data,function(t){t.status?(n.create("success"," 保存成功！"),e.btn_text="保存",r.go("shop.ump.dynamics.list")):(n.create("danger",t.msg),e.btn_text="保存",e.form.$invalid=!1)},function(t){e.btn_text="保存",e.form.$invalid=!1,n.create("danger",t.data.error.message)})}}}])}),define("apps/ump/controllers/dynamics.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("dynamicsGoodsModalCtrl",["$scope","$modalInstance","dynamicsGoodsRes","tagResource","Flash","$state",function(e,t,a,o,s,n){function r(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,type:1,column:"csale",direction:"desc"},r(),e.params.active=t.active;var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id),a.get(e.params,function(a){e.paginationConf.totalItems=a._count,e.goods=a.data;for(i in e.goods)for(j in t.contentgoods)e.goods[i].id==t.contentgoods[j].goods_id&&(e.goods[i].has_show=1)})};e.search=function(){c()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",c()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ump/controllers/repurchase.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.repurchase.list",["$scope","repuchaseResource","$modal","Flash",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",direction:"desc"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.query(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})},n=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1};e.sorting={created_at:"",repurchase_price:"",price:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),n()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.checkRepurchasePrice=function(e,t){return/^\d+(\.\d+)?$/.test(e)?parseFloat(e)>parseFloat(t)?"复购价不能超过商品价格":void 0:"格式不正确!"},e.saveField=function(e,a,s){var n={goods_id:s};n[e]=a,t.update(n,function(e){e.success?o.create("success"," 修改成功！"):o.create("danger",e.error)})},e.remove=function(a,s){t.delete({goods_id:s},function(t){t.success?(e.data.splice(a,1),o.create("success"," 删除成功！")):o.create("danger",t.error)})},e.setRepurchasePrice=function(e){var t=a.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/repurchase_tpl.html",controller:"repurchase.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){s()})}}])}),define("apps/ump/controllers/multis.repurchase",["apps/common/controllers/controllers"],function(e){e.controller("ump.multis.repurchase",["$scope","Flash","$modalInstance","repuchaseResource","goods_id",function(e,t,a,o,s){e.isGet=!1,e._global=_global,o.getUnAttend({goods_id:s},function(t){e.isGet=!0,e.goodsData=t.data}),e.cancel=function(){a.dismiss("cancel")},e.btn_text="保存",e.saveProductPrice=function(n){if(!n){e.btn_text="保存中...",e.pricefrom.$invalid=!0;var r={goods_id:s};e.goodsData.is_sku?(r.products=[],angular.forEach(e.goodsData.products,function(e,t){r.products.push({product_id:e.product_id,repurchase_price:e.repurchase_price})})):r.repurchase_price=e.goodsData.repurchase_price,o.add(r,function(o){o.success?(t.create("success","保存成功"),a.close(1)):t.create("danger",o.error),e.pricefrom.$invalid=!1,e.btn_text="保存"})}}}])}),define("apps/ump/controllers/repurchase.price",["apps/common/controllers/controllers"],function(e){e.controller("repurchase.price.tpl",["$scope","Flash","repuchaseResource","goodsId","$modalInstance",function(e,t,a,o,s){e.products=[],e.cancel=function(){s.dismiss("cancel")},e.btn_text="保存",e.saveRepurchasePrice=function(n){if(!n){e.btn_text="保存中...",e.repurchasefrom.$invalid=!0;var r=[];angular.forEach(e.products,function(e,t){r.push({repurchase_price:e.repurchase_price,product_id:e.product_id})}),a.update({goods_id:o,products:r},function(a){a.success?(t.create("success","保存成功"),s.close(1)):t.create("danger","保存失败"),e.btn_text="保存",e.repurchasefrom.$invalid=!1})}},a.get({goods_id:o},function(t){e.products=t.data})}])}),define("apps/ump/controllers/repurchase.setting",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.repurchase.setting",["$scope","merchantSettingResource","$modal","Flash",function(e,t,a,o){e.setting=t.get(),e.btn_text="保存",e.submitForm=function(a){a&&(e.btn_text="保存中...",e.form.$invalid=!0,t.update(e.setting,function(a){e.setting=t.get(),e.btn_text="保存",o.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/ump/controllers/coupon.model.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("coupon.model.goods.ctrl",["$scope","$modalInstance","goodsResource","tagResource","Flash","goodsList",function(e,t,a,o,s,n){function r(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,
itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},r();var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data,n&&n.length>0&&angular.forEach(e.goods,function(e){angular.forEach(n,function(t){e.id===t.id&&(e.disabled=!0)})})})};e.search=function(){i()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",i()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):(n&&n.length>0&&angular.forEach(n,function(t){angular.forEach(e.selected,function(a,o){t.id===a.id&&e.selected.splice(o,1)})}),t.close(e.selected))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ump/controllers/sharered.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sharered.list",["$scope","Flash","shareredResource","$state","redStorage",function(e,t,a,o,s){var n=this,r=function(e,o){return 3==o?a.pauseActivity({id:e},function(e){e.status?(t.create("success","暂停成功！"),l()):t.create("danger","暂停失败")},function(){}):1==o&&a.startActivity({id:e},function(e){e.status?(t.create("success","开始成功！"),l()):t.create("danger","开始失败")},function(){})},i=function(e){return a.deleteActivity({id:e},function(e){e.status?(t.create("success","删除成功！"),l()):t.create("danger","删除失败！")},function(){})},c=function(){l()},l=function(e){e&&(n.paginationConf={currentPage:1,itemsPerPage:10});var t={page:n.paginationConf.currentPage-1,activity_name:n.keywords||null};return a.get(t,function(e){e.status&&(n.data=e.data.list,n.paginationConf.currentPage=parseInt(e.data.page)+1,n.paginationConf.totalItems=e.data.total,n.paginationConf.itemsPerPage=e.data.limit)})},d=function(e){s.setRed({id:e}),o.go("shop.ump.sharered.sub.stat",{id:e})},p=function(){n.types=["","暂停","未开始","进行中","已结束"],n.paginationConf={currentPage:1,itemsPerPage:10},u()},u=function(){e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",c)};n.pauseActivity=r,n.deleteActivity=i,n.search=l,n.toPage=d,p()}])}),define("apps/ump/controllers/sharered.manage",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sharered.manage",["$stateParams","shareredManageResource","$scope","$state","$modal","Flash","$timeout",function(e,t,a,o,s,n,r){var i=this,c=function(){return!!i.type&&(3==i.type||1==i.type)},l=function(e){var t=e;return i.issue_goods_2=2==e.issue_activity_goods_type?e.issue_image:[],i.issue_goods_3=3==e.issue_activity_goods_type?e.issue_image:[],i.issue_goods=2==e.issue_activity_goods_type?i.issue_goods_2:i.issue_goods_3,i.use_goods_2=2==e.use_activity_goods_type?e.use_image:[],i.use_goods_3=3==e.use_activity_goods_type?e.use_image:[],i.use_goods=2==e.use_activity_goods_type?i.use_goods_2:i.use_goods_3,t.created_range={startDate:e.start_time,endDate:e.end_time},2!=i.type&&(i.oldActivity_budget=1==e.red_packet_content?e.activity_budget:0,i.oldCreated_range=t.created_range),2==e.red_packet_content&&(i.old_discount_red_packet_amount=e.discount_red_packet_amount),t.dates=2==e.use_type?{startDate:e.use_start_time,endDate:e.use_end_time}:{startDate:new Date,endDate:new Date},r(function(){$('input[name="created_range"]').val(e.start_time+"/"+e.end_time),2==e.use_type?$('input[name="dates"]').val(e.use_start_time+"/"+e.use_end_time):""},20),t},d=function(e){t.get({id:e},function(e){e.status&&(i.data=l(e.data),u())})},p=function(e,t){s.open({animation:!1,templateUrl:"assets/js/apps/design/templates/model_goods_list.html",controller:"modelGoodsCtrl"}).result.then(function(a){"issue_goods"===e?(i.issue_goods_2=2==t?i.issue_goods_2.concat(a):i.issue_goods_2,i.issue_goods_3=3==t?i.issue_goods_3.concat(a):i.issue_goods_3,i.issue_goods=2==t?i.issue_goods_2:i.issue_goods_3):"use_goods"===e&&(i.use_goods_2=2==t?i.use_goods_2.concat(a):i.use_goods_2,i.use_goods_3=3==t?i.use_goods_3.concat(a):i.use_goods_3,i.use_goods=2==t?i.use_goods_2:i.use_goods_3)})},u=function(){a.$watch("vm.data.issue_activity_goods_type",function(){1==i.data.issue_activity_goods_type?i.issue_goods=[]:2==i.data.issue_activity_goods_type?i.issue_goods=i.issue_goods_2:i.issue_goods=i.issue_goods_3}),a.$watch("vm.data.use_activity_goods_type",function(){1==i.data.use_activity_goods_type?i.use_goods=[]:2==i.data.use_activity_goods_type?i.use_goods=i.use_goods_2:i.use_goods=i.use_goods_3})},m=function(e,t,a){"issue_goods"===e?(2==t?i.issue_goods_2.splice(a.$index,1):i.issue_goods_3.splice(a.$index,1),i.issue_goods=2==t?i.issue_goods_2:i.issue_goods_3):"use_goods"===e&&(2==t?i.use_goods_2.splice(a.$index,1):i.use_goods_3.splice(a.$index,1),i.use_goods=2==t?i.use_goods_2:i.use_goods_3)},g=function(){i.data.get_red_packet_desc.push("")},f=function(e){i.data.get_red_packet_desc.length>1&&i.data.get_red_packet_desc.splice(e,1)},h=function(){i.data.use_goods_id=[],1!=i.data.use_activity_goods_type&&angular.forEach(i.use_goods,function(e){i.data.use_goods_id.push(e.id)}),i.data.issue_goods_id=[],1!=i.data.issue_activity_goods_type&&angular.forEach(i.issue_goods,function(e){i.data.issue_goods_id.push(e.id)});var e=[];angular.forEach(i.data.get_red_packet_desc,function(t){t?e.push(t):e.push("领个抵用券，回家买买买~")});var t={activity_name:i.data.activity_name,red_packet_content:i.data.red_packet_content,red_packet_type:1==i.data.red_packet_content?i.data.red_packet_type:null,once_issue:1==i.data.red_packet_content?i.data.once_issue:null,discount:2==i.data.red_packet_content?i.data.discount:null,discount_red_packet_amount:2==i.data.red_packet_content?i.data.discount_red_packet_amount:null,once_issue_amount:i.data.once_issue_amount,share_desc:i.data.share_desc||"给小伙伴们发放现金抵用券，大家一起来抢吧，先抢先得~",get_red_packet_desc:e,share_img:i.data.share_img,activity_rule:i.data.activity_rule,start_time:i.data.start_time,end_time:i.data.end_time,issue_activity_goods_type:i.data.issue_activity_goods_type,issue_goods_id:i.data.issue_goods_id,issue_minimum_amount:i.data.issue_minimum_amount,activity_budget:1==i.data.red_packet_content?i.data.activity_budget:null,get_red_packet_amount:i.data.get_red_packet_amount,use_type:i.data.use_type,get_after_day:1==i.data.use_type?i.data.get_after_day:null,can_use_day:1==i.data.use_type?i.data.can_use_day:null,use_start_time:2==i.data.use_type?i.data.use_start_time:null,use_end_time:2==i.data.use_type?i.data.use_end_time:null,use_activity_goods_type:i.data.use_activity_goods_type,use_goods_id:i.data.use_goods_id,use_minimum_amount:i.data.use_minimum_amount};return t},_=function(){if(!i.data.activity_rule)return void n.create("danger","请填写活动规则！");var s=$('input[name="created_range"]').val();if(""==s)return void n.create("danger","请选择活动生效时间");if(i.data.start_time=s.split("/")[0],i.data.end_time=s.split("/")[1],e.id&&(1==i.type||3==i.type)){if(new Date(i.data.start_time).getTime()<new Date(i.oldCreated_range.startDate).getTime())return void n.create("danger","活动生效开始时间不能小于原活动生效开始时间"+i.oldCreated_range.startDate);if(new Date(i.data.end_time).getTime()<new Date(i.oldCreated_range.endDate).getTime())return void n.create("danger","活动生效结束时间不能小于原活动生效结束时间"+i.oldCreated_range.endDate)}if(2==i.data.use_type){var r=$('input[name="dates"]').val();if(""==r)return void n.create("danger","请选择抵用券使用固定时间");i.data.use_start_time=r.split("/")[0],i.data.use_end_time=r.split("/")[1]}if(1!=i.data.issue_activity_goods_type&&!(i.issue_goods&&i.issue_goods.length>0))return void n.create("danger","请添加发放限制"+(2==i.data.issue_activity_goods_type?"自选商品":"排除商品"));if(1!=i.data.use_activity_goods_type&&!(i.use_goods&&i.use_goods.length>0))return void n.create("danger","请添加使用限制"+(2==i.data.use_activity_goods_type?"自选商品":"排除商品"));var c=h();e.id?(c.id=e.id,t.update(c,function(e){e.status?(o.go("shop.ump.sharered.list"),n.create("success"," 修改成功！")):n.create("danger",e.data||"修改失败！")},function(e){a.btn_text="修改",n.create("danger",e.data.data)})):(c.id=0,t.save(c,function(e){e.status?(o.go("shop.ump.sharered.list"),n.create("success"," 保存成功！")):n.create("danger",e.data||"保存失败！")},function(e){n.create("danger",e.data.error.message)}))},v=function(){e.id?(i.formBtnText="修改",i.editId=e.id,e.type&&(i.type=e.type),d(e.id)):(i.formBtnText="保存",i.data={get_red_packet_desc:[null,null],issue_activity_goods_type:1,red_packet_content:1,red_packet_type:1,use_type:1,use_activity_goods_type:1,share_img:"/2017/04/20/FoKSDPdUNQL9aL_RHHR1Yzc_ZP5Q.png"},u(),i.issue_goods_2=[],i.issue_goods_3=[],i.use_goods_2=[],i.use_goods_3=[]),a.editorOptions=angular.extend({},{height:"150px",toolbar:[["Bold","Italic","Underline","-","NumberedList","BulletedList","Outdent","Indent","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]],allowedContent:!0})};i.addNewCopywriting=g,i.deleteCopywriting=f,i.addGoods=p,i.removeGoods=m,i.submitForm=_,i.canEdit=c,v()}])}),define("apps/ump/controllers/sharered.receivedetails",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sharered.receivedetails",["$stateParams","$scope","shareredReceivedetailsResource",function(e,t,a){var o=this,s=function(){var e,t="/marketing/redpacket_expdetail.json",a=[];o.id&&a.push("id="+o.id),o.aid&&a.push("aid="+o.aid),o.query.name&&a.push("name="+o.query.name),o.query.use_order_sn&&a.push("use_order_sn="+o.query.use_order_sn),o.query.get_name&&a.push("get_name="+o.query.get_name),o.query.open_status&&a.push("get_name="+o.query.get_name),o.query.order_time&&a.push("order_time="+o.query.order_time),e=t+(a.length>0?"?"+a.join("&"):""),window.location.href=e},n=function(){var e={id:o.id,aid:o.aid,offset:(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,limit:o.paginationConf.itemsPerPage,get_name:o.query.get_name||null,name:o.query.name||null,member_id:o.query.member_id||null,use_order_sn:o.query.use_order_sn||null};if($('input[name="get_time"]').val()){var t=$('input[name="get_time"]').val(),t=t.split("/");e.get_start_time=t[0],e.get_end_time=t[1]}if($('input[name="order_time"]').val()){var a=$('input[name="order_time"]').val(),a=a.split("/");e.order_start_time=a[0],e.order_end_time=a[1]}return e},r=function(e){e&&(o.paginationConf={currentPage:1,itemsPerPage:10});var t=n();return a.getReceiveDetailList(t,function(e){e.status&&(o.data=e.data,o.paginationConf.totalItems=e._count)})},i=function(){r()},c=function(){t.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",i)},l=function(){e.name?o.query={name:e.name}:o.query={},e.id&&(o.id=e.id),e.aid&&(o.aid=e.aid),o.ranges={"今天":[moment(),moment()],"明天":[moment().add("days",1),moment().add("days",1)],"未来7天":[moment(),moment().add("days",6)],"未来15天":[moment(),moment().add("days",15)],"本月":[moment(),moment().endOf("month")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)]},o.paginationConf={currentPage:1,itemsPerPage:10},c()};o.search=r,o.exportDetails=s,l()}])}),define("apps/ump/controllers/sharered.stat",["apps/common/controllers/controllers","echarts"],function(e,t){e.controller("shop.ump.sharered.stat",["$scope","shareredStatResource","redStorage","$stateParams",function(e,a,o,s){var n=this,r=t.init(document.getElementById("lineChart1")),i=t.init(document.getElementById("lineChart2"));r.showLoading({text:"数据读取中....",effect:"spin"}),i.showLoading({text:"数据读取中....",effect:"spin"});var c={tooltip:{trigger:"axis"},legend:{data:[]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:[]}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:[]},{name:"",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:[]}]},l=function(e){var t={line1Data:{legendData:["已发放抵用券数","已领取人数"],seriesData:{one:[],two:[]}},line2Data:{legendData:["已发放金额","已使用金额"],seriesData:{one:[],two:[]}},xAxisData:[]};e.length>0&&angular.forEach(e,function(e){t.xAxisData.push(e.date),t.line1Data.seriesData.one.push(e.red_packet_send),t.line1Data.seriesData.two.push(e.red_packet_get),t.line2Data.seriesData.one.push(e.red_packet_money_send),t.line2Data.seriesData.two.push(e.red_packet_money_get)});var a=angular.copy(c);a.legend.data=t.line1Data.legendData,a.xAxis[0].data=t.xAxisData,a.series[0].data=t.line1Data.seriesData.one,a.series[0].name=t.line1Data.legendData[0],a.series[1].data=t.line1Data.seriesData.two,a.series[1].name=t.line1Data.legendData[1];var o=angular.copy(c);o.legend.data=t.line2Data.legendData,o.xAxis[0].data=t.xAxisData,o.series[0].data=t.line2Data.seriesData.one,o.series[0].name=t.line2Data.legendData[0],o.series[1].data=t.line2Data.seriesData.two,o.series[1].name=t.line2Data.legendData[1],r.hideLoading(),i.hideLoading(),r.setOption(a),i.setOption(o)},d=function(){return a.getStatData({id:n.id},function(e){e.status&&l(e.data)})},p=function(e){e&&(n.paginationConf={currentPage:1,itemsPerPage:10});var t={id:n.id,offset:(n.paginationConf.currentPage-1)*n.paginationConf.itemsPerPage,limit:n.paginationConf.itemsPerPage,name:n.query.name||null,order_sn:n.query.order_sn||null,issue_type:n.query.issue_type||null,open_status:n.query.open_status||null};return a.getDetailList(t,function(e){e.status&&(n.data=e.data,n.paginationConf.totalItems=e._count)})},u=function(){p()},m=function(){e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",u)},g=function(){var e,t="/marketing/redpacket_explist.json",a=[];n.id&&a.push("id="+n.id),n.query.name&&a.push("name="+n.query.name),n.query.order_sn&&a.push("order_sn="+n.query.order_sn),n.query.issue_type&&a.push("issue_type="+n.query.issue_type),n.query.open_status&&a.push("open_status="+n.query.open_status),e=t+(a.length>0?"?"+a.join("&"):""),window.location.href=e},f=function(){n.issue_types=["","发送失败","发送成功"],n.open_statuses=["","有剩余","已领完"],s.id?(n.id=s.id,o.setRed({id:s.id})):n.id=o.getRed().id,d(),n.query={},n.paginationConf={currentPage:1,itemsPerPage:10},m()};n.search=p,n.exportDetails=g,f()}])}),define("apps/ump/controllers/sharered.operationlog",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sharered.operationlog",["$scope","$stateParams","shareredOperationlogResource",function(e,t,a){var o=this,s=function(e){a.get({page:o.paginationConf.currentPage-1||0,id:e},function(e){e.status&&(o.data=e.data.list,o.paginationConf.currentPage=parseInt(e.data.page)+1,o.paginationConf.totalItems=e.data.total,o.paginationConf.itemsPerPage=e.data.limit)})},n=function(){t.id&&s(t.id)},r=function(){e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",n)},i=function(){o.paginationConf={currentPage:1,itemsPerPage:10},r()};i()}])}),define("apps/ump/controllers/sharered.sub.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("sharered.sub.ctrl",["$scope","redStorage",function(e,t){e.id=t.getRed().id}])}),define("apps/ump/controllers/sign.setting.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sign.setting.ctrl",["$scope","signDesignData","$stateParams","signSettingService","Flash","signDesignService","checkAddArrService","$modal",function(e,t,a,o,s,n,r,i){var c=function(){e.shareDescRequired=!0},l=function(t,a){a?angular.forEach(e.data.integral_data,function(e,t){e.disabled=!1,e.canNotDel=!1}):angular.forEach(e.data.integral_data,function(e,a){a!=t&&(e.disabled=!0,e.canNotDel=!0)})},d=function(t,a){a?angular.forEach(e.cyclePrizes,function(e,t){e.disabled=!1,e.canNotDel=!1}):angular.forEach(e.cyclePrizes,function(e,a){a!=t&&(e.disabled=!0,e.canNotDel=!0)})},p=function(t,a){t?(e.canAddNewIntegralData=!0,l(a,!0)):(e.canAddNewIntegralData=!1,l(a,!1))},u=function(t,a){t?(e.canAddNewAwardData=!0,d(a,!0)):(e.canAddNewAwardData=!1,d(a,!1))},m=function(){e.data.integral_data.push({integral_con_day:1*e.data.integral_data[e.data.integral_data.length-1].integral_con_day+1,get_integral:0})},g=function(t){var a=!0;e.data.integral_data&&e.data.integral_data.length>1&&e.data.integral_data.splice(t,1),angular.forEach(e.data.integral_data,function(e,t){e.integral_con_day||(p(e,t),a=!1)}),a&&p(e.data.integral_data[0].integral_con_day,!0)},f=function(){e.cyclePrizes.length>5||5==e.cyclePrizes.length||e.cyclePrizes.push({awards_type:1,awards_con_day:1*e.cyclePrizes[e.cyclePrizes.length-1].awards_con_day+1,is_cycle:!1,goods:{goods_pic:null,goods_name:null,get_goods_time:null},coupon:{coupon_id:null,coupon_name:null},paginationConf:{currentPage:1,itemsPerPage:5,maxSize:2,notShowJump:!0,notBoundaryLinks:!0}})},h=function(t){var a=!0;e.cyclePrizes&&e.cyclePrizes.length>1&&e.cyclePrizes.splice(t,1),angular.forEach(e.cyclePrizes,function(e,t){e.awards_con_day||(u(e,t),a=!1)}),a&&u(e.cyclePrizes[0].awards_con_day,!0)},_=function(){o.getDetail(function(t){t.status&&(e.data=t.data,t.data.awards_data||t.data.integral_data?(e.isEdit=!0,e.cyclePrizes=[],1==e.data.is_awards?angular.forEach(e.data.awards_data,function(t){1==t.awards_type?e.cyclePrizes.push({awards_type:1,awards_con_day:t.awards_con_day,is_cycle:1==t.is_cycle,goods:{goods_pic:t.goods_pic,goods_name:t.goods_name,get_goods_time:t.get_goods_time},coupon:{coupon_id:null,coupon_name:null},paginationConf:{currentPage:1,itemsPerPage:5,maxSize:2,notShowJump:!0,notBoundaryLinks:!0}}):2==t.awards_type&&e.cyclePrizes.push({awards_type:2,awards_con_day:t.awards_con_day,is_cycle:1==t.is_cycle,goods:{goods_pic:null,goods_name:null,get_goods_time:null},coupon:{coupon_id:t.coupon_id,coupon_name:t.coupon_name},paginationConf:{currentPage:1,itemsPerPage:5,maxSize:2,notShowJump:!0,notBoundaryLinks:!0}})}):e.cyclePrizes=[{awards_type:1,awards_con_day:1,is_cycle:!1,goods:{goods_pic:null,goods_name:null,get_goods_time:null},coupon:{coupon_id:null,coupon_name:null},paginationConf:{currentPage:1,itemsPerPage:5,maxSize:2,notShowJump:!0,notBoundaryLinks:!0}}],2==e.data.is_integral&&(e.data.integral_data=[{integral_con_day:1,get_integral:0}])):(e.data.is_integral=1,e.data.is_awards=1,e.data.integral_data=[{integral_con_day:1,get_integral:0}],e.cyclePrizes=[{awards_type:1,awards_con_day:1,is_cycle:!1,goods:{goods_pic:null,goods_name:null,get_goods_time:null},coupon:{coupon_id:null,coupon_name:null},paginationConf:{currentPage:1,itemsPerPage:5,maxSize:2,notShowJump:!0,notBoundaryLinks:!0}}])),e.oldData=angular.copy(e.data),e.oldCyclePrizes=angular.copy(e.cyclePrizes)})},v=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/ump/templates/sign_modal.html",controller:"shop.ump.sign.modal.ctrl",controllerAs:"vm",size:"sm",resolve:{msg:function(){return e}}});t.result.then(function(e){D()},function(){})},y=function(){1==e.signStatus.is_open_type?v("是否确认开启签到活动？"):2==e.signStatus.is_open_type?v("是否确认关闭签到活动？一旦关闭，签到所有页面均不可访问"):3==e.signStatus.is_open_type?v("请注意此操作不可逆，是否确认清零签到中显示的积分和奖品？已经获得的积分记录不会清零。"):4==e.signStatus.is_open_type?v("是否确认停止签到活动？只停止签到操作，签到历史和签到奖励仍保留"):5==e.signStatus.is_open_type&&v("是否确认开启签到活动？")},b=function(){return o.getSignStatus(function(t){t.status&&(e.signStatus=t.data,4==e.signStatus.is_open_type?e.showSignStart=!0:e.showSignStart=!1,e.signStatus.is_open_type=e.signStatus.is_open_type+"")})},$=function(){return o.setSignStart({id:e.data.activity_id},function(t){t.status?(s.create("success",t.msg||"活动开启成功"),b(),e.showEdit=!1):s.create("danger",t.msg||"活动开启失败")},function(e){s.create("danger",e.data.error.message)})},k=function(t){return o.editSignStatus({is_open_type:e.signStatus.is_open_type,activity_id:e.data.activity_id},function(t){t.status?(s.create("success",t.msg||"操作成功"),b(),e.showEdit=!1):s.create("success",t.msg||"操作失败")})},P=function(){var t;if(2==e.data.is_integral&&2==e.data.is_awards)return void s.create("danger","签到积分设置和商品大奖设置至少开启一项");if(1==e.data.is_integral&&0==e.data.integral_data.length)return void s.create("danger","签到积分设置已开启，请至少填写一条设置积分");if(1==e.data.is_integral&&e.data.integral_data.length>0){var a=r.checkAddArr(e.data.integral_data,[{key:"integral_con_day",value:"连续签到天数"}],"asce");if(!a.flag)return void s.create("danger","签到积分设置第"+(a.index+1)+"级"+a.value+"必须大于上一阶梯"+a.value)}if(1==e.data.is_integral&&2==e.data.is_awards){var n=!1;if(angular.forEach(e.data.integral_data,function(e){0!=e.get_integral&&e.get_integral&&(n=!0)}),!n)return void s.create("danger","积分奖励不能全部为零")}if(1==e.data.is_awards&&0==e.cyclePrizes.length)return void s.create("danger","周期大奖设置已开启，请至少填写一个周期大奖");if(1==e.data.is_awards&&e.cyclePrizes.length>0){var i,n=!0;if(angular.forEach(e.cyclePrizes,function(e,t){2==e.awards_type&&!e.coupon.coupon_id&&n&&(n=!1,i=t)}),!n)return void s.create("danger","第"+(i+1)+"个周期大奖-优惠券没有选择，请选择！");var a=r.checkAddArr(e.cyclePrizes,[{key:"awards_con_day",value:"连续签到时长"}],"asce");if(!a.flag)return void s.create("danger","周期大奖设置第"+(a.index+1)+"阶梯"+a.value+"必须大于上一阶梯"+a.value)}t={activity_id:e.data.activity_id,is_integral:e.data.is_integral,is_awards:e.data.is_awards,share_desc:e.data.share_desc||null,rule:e.data.rule||null},1==e.data.is_integral&&(t.integral_data=e.data.integral_data),1==e.data.is_awards&&(t.awards_data=[],angular.forEach(e.cyclePrizes,function(e){1==e.awards_type?t.awards_data.push({awards_con_day:e.awards_con_day,awards_type:e.awards_type,goods_pic:e.goods.goods_pic,goods_name:e.goods.goods_name,get_goods_time:e.goods.get_goods_time,is_cycle:e.is_cycle?1:2}):2==e.awards_type&&t.awards_data.push({awards_con_day:e.awards_con_day,awards_type:e.awards_type,is_cycle:e.is_cycle?1:2,coupon_id:e.coupon.coupon_id,coupon_name:e.coupon.coupon_name})})),o.update(t,function(e){e.status?(s.create("success",e.msg||"操作成功"),_()):s.create("danger",e.msg||"操作失败")})},w=function(){e.showEdit=!e.showEdit},D=function(){1==e.signStatus.is_open_type||5==e.signStatus.is_open_type?$():k()},C=function(){n.getSignDesinContent(function(t){t.status&&0==t.data.length?e.slices=[{type:"sign",icon:"fa fa-pencil-square-o",name:"签到",content:{bg_pic:"/2017/06/16/FoCqld2DpUsZ0IO_o2tb_nc6Ni5v.jpg"}},{type:"calendar",icon:"fa fa-calendar",name:"日历",content:{bg_color:"#ff5845",wrap_color:"#ea412c"}},{type:"sign_rule",icon:"fa fa-file-text-o",name:"签到规则",content:{wrap_color:"#ff5845",inside_color:"#ea412c"}}]:t.status&&t.data.length>0?e.slices=t.data:t.status||s.create("danger","获取签到装修页面失败，请重新获取")})},x=function(){e.data=angular.copy(e.oldData),e.cyclePrizes=angular.copy(e.oldCyclePrizes)},I=function(){e.defaultAwardMsg="{{周期大奖}}",e.canAddNewAwardData=!0,e.canAddNewIntegralData=!0,e.data={},e.icon_list=t.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(a,o){o.item.sortable.droptarget&&a.target!=o.item.sortable.droptarget[0]&&(e.icon_list=t.concat(),"mouseup"==a.handleObj.type&&e.editSlice(o.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},b(),_(),C()};e.addNewIntegral=m,e.deleteIntegral=g,e.addNewPrizes=f,e.deletePrizes=h,e.updateDetail=P,e.edit=w,e.shareDescChanged=c,e.cancelEdit=x,e.canEditIntegralDay=p,e.canEditAwardDay=u,e.radioChange=y,I()}])}),define("apps/ump/controllers/sign.record.ctrl",["apps/common/controllers/controllers","moment","echarts"],function(e,t,a){e.controller("shop.ump.sign.record.ctrl",["$scope","signRecordService",function(e,t){var o=this,s=a.init(document.getElementById("lineChart")),n={tooltip:{trigger:"axis"},legend:{data:["签到人数"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:[]}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"签到人数",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:[]}]},r=function(e){o.query.s&&o.query.s==e?(o.query.p="desc"==o.query.p?"asc":"desc",o.sorting[o.query.s]="sorting-"+o.query.p):o.query.s&&o.query.s!=e?(o.sorting[o.query.s]="",o.query.s=e,o.query.p="asc",o.sorting[o.query.s]="sorting-"+o.query.p):(o.query.s=e,o.query.p="asc",o.sorting[o.query.s]="sorting-"+o.query.p),l("search")},i=function(){var e,t="/marketing/signin_exp_list.json",a=[];if(o.query.s&&a.push("s="+o.query.s),o.query.p&&a.push("p="+o.query.p),$('input[name="sign_range"]').val()){var s=$('input[name="sign_range"]').val(),n=s.split("/");a.push("get_start_time="+n[0]),a.push("get_end_time="+n[1])}o.query.awards_type&&a.push("awards_type="+o.query.awards_type),o.query.member_id&&a.push("member_id="+o.query.member_id),e=t+(a.length>0?"?"+a.join("&"):""),window.location.href=e},c=function(){var e={awards_type:o.query.awards_type||null,member_id:o.query.member_id||null,s:o.query.s,p:o.query.p};if($('input[name="sign_range"]').val()){var t=$('input[name="sign_range"]').val(),a=t.split("/");e.get_start_time=a[0],e.get_end_time=a[1]}return e},l=function(e){var a=c();return a.offset="search"==e?0:(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,a.limit=o.paginationConf.itemsPerPage,t.getList(a,function(e){e.status&&(o.data=e.data,o.paginationConf.totalItems=e._count)})},d=function(){return t.getLineData(function(e){if(e.status){var t=[],a=[];angular.forEach(e.data,function(e){t.push(e.date),a.push(e.count)}),n.xAxis[0].data=t,n.series[0].data=a,s.setOption(n)}})},p=function(){o.query={},o.paginationConf={currentPage:1,itemsPerPage:10},o.sorting={all_sign_day:"",all_integral:"",con_sign_day:""},o.awards_types=[{name:"全部",type:null},{name:"商品",type:1},{name:"优惠券",type:2}],o.query.awards_type=o.awards_types[0].type,d(),e.$watch("vm.paginationConf.currentPage",l)};o.search=l,o.sortChange=r,o.exportDetails=i,p()}])}),define("apps/ump/controllers/sign.design.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sign.design.ctrl",["$scope","signDesignData","$stateParams","$timeout","signDesignService","designValidate","Flash",function(e,t,a,o,s,n,r){function i(){e.disabledBtnStatus=!1,e.addNew?e.disabledBtnText="保存":e.disabledBtnText="修改"}e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,a){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,o(function(){e.$broadcast("design_data",t),angular.isUndefined(a)||e.$broadcast("design_dirty",a)},200)};var c=function(t){e.disabledBtnStatus=!0,e.disabledBtnText="修改中..",s.update({data:t,activity_id:e.data.activity_id},function(e){e.success?r.create("success","修改成功"):r.create("success","修改失败"),i()})},l=function(){var t=angular.copy(e.slices);for(var a in t){var o=n[t[a].type](t[a].content);if(o)return e.editSlice(e.slices[a],o),i(),!1}c(t)},d=function(){s.getSignDesinContent(function(t){t.status?(e.data=t,0==t.data.length?(e.addNew=!0,e.disabledBtnText="保存",e.slices=[{type:"sign",icon:"fa fa-pencil-square-o",name:"签到",content:{bg_pic:"/2017/06/16/FoCqld2DpUsZ0IO_o2tb_nc6Ni5v.jpg"}},{type:"calendar",icon:"fa fa-calendar",name:"日历",content:{bg_color:"#ff5845",wrap_color:"#ea412c"}},{type:"sign_rule",icon:"fa fa-file-text-o",name:"签到规则",content:{wrap_color:"#ff5845",inside_color:"#ea412c"}}]):t.data.length>0&&(e.disabledBtnText="修改",e.slices=t.data)):r.create("danger","签到装修页面内容获取失败，请重新获取！"),e.editSlice(e.slices[0]),i()})},p=function(){e.icon_list=t.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(a,o){o.item.sortable.droptarget&&a.target!=o.item.sortable.droptarget[0]&&(e.icon_list=t.concat(),"mouseup"==a.handleObj.type&&e.editSlice(o.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},d()};e.submit=l,p()}])}),define("apps/ump/controllers/sign.order.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sign.order.ctrl",["$scope","signOrderService","Flash",function(e,t,a){var o=this,s=function(){var e,t="/marketing/signin_goods_exp_list.json",a=[];o.query.member_id&&a.push("member_id="+o.query.member_id),o.query.get_name&&a.push("get_name="+o.query.get_name),o.query.mobile&&a.push("mobile="+o.query.mobile),o.query.type&&a.push("type="+o.query.type),o.query.desc&&a.push("desc="+o.query.desc),e=t+(a.length>0?"?"+a.join("&"):""),window.location.href=e},n=function(e,t){if(o.oldValue=t,""==e)return"备注不能为空!"},r=function(e,s,n){if(o.oldValue!==s){var r={id:n};r[e]=s,t.updateRemark(r,function(e){e.status?a.create("success",e.data||"编辑成功"):a.create("danger",e.data||"编辑失败")})}},i=function(){var e={member_id:o.query.member_id||null,get_name:o.query.get_name||null,mobile:o.query.mobile||null,type:o.query.type||0,desc:o.query.desc||0};return e},c=function(e){var a=i();return a.offset="search"==e?0:(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,a.limit=o.paginationConf.itemsPerPage,t.getList(a,function(e){e.status&&(o.data=e.data,o.paginationConf.totalItems=e._count)})},l=function(e,s){var n="all"==e?{id:o.selected_ids.join(",")?o.selected_ids.join(","):null}:{id:s+""};n.id?t.deliverGoods(n,function(e){e.status?(a.create("success",e.data||"操作成功"),c()):a.create("danger",e.data||"操作失败")}):a.create("danger","当前未选择商品发货")},d=function(e,t){"all"==e?o.selectAll?angular.forEach(o.data,function(e){1==e.type&&(e.checked=!0,o.selected_ids.push(e.id))}):(o.selected_ids=[],angular.forEach(o.data,function(e){e.checked=!1})):t.checked?o.selected_ids.push(t.id):o.selected_ids.splice(o.selected_ids.indexOf(t.id),1)},p=function(){o.selected_ids=[],o.paginationConf={currentPage:1,itemsPerPage:10,totalItems:100},o.operationTypes=[{name:"全部",type:0},{name:"待发货",type:1},{name:"已发货",type:2},{name:"待领取",type:3},{name:"已过期",type:4}],o.descTypes=[{name:"全部",type:0},{name:"有备注",type:1},{name:"无备注",type:2}],o.query={type:o.operationTypes[0].type,desc:o.descTypes[0].type},e.$watch("vm.paginationConf.currentPage",function(){o.selected_ids=[],o.selectAll=!1,c()})};o.checkMsg=n,o.saveField=r,o.exportDetails=s,o.deliverGoods=l,o.checkChange=d,o.search=c,p()}])}),define("apps/ump/controllers/sign_modal",["apps/common/controllers/controllers"],function(e){e.controller("shop.ump.sign.modal.ctrl",["$scope","Flash","msg",function(e,t,a){var o=this,s=function(){o.msg=a};s()}])}),define("apps/ump/controllers/_base",["apps/ump/controllers/coupon.list","apps/ump/controllers/coupon.info","apps/ump/controllers/coupon.code","apps/ump/controllers/coupon.data","apps/ump/controllers/discount.list","apps/ump/controllers/discount.info","apps/ump/controllers/discount.record","apps/ump/controllers/create.code","apps/ump/controllers/coupon.code.send","apps/ump/controllers/seckill.list","apps/ump/controllers/seckill.info","apps/ump/controllers/fcoupon.info","apps/ump/controllers/fcoupon.list","apps/ump/controllers/fcoupon.store","apps/ump/controllers/fcoupon.detail","apps/ump/controllers/setmeal.list","apps/ump/controllers/setmeal.info","apps/ump/controllers/setmeal.records","apps/ump/controllers/setmeal.details","apps/ump/controllers/setmeal.goods.ctrl","apps/ump/controllers/bangmian/bangmian.list","apps/ump/controllers/bangmian/bangmian.info","apps/ump/controllers/bangmian/bangmian.starts","apps/ump/controllers/bangmian/bangmian.records","apps/ump/controllers/dynamics.list","apps/ump/controllers/dynamics.info","apps/ump/controllers/dynamics.goods.ctrl","apps/ump/controllers/repurchase.list","apps/ump/controllers/multis.repurchase","apps/ump/controllers/repurchase.price","apps/ump/controllers/repurchase.setting","apps/ump/controllers/coupon.model.goods.ctrl","apps/ump/controllers/sharered.list","apps/ump/controllers/sharered.manage","apps/ump/controllers/sharered.receivedetails","apps/ump/controllers/sharered.stat","apps/ump/controllers/sharered.operationlog","apps/ump/controllers/sharered.sub.ctrl","apps/ump/controllers/sign.setting.ctrl","apps/ump/controllers/sign.record.ctrl","apps/ump/controllers/sign.design.ctrl","apps/ump/controllers/sign.order.ctrl","apps/ump/controllers/sign_modal"],function(){}),
define("apps/ump/directives/select.file",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("fileUpload",["$modal",function(e){return{restrict:"AE",replace:!0,scope:{size:"@"},require:"^?ngModel",link:function(t,a,o,s){t.animationsEnabled=!1,a.bind("click",function(){n()});var n=function(a){var o=e.open({animation:t.animationsEnabled,controller:"file.upload.modal",templateUrl:"assets/js/apps/ump/templates/file.upload.html",size:a,resolve:{type:function(){return t.type}}});o.result.then(function(e){s.$setViewValue(e)})}}}}]),t.controller("file.upload.modal",["$scope","$modalInstance","Flash","$location","$state","$stateParams",function(e,t,a,o,s,n){e.csvfileInfo={status:!1,name:"",size:0},e.butInfo={text:"确认上传",status:!1},e.downTpl=function(){window.location.href="http://7xolp5.com1.z0.glb.clouddn.com/%E5%AF%BC%E5%85%A5%E4%BC%9A%E5%91%98%E6%B4%BE%E5%8F%91%E6%A8%A1%E6%9D%BF_20160603.csv"},e.ok=function(){if(!e.csvfileInfo.status)return a.create("danger","请选择一个CSV文件"),!1;if(e.csvfile.size>1048576)return a.create("danger","文件大小不能超过1MB"),!1;var o=e.csvfile.name.substr(e.csvfile.name.toLowerCase().lastIndexOf(".")+1);if("csv"!=o)return a.create("danger","请选择一个CSV文件。"),!1;var s=new FormData($("#csvFileUpload")[0]);$.ajax({url:"/marketing/coupon.excel_batch_code/"+n.id+".json",method:"POST",data:s,processData:!1,contentType:!1,beforeSend:function(){e.butInfo.text="批量派发中..",e.butInfo.status=!0},success:function(o){o.status?(a.create("success",o.msg),t.close(o.status)):(a.create("danger",o.msg),e.butInfo.text="确认上传",e.butInfo.status=!1)},error:function(t){a.create("danger",t.responseJSON.error.msg),e.butInfo.text="确认上传",e.butInfo.status=!1}})},e.selectCsvFile=function(t){e.$apply(function(a){e.csvfile=t.files[0],e.csvfileInfo.status=!0,e.csvfileInfo.status=!0,e.csvfileInfo.name=e.csvfile.name,e.csvfileInfo.size=parseFloat(e.csvfile.size/1024).toFixed(2)})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ump/directives/check.number",["apps/common/directives/directives"],function(e){e.directive("checkInt",function(){return{restrict:"AE",require:"ngModel",link:function(e,t,a,o){t.bind("blur",function(){if("undefined"!=typeof o.$viewValue){var e=Math.round(Number(o.$viewValue));a.max&&(e=Math.min(e,Number(a.max))),a.min&&(e=Math.max(e,Number(a.min))),o.$setViewValue(e),o.$render()}})}}})}),define("apps/ump/directives/sign.coupon.select",["apps/common/directives/directives"],function(e){e.directive("signCouponSelect",["signSettingService",function(e){return{restrict:"EA",templateUrl:"assets/js/apps/ump/templates/sign.coupon.select.html",replace:!0,scope:{prizeParam:"=",conf:"="},link:function(t,a,o){t.paginationConf=t.prizeParam.paginationConf;var s=function(a){var o={name:t.keywords};return o.page="search"==a?0:t.prizeParam.paginationConf.currentPage-1,o.limit=t.prizeParam.paginationConf.itemsPerPage,e.getCouponList(o,function(e){e.data&&(t.couponList=e.data.list,t.prizeParam.paginationConf.totalItems=e.data.total)})};t.click=function(e,a){t.prizeParam.coupon.coupon_id?(t.prizeParam.coupon.coupon_id=t.prizeParam.coupon.coupon_id==e?null:e,t.prizeParam.coupon.coupon_name=t.prizeParam.coupon.coupon_name==a?null:a):(t.prizeParam.coupon.coupon_id=e,t.prizeParam.coupon.coupon_name=a)},t.canClick=function(e){return t.prizeParam.coupon.coupon_id&&t.prizeParam.coupon.coupon_id!=e},t.$watch("prizeParam.paginationConf.currentPage + scope.prizeParam.paginationConf.totalItems",function(e,t){s()}),t.search=s}}}])}),define("apps/ump/directives/_base",["apps/ump/directives/select.file","apps/ump/directives/check.number","apps/ump/directives/sign.coupon.select"],function(){}),define("apps/ump/main",["apps/ump/states/_base","apps/ump/services/_base","apps/ump/controllers/_base","apps/ump/directives/_base"],function(){}),define("apps/apps/states/peerpay",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps",{url:"/apps",templateUrl:"assets/js/apps/apps/templates/layout.html"}).state("shop.apps.peerpay",{abstract:!0,url:"/peerpay",template:"<div ui-view></div>"}).state("shop.apps.peerpay.list",{url:"",controller:"peerpay.list",templateUrl:"assets/js/apps/apps/templates/peerpay.list.html"})}])}),define("apps/apps/states/bargain",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.bargain",{abstract:!0,url:"/bargain",template:"<div ui-view></div>"}).state("shop.apps.bargain.list",{url:"/list/:status",templateUrl:"assets/js/apps/apps/templates/bargain.html",controller:"shop.apps.bargain.list"}).state("shop.apps.bargain.add",{url:"/add/:goods_id",templateUrl:"assets/js/apps/apps/templates/bargain.info.html",controller:"shop.apps.bargain.info"}).state("shop.apps.bargain.edit",{url:"/edit/:id/:goods_id",templateUrl:"assets/js/apps/apps/templates/bargain.info.html",controller:"shop.apps.bargain.info"}).state("shop.apps.bargain.starts",{url:"/starts/:id/:name/:status",templateUrl:"assets/js/apps/apps/templates/bargain.starts.html",controller:"shop.apps.bargain.starts"}).state("shop.apps.bargain.records",{url:"/records/:bargain_initiate_id/:bargain_id/:bargain_initiate_name/:bargain_name",templateUrl:"assets/js/apps/apps/templates/bargain.records.html",controller:"shop.apps.bargain.records"}).state("shop.apps.bargain.configs",{url:"/configs",templateUrl:"assets/js/apps/apps/templates/bargain.configs.html",controller:"shop.apps.bargain.configs"})}])}),define("apps/apps/states/pintuan",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.pintuan",{abstract:!0,url:"/pintuan",template:"<div ui-view></div>"}).state("shop.apps.pintuan.list",{url:"/list/:status",templateUrl:"assets/js/apps/apps/templates/pintuan.html",controller:"shop.apps.pintuan.list"}).state("shop.apps.pintuan.add_close",{url:"/add/:goods_id",templateUrl:"assets/js/apps/apps/templates/pintuan.info.html",controller:"shop.apps.pintuan.info"}).state("shop.apps.pintuan.edit",{url:"/edit/:id/:goods_id",templateUrl:"assets/js/apps/apps/templates/pintuan.info.html",controller:"shop.apps.pintuan.info"}).state("shop.apps.pintuan.records",{url:"/records/:id/:title",templateUrl:"assets/js/apps/apps/templates/pintuan.records.html",controller:"shop.apps.pintuan.records"}).state("shop.apps.pintuan.details",{url:"/details/:id/:pintuanInitiateId/:pintuanTitle/:memberName",templateUrl:"assets/js/apps/apps/templates/pintuan.details.html",controller:"shop.apps.pintuan.details"}).state("shop.apps.pintuan.configs",{url:"/configs",templateUrl:"assets/js/apps/apps/templates/pintuan.configs.html",controller:"shop.apps.pintuan.configs"}).state("shop.apps.pintuan.refund",{url:"/refund/:pintuanId/:pintuanInitiateId",templateUrl:"assets/js/apps/apps/templates/pintuan.refund.html",controller:"shop.apps.pintuan.refund"})}])}),define("apps/apps/states/snatch",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.snatch",{abstract:!0,url:"/snatch",templateUrl:"assets/js/apps/apps/templates/snatch.tab.html",controller:["$scope","videoAddress",function(e,t){e.videoAddress=t}]}).state("shop.apps.snatch.list",{url:"",templateUrl:"assets/js/apps/apps/templates/snatch.html",controller:"snatch.list"}).state("shop.apps.snatch.add",{url:"/add/:goods_id",templateUrl:"assets/js/apps/apps/templates/snatch.add.html",controller:"snatch.info"}).state("shop.apps.snatch.config",{url:"/config",templateUrl:"assets/js/apps/apps/templates/snatch.config.html",controller:"snatch.config"}).state("shop.apps.snatch.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/apps/templates/snatch.detail.html",controller:"snatch.detail"})}])}),define("apps/apps/states/collect",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.collect",{abstract:!0,url:"/collect",templateUrl:"assets/js/apps/apps/templates/collect.tab.html",controller:["$scope","videoAddress",function(e,t){e.videoAddress=t}]}).state("shop.apps.collect.list",{url:"",templateUrl:"assets/js/apps/apps/templates/collect.html",controller:"collect.list"}).state("shop.apps.collect.add",{url:"/add",templateUrl:"assets/js/apps/apps/templates/collect.add.html",controller:"collect.add"}).state("shop.apps.collect.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/apps/templates/collect.add.html",controller:"collect.add"}).state("shop.apps.collect.add_support",{url:"/add_support/:cid",templateUrl:"assets/js/apps/apps/templates/collect.add.html",controller:"collect.add"}).state("shop.apps.collect.config",{url:"/config",templateUrl:"assets/js/apps/apps/templates/collect.config.html",controller:"collect.config"}).state("shop.apps.collect.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/apps/templates/collect.detail.html",controller:"collect.detail"}).state("shop.apps.collect.detail_list",{url:"/detail_list/:id",templateUrl:"assets/js/apps/apps/templates/collect.detail_list.html",controller:"collect.detail_list"}).state("shop.apps.collect.reward_list",{url:"/reward_list/:id",templateUrl:"assets/js/apps/apps/templates/collect.reward_list.html",controller:"collect.reward_list"}).state("shop.apps.collect.progress",{url:"/progress/:id/:status",templateUrl:"assets/js/apps/apps/templates/collect.progress.html",controller:"collect.progress"}).state("shop.apps.collect.progress_add",{url:"/progress_add/:id",templateUrl:"assets/js/apps/apps/templates/collect.progress_add.html",controller:"collect.progress_add"}).state("shop.apps.collect.order_detail",{url:"/order_detail/:id",templateUrl:"assets/js/apps/apps/templates/collect.order_detail.html",controller:"collect.order_detail"})}])}),define("apps/apps/states/thirdapp",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.thirdapp",{abstract:!0,url:"/thirdapp",template:"<div ui-view></div>"}).state("shop.apps.thirdapp.list",{url:"",controller:"thirdapp.list",templateUrl:"assets/js/apps/apps/templates/thirdapp.list.html"})}])}),define("apps/apps/states/guess",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.guess",{abstract:!0,url:"/guess",templateUrl:"assets/js/apps/apps/templates/guess.tab.html"}).state("shop.apps.guess.list",{url:"",templateUrl:"assets/js/apps/apps/templates/guess.html",controller:"guess.list"}).state("shop.apps.guess.add",{url:"/add/:goods_id",templateUrl:"assets/js/apps/apps/templates/guess.info.html",controller:"shop.apps.guess.info"}).state("shop.apps.guess.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/apps/templates/guess.info.html",controller:"shop.apps.guess.info"}).state("shop.apps.guess.periods",{url:"/periods/:id",templateUrl:"assets/js/apps/apps/templates/guess.periods.html",controller:"guess.periods"}).state("shop.apps.guess.periods_list",{url:"/periods/list/:id?:guessId",templateUrl:"assets/js/apps/apps/templates/guess.periods_list.html",controller:"guess.periods_list"})}])}),define("apps/apps/states/article",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.article",{abstract:!0,url:"/article",templateUrl:"assets/js/apps/apps/templates/article.tab.html",controller:["$scope","videoAddress",function(e,t){e.videoAddress=t}]}).state("shop.apps.article.manage",{url:"/manage",templateUrl:"assets/js/apps/apps/templates/article.manage.html",controller:"shop.apps.article.manage"}).state("shop.apps.article.guider",{url:"/guider/:id",templateUrl:"assets/js/apps/apps/templates/article.guider.html",controller:"shop.apps.article.guider"}).state("shop.apps.article.detail",{url:"/detail/:article_id/:member_id",templateUrl:"assets/js/apps/apps/templates/article.detail.html",controller:"shop.apps.article.detail"}).state("shop.apps.article.setting",{url:"/setting",templateUrl:"assets/js/apps/apps/templates/article.setting.html",controller:"shop.apps.article.setting"}).state("shop.apps.article.accounts",{url:"/accounts",templateUrl:"assets/js/apps/apps/templates/article.accounts.html",controller:"shop.apps.article.accounts"}).state("shop.apps.article.data",{url:"/data/:id",templateUrl:"assets/js/apps/apps/templates/article.data.html",controller:"shop.apps.article.data"}).state("shop.apps.article.add",{url:"/add?templateId",templateUrl:"assets/js/apps/apps/templates/article.add.html",controller:"shop.apps.article.add"}).state("shop.apps.article.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/apps/templates/article.add.html",controller:"shop.apps.article.add"}).state("shop.apps.article.list",{url:"/list/:id",templateUrl:"assets/js/apps/apps/templates/article.html",controller:"shop.apps.article.list"}).state("shop.apps.article.template_center",{abstract:!0,url:"/template_center",template:"<div ui-view></div>"}).state("shop.apps.article.template_center.list",{url:"/list",templateUrl:"assets/js/apps/apps/templates/article.template_center.list.html",controller:"shop.apps.article.template_center.list.ctrl",controllerAs:"vm"})}])}),define("apps/apps/states/auction",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.auction",{abstract:!0,url:"/auction",template:"<div ui-view></div>"}).state("shop.apps.auction.list",{url:"/list/:status",templateUrl:"assets/js/apps/apps/templates/auction.html",controller:"shop.apps.auction.list"}).state("shop.apps.auction.add",{url:"/add/:goods_id",templateUrl:"assets/js/apps/apps/templates/auction.add.html",controller:"shop.apps.auction.add"}).state("shop.apps.auction.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/apps/templates/auction.add.html",controller:"shop.apps.auction.add"}).state("shop.apps.auction.records",{url:"/records/:id",templateUrl:"assets/js/apps/apps/templates/auction.records.html",controller:"shop.apps.auction.records"}).state("shop.apps.auction.refund",{url:"/refund/:auctionId/:auctionInitiateId",templateUrl:"assets/js/apps/apps/templates/auction.refund.html",controller:"shop.apps.auction.refund"}).state("shop.apps.auction.covers",{url:"/covers/:id/:auctionRoundId",templateUrl:"assets/js/apps/apps/templates/auction.covers.html",controller:"shop.apps.auction.covers"}).state("shop.apps.auction.bond",{url:"/bond/:id",templateUrl:"assets/js/apps/apps/templates/auction.bond.html",controller:"shop.apps.auction.bond"}).state("shop.apps.auction.copy",{url:"/copy",templateUrl:"assets/js/apps/apps/templates/auction.copy.html",controller:"shop.apps.auction.copy"})}])}),define("apps/apps/states/game",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.game",{abstract:!0,url:"/game",template:"<div ui-view></div>"}).state("shop.apps.game.info",{url:"",controller:"game.info",templateUrl:"assets/js/apps/apps/templates/game.html"})}])}),define("apps/apps/states/pin",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.pin",{abstract:!0,url:"/pin",template:"<div ui-view></div>"}).state("shop.apps.pin.list",{url:"/list/:status",templateUrl:"assets/js/apps/apps/templates/pin.list.html",controller:"shop.apps.pin.list"}).state("shop.apps.pin.add",{url:"/add/:step/:goods_id",templateUrl:"assets/js/apps/apps/templates/pin.info.html",controller:"shop.apps.pin.info"}).state("shop.apps.pin.edit",{url:"/edit/:step/:id",templateUrl:"assets/js/apps/apps/templates/pin.edit.html",controller:"shop.apps.pin.info"}).state("shop.apps.pin.records",{url:"/records/:id",templateUrl:"assets/js/apps/apps/templates/pin.records.html",controller:"shop.apps.pin.records"}).state("shop.apps.pin.details",{url:"/details/:id/:pinInitiateId/:pinTitle/:memberName",templateUrl:"assets/js/apps/apps/templates/pin.details.html",controller:"shop.apps.pin.details"}).state("shop.apps.pin.configs",{url:"/configs",templateUrl:"assets/js/apps/apps/templates/pin.configs.html",controller:"shop.apps.pin.configs"}).state("shop.apps.pin.refund",{url:"/refund/:pinId/:pinInitiateId",templateUrl:"assets/js/apps/apps/templates/pin.refund.html",controller:"shop.apps.pin.refund"}).state("shop.apps.pin.recordsdetails",{url:"/recordsdetails/:list_id/:id",templateUrl:"assets/js/apps/apps/templates/pin.recordsdetails.html",controller:"shop.apps.pin.recordsdetails"})}])}),define("apps/apps/states/activity",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.activity",{abstract:!0,url:"/activity",template:"<div ui-view></div>"}).state("shop.apps.activity.info",{url:"",controller:"activity.info",templateUrl:"assets/js/apps/apps/templates/activity.html"})}])}),define("apps/apps/states/returncash",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.returncash",{abstract:!0,url:"/returncash",template:'<div ui-view class="returncashView"></div>'}).state("shop.apps.returncash.main",{url:"/main",templateUrl:"assets/js/apps/apps/templates/returncash.main.html",controller:"returncash.main.ctrl",controllerAs:"vm"}).state("shop.apps.returncash.add",{url:"/add/:goods_id",templateUrl:"assets/js/apps/apps/templates/returncash.manage.html",controller:"returncash.manage.ctrl",controllerAs:"vm"}).state("shop.apps.returncash.edit",{url:"/edit/:id/:status",templateUrl:"assets/js/apps/apps/templates/returncash.manage.html",controller:"returncash.manage.ctrl",controllerAs:"vm"}).state("shop.apps.returncash.manage",{url:"/manage",controller:""}).state("shop.apps.returncash.activerecord",{url:"/activerecord/:id",templateUrl:"assets/js/apps/apps/templates/returncash.activerecord.html",controller:"returencash.activerecord",controllerAs:"vm"}).state("shop.apps.returncash.statisticalData",{url:"/statisticalData/:id",templateUrl:"assets/js/apps/apps/templates/returncash.statisticalData.html",controller:"returncash.statisticalData.ctrl",controllerAs:"vm"})}])}),define("apps/apps/states/combomenu",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.combomenu",{abstract:!0,url:"/combomenu",template:"<div ui-view></div>"}).state("shop.apps.combomenu.list",{url:"",controller:"combomenu",templateUrl:"assets/js/apps/apps/templates/combomenu.html"}).state("shop.apps.combomenu.add",{url:"/add",controller:"combomenu.add",templateUrl:"assets/js/apps/apps/templates/combomenu.add.html"}).state("shop.apps.combomenu.edit",{url:"/edit/:id",controller:"combomenu.add",templateUrl:"assets/js/apps/apps/templates/combomenu.add.html"}).state("shop.apps.combomenu.comboinfo",{url:"/comboinfo/:id",controller:"combomenu.comboinfo",templateUrl:"assets/js/apps/apps/templates/combomenu.comboinfo.html"})}])}),define("apps/apps/states/pack",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.pack",{abstract:!0,url:"/pack",templateUrl:"assets/js/apps/apps/templates/pack.tab.html"}).state("shop.apps.pack.list",{url:"/list",templateUrl:"assets/js/apps/apps/templates/pack.list.html",controller:"shop.apps.pack.list"}).state("shop.apps.pack.add",{url:"/add",templateUrl:"assets/js/apps/apps/templates/pack.form.html",controller:"shop.apps.pack.form"}).state("shop.apps.pack.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/apps/templates/pack.form.html",controller:"shop.apps.pack.form"}).state("shop.apps.pack.order",{url:"/order/:id",templateUrl:"assets/js/apps/apps/templates/pack.order.html",controller:"shop.apps.pack.order"})}])}),define("apps/apps/states/_base",["apps/apps/states/peerpay","apps/apps/states/bargain","apps/apps/states/pintuan","apps/apps/states/snatch","apps/apps/states/collect","apps/apps/states/thirdapp","apps/apps/states/guess","apps/apps/states/article","apps/apps/states/auction","apps/apps/states/game","apps/apps/states/pin","apps/apps/states/activity","apps/apps/states/returncash","apps/apps/states/combomenu","apps/apps/states/pack"],function(){}),define("apps/apps/services/peerpay",["apps/common/services/services"],function(e){e.factory("peerpayResource",["$resource",function(e){return e("/marketing/peerpay/:id.json",{id:"@id"},{update:{method:"PUT"},set:{method:"PUT",url:"/marketing/peerpay_set.json"}})}])}),define("apps/apps/services/bargain",["apps/common/services/services"],function(e){e.factory("bargainResource",["$resource",function(e){return e("/marketing/bargain/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT"},delete:{method:"DELETE"},forbid:{method:"DELETE"}})}]),e.factory("bargainStartsResource",["$resource",function(e){return e("/marketing/bargain_member/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},forbid:{method:"PUT"}})}]),e.factory("bargainRecordsResource",["$resource",function(e){return e("/marketing/bargain_member_join/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1}})}]),e.factory("bargainConfigsResource",["$resource",function(e){return e("/marketing/bargain_set/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),e.factory("bargainGoodsResource",["$resource",function(e){return e("/marketing/bargain_goods/:id.json",{id:"@id"},{})}]),e.factory("bargainFinishResource",["$resource",function(e){return e("/marketing/bargain/:id/finish.json",{id:"@id"},{finish:{method:"PUT"}})}])}),define("apps/apps/services/pintuan",["apps/common/services/services"],function(e){e.factory("pintuanResource",["$resource",function(e){return e("/marketing/pintuan/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},save:{method:"POST"},update:{method:"PUT"},delete:{method:"DELETE"},forbid:{method:"DELETE"}})}]),e.factory("pintuanFinishResource",["$resource",function(e){return e("/marketing/pintuan/:id/finish.json",{id:"@id",pintuanInitiateId:"@pintuanInitiateId"},{query:{method:"PUT",isArray:!1}})}]),e.factory("pintuanRecordsResource",["$resource",function(e){return e("/marketing/pintuan/:id/initiate.json",{id:"@id"},{query:{method:"GET",isArray:!1},getQrcodeInfo:{method:"GET",url:"marketing/qrcode_pintuan_initiate/:id.json"}})}]),e.factory("pintuanDetailResource",["$resource",function(e){return e("/marketing/pintuan/:id/initiate/:pintuanInitiateId.json",{id:"@id",pintuanInitiateId:"@pintuanInitiateId"},{query:{method:"GET",isArray:!1}})}]),e.factory("pintuanGoodsResource",["$resource",function(e){return e("/marketing/pintuan/:id/isPintuan.json",{id:"@id"},{})}]),e.factory("pintuanConfigsResource",["$resource",function(e){return e("/marketing/pintuan_set/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),e.factory("pintuanRefundResource",["$resource",function(e){return e("/marketing/pintuan_refund.json",{},{query:{method:"GET",isArray:!1},batchRefund:{method:"PUT",url:"/marketing/set/pintuan_refund.json"}})}])}),define("apps/apps/services/snatch",["apps/common/services/services"],function(e){e.factory("snatchResource",["$resource",function(e){return e("/snatch/snatch.json",{},{})}]),e.factory("snatchGoodsResource",["$resource",function(e){return e("/marketing/pintuan/:id/isPintuan.json",{id:"@id"},{})}]),e.factory("snatchGoodListRes",["$resource",function(e){return e("/marketing/discount_goods.json",{},{})}]),e.factory("snatchDetailResource",["$resource",function(e){return e("/snatch/snatch/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1}})}]),e.factory("snatchConfigResource",["$resource",function(e){return e("/snatch/design.json",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),e.factory("openNextResource",["$resource",function(e){return e("/snatch/next_snatch/:id.json",{id:"@id"},{})}]),e.factory("closeNextResource",["$resource",function(e){return e("/snatch/close_start/:id.json",{id:"@id",type:"@type"},{update:{method:"PUT"}})}]),e.factory("finishSnatchResource",["$resource",function(e){return e("/snatch/close_snatch/:id.json",{id:"@id"},{update:{method:"PUT"}})}]),e.factory("qrcodeSnatchResource",["$resource",function(e){return e("/snatch/snatch_qrcode/:id.json",{id:"@id"},{})}])}),define("apps/apps/services/collect",["apps/common/services/services"],function(e){e.factory("collectResource",["$resource",function(e){return e("/collect/collect.json",{id:"@id"},{get:{method:"GET"},save:{method:"POST"},getOne:{method:"GET",url:"/collect/collect/:id.json"},update:{method:"PUT",url:"/collect/collect/:id.json"},remove:{method:"DELETE",url:"/collect/collect/:id.json"},setRemarks:{method:"PUT",url:"/collect/shop_remark.json"}})}]),e.factory("collectCloseResource",["$resource",function(e){return e("/collect/close_collect/:id.json",{id:"@id"},{close:{method:"PUT"}})}]),e.factory("collectSortResource",["$resource",function(e){return e("/collect/collect_sort/:id.json",{id:"@id"},{set:{method:"PUT"}})}]),e.factory("collectDelResource",["$resource",function(e){return e("/collect/reward/:id.json",{id:"@id"},{remove:{method:"DELETE"}})}]),e.factory("rewardResource",["$resource",function(e){return e("/collect/reward.json",{id:"@id"},{get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"}})}]),e.factory("collectConfigResource",["$resource",function(e){return e("/collect/design.json",{},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}]),e.factory("collectProgressResource",["$resource",function(e){return e("/collect/speed.json",{id:"@id"},{get:{method:"GET",url:"/collect/speed/:id.json"},remove:{method:"DELETE",url:"/collect/speed/:id.json"},update:{method:"PUT"},save:{method:"POST"}})}]),e.factory("collectOrderResource",["$resource",function(e){return e("/collect/orders/:id.json",{id:"@id"},{})}]),e.factory("collectOrderOneResource",["$resource",function(e){return e("/collect/order/:id.json",{id:"@id"},{})}]),e.factory("collectSendResource",["$resource",function(e){return e("/collect/shipment.json",{},{})}]),e.factory("collectPublishResource",["$resource",function(e){return e("/collect/publish/:id.json",{id:"@id"},{set:{method:"PUT"}})}]),e.factory("collectRefundResource",["$resource",function(e){return e("/collect/refund/:id.json",{id:"@id"},{save:{method:"POST"}})}])}),define("apps/apps/services/thirdapp",["apps/common/services/services"],function(e){e.factory("thirdappResource",["$resource",function(e){return e("marketing/third_app.json",{id:"@id"},{list:{method:"GET",url:"marketing/third_app.json"},get:{method:"GET",url:"marketing/third_app/:id.json"},update:{method:"post",url:"marketing/third_app.json"}})}]),e.factory("thirdappShowResource",["$resource",function(e){return e("marketing/third_app_standard.json",{id:"@id"},{get:{method:"GET"}})}])}),define("apps/apps/services/guess",["apps/common/services/services"],function(e){e.factory("guessList",["$resource",function(e){return e("/marketing/guess_es.json",{id:"@id"},{get:{method:"GET"},save:{method:"POST"},getdetail:{method:"GET",url:"/marketing/guess_es/:id.json"},put:{method:"PUT",url:"/marketing/guess_es/:id.json"}})}]),e.factory("guessFinish",["$resource",function(e){return e("/marketing/guess_put/:id.json",{id:"@id"},{close:{method:"PUT",isArray:!1}})}]),e.factory("guessWinnerList",["$resource",function(e){return e("/marketing/guess_record/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("guessWinner",["$resource",function(e){return e("/marketing/guess_winning/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("guessPreiods",["$resource",function(e){return e("/marketing/guess_stage/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1},editPrice:{method:"PUT",isArray:!1}})}]),e.factory("guessHelper",["$resource",function(e){return e("/marketing/guess_helper/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("guessRecord",["$resource",function(e){return e("/marketing/guess_records/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("guessPreiodsList",["$resource",function(e){return e("/marketing/guess_stage_list/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("qrCode",["$resource",function(e){return e("/marketing/guess_code/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}])}),define("apps/apps/services/article",["apps/common/services/services"],function(e){e.factory("articleResource",["$resource",function(e){return e("/article/articles.json",{id:"@id"},{get:{method:"GET",url:"/article/articles.json"},getGuider:{method:"GET",url:"/article/article_guider/:id.json"},getDetail:{method:"GET",url:"/article/guider_detil.json"},details:{method:"GET",url:"/article/article/:id.json"},getTemplateComponent:{method:"GET",url:"/article/article_templatecomponent/:id.json",isArray:!1},add:{method:"POST",url:"/article/article.json"},edit:{method:"PUT",url:"/article/article/:id.json"},editTop:{method:"PUT",url:"/article/article_sort/:id.json"},delete:{method:"DELETE",url:"/article/article/:id.json"},upData:{method:"PUT",url:"/article/close_article/:id.json"},spreadData:{method:"PUT",url:"/article/spread_article/:id.json"},addScore:{method:"POST",url:"/article/add_articlescore.json"},qrCodes:{method:"GET",url:"/article/article_qrcode.json"}})}]),e.factory("articleStatDay",["$resource",function(e){return e("/article/article_graph.json",{id:"@id"},{query:{method:"GET",url:"/article/article_graph/:id.json"},articleList:{method:"GET",url:"/article/graph_list/:id.json"},detailsList:{method:"GET",url:"/article/get_bowsesrdetil.json"},export:{method:"GET",url:"/article/export_graph/:id.json"}})}]),e.factory("articleGoodsList",["$resource",function(e){return e("/article/goods_list.json",{get:{method:"GET",url:"/article/goods_list.json",isArray:!1}})}]),e.factory("articleGoodsSelected",["$resource",function(e){return e("/article/goods_select.json",{},{getSelected:{method:"GET",url:"/article/goods_select.json"}})}]),e.factory("articleSetting",["$resource",function(e){return e("/article/get_rule.json",{},{get:{method:"GET",url:"/article/get_rule.json"},update:{method:"PUT",url:"/article/put_rule.json"}})}]),e.factory("articleTemplateCenterResource",["$resource",function(e){return e("/article/article_templatecenter.json",{id:"@id"},{getList:{method:"GET",isArray:!1},getTags:{method:"GET",isArray:!1,url:"/article/article_templatelabel.json"},getDetail:{method:"GET",isArray:!1,url:"/article/article_templatedetail/:id.json"}})}]),e.factory("articleData",[function(){var e=[{type:"goods",icon:"fa fa-thumbs-o-up",name:"推荐商品",content:{size:"small",show_title:!0,show_cart:!0,show_price:!0,show_csale:!0}},{type:"text",icon:"fa fa-font",name:"富文本",content:{}},{type:"tuiwen_title",icon:"fa fa-bold",name:"标题",content:{title_type:"1",date_type:"1",date:moment().format("YYYY-MM-DD")}},{type:"video",icon:"fa fa-film",name:"视频",content:{}}];if(2==_global.shop.type)for(var t=e.length-1;t>-1;t--)"seckill"===e[t].type&&e.splice(t,1);return e}])}),define("apps/apps/services/auction",["apps/common/services/services"],function(e){e.factory("auctionResource",["$resource",function(e){return e("/auction/list.json",{},{query:{method:"GET",url:"/auction/list.json"}})}]),e.factory("auctionEnrollResource",["$resource",function(e){return e("/auction/enroll/:id.json",{id:"@id"},{get:{method:"GET",url:"/auction/enroll/:id.json"}})}]),e.factory("auctionGoodsResource",["$resource",function(e){return e("/auction/is_auction/:id.json",{id:"@id"},{})}]),e.factory("auctionRecordsResource",["$resource",function(e){return e("/auction/info/:id.json",{id:"@id"},{get:{method:"GET",url:"/auction/info/:id.json"}})}]),e.factory("auctionDetailResource",["$resource",function(e){return e("/auction/record/:id.json",{id:"@id"},{get:{method:"GET",url:"/auction/record/:id.json"}})}]),e.factory("auctionAddPoatResource",["$resource",function(e){return e("/auction/auction.json",{},{post:{method:"POST",url:"/auction/auction.json"}})}]),e.factory("auctionIdPutResource",["$resource",function(e){return e("/auction/auction/:id.json",{id:"@id"},{put:{method:"PUT",url:"/auction/auction/:id.json"}})}]),e.factory("auctionRefundResource",["$resource",function(e){return e("/auction/refund_earnest_list.json",{},{get:{method:"GET",url:"/auction/refund_earnest_list.json",isArray:!0}})}]),e.factory("auctionEarnestRefundResource",["$resource",function(e){return e("/auction/refund_earnest.json",{},{put:{method:"PUT",url:"/auction/refund_earnest.json"
}})}]),e.factory("auctionRoundsIdResource",["$resource",function(e){return e("/auction/:id/rounds.json",{id:"@id"},{get:{method:"GET",url:"/auction/:id/rounds.json"}})}]),e.factory("auctionRoundsDetailResource",["$resource",function(e){return e("/auction/:id/rounds/:auctionRoundId.json",{id:"@id",auctionRoundId:"@auctionRoundId"},{get:{method:"GET",url:"/auction/:id/rounds/:auctionRoundId.json"}})}]),e.factory("auctionBondIdResource",["$resource",function(e){return e("/auction/:id/earnests.json",{id:"@id"},{get:{method:"GET",url:"/auction/:id/earnests.json"}})}]),e.factory("auctionFinishedResource",["$resource",function(e){return e("/auction/finish/:id.json",{id:"@id"},{PUT:{method:"PUT",url:"/auction/finish/:id.json"}})}]),e.factory("auctionSettingResource",["$resource",function(e){return e("/auction/auction/setting.json",{},{get:{method:"GET",isArray:!1},save:{method:"POST",url:"/auction/auction/setting.json"}})}])}),define("apps/apps/services/pack",["apps/common/services/services"],function(e){e.factory("packResource",["$resource",function(e){return e("/pack_purchase/pack_purchase.json",{id:"@id"},{postPackPurchase:{method:"POST",url:"/pack_purchase/pack_purchase.json"},putPackPurchase:{method:"PUT",url:"/pack_purchase/pack_purchase/:id.json"},getInfo:{method:"GET",url:"/pack_purchase/pack_purchase/:id.json"},over:{method:"PUT",url:"/pack_purchase/pack_purchase_over/:id.json"},delete:{method:"PUT",url:"/pack_purchase/pack_purchase_delete/:id.json"},getOrders:{method:"GET",url:"/pack_purchase/orders/:id.json"},getQrcodeInfo:{method:"GET",url:"pack_purchase/qrcode_info/:id.json"}})}])}),define("apps/apps/services/pin",["apps/common/services/services"],function(e){e.factory("pinResource",["$resource",function(e){return e("/marketing/tuan/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},save:{method:"POST",url:"/marketing/tuan.json"},update:{method:"PUT"},delete:{method:"DELETE"},getQrcodeInfo:{method:"GET",url:"marketing/tuan_qrcode/:id.json"},getTuanDetail:{method:"GET",url:"marketing/qrcode_tuan_initiate/:id.json"},closeLadder:{method:"PUT",url:"marketing/close_ladder/:id.json"},pinQrcode:{method:"GET",url:"marketing/qrcode_tuan.json"}})}]),e.factory("pinMarket",["$resource",function(e){return e("",{id:"@id"},{getSku:{method:"GET",url:"/marketing/tuan_product/:id.json",isArray:!0},getSurvey:{method:"GET",url:"/marketing/ladder_item/:id.json",isArray:!0},getStock:{method:"GET",url:"/marketing/item_stock/:id.json",isArray:!0}})}]),e.factory("pinRecords",["$resource",function(e){return e("",{id:"@id"},{getList:{method:"GET",url:"marketing/tuan/initiate/:id.json"},getInitiateJoin:{method:"GET",url:"marketing/tuan/initiate_join/:id.json"},ladderDummy:{method:"POST",url:"marketing/tuan/virtual.json"},setTime:{method:"PUT",url:"marketing/extend_initiate/:id.json"},overLadder:{method:"PUT",url:"marketing/close_ladder/:id.json"}})}]),e.factory("pinRefund",["$resource",function(e){return e("",{},{getList:{method:"GET",url:"marketing/tuan_refund.json"}})}]),e.factory("pinCountList",["$resource",function(e){return e("",{id:"@id"},{getList:{method:"GET",url:"marketing/tuan_stat/:id.json",isArray:!0}})}]),e.factory("pinProps",["$resource",function(e){return e("/marketing/goods_props/:goods_id.json",{id:"@id"},{})}]),e.factory("pinGoodsData",[function(){var e={title:"",created_at:"",note:"",setting:0,pin_item:[{pin_num:"",expire_in:""}]},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t}])}),define("apps/apps/services/returncash",["apps/common/services/services"],function(e){e.factory("returncashResource",["$resource",function(e){return e("marketing/return_cash_list.json",{id:"@id"},{getList:{method:"GET",isArray:!1},deleteById:{method:"DELETE",url:"/marketing/return_cash/:id.json"},endById:{method:"PUT",url:"/marketing/close_return_cash/:id.json"},getQrcodeById:{method:"GET",url:"/marketing/return_cash_qrcode/:id.json",isArray:!1}})}]),e.factory("returncashManageResource",["$resource",function(e){return e("/marketing/return_cash/:id.json",{id:"@id"},{save:{method:"POST"},update:{method:"PUT"},getDetail:{method:"GET",isArray:!1},getGoodsProps:{method:"GET",isArray:!1,url:"/marketing/goods_props/:id.json"}})}]),e.factory("returncashStatisticaldataResource",["$resource",function(e){return e("/marketing/return_cash_data/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("returncashActiverecordResource",["$resource",function(e){return e("marketing/return_cash_record_list.json",{id:"@id"},{getList:{method:"GET",isArray:!1},manualRemit:{method:"POST",url:"/marketing/manual_remit/:id.json"}})}])}),define("apps/apps/services/combomenu",["apps/common/services/services"],function(e){e.factory("comboResource",["$resource",function(e){return e("/combomenu/combo_menu.json",{},{get:{method:"GET",url:"/combomenu/combo_menu.json"},delete:{method:"DELETE",url:"/combomenu/combo_menu_del/:id.json"},switch:{method:"PUT",url:"/combomenu/combo_menu_end/:id.json"},order:{method:"GET",url:"/combomenu/combo_menu_order/:id.json"},add:{method:"POST",url:"/combomenu/combo_menu.json"},update:{method:"PUT",url:"/combomenu/combo_menu.json"},goods:{method:"GET",url:"/marketing/discount_goods.json"},designGoods:{method:"GET",url:"/combomenu/design_combo.json"}})}])}),define("apps/apps/services/_base",["apps/apps/services/peerpay","apps/apps/services/bargain","apps/apps/services/pintuan","apps/apps/services/snatch","apps/apps/services/collect","apps/apps/services/thirdapp","apps/apps/services/guess","apps/apps/services/article","apps/apps/services/auction","apps/apps/services/pack","apps/apps/services/pin","apps/apps/services/returncash","apps/apps/services/combomenu","apps/apps/services/pack"],function(){}),define("apps/apps/controllers/peerpay.list",["apps/common/controllers/controllers"],function(e){e.controller("peerpay.list",["$scope","Flash","peerpayResource","$modal",function(e,t,a,o){e.type=0;var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,type:e.type},function(t){e.paginationConf.totalItems=t._count,e.enabled_peerpay=t.enabled_peerpay,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s);var n=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:s()};e.set_type=function(t){e.type=t,n()},e.open_peerpay_status=!1,e.open_peerpay=function(o){e.open_peerpay_status=!0,a.set({type:o},function(a){e.open_peerpay_status=!1,t.create("success","设置成功！")},function(a){e.open_peerpay_status=!1,t.create("danger",a.data.error.message)})},e.confirmDelete=function(e){a.delete({id:e},function(e){t.create("success"," 删除成功！"),n()},function(e){t.create("danger",e.data.error.message)})},e.add=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/peerpay.modal.html",controller:"peerpayModelCtrl",resolve:{item:function(){return{type:e.type}}}});t.result.then(function(e){e&&s()})},e.edit=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/peerpay.modal.html",controller:"peerpayModelCtrl",resolve:{item:function(){return e}}});t.result.then(function(e){e&&s()})}}]).controller("peerpayModelCtrl",["$scope","Flash","peerpayResource","$modalInstance","item",function(e,t,a,o,s){s.id?e.title="编辑":e.title="添加",e.data=s,1==e.data.type?e.text="代付人的留言":e.text="发起人的求助",e.btn_text="保存",e.ok=function(n){n&&(e.form.$invalid=!0,e.btn_text="保存中...",s.id?a.update(e.data,function(a){e.form.$invalid=!1,e.btn_text="保存",t.create("success"," 修改成功！"),o.close(1)},function(a){e.form.$invalid=!1,e.btn_text="保存",t.create("danger",a.data.error.message),o.dismiss("cancel")}):a.save(e.data,function(a){e.form.$invalid=!1,e.btn_text="保存",t.create("success"," 添加成功！"),o.close(1)},function(a){e.form.$invalid=!1,e.btn_text="保存",t.create("danger",a.data.error.message),o.dismiss("cancel")}))},e.cancel=function(){o.dismiss("cancel")}}])}),define("apps/apps/controllers/bargain.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.bargain.list",["$scope","ngPopover","$resource","bargainResource","Flash","$stateParams","$state","bargainFinishResource","videoAddress",function(e,t,a,o,s,n,r,i,c){e.videoAddress=c,e.status=n.status;var l=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,status:e.status,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.remove=function(e,t){o.delete({id:t},function(e){e.success?(l(),s.create("success"," 删除成功！")):s.create("success"," 删除失败！")},function(e){s.create("danger",e.data.error.message)})},e.over=function(t,a){i.finish({id:a.id},function(a){a.success&&(s.create("success","已结束！"),e.data[t].status=2)},function(e){s.create("danger",e.error.message)})}}])}),define("apps/apps/controllers/bargain.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("bargainGoodsCtrl",["$scope","$modal","Flash",function(e,t,a){e.sortableOptions={cursor:"move",zIndex:99999,axis:"x"},e.remove=function(t){e.goods.splice(t.$index,1)},e.add_goods=function(e,o){if("credit.goods.add"==e&&0===_global.setting.credit_rule)return a.create("warning","请先在积分设置中填写默认积分抵扣比例"),!1;var s=t.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/bargain_goods_list.html",controller:"bargainGoodsModalCtrl"});s._skipTo=e,s._flag=o}}]).controller("bargainGoodsModalCtrl",["$scope","$modalInstance","discountGoodsRes","tagResource","Flash","$state","snatchGoodListRes","creditGoodsListRes","auctionGoodsResource","$modal",function(e,t,a,o,s,n,r,i,c,l){function d(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},"pintuan"==t._flag||"guess"==t._flag||"auction"==t._flag?e.type=7:"repurchase"==t._flag?e.type=14:"pin"==t._flag?e.type=8:e.type=1,e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,type:e.type,column:"csale",direction:"desc"},d();var p=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id);var o;switch(e.invalid_btn="已参加",t._flag){case"snatch":o=r,e.invalid_btn="正在参加";break;case"credit":o=i;break;default:o=a}o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",p()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(e){if(!e)return!1;if("repurchase"==t._flag){var a=l.open({size:"md",animation:!1,templateUrl:"assets/js/apps/ump/templates/multis.repurchase.html",controller:"ump.multis.repurchase",resolve:{goods_id:function(){return e}}});a.result.then(function(e){e&&(n.reload(),t.close(1))})}else t.close(),t._skipTo&&("pin"==t._flag?n.go(t._skipTo,{goods_id:e,step:1}):n.go(t._skipTo,{goods_id:e}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/bargain.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.bargain.info",["$scope","bargainResource","$stateParams","Flash","$state","goodsResource",function(e,t,a,o,s,n){a.id?(e.title="编辑砍价活动",t.get({id:a.id},function(t){e.data=t;for(var a=0;a<t.bargain_lines.length;a++)t.bargain_lines[a].role_id=""+t.bargain_lines[a].role_id;e.bargain_lines=t.bargain_lines})):e.title="新增砍价活动",a.goods_id&&n.get({id:a.goods_id},function(t){e.good=t,e.data||(e.data={stock:t.stock})});var r=[{role_id:"1",bonus:1},{role_id:"2",bonus:1}];a.id||(e.bargain_lines=[],e.bargain_lines.push(angular.copy(r[0]))),e.addRoleBonus=function(){e.bargain_lines&&(1==e.bargain_lines.length?"1"===e.bargain_lines[0].role_id?e.bargain_lines.push(angular.copy(r[1])):"2"===e.bargain_lines[0].role_id&&e.bargain_lines.push(angular.copy(r[0])):0==e.bargain_lines.length&&e.bargain_lines.push(angular.copy(r[0])))},e.removeRoleBonus=function(t,a){t.preventDefault(),t.stopPropagation(),e.bargain_lines.splice(a,1)},e.getNowFormatDate=function(){var e=new Date(new Date-864e5),t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.submitForm=function(n){if(n){e.good&&(e.data.goods_id=e.good.id,e.data.goods_img=e.good.img,e.data.goods_title=e.good.title);var r="";if(e.bargain_lines&&e.bargain_lines.length>0){for(var i=0;i<e.bargain_lines.length;i++)0!=i&&(r+=";"),r+=e.bargain_lines[i].role_id+","+e.bargain_lines[i].bonus;e.data.bargain_lines=r}e.form.$invalid=!0,a.id?t.update({id:a.id},e.data,function(t){t.success&&(o.create("success"," 保存成功！"),e.btn_text="保存",s.go("shop.apps.bargain.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error)}):t.save(e.data,function(t){t.success&&(o.create("success"," 保存成功！"),e.btn_text="保存",s.go("shop.apps.bargain.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)})}}}])}),define("apps/apps/controllers/bargain.starts",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.bargain.starts",["$scope","ngPopover","$resource","bargainStartsResource","Flash","$stateParams",function(e,t,a,o,s,n){e.bargain_id=n.id,e.bargain_name=n.name,e.bargain_status=n.status;var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,bargain_id:e.bargain_id,status:e.bargain_status,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.forbid=function(t,a){o.forbid({id:a,is_disable:1},function(a){a.success?(e.data[t].is_disable=1,s.create("success","禁止成功")):s.create("success","禁止失败")},function(e){s.create("danger",e.data.error.message)})}}])}),define("apps/apps/controllers/bargain.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.bargain.records",["$scope","ngPopover","$resource","bargainRecordsResource","Flash","$stateParams",function(e,t,a,o,s,n){e.bargain_initiate_id=n.bargain_initiate_id,e.bargain_initiate_name=n.bargain_initiate_name,e.bargain_id=n.bargain_id,e.bargain_name=n.bargain_name;var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,bargain_initiate_id:e.bargain_initiate_id,bargain_id:e.bargain_id,sort:e.sorts},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/apps/controllers/bargain.configs",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.bargain.configs",["$scope","ngPopover","$resource","bargainConfigsResource","Flash","$stateParams","$modal",function(e,t,a,o,s,n,r){e.edit=function(e){$("#inline-edit-"+e).trigger("click")};var i=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,sort:e.sorts},function(a){e.paginationConf.totalItems=a._count,e.paginationConf.totalItems<=(e.paginationConf.currentPage-1)*t.limit&&(e.paginationConf.currentPage=e.paginationConf.currentPage-1),e.data=a.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.remove=function(e,t){o.delete({id:t},function(e){e.success?(i(),s.create("success"," 删除成功！")):s.create("success"," 删除失败！")},function(e){s.create("danger",e.data.error.message)})},e.checkMsg=function(t,a){if(e.oldValue=a,""==t)return"砍价文案不能为空!"},e.saveField=function(t,a,n){if(e.oldValue!==a){var r={id:n};r[t]=a,o.update(r,function(e){e.success||s.create("danger","编辑失败")})}},e.add_configs=function(){var e=r.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/bargain.configs.info.html",controller:"bargainConfigCtrl"});e.result.then(function(e){i()})}}]).controller("bargainConfigCtrl",["$scope","bargainConfigsResource","$modalInstance","Flash","$state",function(e,t,a,o,s){e.btn_text="保存",e.ok=function(s){s&&(e.form.$invalid=!0,e.btn_text="保存中...",t.save({msg:e.msg},function(t){e.form.$invalid=!1,e.btn_text="保存",a.close(t.data),o.create("success"," 保存成功！")},function(t){e.form.$invalid=!1,e.btn_text="保存",o.create("danger",t.data.error.message)}))},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/apps/controllers/pintuan.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pintuan.list",["$scope","ngPopover","$resource","pintuanResource","Flash","$stateParams","pintuanFinishResource","$state","goodsResource","videoAddress",function(e,t,a,o,s,n,r,i,c,l){e.videoAddress=l,e.status=n.status;var d=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,goods_title:e.goods_title,status:e.status},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.finish=function(e,t){r.query({id:t.id},t,function(e){s.create("success","已结束！"),location.reload()},function(e){s.create("danger",e.error.message)})},e.showQrcode=function(t){c.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){t.close(),s.create("success"," 复制成功！")}}])}),define("apps/apps/controllers/pintuan.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pintuan.info",["$scope","pintuanResource","$stateParams","Flash","$state","goodsResource",function(e,t,a,o,s,n){a.id?(e.title="编辑活动",t.get({id:a.id},function(t){e.data=t.data,e.data.expire_in=t.data.expire_in/3600+"",e.pintuan_item=t.data.pintuan_item,e.btn_ct_status=t.data.btn_ct_status})):(e.pintuan_item=[{cpeoples:null,price:null}],e.btn_ct_status=1,e.title="新增活动"),a.goods_id&&n.get({id:a.goods_id},function(t){e.good=t,e.data||(e.data={stock:t.stock,price:t.price})}),e.addPintuanItem=function(){return e.pintuan_item.length>=3?void o.create("danger","最多可设置3个阶梯价格!"):void e.pintuan_item.push({cpeoples:null,price:null})},e.removePintuanItem=function(t,a){t.preventDefault(),t.stopPropagation(),e.pintuan_item.splice(a,1)},e.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate()-1;o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.btn_text="保存",e.submitForm=function(n){if(n){if(e.btn_text="保存中...",e.form.$invalid=!0,e.good&&(e.data.goods_id=e.good.id,e.data.goods_img=e.good.img,e.data.goods_title=e.good.title),e.pintuan_item.length<1)return o.create("danger","请设置拼团价格!"),e.btn_text="保存",void(e.form.$invalid=!1);if(!e.data.expire_in)return o.create("danger","请设置拼团限时!"),e.btn_text="保存",void(e.form.$invalid=!1);e.data.pintuan_item=e.pintuan_item,e.data.btn_ct_status=e.btn_ct_status,e.form.$invalid=!0,a.id?t.update({id:a.id},e.data,function(t){e.btn_text="保存",t.success&&(o.create("success"," 保存成功！"),s.go("shop.apps.pintuan.list")),t.error&&o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}):t.save(e.data,function(t){e.btn_text="保存",t.success&&(o.create("success"," 保存成功！"),s.go("shop.apps.pintuan.list",{status:"all"})),t.error&&o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)})}}}])}),define("apps/apps/controllers/pintuan.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pintuan.records",["$scope","ngPopover","$resource","pintuanRecordsResource","Flash","$stateParams","pintuanResource",function(e,t,a,o,s,n,r){e.id=n.id,e.title=n.title,e.status="all",e.cpeoples="all",r.get({id:n.id},function(t){e.cpeoplesData=t.data.pintuan_item});var i=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.startDate=t[0],e.endDate=t[1]):(e.startDate=null,e.endDate=null);var a={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(a.offset-1)*a.limit,limit:a.limit,member_name:e.member_name,startDate:e.startDate,endDate:e.endDate,status:e.status,id:e.id,cpeoples:e.cpeoples},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.showQrcode=function(t){o.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){t.close(),s.create("success"," 复制成功！")}}])}),define("apps/apps/controllers/pintuan.details",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pintuan.details",["$scope","ngPopover","$resource","pintuanDetailResource","Flash","$stateParams",function(e,t,a,o,s,n){e.id=n.id,e.pintuanInitiateId=n.pintuanInitiateId,e.pintuanTitle=n.pintuanTitle,e.memberName=n.memberName,e.status="all";var r=function(){var t=$('input[name="created_range"]').val();""!=t&&(t=t.split("/"),e.startDate=t[0],e.endDate=t[1]);var a={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(a.offset-1)*a.limit,limit:a.limit,order_sn:e.order_sn,startDate:e.startDate,endDate:e.endDate,member_name:e.member_name,id:e.id,pintuanInitiateId:e.pintuanInitiateId},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]}}])}),define("apps/apps/controllers/pintuan.configs",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pintuan.configs",["$scope","ngPopover","$resource","pintuanConfigsResource","Flash","$stateParams","$modal",function(e,t,a,o,s,n,r){e.edit=function(e){$("#inline-edit-"+e).trigger("click")};var i=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,type:1},function(a){e.paginationConf.totalItems=a._count,e.paginationConf.totalItems<=(e.paginationConf.currentPage-1)*t.limit&&(e.paginationConf.currentPage=e.paginationConf.currentPage-1),e.data=a.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.remove=function(e,t){o.delete({id:t},function(e){e.success?(i(),s.create("success"," 删除成功！")):s.create("success"," 删除失败！")},function(e){s.create("danger",e.data.error.message)})},e.checkMsg=function(t,a){if(e.oldValue=a,""==t)return"砍价文案不能为空!"},e.saveField=function(t,a,n){if(e.oldValue!==a){var r={id:n};r[t]=a,o.update(r,function(e){e.success||s.create("danger","编辑失败")})}},e.add_configs=function(){var e=r.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/pintuan.configs.info.html",controller:"pintuanConfigCtrl"});e.result.then(function(e){i()})}}]).controller("pintuanConfigCtrl",["$scope","pintuanConfigsResource","$modalInstance","Flash","$state",function(e,t,a,o,s){e.ok=function(){t.save({msg:e.msg,type:1},function(e){a.close(e.data),o.create("success"," 保存成功！")},function(t){e.form.$invalid=!1,o.create("danger",t.data.error.message)})},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/apps/controllers/pintuan.refund",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pintuan.refund",["$scope","ngPopover","$resource","pintuanRefundResource","Flash","$stateParams","paymentResource","pintuanResource","pintuanRecordsResource","$modal",function(e,t,a,o,s,n,r,i,c,l){function d(){e.pintuan_id&&"all"!=e.pintuan_id&&c.query({id:e.pintuan_id},function(t){e.pintuanInitiateData=t.data;for(var a=0;a<e.pintuanInitiateData.length;a++)e.pintuanInitiateData[a].id+""==n.pintuanInitiateId&&(e.pintuanInitiate.selected={id:e.pintuanInitiateData[a].id+"",member_name:e.pintuanInitiateData[a].member_name+e.pintuanInitiateData[a].id})})}e.pintuan_id=n.pintuanId,e.pintuan_initiate_id=n.pintuanInitiateId,e.payment_code="all",e.refund_status="all",e.pintuanInitiateData=[],e.paymentData=r.query(),e.pintuan={},e.pintuan.selected={id:"all",title:"活动"},e.selectedRefundIds=[],e.goods={checkedAll:!1},i.query({type:1},function(t){e.pintuanData=t.data;for(var a=0;a<e.pintuanData.length;a++)e.pintuanData[a].id+""==n.pintuanId&&(e.pintuan.selected={id:e.pintuanData[a].id+"",title:e.pintuanData[a].title})}),d(),e.pintuanInitiate={},e.pintuanInitiate.selected={id:"",member_name:"团长"},e.pintuanChange=function(){e.pintuan_id=e.pintuan.selected.id,d()},e.pintuanRecordsChange=function(){e.pintuan_initiate_id=e.pintuanInitiate.selected.id};var p=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,member_name:e.member_name,payment_code:e.payment_code,pintuan_id:e.pintuan_id,pintuan_initiate_id:e.pintuan_initiate_id,refund_status:e.refund_status},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),e.search=function(){1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1},e.batchRefund=function(){return e.selectedRefundIds&&0!=e.selectedRefundIds.length?void o.batchRefund({order_refund_ids:"["+e.selectedRefundIds.join(",")+"]"},function(t){if(e.goods.checkedAll=!1,1==t.status)if(angular.isUndefined(t.feedback_url))s.create("success",t.msg);else{window.open(t.feedback_url);l.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return t.feedback_url}}})}else s.create("danger",t.msg)}):void s.create("danger","没有数据可退款")},e.toggleSelection=function(t){var a=e.selectedRefundIds.indexOf(t);a>-1?e.selectedRefundIds.splice(t,1):e.selectedRefundIds.push(t)},e.$watch("goods.checkedAll",function(t){if(t){var a=e.data.filter(function(e){if(0==e.is_sys&&"alipay"==e.payment_code)return e});e.selectedRefundIds=a.map(function(e){return e.refund_id})}else e.selectedRefundIds=[]})}]),e.controller("modalFeedback",["$scope","$state","$modalInstance","url",function(e,t,a,o){e.goUrl=o,e.refresh=function(){a.close(),t.reload()}}])}),define("apps/apps/controllers/snatch.config",["apps/common/controllers/controllers"],function(e){e.controller("snatch.config",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","snatchConfigResource","snatchResource",function(e,t,a,o,s,n,r,i,c){e.config={title:"人人夺宝"};var l=function(){var e=new Date,t=e.getMonth(),a=e.getDate();return t<=2&&!(2==t&&a>=15)};e.tis=l(),i.get({id:s.id},function(t){0==t.data.length?e.slices=[{content:{item_list:{}},type:"snatch_nav"},{content:{item_list:{}},type:"slide"},{content:{size:"small",number:6},type:"snatch_goods"}]:(e.slices=t.data,e.config.title=t.title,e.config.description=t.description)}),c.get({},function(t){e.data=t.data}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.removeSlice=function(t){e.slices.splice(t,1),e.designs=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.designs=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(){if(e.config.title)for(var a=["一元","1元","元"],o=0;o<a.length;o++){if(e.config.title.search(a[o])>-1)return t.create("danger","请重新填写页面标题"),!1;if(e.config.description&&e.config.description.search(a[o])>-1)return t.create("danger","请重新填写页面描述"),!1}if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var s=angular.copy(e.slices);for(var n in s){var c=r[s[n].type](s[n].content);if(c)return e.editSlice(e.slices[n],c),!1}e.config.data=s,i.update(e.config,function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/apps/controllers/snatch.detail",["apps/common/controllers/controllers"],function(e){e.controller("snatch.detail",["$scope","$modal","$stateParams","Flash","snatchDetailResource","saveDeliver","finishSnatchResource","openNextResource","closeNextResource","$state",function(e,t,a,o,s,n,r,i,c,l){e.id=a.id,e.snatch_status=0,e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={};var d=function(){s.query({offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,id:e.id,nickname:e.searchInfo.nickname,mobile:e.searchInfo.mobile,start_time:e.startDate,end_time:e.endDate},function(t){e.paginationConf.totalItems=t._total,e.data=t.data,e.address=t.address,e.snatch=t.snatch,t.win&&(e.winner=t.win,e.delivery={goodsInfo:t.win.goods_info,order_id:t.win.order_id,address:t.address})})};e.finishSnatch=function(t){r.update({id:t},function(t){t.status?(o.create("success",t.msg),e.snatch.status=4,e.snatch.open_next_show=1):o.create("danger",t.msg)})},e.switchAutoStart=function(t,a){c.update({id:t.id,type:a},function(t){t.status?(o.create("success",t.msg),1==a?e.snatch.is_start=0:e.snatch.is_start=1):o.create("danger",t.msg)})},e.openNextSnatch=function(e){i.save({id:e.id},function(e){e.status?(o.create("success",e.msg),l.go("shop.apps.snatch.list")):o.create("danger",e.msg)})},e.$watch("paginationConf.currentPage",d),e.search=function(){var t=$('input[name="created_range"]').val();
""!=t&&(t=t.split("/"),e.startDate=t[0],e.endDate=t[1]),1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.showAll=function(e){t.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/snatch.number.html",controller:"snatch.number",resolve:{items:function(){return e}}})},e.sendGoods=function(a){var s=t.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/snatch.delivery.html",controller:"snatch.sendgoods",resolve:{data:function(){return a}}});s.result.then(function(t){n.save(t,function(t){t.success?(e.address.status=1,o.create("success","发货成功")):o.create("danger",t.error)})})}}]).controller("snatch.number",function(e,t,a){e.items=a,e.cancel=function(){t.dismiss("cancel")}}).controller("snatch.sendgoods",["$scope","$modalInstance","Flash","getDelivery","data",function(e,t,a,o,s){e.delivery_data=s,e.address=s.address,e.deliveryList=o.query(),e.deliveryInfo={type:s.address.is_selffetch,isOther:0},e.set_delivery=function(t,a,o,s){e.deliveryInfo.isOther=t,e.deliveryInfo.otherName=o,0==t&&(e.deliveryInfo.id=a,e.deliveryInfo.name=o,e.deliveryInfo.code=s)},e.saveOrderDelivery=function(){var o={order_id:s.order_id,goods:[{id:s.goodsInfo.order_goods_id,sum:1}],deliveryInfo:e.deliveryInfo},n=/^[0-9]*[1-9][0-9]*$/,r=!1;return 0==e.deliveryInfo.type&&(e.deliveryInfo.isOther?""!=e.deliveryInfo.name&&""!=e.deliveryInfo.number?n.test(e.deliveryInfo.number)?r=!0:(a.create("danger","请输入正确的物流单号"),r=!1):""==e.deliveryInfo.name?(a.create("danger","请填写物流公司名称"),r=!1):""==e.deliveryInfo.number&&(a.create("danger","请填写物流单号"),r=!1):""!=e.deliveryInfo.id&&""!=e.deliveryInfo.number?n.test(e.deliveryInfo.number)?r=!0:(a.create("danger","请输入正确的物流单号"),r=!1):(a.create("danger","请填写物流信息"),r=!1)),!!r&&void t.close(o)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/snatch.info",["apps/common/controllers/controllers"],function(e){e.controller("snatch.info",["$scope","$stateParams","$state","Flash","goodsResource","snatchResource",function(e,t,a,o,s,n){e.entity={is_start:0,lowest_number:1},t.goods_id&&s.get({id:t.goods_id},function(t){e.good=t,e.entity.name=t.title,e.entity.goods_id=t.id,e.entity.goods_img=t.img}),e.submitForm=function(t){t&&(e.form.$invalid=!0,n.save(e.entity,function(t){t.status?(o.create("success","保存成功"),a.go("shop.apps.snatch.list")):(e.form.$invalid=!1,o.create("danger",t.msg))}))}}])}),define("apps/apps/controllers/snatch.list",["apps/common/controllers/controllers"],function(e){e.controller("snatch.list",["$scope","$modal","Flash","ngPopover","snatchResource","openNextResource","closeNextResource","finishSnatchResource","qrcodeSnatchResource",function(e,t,a,o,s,n,r,i,c){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={status:"0",start_time:"",end_time:""};var l=function(){e.searchInfo.dates=null,e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._total,e.data=t.data,e.qrcode=t.qrcode,e.copy_text=t.qrcode.url})};e.$watch("paginationConf.currentPage",l),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.showQrcode=function(t){c.get({id:t},function(t){e.qrcodeInfo=t.qrcode})},e.showMessage=function(){o.close(),a.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/apps/controllers/auction.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.list",["$scope","ngPopover","$resource","auctionResource","Flash","$stateParams","$state","goodsResource","auctionFinishedResource","$modal","videoAddress",function(e,t,a,o,s,n,r,i,c,l,d){e.videoAddress=d,e.status=n.status,e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",name:"",type:"0",status:e.status};var p=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.auction=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),e.showQrcode=function(t){i.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.search=function(){e.paginationConf.currentPage=1,p()},e.showMessage=function(){t.close(),s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.over=function(t){e.overdata={id:t,type:"-1"},c.PUT(e.overdata,function(e){1==e.status?s.create("success","活动结束！"):0==e.status&&s.create("danger",e.msg),p()})},e.finish=function(e){var t=l.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/auction_finished.html",controller:"shop.apps.auction.finished",resolve:{Id:function(){return e}}});t.result.then(function(e){p()},function(e){p()})}}])}),define("apps/apps/controllers/auction.add",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.add",["$scope","auctionAddPoatResource","auctionIdPutResource","$stateParams","Flash","$state","auctionRecordsResource","goodsResource",function(e,t,a,o,s,n,r,i){function c(e,t){return new Date(e.replace(/-/g,"/"))<=new Date(t.replace(/-/g,"/"))}e.status=o.status,e.data={},e.title="新增活动",o.goods_id?i.get({id:o.goods_id},function(t){e.good=t,e.data||(e.data={stock:t.stock,price:t.price})}):o.id&&(e.title="编辑活动",r.get({id:o.id},function(t){e.good=t.goods,e.data=t})),e.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate()-1;o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.getNowFormatDateNew=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.btn_text="保存",e.submitForm=function(r){if(r){if(e.NewnowFormatDate="",e.NewnowFormatDate=e.getNowFormatDateNew(),e.btn_text="保存中...",e.form.$invalid=!0,e.good&&(e.data.goods_id=e.good.id,e.data.goods_img=e.good.img,e.data.goods_title=e.good.title),""==e.data.title)return s.create("danger","请填写活动名称!"),e.btn_text="保存",void(e.form.$invalid=!1);if(e.data.round<1)return s.create("danger","活动轮次不能为空!"),e.btn_text="保存",void(e.form.$invalid=!1);if(0==e.data.earnest)return s.create("danger","保证金不能为零!"),e.btn_text="保存",void(e.form.$invalid=!1);if(""==e.data.base_price)return s.create("danger","起拍价不能为空!"),e.btn_text="保存",void(e.form.$invalid=!1);var i=.2*e.good.price;if(e.data.earnest>i)return s.create("danger","保证金必须少于商品原价20%!"),e.btn_text="保存",void(e.form.$invalid=!1);if(0==e.data.increase)return s.create("danger","加价幅度不能为零!"),e.btn_text="保存",void(e.form.$invalid=!1);if(1==c(e.data.preview_at,e.NewnowFormatDate))return s.create("danger","活动预展开始时间不能小于当前时间!"),e.btn_text="保存",e.form.$invalid=!1,!1;if(1==c(e.data.start_at,e.NewnowFormatDate))return s.create("danger","活动开始时间不能小于当前时间!"),e.btn_text="保存",e.form.$invalid=!1,!1;if(e.data.preview_at>=e.data.start_at)return s.create("danger","活动预展开始时间不能晚于或等于活动开始时间!"),e.btn_text="保存",void(e.form.$invalid=!1);o.goods_id?t.post(e.data,function(t){e.btn_text="保存",1==t.status&&(s.create("success"," 保存成功！"),n.go("shop.apps.auction.list")),0==t.status&&(e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.msg))},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)}):a.put({id:o.id},e.data,function(t){1==t.status&&(e.form.$invalid=!1,s.create("success"," 编辑成功！"),n.go("shop.apps.auction.list")),0==t.status&&(e.btn_text="保存",s.create("danger",t.msg))},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)})}}}])}),define("apps/apps/controllers/auction.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.records",["$scope","ngPopover","$resource","auctionRecordsResource","auctionEnrollResource","auctionDetailResource","Flash","$stateParams","auctionResource","$modal","goodsResource","auctionRoundsIdResource",function(e,t,a,o,s,n,r,i,c,l,d,p){e.id=i.id,e.paginationConf={currentPage:1,itemsPerPage:10};var u=function(){o.get({member_name:e.member_name,startDate:e.startDate,endDate:e.endDate,status:e.status,id:e.id,cpeoples:e.cpeoples},function(t){e.Records=t})};u(),e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,id:e.id,mobile:e.mobile,status:e.status};var m=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,p.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",m),e.search=function(){e.params.mobile=e.mobile,e.params.status=e.status,1==e.paginationConf.currentPage?m():e.paginationConf.currentPage=1},e.showrecords=function(e,t){var a=l.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/auction.records_details.html",controller:"shop.apps.auction.detail.records",resolve:{orderId:function(){return e},ordertype:function(){return t}}});a.result.then(function(e){getEnroll()},function(e){getEnroll()})},e.showQrcode=function(t){d.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})}}])}),define("apps/apps/controllers/auction.detail.records",["apps/common/controllers/controllers"],function(e,t){e.controller("shop.apps.auction.detail.records",["$scope","$modalInstance","$state","$modal","orderId","auctionDetailResource","auctionroundsResource","ordertype",function(e,t,a,o,s,n,r,i){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,id:s,type:i};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c)}])}),define("apps/apps/controllers/auction.finished",["apps/common/controllers/controllers"],function(e,t){e.controller("shop.apps.auction.finished",["$scope","Flash","$modalInstance","$state","$modal","ngPopover","auctionFinishedResource","Id",function(e,t,a,o,s,n,r,i){e._global=_global,e.cancel=function(){a.dismiss("cancel")},e.data={id:i,type:""},e.finished=function(){return e.data.type=$("input[name='finished_type']:checked").attr("val"),void 0==e.data.type?(t.create("danger","请选择活动结束方式"),!1):void r.PUT(e.data,function(o){e.btn_text="保存中...",e.form.$invalid=!0,1==o.status?t.create("success","活动结束！"):0==o.status&&t.create("danger",o.msg),a.close(1)})}}])}),define("apps/apps/controllers/auction.covers",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.covers",["$scope","auctionRecordsResource","$stateParams","$modal","auctionRoundsDetailResource",function(e,t,a,o,s){e.id=a.id,e.auctionRoundId=a.auctionRoundId,e.paginationConf={currentPage:1,itemsPerPage:10};var n=function(){t.get({member_name:e.member_name,startDate:e.startDate,endDate:e.endDate,status:e.status,id:e.id,cpeoples:e.cpeoples},function(t){e.Records=t})};n(),e.paginationConf={currentPage:1,itemsPerPage:10},e.status=a.status,e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,id:e.id,nickname:"",mobile:"",status:e.status,auctionRoundId:e.auctionRoundId};var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){e.paginationConf.currentPage=1,r()}}])});define("apps/apps/controllers/auction.bond",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.bond",["$scope","ngPopover","$resource","auctionEnrollResource","auctionDetailResource","Flash","$stateParams","auctionResource","$modal","auctionBondIdResource",function(e,t,a,o,s,n,r,i,c,l){e.id=r.id,e.paginationConf={currentPage:1,itemsPerPage:10},e.paginationConf={currentPage:1,itemsPerPage:10},e.status=r.status,e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,id:e.id,nickname:"",mobile:"",status:e.status};var d=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,l.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){e.paginationConf.currentPage=1,d()},e.showrefund=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/auction.refund.detail.html",controller:"shop.apps.auction.refund",resolve:{EarnestId:function(){return e}}});t.result.then(function(e){d()},function(e){d()})}}])});define("apps/apps/controllers/auction.copy",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.copy",["$scope","Flash","$sce","auctionSettingResource","$modal",function(e,t,a,o,s){e.setting={sys_agreement:0,earnest_agreement:""},e.btn_text="保存",o.get(function(t){e.setting.sys_agreement=t.sys_agreement,e.setting.earnest_agreement=t.earnest_agreement}),e.radioCopy=function(){o.get({sys_agreement:e.setting.sys_agreement},function(t){e.setting.earnest_agreement=t.earnest_agreement})},e.submitForm=function(a){a&&(e.btn_text="保存中...",o.save(e.setting,function(a){e.btn_text="保存",t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/apps/controllers/auction.refund",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.auction.refund",["$scope","EarnestId","auctionRefundResource","auctionEarnestRefundResource","$modalInstance","Flash",function(e,t,a,o,s,n){e._global=_global,e.cancel=function(){s.close(1),s.dismiss("cancel")},e.param={earnest_id:t};var r=function(){a.get(e.param,function(t){e.refund_list=t})};r(),e.surerefund=function(t){e.params={refund_id:t},o.put(e.params,function(e){1==e.status?(n.create("success","同意退款"),window.location.href=""+e.feedback_url):n.create("danger",e.error)})}}])}),define("apps/apps/controllers/collect",["apps/common/controllers/controllers"],function(e){e.controller("collect.list",["$scope","Flash","ngPopover","collectResource","collectCloseResource","collectSortResource","collectPublishResource",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={status:"0",start_time:"",end_time:""};var i=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._total,e.data=t.data,e.qrcode=t.qrcode})};e.$watch("paginationConf.currentPage",i),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(e.searchInfo.dates=null,t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.publish=function(e,a){r.set({id:e},function(e){return e.status?(t.create("success","发布成功"),void i()):(t.create("danger",e.msg||"发布失败"),!1)},function(e){return t.create("danger",e.data.error),!1})},e.removeItem=function(a,s){o.remove({id:a},function(a){return a.status?void e.data.splice(s,1):(t.create("danger","删除失败"),!1)})},e.cancelItem=function(a,o){s.close({id:a},function(a){return a.status?(e.data[o].status=3,void t.create("success","操作成功")):(t.create("danger","操作失败"),!1)},function(e){t.create("danger",e.data.error)})},e.checkSort=function(e,t){return e!==t&&(/^\d+(\d+)?$/.test(e)?void 0:"格式不正确!")},e.saveField=function(e,a){var o={id:a,sort:parseInt(e,10)};n.set(o,function(e){return e.error?(t.create("danger",e.msg||"操作失败"),!1):void t.create("success",e.msg||"修改成功")},function(e){t.create("danger",e.data.error)})},e.showMessage=function(){a.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}]).controller("collect.add",["$scope","$state","$stateParams","Flash","collectResource","rewardResource","collectConfigResource",function(e,t,a,o,s,n,r){r.get({id:a.id},function(t){var a=t.data;if(a.length)for(var o=0;o<a.length;o++)if("collect_list"==a[o].type){e.config_type=a[o].content.size;break}});var i=a.id,c=a.cid||0,l={};e.entity={sort:0},e.rewardList=[l],e.step=a.cid?2:1,i&&(c=i,s.getOne({id:i},function(t){t&&(e.entity=t,e.rewardList=t.reward)})),e.addReward=function(t){return t?(o.create("danger","请填写完整的回报信息"),!1):e.rewardList.length>9?(o.create("danger","最多只能添加10个回报"),!1):void e.rewardList.push({})},e.cancelReward=function(t){e.rewardList.splice(t,1)},e.setPostage=function(t,a){0==t&&(e.rewardList[a].postage=0)},e.textCount=function(e){return e&&e.replace(/\s/g,"").length||0},e.valided=!1,e.submitForm1=function(t){e.valided=!0,e.entity.id?s.update(e.entity,function(t){return e.valided=!1,t.status?(e.step=2,void(e.rewardList.length||(e.rewardList=[l]))):(e.error_field=t.field,o.create("danger",t.msg||"编辑失败"),!1)},function(t){e.valided=!1,o.create("danger",t.data.error)}):s.save(e.entity,function(t){return e.valided=!1,t.status?(e.step=2,void(c=t.result.id)):(e.error_field=t.field,o.create("danger",t.msg||"添加失败"),!1)},function(t){e.valided=!1,o.create("danger",t.data.error)})},e.submitForm2=function(a){if(e.valided=!0,!c)return!1;var s={cid:c,data:e.rewardList},r=!!e.rewardList[0].id;r?n.update(s,function(a){return e.valided=!1,a.status?void t.go("shop.apps.collect.list"):(o.create("danger",a.msg||"编辑失败"),!1)},function(t){e.valided=!1,o.create("danger",t.data.error)}):n.save(s,function(a){return e.valided=!1,a.status?void t.go("shop.apps.collect.list"):(o.create("danger",a.msg||"添加失败"),!1)},function(t){e.valided=!1,o.create("danger",t.data.error)})},e.editorOptions=angular.extend({},window._editorOptions,{extraPlugins:"uploadimage",height:"150px"})}]).controller("collect.config",["$scope","$timeout","$stateParams","Flash","designData","designValidate","collectResource","collectConfigResource",function(e,t,a,o,s,n,r,i){function c(){e.disabledBtn={status:!1,text:"保存"}}e.config={title:"人人众筹"},e.data=[],i.get({id:a.id},function(t){0==t.data.length?e.slices=[{content:{item_list:[{img:"/2016/4/19/fb0rlbrysnwaXz6qSWA8hTgHJyyv.jpg"}],style:8},type:"slide"},{content:{size:"big",number:6},type:"collect_list"}]:(e.slices=t.data,e.config.title=t.title,e.config.description=t.description,r.get(function(t){t.data.length>3&&(e.data=t.data.splice(0,3))})),angular.forEach(e.slices,function(t,a){"collect_list"==t.type&&e.editSlice(t)})}),e.icon_list=s.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=s.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.editSlice=function(a,o){angular.forEach(e.slices,function(e,t){e.class=!1}),a.class=!0,e.designs=a,t(function(){e.$broadcast("design_data",a),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.removeSlice=function(t){e.slices.splice(t,1),e.designs=!1},c(),e.save=function(){if(e.disabledBtn={status:!0,text:"保存中.."},0==e.slices.length)return o.create("danger","您还没拖动模块到手机！"),c(),!1;var t=angular.copy(e.slices);for(var a in t){var s=n[t[a].type](t[a].content);if(s)return e.editSlice(e.slices[a],s),c(),!1}e.config.data=t,i.update(e.config,function(e){return c(),e.error?(o.create("danger",s.msg),!1):void o.create("success"," 修改成功！")},function(e){c(),o.create("danger",e.data.error)})}}]).controller("collect.detail",["$scope","$stateParams","collectResource",function(e,t,a){e.paginationConf={currentPage:1,itemsPerPage:10},e.item={},a.getOne({id:t.id},function(t){e.item=t}),e.icon="down",e.switchBox=function(){e.icon="down"==e.icon?"up":"down"}}]).controller("collect.order_detail",["$scope","$stateParams","collectOrderOneResource",function(e,t,a){var o=t.id;e.item={},a.get({id:o},function(t){e.item=t})}]).controller("collect.reward_list",["$scope","$stateParams","Flash","collectResource","collectDelResource",function(e,t,a,o,s){o.getOne({id:t.id},function(t){e.is_publish=t.is_publish,e.reward=t.reward||[]}),e.removeReward=function(t,o){s.remove({id:t},function(t){return t.error?(a.create("danger",t.msg||"删除失败！"),!1):void e.reward.splice(o,1)},function(e){a.create("danger",e.data.error||"删除失败！")})}}]).controller("collect.detail_list",["$scope","$state","ngPopover","$stateParams","$modal","Flash","collectResource","collectOrderResource","orderQureyPay",function(e,t,a,o,s,n,r,i,c){e.rewardList=[],r.getOne({id:o.id},function(t){t.reward&&(e.rewardList=t.reward.map(function(e){return{amount:e.amount,id:e.id}}))}),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={id:o.id,status:"-1",reward_id:"0"};var l=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,i.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.orders=t.data})};e.$watch("paginationConf.currentPage",l),e.search=function(){e.searchInfo.export=0,1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.export=function(){e.searchInfo.export=1;var t=e.searchInfo,a="";for(var s in t)"id"!=s&&(a+=s+"="+t[s]+"&");a.length&&(a=a.substring(0,a.length-1)),window.location.href="/collect/orders/"+o.id+".json?"+a},e.sendGoods=function(e){var t=s.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/collect.delivery.html",controller:"collect.send",resolve:{item:function(){return e}}});t.result.then(function(){l()})},e.remarkInfo={cid:"",order_sn:"",shop_remark:""},e.set_remarkClick=function(t){e.remarkInfo.item=t,e.remarkInfo.cid=t.cid,e.remarkInfo.order_sn=t.order_sn,e.remarkInfo.shop_remark=t.shop_remark},e.remorkF={btn_text:"保存",btn_status:!1},e.set_remark=function(t){t&&(e.remorkF.btn_status=!0,e.remorkF.btn_text="保存中...",r.setRemarks(e.remarkInfo,function(t){e.remorkF.btn_status=!1,e.remorkF.btn_text="保存",t.status?(n.create("success","提交成功"),a.close(),e.remarkInfo.item.shop_remark=e.remarkInfo.shop_remark):n.create("danger","提交失败")}))},e.cancel=function(){a.close(),e.remarkInfo={cid:"",shop_remark:""}},e.expressSet=function(t,a,o){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},c.save(e.orderQureyData,function(e){if(e.status){s.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return o}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})},e.refund=function(e){if(!e)return!1;s.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/collect.refund.html",controller:"collect.refund",resolve:{data:function(){return e}}})}}]).controller("collect.progress",["$scope","$stateParams","Flash","collectProgressResource",function(e,t,a,o){o.get({id:t.id},function(t){e.progress=t});var s=function(t,s){o.remove({id:t},function(t){return t.error?(a.create("danger",t.msg||"删除失败！"),!1):void e.progress.speed.splice(s,1)},function(e){return a.create("danger",e.data.error),!1})};e.closeProgress=function(e,t){return!!e&&void(Utils.confirm("确定删除？")&&s(e,t))}}]).controller("collect.progress_add",["$scope","$state","$stateParams","$location","Flash","collectProgressResource",function(e,t,a,o,s,n){e.progress={imgs:[]},e.submit="保存",e.submitForm=function(o){if(o){if(0==e.progress.imgs.length)return s.create("danger","进展图片不能为空"),!1;e.submit="保存中…",e.disable=!0;var r={cid:a.id,pic:e.progress.imgs,content:e.progress.content};n.save(r,function(o){o.status||s.create("danger",o.msg||"添加失败"),e.disable=!1,e.submit="保存",s.create("success","添加成功"),t.go("shop.apps.collect.progress",{id:a.id})},function(e){s.create("danger",e.data.error)})}}}]).controller("collect.send",["$scope","$modalInstance","Flash","collectSendResource","getDelivery","item",function(e,t,a,o,s,n){n.reward=n.reward||{},e.goods_info={img:n.reward.pic,name:n.reward.name},e.address_info={addr:n.address,consignee:n.consignee,mobile:n.mobile},e.remark=n.remark,e.deliveryList=s.query(),e.deliveryInfo={type:0,isOther:0},e.set_delivery=function(t,a,o,s){e.deliveryInfo.isOther=t,e.deliveryInfo.otherName=o,0==t&&(e.deliveryInfo.id=a,e.deliveryInfo.name=o,e.deliveryInfo.code=s)},e.saveOrderDelivery=function(){var s={order_id:n.id,cid:n.cid,is_no_express:e.deliveryInfo.type,delivery_id:e.deliveryInfo.id||0,logis_code:e.deliveryInfo.code||"",logis_name:e.deliveryInfo.name,logis_no:e.deliveryInfo.number},r=/^[0-9]*[1-9][0-9]*$/;if(0==e.deliveryInfo.type)if(e.deliveryInfo.isOther)if(""!=e.deliveryInfo.name&&""!=e.deliveryInfo.number){if(!r.test(e.deliveryInfo.number))return a.create("danger","请输入正确的物流单号"),!1}else{if(""==e.deliveryInfo.name)return a.create("danger","请填写物流公司名称"),!1;if(""==e.deliveryInfo.number)return a.create("danger","请填写物流单号"),!1}else{if(!e.deliveryInfo.name)return a.create("danger","请输入物流名称"),!1;if(""==e.deliveryInfo.id||""==e.deliveryInfo.number)return a.create("danger","请填写物流信息"),!1;if(!r.test(e.deliveryInfo.number))return a.create("danger","请输入正确的物流单号"),!1}o.save(s,function(e){e.status&&(a.create("success","发货成功"),t.close())},function(e){return a.create("danger",e.data.error),!1})},e.cancel=function(){t.dismiss("cancel")}}]).controller("collect.express",["$scope","$modalInstance","$http","express",function(e,t,a,o){e.expressInfo=o,e.cancel=function(){t.dismiss("cancel")}}]).controller("collect.refund",["$scope","$modalInstance","Flash","data","collectRefundResource",function(e,t,a,o,s){e.refund=o.refund_reason,e.toRefund=function(){s.save({id:o.id},function(e){return e.error?(a.create("danger",e.msg),!1):(a.create("success","退款成功"),void t.close())},function(e){a.create("danger",e.data.error)})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/thirdapp.list",["apps/common/controllers/controllers"],function(e){e.controller("thirdapp.list",["$scope","Flash","thirdappResource","$modal","thirdappShowResource",function(e,t,a,o,s){e.type=0;var n=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.list({offset:(t.offset-1)*t.limit,limit:t.limit,type:e.type},function(t){e.paginationConf.totalItems=t._count,e.data=t}),s.get({offset:(t.offset-1)*t.limit,limit:t.limit,type:e.type},function(t){e.info=t})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.confirmAdd=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/thirdapp.modal.html",controller:"thirdappModelCtrl",resolve:{item:function(){return e}}});t.result.then(function(e){e&&n()})},e.edit=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/peerpay.modal.html",controller:"peerpayModelCtrl",resolve:{item:function(){return e}}});t.result.then(function(e){e&&n()})}}]).controller("thirdappModelCtrl",["$scope","Flash","thirdappResource","$modalInstance","item",function(e,t,a,o,s){a.get({id:s.id},function(t){e.data=t.data,e.data.is_add=s.is_add}),e.ok=function(){1==s.is_add?a.update(e.data,function(e){e.status?t.create("success",e.msg):t.create("danger",e.msg),o.close(1)},function(e){t.create("danger",e.data.error.message),o.dismiss("cancel")}):a.save(e.data,function(e){e.status?t.create("success",e.msg):t.create("danger",e.msg),o.close(1)},function(e){t.create("danger",e.data.error.message),o.dismiss("cancel")})},e.cancel=function(){o.dismiss("cancel")}}])}),define("apps/apps/controllers/guess",["apps/common/controllers/controllers"],function(e){e.controller("guess.list",["$scope","Flash","ngPopover","collectResource","collectCloseResource","collectSortResource","collectPublishResource","$modal","guessList","guessFinish","qrCode","videoAddress",function(e,t,a,o,s,n,r,i,c,l,d,p){e.videoAddress=p,e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={title:"",status:"all",start_time:"",end_time:""};var u=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,c.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.guessItems=t.data,e.qrcode=t.qrcode})};e.$watch("paginationConf.currentPage",u),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(e.searchInfo.dates=null,t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?u():e.paginationConf.currentPage=1},e.showWinnerList=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/guess_winner_list.html",controller:"guessWinnerListCtrl"});a._flag=e,a.id=t},e.finishGuess=function(e){l.close({id:e},function(e){e.status?(u(),t.create("success","已结束！")):t.create("danger","结束失败")},function(e){t.create("danger",e.data.error.message)})},e.showQrcode=function(t){d.get({id:t},function(t){e.qrcodeInfo=t})},e.copyMessage=function(){$("#urlInput").select(),document.execCommand("Copy"),t.create("success"," 复制成功！")}}]).controller("guessWinnerListCtrl",["$scope","$modalInstance","discountGoodsRes","tagResource","Flash","$state","bargainGoodsResource","pintuanGoodsResource","seckillGoodsResource","snatchGoodListRes","snatchGoodsResource","bangmianGoodsResource","guessWinnerList",function(e,t,a,o,s,n,r,i,c,l,d,p,u){e.paginationConf={currentPage:1,itemsPerPage:5},e.params={id:t.id};var m=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,u.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.winnerList=t.data},function(e){s.create("danger",e.data.error.message)})};e.$watch("paginationConf.currentPage",m),e.flag=t._flag,e._global=_global,e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/guess.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.guess.info",["$scope","guessList","$stateParams","Flash","$state","goodsResource",function(e,t,a,o,s,n){function r(e){e=e||[];for(var t={},a=0;a<e.length;a++){var o=e[a];"undefined"==typeof t[o]&&(t[o]=1)}e.length=0;for(var a in t)e[e.length]=a;return e}e.textCount=function(e){return e&&e.replace(/\s/g,"").length||0},e.data={},e.hideTemporary=[1,1,1,1,1,1,1,1],e.fixedTemporary=[0,1,1,1,1,1,1,1],e.pointTemporary=[1,1,1,1,1,1,1,1],a.id?(e.fixedTemporary=[1,1,1,1,1,1,1,1],e.title="编辑活动",e.hidechange=function(e){o.create("danger","隐藏助力数字和固定竞猜数字不可同时设置！")},e.jShidechange=function(e){o.create("danger","当前隐藏助力数字和固定竞猜数字未设置！")},e.data.guess_key="猜点",e.good={},t.getdetail({id:a.id},function(t){e.data=t,e.good.id=e.data.goods_id,e.good.img=e.data.goods_img,e.good.title=e.data.goods_title,e.good.stock=e.data.stock,e.good.price=e.data.price,0!=e.data.status?($("fieldset").attr("disabled","disabled"),e.is_disabled=!0):e.is_disabled=!1,e.data.fixed.length>0&&angular.forEach(e.data.fixed,function(t,a){0!=t&&e.fixedTemporary.splice(t-1,1,0)}),e.data.hide.length>0&&angular.forEach(e.data.hide,function(t,a){0!=t&&e.hideTemporary.splice(t-1,1,0);
}),e.data.point.length>0&&angular.forEach(e.data.point,function(t,a){0!=t&&e.pointTemporary.splice(t-1,1,0)})})):(e.btn_ct_status=1,e.title="新增竞猜",e.data.guess_key="猜点"),a.goods_id&&(e.data.hide=[],e.data.fixed=[],e.data.point=[],e.data.is_credit=0,e.hidechange=function(e){o.create("danger","隐藏助力数字和固定竞猜数字不可同时设置！")},e.jShidechange=function(e){o.create("danger","当前隐藏助力数字和固定竞猜数字未设置！")},n.get({id:a.goods_id},function(t){e.good=t})),e.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.btn_text="保存",e.submitForm=function(n){if(n){if(e.data.hide=[],e.data.fixed=[],e.data.point=[],angular.forEach(e.hideTemporary,function(t,a){if(0==t)return void e.data.hide.push(a+1)}),angular.forEach(e.fixedTemporary,function(t,a){if(0==t)return void e.data.fixed.push(a+1)}),angular.forEach(e.pointTemporary,function(t,a){if(0==t)return void e.data.point.push(a+1)}),r(e.data.hide),r(e.data.fixed),r(e.data.point),0==e.data.fixed.length)return o.create("danger","至少设置一个固定隐藏价格!"),!1;if(e.data.min_price<=0)return o.create("danger","竞猜区间最低价格必须大于零！"),!1;if(e.data.guess_count<=0)return o.create("danger","竞猜数量必须大于零！"),!1;if(e.data.cart_time<=0)return o.create("danger","猜中商品保留时间必须大于零！"),!1;e.btn_text="保存中...",e.form.$invalid=!0,e.good&&(e.data.goods_id=e.good.id,e.data.goods_img=e.good.img,e.data.goods_title=e.good.title),e.form.$invalid=!0,a.id?t.put({id:a.id},e.data,function(t){e.btn_text="保存",1==t.status&&(o.create("success","编辑成功！"),s.go("shop.apps.guess.list")),0==t.status&&o.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}):t.save(e.data,function(t){e.btn_text="保存",1==t.status&&(o.create("success"," 添加成功！"),s.go("shop.apps.guess.list")),0==t.status&&o.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)})}}}])}),define("apps/apps/controllers/guess.periods",["apps/common/controllers/controllers"],function(e){e.controller("guess.periods",["$scope","Flash","thirdappResource","$modal","guessPreiods","$stateParams","guessList",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={status:"all",id:n.id};var i=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.guessPreiods=t.data,e.qrcode=t.qrcode})};r.getdetail({id:n.id},function(t){e.startPrice=parseFloat(t.min_price).toFixed(2),e.endPrice=parseFloat(t.max_price).toFixed(2)}),e.$watch("paginationConf.currentPage",i),e.search=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.showWinner=function(e,t){var a=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/guess_winner_list.html",controller:"guessWinnerCtrl"});a._flag=e,a.id=t},e.checkPrice=function(t){return/^\d+(\.\d+)?$/.test(t)?parseFloat(t)>e.endPrice||parseFloat(t)<e.startPrice?"请在本次竞猜价格区间内("+e.startPrice+"一"+e.endPrice+")输入":void 0:"请输入数字,最多2位小数"},e.saveField=function(e,a,o){var n={id:o};n[e]=a,s.editPrice(n,function(e){i()},function(e){t.create("danger",e.data.error)})}}]).controller("guessWinnerCtrl",["$scope","$modalInstance","discountGoodsRes","tagResource","Flash","$state","bargainGoodsResource","pintuanGoodsResource","seckillGoodsResource","snatchGoodListRes","snatchGoodsResource","bangmianGoodsResource","guessWinner",function(e,t,a,o,s,n,r,i,c,l,d,p,u){u.get({id:t.id},function(t){e.winner=t},function(e){}),e.flag=t._flag,e._global=_global,e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/guess.periods_list",["apps/common/controllers/controllers"],function(e){e.controller("guess.periods_list",["$scope","Flash","thirdappResource","$modal","guessPreiodsList","$stateParams",function(e,t,a,o,s,n){e.getGuessId=function(t){var a=document.URL;e.guess_id=parseInt(a.split("=")[1])},e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={member_name:"",id:n.id,is_right:""};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.guessPreiodsList=t.data,e.qrcode=t.qrcode})};e.$watch("paginationConf.currentPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.showGuessRecord=function(e,t,a){var s=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/guess_winner_list.html",controller:"guessRecordCtrl"});s._flag=e,s.id=a,s.member_id=t},e.showHelper=function(e,t,a){var s=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/guess_winner_list.html",controller:"guessRecordCtrl"});s._flag=e,s.member_id=t,s.stage_id=a}}]).controller("guessRecordCtrl",["$scope","$modalInstance","discountGoodsRes","tagResource","Flash","$state","bargainGoodsResource","pintuanGoodsResource","seckillGoodsResource","snatchGoodListRes","snatchGoodsResource","bangmianGoodsResource","guessHelper","guessRecord",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m){e.flag=t._flag,e._global=_global,e.paginationConf={currentPage:1,itemsPerPage:5},e.params={};var g=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage;var a;"guessRecord"==t._flag?(a=m,e.params.id=t.id,e.params.member_id=t.member_id):(a=u,e.params.guess_stage_id=t.stage_id,e.params.id=t.member_id),a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.items=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",g),e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/article.manage",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.article.manage",["$scope","articleResource","Flash","ngPopover","$stateParams",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:10},t.qrCodes(function(t){e.qrCode=t.data,e.text_url=e.qrCode.code_url}),e.fallbacks=function(t){Utils.prompt("Press cmd+c to copy the text below.",e.text_url)};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._total,e.data=t.data},function(t){e.data=[],a.create("danger",t.data.error)})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.articleDelete=function(e){t.details({id:e},function(o){"0"==o.is_published?t.delete({id:e},function(e){1==e.status?(a.create("success",e.msg),n()):a.create("danger",e.msg)}):a.create("danger","已发布状态不允许删除")})},e.articleUp=function(e){t.upData({id:e},function(e){1==e.status?(a.create("success",e.msg),n()):a.create("danger",e.msg)})},e.articleSpread=function(e){t.spreadData({id:e},function(e){1==e.status?(a.create("success",e.msg),n()):a.create("danger",e.msg)})},e.articleTop=function(e,o){t.editTop({id:e,is_recommended:1-o},function(e){1==e.status?(a.create("success",e.msg),n()):a.create("danger",e.msg)})},e.integral={value:""},e.integral.type=0,e.integralId="",e.addIntegralId=function(t){e.integralId=t},e.addIntegral=function(){"number"==typeof e.integral.value?parseInt(e.integral.value)==e.integral.value?t.addScore({id:e.integralId,append_point:e.integral.value,type:e.integral.type},function(e){1==e.status?(a.create("success",e.msg),n(),o.close()):a.create("danger",e.msg)}):a.create("danger","请输入整数"):a.create("danger","请输入数字")},e.creditButInfo={text:"保存",disabled:!1},e.cancel=function(){o.close()}}]).controller("shop.apps.article.add",["$scope","articleResource","Flash","$state","$stateParams","tagResource","articleGoodsList","articleGoodsSelected","articleData","$timeout","designValidate",function(e,t,a,o,s,n,r,i,c,l,d){var p=function(e){return e&&e.replace(/\s/g,"").length||0},u=function(t){if("next"===t){if(0===e.slices.length)return a.create("danger","您还没拖动模块到手机！"),!1;var o=angular.copy(e.slices);for(var s in o){var n=d[o[s].type](o[s].content,e.data.title);if(n)return e.editSlice(e.slices[s],n),f(),!1}e.step=2}else e.step=1},m=function(t){e.slices.splice(t,1),e.design=!1},g=function(t,a){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,l(function(){e.$broadcast("design_data",t),angular.isUndefined(a)||e.$broadcast("design_dirty",a)},200)},f=function(){e.disabledBtnStatus=!1,s.id?e.disabledBtnText="修改":e.disabledBtnText="保存"},h=function(a){t.details({id:a},function(t){t&&(e.data=t,e.slices=t.data)})},_=function(){if(e.disabledBtnStatus=!0,s.id?e.disabledBtnText="修改中...":e.disabledBtnText="保存中...",e.config=e.data,0===e.slices.length)return a.create("danger","您还没拖动模块到手机！"),f(),!1;var n=angular.copy(e.slices);for(var r in n){var i=d[n[r].type](n[r].content,e.data.title);if(i)return e.editSlice(e.slices[r],i),f(),!1}e.config.data=n,s.id?(e.config.id=s.id,t.edit(e.config,function(e){return e.status?(a.create("success",e.msg||"修改成功!"),void o.go("shop.apps.article.manage")):(a.create("danger",e.msg||"修改失败!"),f(),!1)},function(e){a.create("danger",e.data.error.message),f()})):t.add(e.config,function(e){return e.status?(a.create("success",e.msg||"添加成功"),void o.go("shop.apps.article.manage")):(a.create("danger",e.msg||"添加失败"),f(),!1)},function(e){a.create("danger",e.data.error.message),f()})},v=function(a){return t.getTemplateComponent({id:a},function(t){e.data=t.data,e.data.is_spreaded="0",e.data.is_published="0",e.slices=t.data.component})},y=function(){s.id?(e.showTime=!0,h(s.id)):s.templateId?v(s.templateId):(e.slices=[{type:"tuiwen_title",icon:"fa fa-bold",name:"标题",content:{title_type:"1",date_type:"1",date:moment().format("YYYY-MM-DD")}}],e.config={},e.data={},e.data.is_spreaded="0",e.data.is_published="0"),e.step=1,e.icon_list=c.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=c.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},f(),e.editorOptions=angular.extend({},window._editorOptions,{extraPlugins:"uploadimage",height:"150px"})};e.stepChange=u,e.textCount=p,e.removeSlice=m,e.editSlice=g,e.submitForm=_,y()}])}),define("apps/apps/controllers/article.setting",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.article.setting",["$scope","articleSetting","Flash",function(e,t,a){e.data={},t.get(function(t){t.status&&(e.data=t.data)}),e.data.is_time_limited=0,e.startData=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],e.endData=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],e.save=function(o){if(1==e.data.is_time_limited){if(!e.data.start_time)return a.create("danger","请选择限制开始时段！"),!1;if(!e.data.end_time)return a.create("danger","请选择限制结束时段！"),!1}o&&t.update(e.data,function(e){e.status&&a.create("success",e.msg)})}}])}),define("apps/apps/controllers/article.accounts",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.article.accounts",["$scope",function(e){}])}),define("apps/apps/controllers/article.data",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("shop.apps.article.data",["$scope","$rootScope","$stateParams","articleStatDay","Flash",function(e,a,o,s,n){function r(e){if(l.clear(),e){var t={},a=[],o=[],s=[];angular.forEach(e.data,function(e,t){a.push(e.date),o.push(e.browse_count),s.push(e.browse_goods)}),t={tooltip:{trigger:"axis"},legend:{data:["展现量","点击量"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:a}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"展现量",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:o},{name:"点击量",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:s}]},l.setOption(t)}}function i(e){if(d.clear(),e){var t=[];amount_sum=[],angular.forEach(e.data,function(e,a){t.push(e.date),amount_sum.push(e.exchange_point)});var a={tooltip:{trigger:"axis"},legend:{data:["积分花费"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:t}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"积分花费",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:amount_sum}]};d.setOption(a)}}var c=o.id;e.article_id=c,e.forDate=function(e){a.date=e},a.ids=c;var l=t.init(document.getElementById("comission_chart")),d=t.init(document.getElementById("comission_cost"));s.query({id:c},function(t){e.articleDayInfo=t.total_count,r(t),i(t)}),e.paginationConfs={currentPage:1,itemsPerPage:10},e.searchInfo={id:c,days:"",startdate:"0",enddate:""};var p=function(){e.searchInfo.offset=(e.paginationConfs.currentPage-1)*e.paginationConfs.itemsPerPage,e.searchInfo.limit=e.paginationConfs.itemsPerPage,s.articleList(e.searchInfo,function(t){e.paginationConfs.totalItems=t._total,e.exchange_point=t.current_page.exchange_point,e.browse_count=t.current_page.browse_count,e.browse_goods=t.current_page.browse_goods,e.articleLists=t.data})};p(),e.$watch("paginationConfs.currentPage + paginationConfs.itemsPerPage",p),e.search={startdate:"0",enddate:"",days:""};var u=function(t){p(),e.search.id=c,s.query(e.search,function(t){r(t),i(t),e.articleDayInfo=t.total_count,e.data=t.data,e.qrcode=t.qrcode})};e.searchs=function(){$(".overview-name").removeClass("span_hover"),e.search.days="",e.searchInfo.days="",e.paginationConfs.currentPage=1;var t=$('input[name="settled_range"]').val();""!=t?(t=t.split("/"),e.search.startdate=t[0],e.search.enddate=t[1],e.searchInfo.startdate=t[0],e.searchInfo.enddate=t[1]):(e.search.startdate="",e.search.enddate="",e.searchInfo.startdate="",e.searchInfo.enddate=""),u()},e.searchFixed=function(t){$(".overview-name").removeClass("span_hover"),$(".selected"+t).addClass("span_hover"),e.search.days=t,e.searchInfo.days=t,e.search.enddate="",e.search.startdate="",e.paginationConfs.currentPage=1,$('input[name="settled_range"]').val(""),u()},e.export=function(){window.location.href="/article/export_graph/"+e.search.id+".json?days="+e.search.days+"&enddate="+e.search.enddate+"&startdate="+e.search.startdate,e.search.id=c},e.selectedIds=[],e.limit={limit_from:0,limit_to:5e3}}]).controller("shop.apps.article.list",["$scope","$rootScope","articleStatDay","articleResource","Flash","$stateParams",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={id:t.ids,day:t.date,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.detailsList(e.searchInfo,function(t){e.dataList=t.data,e.paginationConf.totalItems=t._total})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r)}])}),define("apps/apps/controllers/article.guider",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.article.guider",["$scope","articleResource","Flash","$stateParams",function(e,t,a,o){var s=o.id;e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:10,id:s};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.getGuider(e.searchInfo,function(t){e.paginationConf.totalItems=t._total,e.guiderData=t.data},function(t){e.data=[],a.create("danger",t.data.error)})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1}}])}),define("apps/apps/controllers/article.detail",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.article.detail",["$scope","articleResource","Flash","$stateParams",function(e,t,a,o){var s=o.article_id,n=o.member_id;e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={article_id:s,member_id:n,status:"0",start_date:"",end_date:""};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.getDetail(e.searchInfo,function(t){e.paginationConf.totalItems=t._total,e.detailData=t.data,e.qrcode=t.qrcode})};e.$watch("paginationConf.currentPage",r),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(e.searchInfo.dates=null,t=t.split("/"),e.searchInfo.start_date=t[0],e.searchInfo.end_date=t[1]):(e.searchInfo.start_date="",e.searchInfo.end_date=""),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/apps/controllers/game",["apps/common/controllers/controllers"],function(e){e.controller("game.info",["$scope","$sce",function(e,t){e.trustSrc=function(e){return t.trustAsResourceUrl(e)},e.gameURL={url:"https://www.rrdshang.com/games/index?uid="+_global.rrdshang_uid}}])}),define("apps/apps/controllers/pin.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pin.list",["$scope","$modal","$resource","Flash","$stateParams","$state","pinResource","pinMarket","ngPopover","pinCountList",function(e,t,a,o,s,n,r,i,c,l){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={sn_id:"",goodsName:"",activityName:"",status:s.status,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var d=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,r.query(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.skuList=[],e.set_type=function(t){e.searchInfo.type=t,1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:d()},r.pinQrcode(function(t){e.qrcode=t,e.copy_text=e.qrcode.url}),e.showMessage=function(){o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.confirmCloseLadder=function(e){r.closeLadder({id:e},function(e){e.success?(o.create("success","结束活动成功"),d()):o.create("danger","结束活动失败")})},e.showQrcode=function(t){r.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){c.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.getStock=function(e){i.getStock({id:e},function(e){t.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/pin.list.modal.html",controller:"pin.list.modal",resolve:{data:function(){return e},type:function(){return"stock"}}})})},e.getSurvey=function(e){i.getSurvey({id:e},function(e){t.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/pin.list.modal.html",controller:"pin.list.modal",resolve:{data:function(){return e},type:function(){return"survey"}}})})},e.getCountList=function(e){l.getList({id:e},function(e){t.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/pin.count.html",controller:"pin.list.count.modal",resolve:{data:function(){return e}}})})}}]),e.controller("pin.list.modal",["$scope","$modalInstance","data","type",function(e,t,a,o){e.info={data:a,type:o},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("pin.list.count.modal",["$scope","$modalInstance","data",function(e,t,a,o){e.data=a,e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/pin.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pin.info",["$scope","$stateParams","Flash","$state","pinResource","goodsResource","pinProps","pinGoodsData",function(e,t,a,o,s,n,r,i){function c(){if(!t.id){var o=[],s=!0;if(angular.forEach(e.data.pin_item,function(e,t){o.push(e.pin_num)}),o=o.sort(),angular.forEach(o,function(e,t){e==o[t+1]&&(s=!1)}),!s)return a.create("danger","拼团人数不能重复"),!1}return!0}function l(){if(t.id){if(e.info.title="编辑活动",!i.goods_id)return o.go("shop.apps.pin.edit",{step:1,goods_id:t.goods_id,id:t.id}),!1}else if(e.info.title="新增活动",!i.goods_id)return o.go("shop.apps.pin.add",{step:1,goods_id:t.goods_id}),!1;e.btnStatus={text:"保存",disabled:!1},e.bacthInfo={isOpenBatchPrice:!1,isOpenBatchLimit:!1},t.goods_id?(e.pinProps_goods_id=t.goods_id,r.get({goods_id:e.pinProps_goods_id},function(t){e.bacthInfo.is_sku=t.is_sku,t.is_sku?(e.goodsData=t.products,e.propsValue=t.goods_props,d(e.goodsData[0],e.propsValue)):e.goodsData=[t],p()})):(e.bacthInfo.is_sku=i.is_sku,i.is_sku?(i.ladderproducts=[],angular.forEach(i.products,function(e,t){length=i.ladder.length,(t+1)%length==0&&i.ladderproducts.push(e)}),angular.forEach(i.stock_info,function(e,t){i.ladderproducts[t].stock=e.stock,i.ladderproducts[t].max_stock=e.stock}),e.goodsData=i.ladderproducts,e.propsValue=i.goods_props,d(e.goodsData[0],e.propsValue)):(e.goodsData=[{product_price:""}],e.goodsData[0].is_sku=0,e.goodsData[0].stock_id=i.products[0].stock_id,e.goodsData[0].pin_price=i.products,e.goodsData[0].product_price=i.products[0].product_price,e.goodsData[0].stock=i.stock_info[0].stock,e.goodsData[0].max_stock=i.stock_info[0].stock,e.goodsData[0].limit_num=i.products[0].limit_num),p())}function d(t,a){e.propsNameArr={val:[]};var o=t.props.split(";"),s=[];angular.forEach(o,function(e,t){var a=e.split(":");s.push(a[0])}),angular.forEach(s,function(t,o){for(var s in a)t==s&&e.propsNameArr.val.push({id:s,name:a[s].name})})}function p(){angular.forEach(e.goodsData,function(a,o){e.bacthInfo.is_sku&&(a.props_arr=a.props_str.split(":"),a.props_detail_arr=a.props.indexOf(";")>-1?a.props.split(";"):[a.props],a.propsObj={},angular.forEach(a.props_detail_arr,function(e,t){var o=e.split(":"),s=o[0],n=o[1];a.propsObj[s]=n})),t.id?1==i.is_sku?(a.pin_price=[],length=i.ladder.length,angular.forEach(i.products.slice(o*length,length*(o+1)),function(e,t){a.pin_price.push({pin_num:e.cpeoples,price:e.ladder_price})})):(a.pin_price=[],angular.forEach(i.products,function(e,t){a.pin_price.push({pin_num:e.cpeoples,price:e.ladder_price})})):(a.pin_price=[],angular.forEach(i.pin_item,function(e,t){a.pin_price.push({pin_num:e.pin_num,price:null,expire_in:e.expire_in}),a.is_limit=0,a.activity_stock=a.stock}))})}e.info={step:t.step,title:""},e.btnStatus={text:"下一步",disabled:!1},1==e.info.step?(t.id?(e.info.title="编辑活动",s.get({id:t.id},function(t){e.data=t,e.data.pin_item=t.ladder})):(e.data={},angular.forEach(i.init(),function(t,a){e.data[a]=t}),e.info.title="新增活动",e.data.barrage=0,e.data.share_activity={name:"原价￥{{商品最高价}}，现价￥{{商品最低价}}起，参加“{{拼团活动名称}}”即可享受",msg:"活动商品数量有限，先到先得。"},e.data.share_detail={name:"我已经参加了“{{团长名称}}”发起的拼团。",msg:"凑足“{{拼团人数}}”人即可享受拼团优惠，我已经参加，你也来吧。"}),t.goods_id&&n.get({id:t.goods_id},function(t){e.good=t,e.data||(e.data={stock:t.stock,price:t.price})}),e.insertAtCaret=function(e,t){e="{"+e+"}";var a=$("."+t)[0];if(a.selectionStart||"0"==a.selectionStart){var o=a.selectionStart,s=a.selectionEnd,n=a.scrollTop;a.value=a.value.substring(0,o)+e+a.value.substring(s,a.value.length),a.focus(),a.selectionStart=o+e.length,a.selectionEnd=o+e.length,a.scrollTop=n}else a.value+=e,a.focus()},e.addPinItem=function(){return e.data.pin_item.length>=3?void a.create("danger","最多可设置3个阶梯价格!"):void e.data.pin_item.push({pin_num:null,expire_in:""})},e.removePinItem=function(t){e.data.pin_item.splice(t,1)},e.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate()-1;o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.submitForm=function(s){if(s&&c()){if(!$(".share_activity_name").val())return a.create("danger","活动分享标题不能为空"),$(".share_activity_name").focus(),!1;if(!$(".share_activity_msg").val())return a.create("danger","活动分享内容不能为空"),$(".share_activity_msg").focus(),!1;if(!$(".share_detail_name").val())return a.create("danger","活动详情分享标题不能为空"),$(".share_detail_name").focus(),!1;if(!$(".share_detail_msg").val())return a.create("danger","活动详情分享标题不能为空"),$(".share_detail_msg").focus(),!1;e.data.share_activity.name=$(".share_activity_name").val(),e.data.share_activity.msg=$(".share_activity_msg").val(),e.data.share_detail.name=$(".share_detail_name").val(),e.data.share_detail.msg=$(".share_detail_msg").val(),e.btnStatus={text:"下一步...",disabled:!0},e.good&&(e.data.goods_id=e.good.id,e.data.goods_img=e.good.img,e.data.goods_title=e.good.title),angular.forEach(e.data,function(e,t){i[t]=e}),t.id?(o.go("shop.apps.pin.edit",{step:2,goods_id:t.goods_id,id:t.id}),e.btnStatus={text:"保存",disabled:!1}):o.go("shop.apps.pin.add",{step:2,goods_id:t.goods_id})}}):(l(),e.pinSkuBatch=function(t,a){var o=e.goodsData[e.bacthInfo.openIndex].propsObj[a];angular.forEach(e.goodsData,function(s,n){if(s.propsObj[a]==o)switch(t){case"pin_price":s.pin_price.map(function(t,a){return t.price=e.bacthInfo.pin_price[a].price});break;case"activity_stock":s.activity_stock=e.bacthInfo.activity_stock;break;case"is_limit":s.is_limit=e.bacthInfo.is_limit}})},e.openSkuBatch=function(t){var a=e.goodsData[t],o=!1;angular.forEach(a.pin_price,function(e,t){e.price||(o=!0)}),e.bacthInfo.isOpenBatchPrice=!!o,e.bacthInfo.pin_price=a.pin_price,e.bacthInfo.activity_stock=a.activity_stock,e.bacthInfo.is_limit=a.is_limit,e.bacthInfo.openIndex=t},e.submitForm=function(n){e.btnStatus={text:"保存中...",disabled:!0},i.goods_setting=e.goodsData,t.id?s.update({id:t.id},i,function(t){e.btnStatus={text:"保存",disabled:!1},t.success?(a.create("success","保存成功"),o.go("shop.apps.pin.list",{status:"all"})):a.create("danger",t.error.message)},function(t){e.btnStatus={text:"保存",disabled:!1},a.create("danger",t.data.error.message)}):s.save(i,function(t){e.btnStatus={text:"保存",disabled:!1},t.success?(a.create("success","保存成功"),o.go("shop.apps.pin.list",{status:"all"})):a.create("danger",t.error.message)},function(t){e.btnStatus={text:"保存",disabled:!1},a.create("danger",t.data.error.message)})})}])}),define("apps/apps/controllers/pin.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pin.records",["$scope","$resource","Flash","$stateParams","pinRecords","pinResource","ngPopover",function(e,t,a,o,s,n,r){e.info=n.query({id:o.id}),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={member_name:"",status:"all",id:o.id,nums:"all",order_sn:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var i=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.searchInfo.startDate=t[0],e.searchInfo.endDate=t[1]):(e.searchInfo.startDate=null,e.searchInfo.endDate=null),e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.getList(e.searchInfo,function(t){e.paginationConf.totalItems=t._count;for(var a=0;a<t.data.length;a++)t.data[a].edit_at=!1;e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.showQrcode=function(t){n.getTuanDetail({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){r.close(),a.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.confirmDummy=function(e){s.ladderDummy({initiate_id:e},function(e){e.status?(a.create("success"," 设置成功！"),i()):a.create("danger",e.msg)})},e.confirmOver=function(e){s.overLadder({id:e},function(e){a.create("success"," 设置成功！"),i()},function(e){a.create("danger",e.msg)})},e.setAtInfo={id:"",at:"",butText:"保存",disabled:!1},e.clickPopover=function(t){e.setAtInfo.id=t},e.setOverTime=function(){return""==e.setAtInfo.at?(a.create("danger","请输入设置时间"),!1):(e.setAtInfo.butText="提交中",e.setAtInfo.disabled=!0,void s.setTime({id:e.setAtInfo.id,finished_at:e.setAtInfo.at},function(t){t.status?(e.cancel(),a.create("success"," 设置成功！"),i()):a.create("danger",t.msg),e.setAtInfo.id="",e.setAtInfo.butText="保存"}))},e.cancel=function(){r.close(),e.setAtInfo.id="",e.setAtInfo.butText="保存",e.setAtInfo.disabled=!1,e.setAtInfo.at=""}}])}),define("apps/apps/controllers/pin.configs",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pin.configs",["$scope","ngPopover","$resource","Flash","$stateParams","$modal",function(e,t,a,o,s,n){}]).controller("pinConfigCtrl",["$scope","$modalInstance","Flash","$state",function(e,t,a,o){}])}),define("apps/apps/controllers/pin.recordsdetails",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pin.recordsdetails",["$scope","$resource","Flash","$stateParams","pinRecords","pinResource",function(e,t,a,o,s,n){e.info=n.query({id:o.list_id}),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={nickname:"",order_sn:"",status:"all",id:o.id,nums:"all",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.getInitiateJoin(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/apps/controllers/pin.refund",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pin.refund",["$scope","ngPopover","$resource","Flash","$stateParams","$modal","pinRefund","paymentResource",function(e,t,a,o,s,n,r,i){e.payment=i.query(),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={tuan_id:s.pinId,initiate_id:s.pinInitiateId,payway:"",nickname:"",status:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var c=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,r.getList(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.search=function(){1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1}}])}),define("apps/apps/controllers/article.add.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("articleAddGoodsCtrl",["$scope","$modal",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.sortableOptions={cursor:"move",zIndex:99999},e.remove=function(t){e.content.goods.splice(t.$index,1)},e.add_goods=function(){var a=t.open({animation:!1,templateUrl:"assets/js/apps/design/templates/model_goods_list.html",controller:"modelGoodsCtrl"});a.result.then(function(t){"undefined"==typeof e.content.goods?e.content.goods=t:e.content.goods=e.content.goods.concat(t)})}}]).controller("modelGoodsCtrl",["$scope","$modalInstance","goodsResource","tagResource","Flash",function(e,t,a,o,s){function n(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),
e.tags.unshift(e.defaultTag)})}e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},n();var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){r()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",r()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/article.template_center.list.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.article.template_center.list.ctrl",["$scope","articleTemplateCenterResource","$modal",function(e,t,a){var o=this,s=function(e){a.open({templateUrl:"assets/js/apps/apps/templates/article.template_center.list.modal.html",controller:"article.template_center.list.modal.ctrl",controllerAs:"vm",resolve:{operation:function(){return{id:e}}}}).result.then()},n=function(){var e={title:o.query.title||null,keywords:[],stars:[],is_active:0},t=$('input[name="pubdate"]').val();return t&&(e.pubdate_start=t.split("/")[0],e.pubdate_end=t.split("/")[1]),angular.forEach(o.levels,function(t){t.checked&&e.stars.push(t.value)}),angular.forEach(o.tags,function(t){t.checked&&e.keywords.push(t.id)}),o.is_active&&(e.is_active=1),e.keywords=e.keywords.join(",")?e.keywords.join(","):null,e.stars=e.stars.join(",")?e.stars.join(","):null,e},r=function(e){var a=n();return a="search"==e?angular.extend(a,{offset:0,limit:o.paginationConf.itemsPerPage}):angular.extend(a,{offset:(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,limit:o.paginationConf.itemsPerPage}),t.getList(a,function(e){o.paginationConf.totalItems=e._total,o.data=e.data})},i=function(){return t.getTags(function(e){o.tags=e.data})},c=function(){i(),o.query={title:null},o.levels=[{name:"无评级",value:"0"},{name:"一星级",value:"1"},{name:"二星级",value:"2"},{name:"三星级",value:"3"},{name:"四星级",value:"4"},{name:"五星级",value:"5"},{name:"六星级",value:"6"}],o.paginationConf={currentPage:1,itemsPerPage:12},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",r)};o.openDetail=s,o.search=r,c()}])}),define("apps/apps/controllers/article.template_center.list.modal.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("article.template_center.list.modal.ctrl",["$scope","operation","articleTemplateCenterResource",function(e,t,a){var o=this,s=function(e){return a.getDetail({id:e},function(e){o.data=e.data,o.data.img=_global.url.ms+o.data.img})},n=function(){t.id&&s(t.id)};n()}])}),define("apps/apps/controllers/returncash.main.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("returncash.main.ctrl",["$scope","returncashResource","$modal","Flash","ngPopover","$state",function(e,t,a,o,s,n){var r=this,i=function(e){return r.qrcodeInfo={},t.getQrcodeById({id:e},function(e){r.qrcodeInfo=e})},c=function(e,t){return t?void o.create("warning","活动手动结束，数据不统计"):void n.go("shop.apps.returncash.statisticalData",{id:e})},l=function(){s.close(),o.create("success"," 复制成功！")},d=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},p=function(e){return t.endById({id:e},function(e){e.success?(o.create("success",e.msg||"结束成功"),h()):o.create("danger",e.msg||"结束失败")},function(e){o.create("danger",e.data.error.message)})},u=function(e){return t.deleteById({id:e},function(e){e.success?(o.create("success",e.msg||"删除成功"),h()):o.create("danger",e.msg||"删除失败")},function(e){o.create("danger",e.data.error.message)})},m=function(e){a.open({templateUrl:"assets/js/apps/apps/templates/returncash.stock.detail.modal.html",controller:"returncash.stock.detail.modal.ctrl",controllerAs:"vm",resolve:{operation:function(){return{inventory:e}}}})},g=function(e,t){if("credit.goods.add"==e&&0===_global.setting.credit_rule)return o.create("warning","请先在积分设置中填写默认积分抵扣比例"),!1;var s=a.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/bargain_goods_list.html",controller:"bargainGoodsModalCtrl"});s._skipTo=e,s._flag=t},f=function(){var e={id:r.query.id||null,goods_title:r.query.goods_title||null,title:r.query.title||null,status:r.type.value};return e},h=function(e){var a=f();return a.offset="search"==e?0:(r.paginationConf.currentPage-1)*r.paginationConf.itemsPerPage,a.limit=r.paginationConf.itemsPerPage,t.getList(a,function(e){e&&(r.paginationConf.totalItems=e._count,r.data=e.data)})},_=function(e){r.type!=e&&(r.type=e,h("search"))},v=function(){r.query={},r.paginationConf={currentPage:1,itemsPerPage:10,totalItems:1e4},r.statusTypes=[{name:"全部活动",value:"all"},{name:"未开始",value:"0"},{name:"活动中",value:"1"},{name:"已结束",value:"2"}],r.type=r.statusTypes[0],e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",h)};r.showQrcode=i,r.endActivity=p,r.deleteActivity=u,r.showStockDetail=m,r.add_goods=g,r.set_type=_,r.search=h,r.showMessage=l,r.fallback=d,r.viewStatisticalData=c,v()}])}),define("apps/apps/controllers/returncash.manage.ctrl",["apps/common/controllers/controllers","moment"],function(e,t){e.controller("returncash.manage.ctrl",["$scope","$stateParams","returncashManageResource","goodsResource","Flash","$timeout","$state","$filter",function(e,a,o,s,n,r,i,c){var l=this,d=function(e){return o.getDetail({id:e},function(e){l.data=e,l.data.created_range={startDate:t(e.start_time).format("YYYY-MM-DD HH:mm:ss"),endDate:t(e.end_time).format("YYYY-MM-DD HH:mm:ss")},l.good={id:e.goods_id,title:e.goods_title,stock:e.stock,price:e.price,img:e.goods_img},l.gradients=[{},{ladder:[{ladder_level:1,ladder_num:1,ladder_price:e.price}]},{ladder:[{ladder_level:1,ladder_num:1,ladder_price:e.price}]}],l.gradients[l.data.ladder_set].ladder=l.data.ladder_json;var a=e;l.bacthInfo.is_sku=e.is_sku,e.is_sku?(angular.forEach(a.products,function(e){angular.forEach(a.inventory,function(t){e.id==t.product_id&&(e.total_stock=t.total_stock,e.limit_num=t.limit_num)})}),l.goodsData=a.products,l.propsValue=a.goods_props,y(l.goodsData[0],l.propsValue)):l.goodsData=a.inventory,v()})},p=function(e){if("next"==e){var t=!0;angular.forEach(l.gradients[l.data.ladder_set].ladder,function(e,a){1*e.ladder_price>1*l.data.activity_price?function(){n.create("danger","活动阶梯价格不能大于活动购买价"),t=!1}:"",a>0&&!(1*e.ladder_num>1*l.gradients[l.data.ladder_set].ladder[a-1].ladder_num)&&(n.create("danger","第"+(a+1)+"阶梯"+(1==l.data.ladder_set?"人数":"销量")+"必须大于上一阶梯"+(1==l.data.ladder_set?"人数":"销量")),t=!1),a>0&&(1*e.ladder_price>1*l.gradients[l.data.ladder_set].ladder[a-1].ladder_price||1*e.ladder_price==1*l.gradients[l.data.ladder_set].ladder[a-1].ladder_price)&&(n.create("danger","第"+(a+1)+"阶梯价格必须小于上一阶梯价格"),t=!1)}),t&&(l.step=2)}else l.step=1},u=function(){if(l.gradients[l.data.ladder_set].ladder.length<5){if(!l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_num)return void n.create("danger","请先填写符合要求的第"+l.gradients[l.data.ladder_set].ladder.length+"阶梯的"+(1==l.data.ladder_set?"人数":"销量"));if(l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_num&&1e5==l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_num)return void n.create("danger","当前阶梯已达最大"+(1==l.data.ladder_set?"人数":"销量")+"限制，无法继续增加活动阶梯");if(!l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_price)return void n.create("danger","请先填写符合要求的第"+l.gradients[l.data.ladder_set].ladder.length+"阶梯的价格");if(l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_price&&.01==l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_price)return void n.create("danger","当前阶梯已达最小价格限制，无法继续增加活动阶梯");l.gradients[l.data.ladder_set].ladder.push({ladder_level:1,ladder_num:1*l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_num+1,ladder_price:(1*l.gradients[l.data.ladder_set].ladder[l.gradients[l.data.ladder_set].ladder.length-1].ladder_price-.01).toFixed(2)})}},m=function(e,t){l.gradients[l.data.ladder_set].ladder.length>1&&l.gradients[l.data.ladder_set].ladder.splice(t,1)},g=function(e){var t=l.goodsData[e],a=!1;l.bacthInfo.isOpenBatchPrice=!!a,l.bacthInfo.total_stock=t.total_stock,l.bacthInfo.limit_num=t.limit_num,l.bacthInfo.openIndex=e},f=function(e,t){var a=l.goodsData[l.bacthInfo.openIndex].propsObj[t];angular.forEach(l.goodsData,function(o,s){if(o.propsObj[t]==a)switch(e){case"activity_stock":o.total_stock=l.bacthInfo.total_stock;break;case"is_limit":o.limit_num=l.bacthInfo.limit_num}})},h=function(){angular.forEach(l.gradients[l.data.ladder_set].ladder,function(e,t){e.ladder_level=t+1});var e={goods_id:l.good.id,title:l.data.title,intro:l.data.intro,activity_price:l.data.activity_price,ladder_set:l.data.ladder_set,ladder_item:l.gradients[l.data.ladder_set].ladder,join_sum:l.data.join_sum,is_show_ladder:l.data.is_show_ladder,slogan:l.data.slogan||"该商品正在优惠促销，参与购买更优惠！",share_title:l.data.share_title||l.good.title,share_pic:l.data.share_pic||l.good.img,share_desc:l.data.share_desc||"参与越多返现越多，活动商品数量有限，先到先得",stock_item:l.goodsData};return e},_=function(){l.btnInfo.disabled=!0;var e=h(),s=$('input[name="created_range"]').val();return""==s?void n.create("danger","请选择活动时间"):(e.start_time=t(l.data.created_range.startDate).format("YYYY-MM-DD HH:mm:ss"),e.end_time=t(l.data.created_range.endDate).format("YYYY-MM-DD HH:mm:ss"),a.id?(l.btnInfo.text="修改中...",2==a.status?(n.create("danger","活动已结束，不能修改"),l.btnInfo.disabled=!1,void(l.btnInfo.text="修改")):(e.id=a.id,o.update(e,function(e){e.success?(n.create("success",e.msg||"修改成功！"),i.go("shop.apps.returncash.main")):(n.create("success",e.msg||"修改失败！"),l.btnInfo.disabled=!1,l.btnInfo.text="修改")},function(e){n.create("danger",e.data.error.message),l.btnInfo.disabled=!1,l.btnInfo.text="修改"}))):(l.btnInfo.text="保存中...",o.save(e,function(e){e.success?(n.create("success",e.msg||"保存成功！"),i.go("shop.apps.returncash.main")):(n.create("success",e.msg||"保存失败！"),l.btnInfo.disabled=!1,l.btnInfo.text="保存")},function(e){n.create("danger",e.data.error.message),l.btnInfo.disabled=!1,l.btnInfo.text="保存"})))},v=function(){angular.forEach(l.goodsData,function(e,t){l.bacthInfo.is_sku&&(e.props_arr=e.props_str.split(":"),e.props_detail_arr=e.props.indexOf(";")>-1?e.props.split(";"):[e.props],e.propsObj={},angular.forEach(e.props_detail_arr,function(t,a){var o=t.split(":"),s=o[0],n=o[1];e.propsObj[s]=n}))})},y=function(e,t){l.propsNameArr={val:[]};var a=e.props.split(";"),o=[];angular.forEach(a,function(e,t){var a=e.split(":");o.push(a[0])}),angular.forEach(o,function(e,a){for(var o in t)e==o&&l.propsNameArr.val.push({id:o,name:t[o].name})})},b=function(e){return o.getGoodsProps({id:e},function(e){l.bacthInfo.is_sku=e.is_sku,e.is_sku?(l.goodsData=e.products,l.propsValue=e.goods_props,y(l.goodsData[0],l.propsValue)):l.goodsData=[e],v()})},k=function(e){return Math.min(l.gradients[l.data.ladder_set].ladder[e-1].ladder_price-.01,1*l.data.activity_price).toFixed(2)},P=function(){return 1==a.status||2==a.status},w=function(){r(function(){l.gradients=[{},{ladder:[{ladder_level:1,ladder_num:1,ladder_price:l.data.activity_price}]},{ladder:[{ladder_level:1,ladder_num:1,ladder_price:l.data.activity_price}]}]},0)},D=function(){l.data={created_range:{startDate:null,endDate:null}},l.options={applyClass:"btn-green",timePicker:!0,timePickerIncrement:!0,timePicker24Hour:!0,timePickerSeconds:!0,format:"YYYY-MM-DD HH:mm:ss",locale:{format:"YYYY-MM-DD HH:mm:ss"},ranges:{}},l.step=1,l.bacthInfo={isOpenBatchPrice:!1,isOpenBatchLimit:!1},a.id?(l.btnInfo={text:"修改",disabled:!1},d(a.id)):(l.btnInfo={text:"保存",disabled:!1},l.data={ladder_set:"1",is_show_ladder:"1",join_sum:"1",created_range:{startDate:t(),endDate:t().add(1,"days")}}),a.goods_id&&(s.get({id:a.goods_id},function(e){l.good=e,a.id||(l.data.activity_price=l.good.price,l.data.share_pic=l.good.img,l.data.is_sku=l.good.is_sku,l.data.price=l.good.price,l.gradients=[{},{ladder:[{ladder_level:1,ladder_num:1,ladder_price:l.good.price}]},{ladder:[{ladder_level:1,ladder_num:1,ladder_price:l.good.price}]}])}),b(a.goods_id))};l.addGradient=u,l.removeGradient=m,l.stepChange=p,l.batchOperationCheck=f,l.batchOperation=g,l.submit=_,l.canEdit=P,l.getMax=k,l.changed=w,D()}])}),define("apps/apps/controllers/returncash.statisticalData.ctrl",["apps/common/controllers/controllers","echarts"],function(e,t){e.controller("returncash.statisticalData.ctrl",["$scope","returncashStatisticaldataResource","$stateParams",function(e,a,o){var s=this,n=t.init(document.getElementById("lineChart1")),r=t.init(document.getElementById("lineChart2"));n.showLoading({text:"数据读取中....",effect:"spin"}),r.showLoading({text:"数据读取中....",effect:"spin"});var i={tooltip:{trigger:"item",formatter:"{b}: {c}"},legend:{orient:"horizontal",x:"center",y:"bottom",data:[]},toolbox:{},series:[{name:"",type:"pie",radius:"50%",center:["50%","50%"],itemStyle:{normal:{label:{show:!0,position:"",formatter:"{b}\n{c}",textStyle:{fontSize:12}},labelLine:{show:!0,length:15}}},data:[]}]},c=function(){if(s.data.order_members||s.data.refund_members){var e=angular.copy(i);e.legend.data=e.legend.data.concat("实际付款人数","退款人数"),e.series[0].data=e.series[0].data.concat({value:s.data.order_members,name:"实际付款人数"},{value:s.data.refund_members,name:"退款人数"}),n.hideLoading(),n.setOption(e)}if(s.data.order_quantities||s.data.refund_quantities){var t=angular.copy(i);t.legend.data=t.legend.data.concat("实际商品购买量","商品退款量"),t.series[0].data=t.series[0].data.concat({value:s.data.order_quantities,name:"实际商品购买量"},{value:s.data.refund_quantities,name:"商品退款量"}),r.hideLoading(),r.setOption(t)}},l=function(e){return a.get({id:e},function(e){s.data=e.data,c()})},d=function(){o.id&&l(o.id)};d()}])}),define("apps/apps/controllers/returncash.stock.detail.modal.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("returncash.stock.detail.modal.ctrl",["$scope","operation","returncashResource",function(e,t,a){var o=this,s=function(){t.inventory&&(o.inventory=t.inventory)};s()}])}),define("apps/apps/controllers/returencash.activerecord.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("returencash.activerecord",["$scope","returncashActiverecordResource","$stateParams","Flash",function(e,t,a,o){var s=this,n=function(){var e={id:a.id||null,return_status:s.query.return_status,member_id:s.query.member_id,order_sn:s.query.order_sn,pay_status:s.query.pay_status,return_sn:s.query.return_sn};return e},r=function(e){var a=n();return a.offset="search"==e?0:(s.paginationConf.currentPage-1)*s.paginationConf.itemsPerPage,a.limit=s.paginationConf.itemsPerPage,t.getList(a,function(e){s.paginationConf.totalItems=e._count,s.data=e.data})},i=function(e){return t.manualRemit({id:e},function(e){e.status?(o.create("success",e.msg),r()):(o.create("danger",e.msg),r())})},c=function(){s.query={return_status:s.return_status_types[0].value,pay_status:s.pay_status_types[0].value}},l=function(){s.query={},s.paginationConf={currentPage:1,itemsPerPage:10,totalItems:1e3},s.return_status_types=[{label:"全部",value:"all"},{label:"未返现",value:0},{label:"已返现",value:1},{label:"返现失败",value:2}],s.pay_status_types=[{label:"全部",value:"all"},{label:"已支付",value:1},{label:"未支付",value:0},{label:"部分退款",value:403},{label:"已退款",value:404},{label:"申请退款",value:402}],s.query.return_status=s.return_status_types[0].value,s.query.pay_status=s.pay_status_types[0].value,e.$watch("vm.paginationConf.currentPage",r)};s.search=r,s.reset=c,s.manualRemit=i,l()}])}),define("apps/apps/controllers/activity",["apps/common/controllers/controllers"],function(e){e.controller("activity.info",["$scope","$sce",function(e,t){e.trustSrc=function(e){return t.trustAsResourceUrl(e)},e.activiryURL={url:"https://www.rrdshang.com/games/main?uid="+_global.rrdshang_uid}}])}),define("apps/apps/controllers/combomenu",["apps/common/controllers/controllers"],function(e){e.controller("combomenu",["$scope","Flash","comboResource","$modal","ngPopover",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={keywords:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.search=function(t){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.showMessage=function(){s.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.showQrcode=function(t){a.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.comboDelete=function(e){a.delete({id:e},function(e){e.success?(n(),t.create("success"," 删除成功！")):t.create("danger",e.error_msg)})},e.comboSwitch=function(e,o){a.switch({id:e,disabled:o},function(e){1==e.status?(t.create("success",e.msg),n()):t.create("danger",e.msg)})}}])}),define("apps/apps/controllers/combomenu.add",["apps/common/controllers/controllers"],function(e){e.controller("combomenu.add",["$scope","Flash","comboResource","$modal","$stateParams","$rootScope","$timeout","$state",function(e,t,a,o,s,n,r,i){function c(){var t=0;n.comboTotal=t,angular.forEach(e.combo.goods,function(e){t+=Number(parseFloat(e.price))}),n.comboTotal=t}s.id?(e.combo_title="修改搭配套餐",a.update({id:s.id},function(t){e.combo=e.combo={combo_name:t.data.combo_name,goods:t.data.goods,decription:t.data.decription,discount_enabled:t.data.discount_enabled,coupon_enabled:t.data.coupon_enabled,combo_price:t.data.combo_price};var a=t.data.description;$("textarea").text(a)}),n.combo_init=1,e.comboEdit=!1,r(function(){c()},500)):(e.combo_title="新增搭配套餐",e.combo={combo_name:"",discount_enabled:1,coupon_enabled:1,combo_price:"",decription:"搭配购买更优惠~{{搭配套餐名称}}{{搭配套餐一口价}}",goods:[]},n.combo_init=0,e.comboEdit=!0),e.selectGoods=function(a){var s=[];e.combo.goods.length>0&&(s=e.combo.goods.map(function(e){return e.id}));var n=o.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/combomenu.addproduct.html",controller:"combomenu.addproduct",resolve:{type:function(){return a},selectIds:function(){return s}}});n.result.then(function(a){if(angular.forEach(a,function(t,a){e.combo.goods.push(t),c()}),e.combo.goods.length>5)return t.create("danger","最多搭配5组商品"),!1})},e.cancelGoods=function(t){var a=0;n.comboTotal=a,e.combo.goods.splice(t,1),0==e.combo.goods.length&&(n.combo_init=0),angular.forEach(e.combo.goods,function(e){a+=Number(parseFloat(e.price))}),n.comboTotal=a},e.btn_text="保存",e.submitForm=function(o){if(o)if(s.id){var n=$("textarea").val(),r={combo_name:e.combo.combo_name,discount_enabled:e.combo.discount_enabled,coupon_enabled:e.combo.coupon_enabled,combo_price:e.combo.combo_price,decription:n};a.update({id:s.id},r,function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("success"," 修改搭配套餐成功！"),i.go("shop.apps.combomenu.list")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)})}else{if(0==e.combo.goods.length)return t.create("danger","至少选择一个搭配商品"),!1;if(e.combo.goods.length<2)return t.create("danger","至少搭配2组商品"),!1;if(e.combo.goods.length>5)return t.create("danger","最多搭配5组商品"),!1;var c=[];angular.forEach(e.combo.goods,function(e){new_c=e.id,c.push({goods_id:new_c})});var n=$("textarea").val(),r={combo_name:e.combo.combo_name,discount_enabled:e.combo.discount_enabled,coupon_enabled:e.combo.coupon_enabled,combo_price:e.combo.combo_price,decription:n,goods:c};a.add(r,function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("success","新增搭配套餐成功！"),i.go("shop.apps.combomenu.list")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)})}}}]).controller("combomenu.addproduct",["$scope","$modalInstance","comboResource","tagResource","Flash","$state","type","selectIds","$rootScope",function(e,t,a,o,s,n,r,i,c){function l(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.selectIds=i,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,type:16,column:"csale",direction:"desc"};var d=0;l();var p=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id),e.invalid_btn="已参加",a.goods(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data,e.selected=[]})};e.search=function(){1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",p),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",p()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?angular.forEach(e.goods,function(t,a){if(1==t.has_recode){if(5==t.combomenu_recode)return!1}else e.selected.push(t)}):e.selected=[]}),e.ok=function(){t.close(e.selected),c.combo_init=1,angular.forEach(e.selected,function(e){d+=Number(parseFloat(e.price))}),c.comboTotal=d},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/combomenu.comboinfo",["apps/common/controllers/controllers"],function(e){e.controller("combomenu.comboinfo",["$scope","Flash","comboResource","$modal","$stateParams",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={id:s.id,member_account:"",order_sn:"",type:"all",startDate:"",endDate:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:"desc"};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage;var t=$('input[name="created_range"]').val(),o=t.split("/");e.searchInfo.startDate=o[0],e.searchInfo.endDate=o[1],a.order(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.sort=function(t){"asc"==t?e.searchInfo.sort="desc":e.searchInfo.sort="asc",n()},e.export=function(){var a=s.id,o="/combomenu/combo_menu_order/"+a+".json?export=1";angular.forEach(e.searchInfo,function(e,t){e&&(o+="&"+t+"="+e)}),window.location.href=o,t.create("success","正在导出,请等待...")}}])}),define("apps/apps/controllers/pack.form",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pack.form",["$scope","ngPopover","$resource","packResource","Flash","$modal","$state","$stateParams",function(e,t,a,o,s,n,r,i){e.info={title:"",start_at:"",price:"",quantity:"",description:"打个包把商品一起带回家~购买{{打包件数}}件{{一口价}}",discount_enabled:0,goods:[]},e.count={price:0},e.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),i.id?(e.head_title="编辑打包购",o.getInfo({id:i.id},function(t){e.info=t,angular.forEach(t.goods,function(t,a){e.count.price+=parseFloat(t.price)}),e.count.price=parseFloat(e.count.price).toFixed(2)})):e.head_title="新增打包购",e.selectGoods=function(t){var a=[];e.info.goods.length>0&&(a=e.info.goods.map(function(e){return e.id}));var o=n.open({animation:!1,templateUrl:"assets/js/apps/apps/templates/get.goods.list.html",controller:"get.goods.list.ctrl",resolve:{type:function(){return t},selectIds:function(){return a}}});o.result.then(function(t){e.count.price=0,angular.forEach(t,function(t,a){e.info.goods.push(t)}),angular.forEach(e.info.goods,function(t,a){e.count.price+=parseFloat(t.price)}),e.count.price=parseFloat(e.count.price).toFixed(2)})},e.cancelGoods=function(t){e.count.price=0,e.info.goods.splice(t,1),angular.forEach(e.info.goods,function(t,a){e.count.price+=parseFloat(t.price)}),e.count.price=parseFloat(e.count.price).toFixed(2)},e.btn_text="保存",e.submitForm=function(t){if($("#add_goods").next(".custom-required-error-info").remove(),0==e.info.goods.length)s.create("danger","至少选择两个活动商品");else if(t)if(i.id)e.btn_text="保存中...",e.form.$invalid=!0,o.putPackPurchase({id:i.id},{id:e.info.id,price:e.info.price,quantity:e.info.quantity,start_at:e.info.start_at,title:e.info.title,description:e.info.description,disabled:e.info.disabled,discount_enabled:e.info.discount_enabled,goods:e.info.goods},function(t){e.btn_text="保存",e.form.$invalid=!1,t.status?(s.create("success"," 修改成功！"),r.go("shop.apps.pack.list")):(e.form.$invalid=!1,s.create("danger",t.msg||" 编辑失败！"))},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.error.message)});else{if(e.info.goods.length<2)return s.create("danger","至少选择两个活动商品"),!1;if($("input[name='quantity']").val()<2)return s.create("danger","打包件数至少两件"),!1;e.btn_text="保存中...",e.form.$invalid=!0,o.postPackPurchase(e.info,function(t){e.btn_text="保存",e.form.$invalid=!1,t.status?(s.create("success"," 保存成功！"),r.go("shop.apps.pack.list")):(e.form.$invalid=!1,s.create("danger",t.msg||" 保存失败！"))},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.error.message)})}}}])}),define("apps/apps/controllers/pack.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pack.list",["$scope","ngPopover","$resource","packResource","Flash",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",column:"",direction:""},e.sorting={price:"",quantity:""};var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})},r=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:n()};e.search=function(){r()},e.nameSearch=function(){""==$("input[name='title']").val()&&r()},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),n()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.over=function(t,a){o.over({id:a.id},function(a){a.status&&(s.create("success","已结束！"),e.data[t].disabled=1)},function(e){s.create("danger",e.data.error.message)})},e.del=function(e,t){o.delete({id:t.id},function(e){e.status?(s.create("success","删除成功"),r()):s.create("danger",e.msg||"删除失败")},function(e){s.create("danger",e.data.error.message)})},e.showQrcode=function(t){o.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){t.close(),s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/apps/controllers/pack.order",["apps/common/controllers/controllers"],function(e){e.controller("shop.apps.pack.order",["$scope","$filter","ngPopover","Flash","packResource","$modal","$stateParams",function(e,t,a,o,s,n,r){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={id:r.id,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_sn:"",member_account:"",status:"all",direction:"",startFinishDate:"",endFinishDate:""};var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.getOrders(e.params,function(t){e.paginationConf.totalItems=t._count,e.orders=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startFinishDate=t[0],e.params.endFinishDate=t[1]):(e.params.startFinishDate="",e.params.endFinishDate=""),1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.sort=function(t){"asc"==t?e.params.direction="desc":e.params.direction="asc",i()},e.export=function(){var e=r.id,t="/pack_purchase/orders/"+e+".json?export=1",a=$('input[name="created_range"]').val();""!=a&&(a=a.split("/"),t+="&startFinishDate="+a[0]+"&endFinishDate="+a[1]),window.location.href=t,o.create("success","正在导出,请等待...")}}])}),define("apps/apps/controllers/get.goods.list.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("get.goods.list.ctrl",["$scope","$modalInstance","discountGoodsRes","tagResource","Flash","$state","type","selectIds",function(e,t,a,o,s,n,r,i){function c(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.selectIds=i,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,type:r,column:"csale",direction:"desc"},c();var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id),e.invalid_btn="已参加",a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data,e.selected=[]})};e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",l()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?angular.forEach(e.goods,function(t,a){0==t.has_recode&&e.selected.push(t)}):e.selected=[]}),e.ok=function(){t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/apps/controllers/_base",["apps/apps/controllers/peerpay.list","apps/apps/controllers/bargain.list","apps/apps/controllers/bargain.goods.ctrl","apps/apps/controllers/bargain.info","apps/apps/controllers/bargain.starts","apps/apps/controllers/bargain.records","apps/apps/controllers/bargain.configs","apps/apps/controllers/pintuan.list","apps/apps/controllers/pintuan.info","apps/apps/controllers/pintuan.records","apps/apps/controllers/pintuan.details","apps/apps/controllers/pintuan.configs","apps/apps/controllers/pintuan.refund","apps/apps/controllers/snatch.config","apps/apps/controllers/snatch.detail","apps/apps/controllers/snatch.info","apps/apps/controllers/snatch.list","apps/apps/controllers/auction.list","apps/apps/controllers/auction.add","apps/apps/controllers/auction.records","apps/apps/controllers/auction.detail.records","apps/apps/controllers/auction.finished","apps/apps/controllers/auction.covers","apps/apps/controllers/auction.bond","apps/apps/controllers/auction.copy","apps/apps/controllers/auction.refund","apps/apps/controllers/collect","apps/apps/controllers/thirdapp.list","apps/apps/controllers/guess","apps/apps/controllers/guess.info","apps/apps/controllers/guess.periods","apps/apps/controllers/guess.periods_list","apps/apps/controllers/article.manage","apps/apps/controllers/article.setting","apps/apps/controllers/article.accounts","apps/apps/controllers/article.data","apps/apps/controllers/article.guider","apps/apps/controllers/article.detail","apps/apps/controllers/game","apps/apps/controllers/pin.list","apps/apps/controllers/pin.info","apps/apps/controllers/pin.records","apps/apps/controllers/pin.configs","apps/apps/controllers/pin.recordsdetails","apps/apps/controllers/pin.refund","apps/apps/controllers/article.add.goods.ctrl","apps/apps/controllers/article.template_center.list.ctrl","apps/apps/controllers/article.template_center.list.modal.ctrl","apps/apps/controllers/returncash.main.ctrl","apps/apps/controllers/returncash.manage.ctrl","apps/apps/controllers/returncash.statisticalData.ctrl","apps/apps/controllers/returncash.stock.detail.modal.ctrl","apps/apps/controllers/returencash.activerecord.ctrl","apps/apps/controllers/activity","apps/apps/controllers/combomenu","apps/apps/controllers/combomenu.add","apps/apps/controllers/combomenu.comboinfo","apps/apps/controllers/pack.form","apps/apps/controllers/pack.list","apps/apps/controllers/pack.order","apps/apps/controllers/get.goods.list.ctrl"],function(){}),
define("apps/apps/directives/countDown",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("countDown",[function(){return{require:"?ngModel",restrict:"AE",replace:!0,scope:{date:"@"},template:'<span style="color:red;"></span>',link:function(e,t,a){function o(){var e=new Date(a.date),s=new Date,n=Math.round((e-s)/1e3),r=parseInt(n/24/3600),i=parseInt(n%86400/3600),c=parseInt(n%3600/60),l=n%60;if(n<0)return void t.html("已结束");var d="";if(r>0){var p=r<10?"0"+r+"天":r+"天";d+=p}var u=i<10?"0"+i+"小时":i+"小时",n=c<10?"0"+c+"分":c+"分",m=l<10?"0"+l+"秒":l+"秒";t.html(d+u+n+m),setTimeout(o,1e3)}o()}}}])}),define("apps/apps/directives/_base",["apps/apps/directives/countDown"],function(){}),define("apps/apps/main",["apps/apps/states/_base","apps/apps/services/_base","apps/apps/controllers/_base","apps/apps/directives/_base"],function(){}),define("apps/guider/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider",{abstract:!0,url:"/guider",templateUrl:"assets/js/apps/guider/templates/layout.html"}).state("guider.dashboard",{url:"",templateUrl:"assets/js/apps/guider/templates/dashboard.html",controller:"guider.dashboard"})}])}),define("apps/guider/states/order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.order",{url:"/order",templateUrl:"assets/js/apps/guider/templates/order.html",controller:"guider.order"})}])}),define("apps/guider/states/orderreports",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.reports",{url:"/order/reports",templateUrl:"assets/js/apps/guider/templates/order.reports.html",controller:"guider.order.reports"})}])}),define("apps/guider/states/guider",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.guider",{abstract:!0,url:"/guider",templateUrl:"assets/js/apps/guider/templates/guider.tab.html",controller:["$scope","videoAddress",function(e,t){e.videoAddress=t}]}).state("guider.guider.member",{url:"",templateUrl:"assets/js/apps/guider/templates/guider.member.html",controller:"guider.guider.member"}).state("guider.guider.level",{url:"/level",templateUrl:"assets/js/apps/guider/templates/guider.level.html",controller:"guider.guider.level"}).state("guider.guider.locking",{url:"/locking/:id",templateUrl:"assets/js/apps/guider/templates/guider.locking.html",controller:"guider.guider.locking"}).state("guider.guider.commission",{url:"/commission/:id/:status",templateUrl:"assets/js/apps/guider/templates/guider.commission.html",controller:"guider.guider.commission"})}])}),define("apps/guider/states/sixsetting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.six_setting",{abstract:!0,url:"/six_setting",templateUrl:"assets/js/apps/guider/templates/six_setting.tab.html"}).state("guider.six_setting.goods",{url:"/goods",templateUrl:"assets/js/apps/guider/templates/six_setting.goods.html",controller:"guider.sixsetting.goods"}).state("guider.six_setting.base",{url:"/base",templateUrl:"assets/js/apps/guider/templates/six_setting.base.html",controller:"guider.sixsetting.base"}).state("guider.six_setting.level",{url:"/level",templateUrl:"assets/js/apps/guider/templates/six_setting.level.html",controller:"guider.six_setting.level"}).state("guider.six_setting.balance",{url:"/balance",templateUrl:"assets/js/apps/guider/templates/six_setting.balance.html",controller:"guider.six_setting.balance"})}])}),define("apps/guider/states/settled",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.settled",{url:"/settled",templateUrl:"assets/js/apps/guider/templates/settled.html",controller:"guider.settled"})}])}),define("apps/guider/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.setting",{abstract:!0,url:"/setting",templateUrl:"assets/js/apps/guider/templates/setting.tab.html"}).state("guider.setting.goods",{url:"/goods",templateUrl:"assets/js/apps/guider/templates/setting.goods.html",controller:"guider.setting.goods"}).state("guider.setting.base",{url:"/base",templateUrl:"assets/js/apps/guider/templates/setting.base.html",controller:"guider.setting.base"}).state("guider.setting.template",{url:"/template",templateUrl:"assets/js/apps/guider/templates/setting.template.html",controller:"guider.setting.template"}).state("guider.setting.repurchase",{url:"/repurchase",templateUrl:"assets/js/apps/guider/templates/setting.repurchase.html",controller:"guider.setting.repurchase"}).state("guider.setting.credit",{url:"/credit",templateUrl:"assets/js/apps/guider/templates/setting.credit.html",controller:"guider.setting.credit"})}])}),define("apps/guider/states/hero",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.hero",{abstract:!0,url:"/hero",templateUrl:"assets/js/apps/guider/templates/hero.tab.html"}).state("guider.hero.setting",{url:"/setting",templateUrl:"assets/js/apps/guider/templates/hero.setting.html",controller:"guider.hero.setting"}).state("guider.hero.list",{url:"/list",templateUrl:"assets/js/apps/guider/templates/hero.list.html",controller:"guider.hero.list"})}])}),define("apps/guider/states/design",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("guider.design",{abstract:!0,url:"/design",templateUrl:"assets/js/apps/guider/templates/design.tab.html"}).state("guider.design.apply",{url:"",templateUrl:"assets/js/apps/guider/templates/design.apply.html",controller:"guider.design.apply"}).state("guider.design.home",{url:"/home",templateUrl:"assets/js/apps/guider/templates/design.home.html",controller:"guider.design.home"}).state("guider.design.center",{url:"/center",templateUrl:"assets/js/apps/guider/templates/design.center.html",controller:"guider.design.center"}).state("guider.design.qrcode",{url:"/qrcode",templateUrl:"assets/js/apps/guider/templates/design.qrcode.html",controller:"guider.design.template"})}])}),define("apps/guider/states/_base",["apps/guider/states/main","apps/guider/states/order","apps/guider/states/orderreports","apps/guider/states/guider","apps/guider/states/sixsetting","apps/guider/states/settled","apps/guider/states/setting","apps/guider/states/hero","apps/guider/states/design"],function(){}),define("apps/guider/controllers/dashboard",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("guider.dashboard",["$scope","$stateParams","guiderStatDay","guiderStatDays",function(e,a,o,s){var n=t.init(document.getElementById("comission_chart")),r=t.init(document.getElementById("trade_chart"));o.get(function(t){e.guiderDayInfo=t}),s.query(function(e){var t=[],a=[],o=[];amount_sum=[],comission_sum=[],angular.forEach(e,function(e,s){t.push(e.date),a.push(e.corder),o.push(e.cguider),amount_sum.push(e.amount_sum),comission_sum.push(e.comission_sum)});var s={tooltip:{trigger:"axis"},legend:{data:["订单数","推客数"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:t}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"订单数",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:a},{name:"推客数",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:o}]};n.setOption(s);var s={tooltip:{trigger:"axis"},legend:{data:["交易额","佣金"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:t}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"交易额",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:amount_sum},{name:"佣金",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:comission_sum}]};r.setOption(s)})}])}),define("apps/guider/controllers/order",["apps/common/controllers/controllers"],function(e){e.controller("guider.order",["$scope","$resource","$filter","ngPopover","Flash","orderResource","$modal",function(e,t,a,o,s,n,r){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",order_sn:"",title:"",nickname:"",mobile:"",status:"all",direction:"desc"};var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.orders=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.viewOrderInfo=function(e){r.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/order_info_tpl.html",controller:"guider.order_info.tpl",resolve:{orderId:function(){return e}}})},e.viewComissionInfo=function(e){r.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/comission_info_tpl.html",controller:"guider.comission_info.tpl",resolve:{orderId:function(){return e}}})},e.sorting={order_amount:"",total_comission:"",shipment_fee:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),i()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.search=function(){e.params.province=e.ctrl.selected[0]?e.ctrl.selected[0].id:"",e.params.city=e.ctrl.selected[1]?e.ctrl.selected[1].id:"",e.params.district=e.ctrl.selected[2]?e.ctrl.selected[2].id:"";var t=$('input[name="settled_range"]').val();""!=t?(t=t.split("/"),e.params.startFinishDate=t[0],e.params.endFinishDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.selectedIds=[],e.export_btn="生成报表",e.isGetted_export=!0,e.exports_is=!1,e.export=function(){e.export_btn="生成中";var a="/guider/order/export?";if(angular.forEach(e.params,function(e,t){e&&(a+=t+"="+e+"&")}),$('input[name="settled_range"]').val()){var o=$('input[name="settled_range"]').val(),n=o.split("/");a+="startFinishDate="+n[0]+"&endFinishDate="+n[1]+"&"}a+="export=yes";var r=t(a,{});r.get(function(t){1==t.status?(e.isGetted_export=!0,e.exports_is=!0,e.export_btn="生成报表",s.create("success",t.msg)):(e.export_btn="生成报表",s.create("danger",t.msg),e.exports_is=!1,e.isGetted_export=!0)})}}])}),define("apps/guider/controllers/order.reports",["apps/common/controllers/controllers"],function(e){e.controller("guider.order.reports",["$scope","$state","Flash","guiderReportsDownload",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,sort:"desc"};var s=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data},function(t){e.data=[],a.create("danger",t.data.error)})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.searchlog=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1};e.reports=function(e){var t=e;window.location.href=t,a.create("success","正在下载,请等待...")}}])}),define("apps/guider/controllers/guider.member",["apps/common/controllers/controllers"],function(e){e.controller("guider.guider.member",["$scope","$filter","ngPopover","Flash","guiderResource","MemberChangeResource","guiderLevelResource","settingResource","$modal",function(e,t,a,o,s,n,r,i,c){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",created_at:"",title:"",nickname:"",mobile:"",level:"",status:"all",direction:"desc"};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.guiders=t.data,e.partnerSetting=t.partner_setting})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.sorting={created_at:"",expect_comission:"",total_comission:"",team_size:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),l()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})});var d=function(){r.get({type:"1"},function(t){e.levels=t.data})};d(),r.get({},function(t){e.allLevels=t.data,e.allLevels.unshift({name:"--请选择--",id:""})}),e.setting=i.get(),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.cancel=function(){a.close()},e.confirmAudit=function(e){s.putGuider({id:e,type:2,pass:1},function(e){e.success?l():o.create("danger","操作失败")})},e.confirmDisable=function(e){s.putGuider({id:e,type:3},function(e){e.success?l():o.create("danger","操作失败")})},e.confirmEnable=function(e){s.putGuider({id:e,type:2},function(e){e.success?l():o.create("danger","操作失败")})},e.setCheckedGuider=function(t){return e.checkedGuider=angular.copy(t),e.levels&&e.levels.length>0?(0==e.checkedGuider.level_id&&(e.checkedGuider.level_id=e.levels[0].id),void("0000-00-00 00:00:00"==e.checkedGuider.level_expire_at&&(e.checkedGuider.level_expire_at=""))):(o.create("danger","请先添加推客会员自定义等级"),!1)},e.setLevel=function(t){t.$valid&&(t.$invalid=!0,s.putGuider({id:e.checkedGuider.id,type:1,level_id:e.checkedGuider.level_id,level_expire_at:e.checkedGuider.level_expire_at},function(e){t.$invalid=!1,e.success?(o.create("success","设置成功"),l(),a.close()):o.create("danger","操作失败")}))},e.showQrcode=function(t){s.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.changeParent=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/guider_typehead_tpl.html",controller:"guider.typehead.tpl",windowClass:"modal-open",size:"lg",resolve:{guiderId:function(){return e}}});t.result.then(function(t){p(t,e)})};var p=function(e,t){s.chang_parent({from_id:t,to_id:e},function(e){l(),o.create("success","变更成功")},function(e){o.create("danger",e.data.error.message)})};e.watch={},e.$watch("watch",function(t){t.isUpdateStatus&&(e.search(),e.watch.isUpdateStatus=!1)},!0),e.setcaptain=function(t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/team/templates/setcaptain.html",controller:"team.setcaptain",resolve:{setcaptainItem:function(){return t}}});a.result.then(function(t){void 0!=t&&(l(),e.data.activity_id=t.id,e.data.activity=t)})},e.changePartner=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/partner_typehead_tpl.html",controller:"partner.typehead.tpl",windowClass:"modal-open",size:"lg"});t.result.then(function(t){u(t,e)})};var u=function(e,t){n.update({member_id:t,partner_id:e,type:10},function(e){e.success?(l(),o.create("success","变更成功")):o.create("danger",e.error)})}}])}),define("apps/guider/controllers/guider.level",["apps/common/controllers/controllers"],function(e){e.controller("guider.guider.level",["$scope","Flash","guiderLevelResource","$modal",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.addGuideLevel=function(){var e=o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/add_level_tpl.html",controller:"guider.level.add",windowClass:"modal-open",resolve:{level_id:function(){return 0}}});e.result.then(function(e){s()})},e.editGuideLevel=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/add_level_tpl.html",controller:"guider.level.add",windowClass:"modal-open",resolve:{level_id:function(){return e}}});t.result.then(function(e){s()})},e.remove=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/guider/controllers/guider.level.add",["apps/common/controllers/controllers"],function(e){e.controller("guider.level.add",["$scope","Flash","guiderLevelResource","settingResource","$modalInstance","$modal","level_id","$stateParams","$state",function(e,t,a,o,s,n,r,i,c){e._global=_global,e.cancel=function(){s.dismiss("cancel")},r?e.level=a.get({id:r},function(){}):e.level={type:0},e.setting=o.get(),e.comission_percent_error=!1,e.$watch("level.comission_percent",function(t,a){var o=0;angular.isUndefined(t)||(angular.forEach(t,function(t,a){var s=e.setting[a]*t;o+=s,s>100&&(e.form[a].$invalid=!0,e.form.$invalid=!0)}),o>100?(e.form.comission_percent1.$invalid=!0,e.form.comission_percent2.$invalid=!0,e.form.comission_percent3.$invalid=!0,e.comission_percent_error=!0,e.form.$invalid=!0):e.comission_percent_error=!1)},!0),e.level_id=r,e.types=[{id:0,name:"按佣金"},{id:1,name:"自定义"}],e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,r?a.update({id:r},e.level,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),s.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}):a.save(e.level,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),s.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/guider/controllers/guider.typehead.tpl",["apps/common/controllers/controllers"],function(e){e.controller("guider.typehead.tpl",["$scope","guiderResource","guiderId","$modalInstance",function(e,t,a,o){e._global=_global,e.cancel=function(){o.dismiss("cancel")},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,nickname:"",mobile:"",column:"created_at",direction:"desc"};var s=function(){e.params.id=a,e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.getParents(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.selectParent=function(e){o.close(e)},e.selectTop=function(){o.close(0)}}])}),define("apps/guider/controllers/partner.typehead.tpl",["apps/common/controllers/controllers"],function(e){e.controller("partner.typehead.tpl",["$scope","PartnerMemberResource","$modalInstance",function(e,t,a){e._global=_global,e.cancel=function(){a.dismiss("cancel")},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,nickname:"",mobile:"",column:"created_at",direction:"desc",type:1};var o=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.getPartner(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.selectParent=function(e){a.close(e)},e.selectTop=function(){a.close(0)}}])}),define("apps/guider/controllers/guider.locking",["apps/common/controllers/controllers"],function(e){e.controller("guider.guider.locking",["$scope","$stateParams","guiderResource","Flash","$modal",function(e,t,a,o,s){e.searchParam={types:[{type:"name",name:"昵称"},{type:"mobile",name:"手机号"},{type:"member_account",name:"会员账号"}],type:{type:"name",name:"昵称"}},e.paginationConf={currentPage:1,itemsPerPage:10};var n={id:t.id},r=function(){n.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,n.limit=e.paginationConf.itemsPerPage,a.getLockings(n,function(t){e.paginationConf.totalItems=t._count,e.members=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){angular.forEach(e.searchParam.types,function(e,t){angular.isDefined(n[e.type])&&delete n[e.type]}),n[e.searchParam.type.type]=e.searchParam.input,1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.openChangeLocking=function(e,t){var a=s.open({animation:!1,controller:"guider.guider.locking.change",templateUrl:"assets/js/apps/guider/templates/guider.locking.change.html",size:"",resolve:{id:function(){return e},member_id:function(){return t}}});a.result.then(function(){r()})},e.unbindLocking=function(e,t){a.unbindLocking({id:e,member_id:t},function(e){e.success?(o.create("success","移除成功"),r()):o.create("danger","操作失败")})}}])}),define("apps/guider/controllers/guider.locking.change",["apps/common/controllers/controllers"],function(e){e.controller("guider.guider.locking.change",["$scope","guiderResource","Flash","$modal","$modalInstance","id","member_id",function(e,t,a,o,s,n,r){e.searchParam={types:[{type:"nickname",name:"昵称"},{type:"mobile",name:"手机号"},{type:"member_account",name:"会员账号"}],type:{type:"nickname",name:"昵称"}},e.paginationConf={currentPage:1,itemsPerPage:10};var i={id:n,member_id:r},c=function(){i.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,i.limit=e.paginationConf.itemsPerPage,t.getChangeLockings(i,function(t){e.paginationConf.totalItems=t._count,e.guiders=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.cancel=function(){s.dismiss("cancel")},e.search=function(){delete i.nickname,delete i.mobile,i[e.searchParam.type.type]=e.searchParam.input,c()},e.changeLocking=function(e){t.changeLocking({id:e,member_id:i.member_id},function(e){e.success?(a.create("success","设置成功"),s.close()):a.create("danger","操作失败")})}}])}),define("apps/guider/controllers/guider.commission",["apps/common/controllers/controllers"],function(e){e.controller("guider.guider.commission",["$scope","$stateParams","guiderCommissionResource",function(e,t,a){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_sn:"",column:"comission",status:"all",direction:"desc"},e.params.id=t.id,e.params.status=t.status;var o=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.commissions=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.sorting={comission:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),o()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.search=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1}}])}),define("apps/guider/controllers/settled",["apps/common/controllers/controllers"],function(e){e.controller("guider.settled",["$scope","$filter","ngPopover","Flash","settledResource","$modal",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_sn:"",nickname:"",mobile:"",column:"id",direction:"desc"};var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.settleds=t.data})};e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r)}])}),define("apps/guider/controllers/order_info_tpl",["apps/common/controllers/controllers"],function(e){e.controller("guider.order_info.tpl",["$scope","orderId","orderResource","$modalInstance",function(e,t,a,o){e._global=_global,e.cancel=function(){o.dismiss("cancel")};var s=function(){a.getOrderGoods({id:t},function(t){e.orderGoods=t})};s()}])}),define("apps/guider/controllers/comission_info_tpl",["apps/common/controllers/controllers"],function(e){e.controller("guider.comission_info.tpl",["$scope","orderId","orderResource","$modalInstance",function(e,t,a,o){e._global=_global,e.cancel=function(){o.dismiss("cancel")};var s=function(){a.getOrderComission({id:t},function(t){e.orderComissions=t})};s()}])}),define("apps/guider/controllers/setting.base",["apps/common/controllers/controllers"],function(e){e.controller("guider.setting.base",["$scope","Flash","settingResource","$modal","videoAddress",function(e,t,a,o,s){e.videoAddress=s,e.setting=a.get(),e.commission_level=_global.setting.commission_level,e.placehold="{{parent_name}}的小店",e.ranks=[{id:0,name:"关闭"},{id:10,name:"显示TOP10"},{id:20,name:"显示TOP20"},{id:50,name:"显示TOP50"},{id:100,name:"显示TOP100"}],e.buyer_periods=[{id:0,name:"一次: 以用户最后访问的小店链接为准有效"},{id:1,name:"永久: 以用户最先访问的小店链接为准有效"},{id:2,name:"1天: 访问小店链接一天内有效"},{id:3,name:"1周: 访问小店链接一周内有效"},{id:4,name:"1月: 访问小店链接一月内有效"}],e.btn_text="保存",e.submitForm=function(o){if(o){e.btn_text="保存中...",e.form.$invalid=!0;var s=angular.copy(e.setting);e.commission_level<3&&delete s.comission_percent3,e.commission_level<2&&delete s.comission_percent2,a.update(s,function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)})}}}])}),define("apps/guider/controllers/setting.goods",["apps/common/controllers/controllers"],function(e){e.controller("guider.setting.goods",["$scope","Flash","settingGoodsResource","goodsResource","$modal",function(e,t,a,o,s){e.commission_level=_global.setting.commission_level,e.params={column:"updated_at",direction:"desc"},e.search={};var n=function(){var t={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};t.column=e.params.column,t.direction=e.params.direction,e.search.params&&e.search.params.input&&(t[e.search.params.type.type]=e.search.params.input),a.get(t,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.resources=o.getGuiderGoods,e.reload=n,e.modelchoice={size:"lg",animation:!1,templateUrl:"assets/js/apps/guider/templates/choice_goods_tpl.html",controller:"choice_goods.tpl",resolve:{guider_goods_id:function(){return 0},commission_type:function(){return"goods"}}},e.editGuideGoods=function(e,t){var a=s.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/guider/templates/choice_goods_tpl.html",controller:"choice_goods.tpl",resolve:{guider_goods_id:function(){return e},goods_id:function(){return t},commission_type:function(){return"goods"}}});a.result.then(function(e){n()})},e.remove=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})},e.sorting={created_at:"",updated_at:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),n()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.goodsSearchTypes=[{type:"title",name:"商品标题"}],e.$watch("search.params",function(e){e&&n()},!0)}])}),define("apps/guider/controllers/setting.repurchase",["apps/common/controllers/controllers"],function(e){e.controller("guider.setting.repurchase",["$scope","Flash","settingRepurchaseResource","goodsResource","$modal",function(e,t,a,o,s){e.commission_level=_global.setting.commission_level,e.search={};var n=function(){var t={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};e.search.params&&e.search.params.input&&(t[e.search.params.type.type]=e.search.params.input),a.get(t,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.editGuideGoods=function(e,t){var a=s.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/guider/templates/choice_goods_tpl.html",controller:"choice_goods.tpl",resolve:{guider_goods_id:function(){return e},goods_id:function(){return t},commission_type:function(){return"repurchase"}}});a.result.then(function(e){n()})},e.remove=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})},e.goodsSearchTypes=[{type:"title",name:"商品标题"}],e.$watch("search.params",function(e){e&&n()},!0),e.resources=o.getGuiderRepurchaseGoods,e.reload=n,e.modelchoice={size:"lg",animation:!1,templateUrl:"assets/js/apps/guider/templates/choice_goods_tpl.html",controller:"choice_goods.tpl",resolve:{guider_goods_id:function(){return 0},commission_type:function(){return"repurchase"}}}}])}),define("apps/guider/controllers/hero.setting",["apps/common/controllers/controllers"],function(e){e.controller("guider.hero.setting",["$scope","Flash","heroResource","$modal","heroUpdate",function(e,t,a,o,s){e.ranks=[{id:10,name:"显示TOP10"},{id:20,name:"显示TOP20"},{id:50,name:"显示TOP50"},{id:100,name:"显示TOP100"}],a.getSetting(function(t){e.setting=t}),e.updateRank=function(){s.get(function(e){e.status?t.create("success",e.msg):t.create("danger",e.msg)})},e.btn_status=!1,e.changeSetting=function(o){e.btn_status=!0,a.updateSetting(o,function(a){e.btn_status=!1,t.create("success"," 修改成功！")},function(a){e.btn_status=!1,t.create("danger",a.data.error)})},e.weidu=1;var n=function(){a.get({weidu:e.weidu},function(t){e.hero=t})};n(),e.setWeidu=function(t){e.weidu=t,n()},e.confirmDelete=function(e,o,s){a.delete({id:s},function(a){t.create("success"," 删除成功！"),e.splice(o,1)},function(e){t.create("danger",e.data.error)})},e.disable=function(e){a.update(e,function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error)})},e.add=function(t){var a={type:t,is_disable:1,weidu:e.weidu},s=o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/hero.modal.html",controller:"heroModelCtrl",resolve:{item:function(){return a}}});s.result.then(function(e){e&&n()})},e.edit=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/hero.modal.html",
controller:"heroModelCtrl",resolve:{item:function(){return e}}});t.result.then(function(e){e&&n()})}}]).controller("heroModelCtrl",["$scope","Flash","heroResource","$modalInstance","item",function(e,t,a,o,s){s.id?e.title="编辑干扰值":e.title="添加干扰值",e.item=s,e._global=_global,e.ok=function(){return s.min>=s.max?(t.create("danger","最大值必须大于最小值！"),!1):(e.form.$invalid=!0,void(s.id?a.update(e.item,function(e){t.create("success"," 修改成功！"),o.close(1)},function(a){e.form.$invalid=!1,t.create("danger",a.data.error),o.dismiss("cancel")}):a.save(e.item,function(e){t.create("success"," 添加成功！"),o.close(1)},function(a){e.form.$invalid=!1,t.create("danger",a.data.error),o.dismiss("cancel")})))},e.cancel=function(){o.dismiss("cancel")}}])}),define("apps/guider/controllers/hero.list",["apps/common/controllers/controllers"],function(e){e.controller("guider.hero.list",["$scope","Flash","heroListResource",function(e,t,a){e.timeRange=[{id:1,name:"昨日"},{id:2,name:"上周"},{id:3,name:"上月"}],e.weidu=[{id:1,name:"佣金"},{id:3,name:"团队人数"}],e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,type:1,weidu:1,is_disturb:0};var o=function(){switch(e.params.weidu){case 1:e.th_text="佣金";break;case 2:e.th_text="销量";break;case 3:e.th_text="团队人数"}e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.guiders=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.search=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1}}])}),define("apps/guider/controllers/choice_goods.tpl",["apps/common/controllers/controllers"],function(e){e.controller("choice_goods.tpl",["$scope","Flash","settingGoodsResource","goodsResource","guiderLevelResource","settingRepurchaseResource","$modalInstance","$modal","goods_id","guider_goods_id","commission_type",function(e,t,a,o,s,n,r,i,c,l,d){e._global=_global,e.cancel=function(){r.dismiss("cancel")};var p=function(e,t){e.comission_percent1="",e.comission_percent2=t>1?"":0,e.comission_percent3=t>2?"":0};if(l){var u;"repurchase"===d?u=n.getItem:"goods"===d&&(u=a.get),e.setting=u({id:l},function(){e.goods=o.get({id:e.setting.goods_id}),e.unit_type=e.setting.unit_type,e.setting.comission_percent1=e.setting.comission_percent.comission_percent1,e.setting.comission_percent2=angular.isDefined(e.setting.comission_percent.comission_percent2)?e.setting.comission_percent.comission_percent2:0,e.setting.comission_percent3=angular.isDefined(e.setting.comission_percent.comission_percent3)?e.setting.comission_percent.comission_percent3:0})}else e.unit_type=0,e.goods=o.get({id:c}),e.setting={},e.setting.goods_id=c,e.setting.unit_type=0,p(e.setting,_global.setting.commission_level);e.setUnitType=function(t){e.unit_type=0==t?0:1,p(e.setting,_global.setting.commission_level)},s.get({},function(t){e.levels=t.data}),e.commission_type=d,e.btn_text="保存",e.submitForm=function(o){if(o){e.btn_text="保存中...",e.form.$invalid=!0;var s=angular.copy(e.setting);if(_global.setting.commission_level<2&&delete s.comission_percent2,_global.setting.commission_level<3&&delete s.comission_percent3,l){var i;"repurchase"===d?i=n.update:"goods"===d&&(i=a.update),i({id:l},s,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),r.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)})}else{var i;"repurchase"===d?i=n.add:"goods"===d&&(i=a.save),i(s,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),r.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)})}}}}])}),define("apps/guider/controllers/setting.template",["apps/common/controllers/controllers"],function(e){e.controller("guider.setting.template",["$scope","Flash","settingResource","$modal",function(e,t,a,o){e.setting=a.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.update(e.setting,function(o){e.setting=a.get(),e.btn_text="保存",e.form.$invalid=!1,t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/guider/controllers/design.apply",["apps/common/controllers/controllers"],function(e){e.controller("guider.design.apply",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","applyResource",function(e,t,a,o,s,n,r,i){e.magic_title="{{shop_name}}:店铺名称",e.magic_guider_rank="{{guider_rank}}:推客排名",e.magic_guider_rank_more="{{1000+guider_rank}}:推客排名加1000初始值",e.magic_guider_parent="{{guider_parent}}:上级推客",e.slices=[{type:"guider_apply"},{type:"guider_text"}],e.invite_periods=[{id:0,name:"一次"},{id:1,name:"永久"}],e.config={audit_type:0,guider_invite_period:0,guider_condition:{},fields:[]},i.get({},function(t){t.data.length>0&&(e.slices=t.data,e.config={audit_type:t.audit_type,set_type:t.set_type?t.set_type:0,guider_invite_period:t.guider_invite_period,fields:t.fields,msg_content:t.msg_content?t.msg_content:"您好,欢迎成为{{shop_name}}的第{{guider_rank}}位推客!",agreement_setting:t.agreement_setting,agreement_disable:t.agreement_disable},""!=t.guider_condition?e.config.guider_condition=t.guider_condition:e.config.guider_condition={pay:0,subscribe:0})}),e.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],e.addField=function(){e.config.fields.push({type:"text"})},e.deleteFields=function(t){e.config.fields.splice(t,1)};var c=[];angular.forEach(n.concat(),function(e,t){"banner"!==e.type&&c.push(e)}),e.icon_list=c,e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(a){if(!a)return!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var o=angular.copy(e.slices);for(var s in o){var n=r[o[s].type](o[s].content);if(n)return e.editSlice(e.slices[s],n),!1}e.config.data=o,1==e.config.set_type&&(e.config.guider_condition={pay:0,subscribe:1},e.config.fields=[],e.config.agreement_disable=1);for(var c=1;c<e.config.fields.length;c++)for(var l=0;l<c;l++)if(e.config.fields[c].name==e.config.fields[l].name)return t.create("danger",'重复的信息名"'+e.config.fields[c].name+'"! 添加字段不能有重复的信息名.'),!1;e.invalid=!0,i.update(e.config,function(a){t.create("success"," 修改成功！"),e.invalid=!1},function(a){t.create("danger",a.data.error.message),e.invalid=!1})}}])}),define("apps/guider/controllers/design.home",["apps/common/controllers/controllers"],function(e){e.controller("guider.design.home",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","homeResource","guider_home_copy",function(e,t,a,o,s,n,r,i,c){e.config={};var l=function(){i.get({id:s.id},function(t){e.slices=t.data,0==t.data.length?e.slices=[{type:"guider_banner",content:{guider_style:t.data[0].content.guider_style?t.data[0].content.guider_style:"user",style:t.data[0].content.style?parseInt(t.data[0].content.style):1,banner_img:"2015/08/21/Fkp4Ht3lNlJIMMBsCgZEo_-XJ4a5.png"}}]:("guider_banner"==t.data[0].type&&(t.data[0].content.guider_style=t.data[0].content.guider_style?t.data[0].content.guider_style:"user",t.data[0].content.style="user"==t.data[0].content.style?1:"shop"==t.data[0].content.style?2:t.data[0].content.style),e.slices=t.data,e.config={bgcolor:t.bgcolor})})};l(),e.icon_list=n.concat(),e.icon_list[0].type="guider_banner",e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),null!=t.content&&t.content!=[]||(t.content={}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.btn_text="保存",e.save=function(){if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var a=angular.copy(e.slices);for(var o in a){var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.config.data=a,e.invalid=!0,e.btn_text="保存中...",i.update(e.config,function(a){t.create("success"," 修改成功！"),e.btn_text="保存",e.invalid=!1},function(a){t.create("danger",a.data.error.message),e.btn_text="保存",e.invalid=!1})},e.btn_status=!1,e.copyPage=function(){e.btn_status=!0,c.copyHomePage(function(a){e.btn_status=!1,a.status?(t.create("success",a.msg),l()):t.create("danger",a.msg)})}}])}),define("apps/guider/controllers/design.center",["apps/common/controllers/controllers"],function(e){e.controller("guider.design.center",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","centerResource",function(e,t,a,o,s,n,r,i){e.config={},i.get({id:s.id},function(t){0==t.data.length?e.slices=[{type:"guider_head"},{type:"guider_nav",content:{item_list:[]}}]:e.slices=t.data,e.config.is_commission_goods=t.is_commission_goods||0,e.config.is_guider_lock=t.is_guider_lock||0,e.config.is_anonymous=t.is_anonymous||0}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(){if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var a=angular.copy(e.slices);for(var o in a){var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.config.data=a,e.invalid=!0,i.update(e.config,function(a){t.create("success"," 修改成功！"),e.invalid=!1},function(a){t.create("danger",a.data.error.message),e.invalid=!1})}}])}),define("apps/guider/controllers/design.qrcode",["apps/common/controllers/controllers"],function(e){e.controller("guider.design.template",["$scope","Flash","spreadResource","$modal",function(e,t,a,o){e.active="",e.temActive="",e.width=248,e.height=225,e.params={limit:6,offset:0,tag_id:""},e.paginationConf={currentPage:1,itemsPerPage:6},e.myStyle={height:"20px",overflow:"hidden"},e.isArrowDown=!0,e.isArrowUp=!1,e.setHeight=function(){"auto"==e.myStyle.height?(e.myStyle.height="20px",e.isArrowUp=!1,e.isArrowDown=!0):(e.myStyle.height="auto",e.isArrowUp=!0,e.isArrowDown=!1)};var s=function(){a.getTemplateTag(function(t){e.tags=t})};s();var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t.data._count,e.data=t.data.data,t.data._count>0&&(e.temActive=t.data.data[0].id,e.open(t.data.data[0].id,"first"))})};e.search=function(t){e.params.tag_id=t,e.active=t,r()},e.open=function(o,s){"first"==s?e.temActive==o&&a.getOnly({id:o},function(a){0==a.code?(e.temActive=o,e.setting=a.data):t.create("danger",a.msg)}):e.temActive!=o&&a.getOnly({id:o},function(a){0==a.code?(e.temActive=o,e.setting=a.data):t.create("danger",a.msg)})},e.showImg=function(){e.setting.is_fg_img_show=!e.setting.is_fg_img_show},e.$watch("images",function(){angular.isUndefined(e.images)||(e.setting._bg_img=e.images[e.images.length-1].url)}),e.btn_text="保存",e.form_invalid=!1,e.submitForm=function(){e.btn_text="保存中...",e.form_invalid=!0,a.save({id:e.setting.id,bg_img:e.setting._bg_img,fg_img:e.setting._fg_img,is_fg_img_show:e.setting.is_fg_img_show?1:0,spread_word1:e.setting.spread_word1,spread_word2:e.setting.spread_word2},function(a){0==a.code?(e.btn_text="保存",e.form_invalid=!1,t.create("success",a.msg)):(e.btn_text="保存",e.form_invalid=!1,t.create("danger",a.msg))})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.openTemp=function(){var e=o.open({animation:!1,size:"lg",templateUrl:"assets/js/apps/guider/templates/design.qrcode.modal.html",controller:"designTemplatemodalCtrl",resolve:{}});e.result.then(function(e){},function(e){r()})},e.setDef=function(){o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/design.setDefault.modal.html",controller:"setDefaultTemplateModalCtrl",resolve:{}})},e.previewTem=function(){o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/design.previewTem.modal.html",controller:"previewTemModalCtrl",windowClass:"guider-design-qrcode-modal",resolve:{items:function(){return{id:e.setting.id,bg_img:e.setting._bg_img,fg_img:e.setting._fg_img,is_fg_img_show:e.setting.is_fg_img_show?1:0,spread_word1:e.setting.spread_word1,spread_word2:e.setting.spread_word2}}}}).result.then(function(){})};var r=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:n()}}])}),define("apps/guider/controllers/design.qrcode.modal",["apps/common/controllers/controllers"],function(e){e.controller("designTemplatemodalCtrl",["$scope","Flash","spreadResource","$modal","$modalInstance",function(e,t,a,o,s){e.active="",e.params={limit:6,offset:0,tag_id:"",enabled:"-1"},e.star=0,e.batchinfo={ids:"",enabled:0,checkarr:[]},e.paginationConf={currentPage:1,itemsPerPage:8};var n=function(){a.getTemplateTag(function(t){e.tags=t})};n();var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.getAllTemplate({limit:e.params.limit,offset:e.params.offset,tag_id:e.params.tag_id,enabled:e.params.enabled},function(t){e.paginationConf.totalItems=t.data._count,e.star=t.data.merchantstar,e.data=t.data.data,e.batchinfo.checkarr=[],angular.forEach(e.data,function(t,a){e.data[a].checked=!1,e.data[a].img=_global.url.ms+t.img})})};e.search=function(t){e.params.tag_id=t,e.active=t,i()},e.chooseTem=function(t){t.checked=!t.checked,1==t.checked?e.batchinfo.checkarr.push(t.id):angular.forEach(e.batchinfo.checkarr,function(a,o){t.id==a&&e.batchinfo.checkarr.splice(o,1)}),e.transformString()},e.transformString=function(){e.batchinfo.ids=e.batchinfo.checkarr.toString()},e.batchTemplate=function(o){a.batchAllTemplate({ids:e.batchinfo.ids,enabled:o},function(a){0==a.code?(angular.forEach(e.data,function(a,s){angular.forEach(e.batchinfo.checkarr,function(t,a){"-1"==e.params.enabled?e.data[s].id==t&&(e.data[s].enabled=o):e.data[s].id==t&&(e.data[s].enabled=1==e.data[s].enabled?0:1)}),1==o?t.create("success","启用成功"):0==o&&t.create("success","取消启用成功")}),"-1"!=e.params.enabled&&(e.batchinfo.checkarr.length=0)):t.create("danger",a.msg)})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.cancel=function(){s.dismiss("cancel")},e.showcheck=function(t){var t=t.toString();e.params.enabled==t?e.params.enabled="-1":e.params.enabled=t,i()};var i=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:r()}}])}),define("apps/guider/controllers/design.setDefault.modal",["apps/common/controllers/controllers"],function(e){e.controller("setDefaultTemplateModalCtrl",["$scope","Flash","settingResourceDesign","$modalInstance",function(e,t,a,o){var s=function(){a.setDefaultData(e.data,function(t){e.data=t.data})};s(),e.btn_text="提交",e.submitDefault=function(s){s&&(e.form.$invalid=!0,e.btn_text="提交中...",a.setDefault(e.data,function(a){0==a.code?(e.btn_text="提交",t.create("success",a.msg)):(e.btn_text="提交",e.form.$invalid=!1,t.create("danger",a.msg)),o.dismiss("cancel")}))},e.cancel=function(){o.dismiss("cancel")}}])}),define("apps/guider/controllers/design.previewTem.modal",["apps/common/controllers/controllers"],function(e){e.controller("previewTemModalCtrl",["$scope","Flash","spreadResource","$modal","$modalInstance","items",function(e,t,a,o,s,n){var r=function(){a.preview(n,function(a){0==a.code?(e.img=_global.url.ms+a.data.img,t.create("success",a.msg)):t.create("danger",a.msg)})};r()}])}),define("apps/guider/controllers/sixsetting.base",["apps/common/controllers/controllers"],function(e){e.controller("guider.sixsetting.base",["$scope","Flash","sixsettingResource","$modal",function(e,t,a,o){e.setting=a.get(function(e){"1000001"==e.code&&t.create("danger",e.error)}),e.setting.guider_sale_reward=[],e.addSettingItem=function(){e.setting.guider_sale_reward.push({reward_condition:null,reward_amount:null})},e.removeSettingItem=function(t,a){t.preventDefault(),t.stopPropagation(),e.setting.guider_sale_reward.splice(a,1)},e.btn_text="保存",e.six_Setting=!1,e.$watch("setting.comission_percent4",function(t){var a=e.setting.comission_percent1+e.setting.comission_percent2+e.setting.comission_percent3+t+e.setting.comission_percent5+e.setting.comission_percent6;a>100?(e.six_Setting=!0,e.form.$invalid=!0):e.six_Setting=!1}),e.$watch("setting.comission_percent5",function(t){var a=e.setting.comission_percent1+e.setting.comission_percent2+e.setting.comission_percent3+t+e.setting.comission_percent4+e.setting.comission_percent6;a>100?(e.six_Setting=!0,e.form.$invalid=!0):e.six_Setting=!1}),e.$watch("setting.comission_percent6",function(t){var a=e.setting.comission_percent1+e.setting.comission_percent2+e.setting.comission_percent3+t+e.setting.comission_percent5+e.setting.comission_percent4;a>100?(e.six_Setting=!0,e.form.$invalid=!0):e.six_Setting=!1}),e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.update(e.setting,function(o){e.setting=a.get(),e.btn_text="保存",t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/guider/controllers/sixsetting.goods",["apps/common/controllers/controllers"],function(e){e.controller("guider.sixsetting.goods",["$scope","Flash","sixsettingGoodsResource","$modal",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.editGuideGoods=function(e,t){var a=o.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/guider/templates/six_choice_goods_tpl.html",controller:"six_choice_goods.tpl",resolve:{guider_goods_id:function(){return e},goods_id:function(){return t}}});a.result.then(function(e){s()})},e.remove=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/guider/controllers/sixsetting.level",["apps/common/controllers/controllers"],function(e){e.controller("guider.six_setting.level",["$scope","Flash","sixsettingLevelResource","$modal",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.editGuideLevel=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/six_setting_add_level_tpl.html",controller:"six_setting.level.add",windowClass:"modal-open",resolve:{level_id:function(){return e}}});t.result.then(function(e){s()})},e.remove=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/guider/controllers/sixsetting.level.add",["apps/common/controllers/controllers"],function(e){e.controller("six_setting.level.add",["$scope","Flash","sixsettingLevelResource","sixsettingResource","$modalInstance","$modal","level_id","$stateParams","$state",function(e,t,a,o,s,n,r,i,c){e._global=_global,e.cancel=function(){s.dismiss("cancel")},r?e.level=a.get({id:r},function(){}):e.level={type:0},e.setting=o.get(),e.comission_percent_error=!1,e.$watch("level.six_comission_percent",function(t,a){var o=0;if(!angular.isUndefined(t)){angular.forEach(e.level.comission_percent,function(t,a){var s=e.setting[a]*t;o+=s}),angular.forEach(t,function(t,a){var s=e.setting[a]*t;s>100-o&&(e.form[a].$invalid=!0,e.form.$invalid=!0),o+=s}),o>100?(e.form.comission_percent4.$invalid=!0,e.form.comission_percent5.$invalid=!0,e.form.comission_percent6.$invalid=!0,e.comission_percent_error=!0,e.form.$invalid=!0):e.comission_percent_error=!1}},!0),e.level_id=r,e.types=[{id:0,name:"按佣金"},{id:1,name:"自定义"}],e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,r?a.update({id:r},e.level,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),s.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}):a.save(e.level,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),s.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/guider/controllers/sixsetting_choice_goods.tpl",["apps/common/controllers/controllers"],function(e){e.controller("six_choice_goods.tpl",["$scope","Flash","sixsettingGoodsResource","goodsResource","sixsettingLevelResource","$modalInstance","$modal","goods_id","$stateParams","$state","guider_goods_id",function(e,t,a,o,s,n,r,i,c,l,d){e._global=_global,e.cancel=function(){n.dismiss("cancel")},d?e.setting=a.get({id:d},function(){o.get({id:e.setting.goods_id},function(t){e.goods=t}),e.unit_type=e.setting.unit_type,e.setting.comission_percent1=e.setting.comission_percent.comission_percent1,e.setting.comission_percent2=e.setting.comission_percent.comission_percent2,e.setting.comission_percent3=e.setting.comission_percent.comission_percent3,e.setting.comission_percent4=e.setting.six_comission_percent.comission_percent4,e.setting.comission_percent5=e.setting.six_comission_percent.comission_percent5,e.setting.comission_percent6=e.setting.six_comission_percent.comission_percent6}):(e.unit_type=0,e.goods=o.get({id:i}),e.setting={},e.setting.goods_id=i),e.setUnitType=function(t){e.unit_type=0==t?0:1,e.setting.comission_percent4="",e.setting.comission_percent5="",e.setting.comission_percent6=""},e.six_Setting_percent=!1,e.six_Setting_amount=!1,e.$watch("setting.comission_percent4",function(t){var a=e.setting.comission_percent1+e.setting.comission_percent2+e.setting.comission_percent3+t+e.setting.comission_percent5+e.setting.comission_percent6;0==e.setting.unit_type?a>100?(e.six_Setting_percent=!0,e.form.$invalid=!0):e.six_Setting_percent=!1:a>e.goods.price?(e.six_Setting_amount=!0,e.form.$invalid=!0):e.six_Setting_amount=!1}),e.$watch("setting.comission_percent5",function(t){var a=e.setting.comission_percent1+e.setting.comission_percent2+e.setting.comission_percent3+t+e.setting.comission_percent4+e.setting.comission_percent6;0==e.setting.unit_type?a>100?(e.six_Setting_percent=!0,e.form.$invalid=!0):e.six_Setting_percent=!1:a>e.goods.price?(e.six_Setting_amount=!0,e.form.$invalid=!0):e.six_Setting_amount=!1}),e.$watch("setting.comission_percent6",function(t){var a=e.setting.comission_percent1+e.setting.comission_percent2+e.setting.comission_percent3+t+e.setting.comission_percent5+e.setting.comission_percent4;0==e.setting.unit_type?a>100?(e.six_Setting_percent=!0,e.form.$invalid=!0):e.six_Setting_percent=!1:a>e.goods.price?(e.six_Setting_amount=!0,e.form.$invalid=!0):e.six_Setting_amount=!1}),e.high_commission=0,s.get(function(t){angular.forEach(t.data,function(t,a){t.comission_percent.comission_percent1>e.high_commission&&(e.high_commission=t.comission_percent.comission_percent1),t.comission_percent.comission_percent2>e.high_commission&&(e.high_commission=t.comission_percent.comission_percent2),t.comission_percent.comission_percent3>e.high_commission&&(e.high_commission=t.comission_percent.comission_percent3),t.six_comission_percent.comission_percent4>e.high_commission&&(e.high_commission=t.six_comission_percent.comission_percent4),t.six_comission_percent.comission_percent5>e.high_commission&&(e.high_commission=t.six_comission_percent.comission_percent5),t.six_comission_percent.comission_percent6>e.high_commission&&(e.high_commission=t.six_comission_percent.comission_percent6)})}),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,d?a.update({id:d},e.setting,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),n.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}):a.save(e.setting,function(a){e.btn_text="保存",t.create("success"," 保存成功！"),n.close(1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/guider/controllers/sixsetting.balance",["apps/common/controllers/controllers"],function(e){e.controller("guider.six_setting.balance",["$scope","Flash","sixsettingBalanceResource","$modal",function(e,t,a,o){e.dates="",e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,nickname:""};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.detailsBalance=function(e){var a=o.open({animation:!1,templateUrl:"assets/js/apps/guider/templates/six_setting_balance_tpl.html",controller:"six_setting.balance.details",windowClass:"modal-open",resolve:{balance_id:function(){return e}}});a.result.then(function(e){t.create("success","成功")})}}])}),define("apps/guider/controllers/sixsetting.balance.details",["apps/common/controllers/controllers"],function(e){e.controller("six_setting.balance.details",["$scope","Flash","$modalInstance","$modal","balance_id","$stateParams","$state","sixsettingBalanceResource",function(e,t,a,o,s,n,r,i){e._global=_global,e.cancel=function(){a.dismiss("cancel")};var c=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};i.get({offset:(t.offset-1)*t.limit,limit:t.limit,id:s},function(t){e.paginationConf.totalItems=t._count,e.detailsData=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c)}])}),define("apps/guider/controllers/setting.credit",["apps/common/controllers/controllers"],function(e){e.controller("guider.setting.credit",["$scope","Flash","creditExtendResource",function(e,t,a){e.credit={credit_concern_disable:0,credit_concern_setting:{},credit_join_disable:0,credit_join_setting:{}},e.commission_level=_global.setting.commission_level;var o=function(){a.get(function(t){angular.extend(e.credit,t),e.commission_level<2&&(e.credit.credit_concern_setting.concern2=e.credit.credit_concern_setting.concern2||0,e.credit.credit_join_setting.join2=e.credit.credit_join_setting.join2||0),e.commission_level<3&&(e.credit.credit_concern_setting.concern3=e.credit.credit_concern_setting.concern3||0,e.credit.credit_join_setting.join3=e.credit.credit_join_setting.join3||0)})};o(),e.saveBtnDisabled=!1,e.saveBtnText="保存",e.submitForm=function(){var o=angular.copy(e.credit);e.commission_level<2&&(delete o.credit_concern_setting.concern2,delete o.credit_join_setting.join2),e.commission_level<3&&(delete o.credit_concern_setting.concern3,delete o.credit_join_setting.join3),e.saveBtnDisabled=!0,e.saveBtnText="保存中...",a.update(o,function(a){return a.error?(t.create("danger",a.msg||"保存失败"),!1):(t.create("success","保存成功"),e.saveBtnDisabled=!1,void(e.saveBtnText="保存"))},function(a){return t.create("danger",a.data.error||"保存失败"),e.saveBtnDisabled=!1,e.saveBtnText="保存",!1})}}])}),define("apps/guider/controllers/_base",["apps/guider/controllers/dashboard","apps/guider/controllers/order","apps/guider/controllers/order.reports","apps/guider/controllers/guider.member","apps/guider/controllers/guider.level","apps/guider/controllers/guider.level.add","apps/guider/controllers/guider.typehead.tpl","apps/guider/controllers/partner.typehead.tpl","apps/guider/controllers/guider.locking","apps/guider/controllers/guider.locking.change","apps/guider/controllers/guider.commission","apps/guider/controllers/settled","apps/guider/controllers/order_info_tpl","apps/guider/controllers/comission_info_tpl","apps/guider/controllers/setting.base","apps/guider/controllers/setting.goods","apps/guider/controllers/setting.repurchase","apps/guider/controllers/hero.setting","apps/guider/controllers/hero.list","apps/guider/controllers/choice_goods.tpl","apps/guider/controllers/setting.template","apps/guider/controllers/design.apply","apps/guider/controllers/design.home","apps/guider/controllers/design.center","apps/guider/controllers/design.qrcode","apps/guider/controllers/design.qrcode.modal","apps/guider/controllers/design.setDefault.modal","apps/guider/controllers/design.previewTem.modal","apps/guider/controllers/sixsetting.base","apps/guider/controllers/sixsetting.goods","apps/guider/controllers/sixsetting.level","apps/guider/controllers/sixsetting.level.add","apps/guider/controllers/sixsetting_choice_goods.tpl","apps/guider/controllers/sixsetting.balance","apps/guider/controllers/sixsetting.balance.details","apps/guider/controllers/setting.credit"],function(){}),define("apps/guider/directives/comission_percent",["apps/common/directives/directives"],function(e){e.directive("comissionPercent",[function(){return{require:"ngModel",link:function(e,t,a,o){o.$validators.comissionPercent=function(t,a){e.form.comission_percent1.$setValidity("comissionPercent",!0),e.form.comission_percent2.$setValidity("comissionPercent",!0),e.form.comission_percent3.$setValidity("comissionPercent",!0);var o=$('input[name="comission_percent1"]').val(),s=$('input[name="comission_percent2"]').val(),n=$('input[name="comission_percent3"]').val();return!(parseFloat(o)+parseFloat(s)+parseFloat(n)>50)}}}}])}),define("apps/guider/directives/comission_amount",["apps/common/directives/directives"],function(e){e.directive("comissionAmount",[function(){return{require:"ngModel",link:function(e,t,a,o){o.$validators.comissionAmount=function(t,a){var o=$('input[name="comission_percent1"]').val(),s=$('input[name="comission_percent2"]').val(),n=$('input[name="comission_percent3"]').val(),r=parseFloat(e.goods.price);return!(parseFloat(o)+parseFloat(s)+parseFloat(n)>r)}}}}])}),define("apps/guider/directives/_base",["apps/guider/directives/comission_percent","apps/guider/directives/comission_amount"],function(){}),define("apps/guider/services/order",["apps/common/services/services"],function(e){
e.factory("orderResource",["$resource",function(e){return e("guider/order.json",{id:"@id"},{getOrderGoods:{method:"GET",url:"guider/order_goods/:id.json",isArray:!0},getOrderComission:{method:"GET",url:"guider/order_comission/:id.json",isArray:!0}})}]),e.factory("guiderReportsDownload",["$resource",function(e){return e("/guider/order/download.json",{},{get:{method:"GET"}})}])}),define("apps/guider/services/guider",["apps/common/services/services"],function(e){e.factory("guiderResource",["$resource",function(e){return e("guider.json",{id:"@id"},{putGuider:{method:"PUT",url:"guider/:id.json"},getQrcodeInfo:{method:"GET",url:"guider/qrcode_info/:id.json"},getInfo:{method:"GET",url:"guider/:id.json"},chang_parent:{method:"put",url:"guider/chang_parent.json"},getParents:{method:"GET",url:"guider/guider_typeahead/:id.json"},getLockings:{method:"GET",url:"guider/invitation_member/:id.json"},getChangeLockings:{method:"GET",url:"guider/guider_typeahead/:id.json"},changeLocking:{method:"PUT",url:"guider/chang_invitation.json"},unbindLocking:{method:"DELETE",url:"guider/delete_invitation.json"}})}])}),define("apps/guider/services/settled",["apps/common/services/services"],function(e){e.factory("settledResource",["$resource",function(e){return e("guider/settled_record.json",{id:"@id"},{})}])}),define("apps/guider/services/setting",["apps/common/services/services"],function(e){e.factory("settingResource",["$resource",function(e){return e("guider/setting.json",{id:"@id"},{update:{method:"PUT"}})}]),e.factory("settingResourceDesign",["$resource",function(e){return e("guider/design_guider_spread/:id.json",{id:"@id"},{update:{method:"PUT"},setDefault:{method:"PUT",url:"guider/guider_spread_text.json"},setDefaultData:{method:"GET",url:"guider/guider_spread_text.json"}})}])}),define("apps/guider/services/sixsetting",["apps/common/services/services"],function(e){e.factory("sixsettingResource",["$resource",function(e){return e("guider/six_setting/:id.json",{id:"@id"},{update:{method:"PUT"},get:{method:"GET",isArray:!1}})}]),e.factory("sixsettingBalanceResource",["$resource",function(e){return e("guider/guider_settled_recode_six/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}])}),define("apps/guider/services/center",["apps/common/services/services"],function(e){e.factory("centerResource",["$resource",function(e){return e("guider/guider_center.json",{id:"@id"},{update:{method:"PUT"}})}])}),define("apps/guider/services/apply",["apps/common/services/services"],function(e){e.factory("applyResource",["$resource",function(e){return e("guider/guider_apply.json",{id:"@id"},{update:{method:"PUT"}})}])}),define("apps/guider/services/home",["apps/common/services/services"],function(e){e.factory("homeResource",["$resource",function(e){return e("guider/guider_home.json",{id:"@id"},{update:{method:"PUT"}})}])}),define("apps/guider/services/guider_level",["apps/common/services/services"],function(e){e.factory("guiderLevelResource",["$resource",function(e){return e("guider/guider_level.json",{id:"@id"},{get:{method:"GET",url:"guider/guider_level/:id.json"},update:{method:"PUT",url:"guider/guider_level/:id.json"},delete:{method:"DELETE",url:"guider/guider_level/:id.json"}})}])}),define("apps/guider/services/guider.commission",["apps/common/services/services"],function(e){e.factory("guiderCommissionResource",["$resource",function(e){return e("guider/single_order",{id:"@id"},{get:{method:"GET",url:"guider/single_order/:id.json"}})}])}),define("apps/guider/services/setting.goods",["apps/common/services/services"],function(e){e.factory("settingGoodsResource",["$resource",function(e){return e("guider/goods_comission.json",{id:"@id"},{get:{method:"GET",url:"guider/goods_comission/:id.json"},update:{method:"PUT",url:"guider/goods_comission/:id.json"},delete:{method:"DELETE",url:"guider/goods_comission/:id.json"}})}])}),define("apps/guider/services/sixsetting.goods",["apps/common/services/services"],function(e){e.factory("sixsettingGoodsResource",["$resource",function(e){return e("guider/six_goods_comission.json",{id:"@id"},{get:{method:"GET",url:"guider/six_goods_comission/:id.json"},update:{method:"PUT",url:"guider/six_goods_comission/:id.json"},delete:{method:"DELETE",url:"guider/six_goods_comission/:id.json"}})}])}),define("apps/guider/services/sixsetting.level",["apps/common/services/services"],function(e){e.factory("sixsettingLevelResource",["$resource",function(e){return e("guider/guider_six_level.json",{id:"@id"},{get:{method:"GET",url:"guider/guider_six_level/:id.json"},update:{method:"PUT",url:"guider/guider_six_level/:id.json"},delete:{method:"DELETE",url:"guider/guider_six_level/:id.json"}})}])}),define("apps/guider/services/dashboard",["apps/common/services/services"],function(e){e.factory("guiderStatDay",["$resource",function(e){return e("/guider/guider_stat_day.json",{query:{method:"GET",isArray:!1}})}]),e.factory("guiderStatDays",["$resource",function(e){return e("/guider/guider_stat_days.json",{query:{method:"GET",isArray:!0}})}])}),define("apps/guider/services/spread",["apps/common/services/services"],function(e){e.factory("spreadResource",["$resource",function(e){return e("guider/guider_spread_template/:id.json",{id:"@id"},{preview:{method:"POST",url:"guider/spread.json"},save:{method:"PUT",url:"guider/design_guider_spread/:id.json"},getOnly:{method:"GET",url:"guider/guider_spread_template/:id.json"},get:{method:"GET",url:"guider/guider_spread_enabled_template.json"},getAllTemplate:{method:"GET",url:"guider/guider_spread_all_template.json"},getTemplateTag:{method:"GET",isArray:!0,url:"guider/guider_spread_tag.json"},batchAllTemplate:{method:"POST",url:"guider/guider_spread_template.json"}})}])}),define("apps/guider/services/hero",["apps/common/services/services"],function(e){e.factory("heroListResource",["$resource",function(e){return e("guider/hero_list.json")}]),e.factory("heroResource",["$resource",function(e){return e("guider/hero/:id.json",{id:"@id"},{update:{method:"PUT"},getSetting:{url:"guider/setting_hero.json"},updateSetting:{url:"guider/setting_hero.json",method:"PUT"}})}]),e.factory("heroUpdate",["$resource",function(e){return e("guider/hero_rank_statis.json",{},{})}])}),define("apps/guider/services/guider_home_copy",["apps/common/services/services"],function(e){e.factory("guider_home_copy",["$resource",function(e){return e("guider/guider_home_copy.json",{id:"@id"},{copyHomePage:{method:"GET",url:"guider/guider_home_copy.json"}})}])}),define("apps/guider/services/setting.repurchase",["apps/common/services/services"],function(e){e.factory("settingRepurchaseResource",["$resource",function(e){return e("guider/repurchase_goods_comission.json",{id:"@id"},{get:{method:"GET",url:"guider/repurchase_goods_comission.json"},getItem:{method:"GET",url:"guider/repurchase_goods_comission/:id.json"},add:{method:"POST",url:"guider/repurchase_goods_comission.json"},update:{method:"PUT",url:"guider/repurchase_goods_comission/:id.json"},delete:{method:"DELETE",url:"guider/repurchase_goods_comission/:id.json"}})}])}),define("apps/guider/services/setting.credit",["apps/common/services/services"],function(e){e.factory("creditExtendResource",["$resource",function(e){return e("/credit/credit_setting.json",{},{update:{method:"PUT"}})}])}),define("apps/guider/services/_base",["apps/guider/services/order","apps/guider/services/guider","apps/guider/services/settled","apps/guider/services/setting","apps/guider/services/sixsetting","apps/guider/services/center","apps/guider/services/apply","apps/guider/services/home","apps/guider/services/guider_level","apps/guider/services/guider.commission","apps/guider/services/setting.goods","apps/guider/services/sixsetting.goods","apps/guider/services/sixsetting.level","apps/guider/services/dashboard","apps/guider/services/spread","apps/guider/services/hero","apps/guider/services/guider_home_copy","apps/guider/services/setting.repurchase","apps/guider/services/setting.credit"],function(){}),define("apps/guider/main",["apps/guider/states/_base","apps/guider/controllers/_base","apps/guider/directives/_base","apps/guider/services/_base"],function(){}),define("apps/member/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member",{url:"/member",templateUrl:"assets/js/apps/member/templates/layout.html"}).state("member.info",{abstract:!0,url:"/info",template:"<div ui-view></div>"}).state("member.info.main",{url:"",templateUrl:"assets/js/apps/member/templates/main.html",controller:"member.info"}).state("member.setting",{url:"/setting",templateUrl:"assets/js/apps/member/templates/member.setting.html",controller:"member.setting"})}])}),define("apps/member/states/list",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member.list",{abstract:!0,url:"/list",template:"<div ui-view></div>"}).state("member.list.main",{url:"",templateUrl:"assets/js/apps/member/templates/list.html",controller:"member.list"}).state("member.list.retCard",{url:"/retCard/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/member/templates/list.html",controller:"member.list"}).state("member.list.balance",{url:"/balance/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/member/templates/balance.html",controller:"member.balance"})}])}),define("apps/member/states/vipcard",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member.vipcard",{abstract:!0,url:"/vipcard",template:"<div ui-view></div>"}).state("member.vipcard.main",{url:"",templateUrl:"assets/js/apps/member/templates/vipcard.html",controller:"member.vipcard"}).state("member.vipcard.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/member/templates/vipcard.add.html",controller:"member.vipcard.info"}).state("member.vipcard.add",{url:"/add",templateUrl:"assets/js/apps/member/templates/vipcard.add.html",controller:"member.vipcard.info"}).state("member.vipcard.discount",{url:"/discount",templateUrl:"assets/js/apps/member/templates/vipcard.discount.html",controller:"member.vipcard.discount"})}])}),define("apps/member/states/credit",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member.credit",{abstract:!0,url:"/credit",template:"<div ui-view></div>"}).state("member.credit.main",{url:"",templateUrl:"assets/js/apps/member/templates/credit.html",controller:"member.credit"}).state("member.credit.add",{url:"/add",templateUrl:"assets/js/apps/member/templates/credit.add.html",controller:"member.credit.info"}).state("member.credit.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/member/templates/credit.add.html",controller:"member.credit.info"}).state("member.credit.annal",{url:"/annal",templateUrl:"assets/js/apps/member/templates/credit.list.html",controller:"member.credit.list"}).state("member.credit.list",{url:"/list/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/member/templates/credit.list.html",controller:"member.credit.list"})}])}),define("apps/member/states/withdraw",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member.withdraw",{abstract:!0,url:"/withdraw",template:"<div ui-view></div>"}).state("member.withdraw.main",{url:"",templateUrl:"assets/js/apps/member/templates/withdraw.html",controller:"member.withdraw"}).state("member.withdraw.setting",{url:"/setting",templateUrl:"assets/js/apps/member/templates/withdraw.setting.html",controller:"member.withdraw_setting"})}])}),define("apps/member/states/balance",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member.balance",{abstract:!0,url:"/balance",template:"<div ui-view></div>"}).state("member.balance.main",{url:"",templateUrl:"assets/js/apps/member/templates/balance.html",controller:"member.balance"})}])}),define("apps/member/states/vipextend",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("member.extend",{abstract:!0,url:"/extend",template:"<div ui-view></div>"}).state("member.extend.main",{url:"",templateUrl:"assets/js/apps/member/templates/extend.html",controller:"member.extend"}).state("member.extend.setting",{url:"/setting",templateUrl:"assets/js/apps/member/templates/vipextend.setting.html",controller:"member.extend.setting"})}])}),define("apps/member/states/_base",["apps/member/states/main","apps/member/states/list","apps/member/states/vipcard","apps/member/states/credit","apps/member/states/withdraw","apps/member/states/balance","apps/member/states/vipextend"],function(){}),define("apps/member/services/main",["apps/common/services/services"],function(e){e.factory("memberstat",["$resource",function(e){return e("/stat/member/day.json",{},{query:{method:"GET",isArray:!0}})}]),e.factory("memberStatUser",["$resource",function(e){return e("/stat/member/day.json",{},{query:{method:"GET",isArray:!0}})}]),e.factory("memberStatLevel",["$resource",function(e){return e("/stat/member/level.json",{},{query:{method:"GET",isArray:!0}})}]),e.factory("memberStatBaseInfo",["$resource",function(e){return e("/stat/member/baseinfo.json",{},{query:{method:"GET",isArray:!1}})}])}),define("apps/member/services/list",["apps/common/services/services"],function(e){e.factory("memberList",["$resource",function(e){return e("members.json",{},{update:{method:"PUT"},query:{method:"GET",url:"/merchant/members.json",isArray:!1},popUpRank:{method:"PUT",url:"/merchant/setLevel.json"},popUpCredit:{method:"PUT",url:"/merchant/setCredit.json"}})}]),e.factory("balanceRecord",["$resource",function(e){return e("members.json",{},{query:{method:"GET",url:"/merchant/balanceDetails.json",isArray:!1}})}])}),define("apps/member/services/credit",["apps/common/services/services"],function(e){e.factory("creditList",["$resource",function(e){return e("/merchant/credits/:id.json",{id:"@id"},{update:{method:"PUT",url:"/merchant/credit/:id.json"},query:{method:"GET",isArray:!1,url:"/merchant/credits.json"},delete:{method:"DELETE",url:"/merchant/credit/:id.json"}})}]),e.factory("creditItem",["$resource",function(e){return e("/merchant/credit/:id.json",{id:"@id"},{update:{method:"PUT",url:"/merchant/credit/:id.json"}})}]),e.factory("creditannal",["$resource",function(e){return e("/merchant/creditDetails/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1}})}])}),define("apps/member/services/vipcard",["apps/common/services/services"],function(e){e.factory("vipCardList",["$resource",function(e){return e("/merchant/cards.json",{},{update:{method:"PUT"},query:{method:"GET",isArray:!1},delete:{method:"DELETE",url:"/merchant/card/:id.json"}})}]),e.factory("vipCardItem",["$resource",function(e){return e("/merchant/card/:id.json",{id:"@id"},{update:{method:"PUT",url:"/merchant/card/:id.json"},query:{method:"GET",isArray:!1}})}])}),define("apps/member/services/withdraw",["apps/common/services/services"],function(e){e.factory("memberWithdrawSource",["$resource",function(e){return e("/member/member_withdraws.json",{id:"@id"},{putWithdraw:{method:"PUT",url:"/member/member_withdraw/:id.json"},query:{method:"GET",isArray:!1},checkMoney:{method:"GET",url:"/member/transferResult/:id.json"}})}]),e.factory("memberRemarkSource",["$resource",function(e){return e("/member/member_withdrawupdate/:id.json",{id:"@id"},{update:{method:"PUT",url:"/member/member_withdrawupdate/:id.json"},query:{method:"GET",isArray:!1}})}]),e.factory("memberWithdrawSettingSource",["$resource",function(e){return e("/withdraw_setting.json",{},{})}]),e.factory("merchantSettingSource",["$resource",function(e){return e("/merchant_setting.json",{},{})}]),e.factory("cashierResult",["$resource",function(e){return e("/member/cashierResult/:id.json",{id:"@id"},{})}]),e.factory("transferResult",["$resource",function(e){return e("/member/transferResult/:id.json",{id:"@id"},{})}]),e.factory("withdrawStatusRes",["$resource",function(e){return e("/member/withdrawStatus/:id.json",{id:"@id"},{})}]),e.factory("memberWithdrawBatchPass",["$resource",function(e){return e("/member/batchWithdraw.json",{},{put:{method:"PUT",url:"/member/batchWithdraw.json"}})}])}),define("apps/member/services/discount",["apps/common/services/services"],function(e){e.factory("memberDiscount",["$resource",function(e){return e("/goods_discounts/:id.json",{id:"@id"},{get:{method:"GET",url:"/goods_discounts.json"},add:{method:"POST",url:"/goods_discounts.json"},edit:{method:"PUT",url:"/goods_discounts/:id.json"},delete:{method:"DELETE",url:"/goods_discounts/:id.json"}})}]),e.factory("getDiscountGoods",["$resource",function(e){return e("/member_discount_goods.json",{},{get:{method:"GET"}})}])}),define("apps/member/services/vipextend",["apps/common/services/services"],function(e){e.factory("vipExtendList",["$resource",function(e){return e("/member/member_extend.json",{},{query:{method:"GET",isArray:!1}})}]),e.factory("vipExtendListHeaders",["$resource",function(e){return e("/member/member_extend_set_head.json",{},{get:{method:"GET"}})}]),e.factory("vipExtend",["$resource",function(e){return e("/member/member_extend_set.json",{},{get:{method:"GET"}})}]),e.factory("vipExtendEdit",["$resource",function(e){return e("/member/member_extend_set_edit.json",{},{put:{method:"POST",url:"/member/member_extend_set_edit.json"}})}])}),define("apps/member/services/_base",["apps/member/services/main","apps/member/services/list","apps/member/services/credit","apps/member/services/vipcard","apps/member/services/withdraw","apps/member/services/discount","apps/member/services/vipextend"],function(){}),define("apps/member/controllers/main",["apps/common/controllers/controllers","echarts","echarts/chart/pie"],function(e,t){e.controller("member.info",["$scope","memberstat","memberStatLevel","memberStatBaseInfo","videoAddress",function(e,a,o,s,n){e.videoAddress=n,s.query(function(t){e.menberBasrInfo=t});var r=t.init(document.getElementById("new-chart"));a.query(function(e){var t=[],a=[],o=[];angular.forEach(e,function(e,s){t.push(e.date),o.push(e.cmember),a.push(e.cturnover)});var s={tooltip:{trigger:"axis"},legend:{data:["新增用户","新增成交用户"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:t}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"新增用户",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:o},{name:"新增成交用户",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:a}]};r.setOption(s)});var i=t.init(document.getElementById("level-chart"),"macarons");o.query(function(e){var t=[],a=[];angular.forEach(e,function(e,o){t.push(e.level_name);var s={value:e.cmember,name:e.level_name};a.push(s)});var o={title:{text:"会员等级分布图",subtext:"",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:t},calculable:!0,series:[{name:"会员等级",type:"pie",radius:"55%",center:["50%","60%"],data:a}]};i.setOption(o)})}])}),define("apps/member/controllers/list",["apps/common/controllers/controllers"],function(e){e.controller("member.list",["$scope","ngPopover","$stateParams","Flash","memberList","vipCardList",function(e,t,a,o,s,n){n.query({},function(t){e.cardList=t.data;for(var a=0;a<e.cardList.length;a++)if(2==e.cardList[a].type||3==e.cardList[a].type){e.isCardList=!0;break}}),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={name:"",phone:"",level_id:a.id,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var r=function(){e.member={checkedAll:!1},e.checkedIds=[],e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.query(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.memberList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.member={checkedAll:!1},e.checkedIds=[],e.$watch("member.checkedAll",function(t){t?e.checkedIds=e.memberList.map(function(e){return e.member_id}):e.checkedIds=[]}),e.toggleSelection=function(t){var a=e.checkedIds.indexOf(t);a>-1?e.checkedIds.splice(a,1):e.checkedIds.push(t)},e.memberInfo={id:"",type:0,levelId:""},e.clickPopover=function(t,a,o){e.memberInfo.id=t,e.memberInfo.levelId=a,e.memberInfo.type=o,angular.forEach(e.cardList,function(t,a){t.id==e.memberInfo.levelId&&(e.radioRank.id=t.id)})},e.radioRank={id:"",level_expire_at:"",level_name:""},e.levelButInfo={text:"保存",disabled:!1},e.setRank=function(){var t=0==e.memberInfo.type?e.memberInfo.id:e.checkedIds.join(),a=!1;""!=e.radioRank.id&&""!=e.radioRank.level_expire_at?a=!0:""==e.radioRank.id?o.create("danger","请选择等级"):""==e.radioRank.level_expire_at&&o.create("danger","请输入过期时间");var n,i,c=e.cardList.filter(function(t,a){return t.id==e.radioRank.id});c.length&&(n=c[0].level_name,i=c[0].type),a&&(e.levelButInfo.text="保存中",e.levelButInfo.disabled=!0,s.popUpRank({member_ids:t,level:e.radioRank.id,level_at:e.radioRank.level_expire_at,level_name:n,level_type:i},function(t){t.success?(e.cancel(),o.create("success","等级修改成功"),r()):o.create("danger",t.error),e.levelButInfo.text="保存",e.levelButInfo.disabled=!1}))},e.postLevelType=function(t){e.itemLevelType=t},e.creditInfo={sum:"",info:""},e.creditButInfo={text:"保存",disabled:!1},e.setIntegral=function(){var t=0==e.memberInfo.type?e.memberInfo.id:e.checkedIds.join(),a=!1;if(""!=e.creditInfo.sum)if(isNaN(e.creditInfo.sum))o.create("danger","请输入数字"),e.creditInfo.sum=0;else{var n=parseInt(e.creditInfo.sum);n!=e.creditInfo.sum?(o.create("danger","请输入整数"),e.creditInfo.sum=parseInt(e.creditInfo.sum)):a=!0}else o.create("danger","请输入相应的积分数");a&&(e.creditButInfo.text="保存中",e.creditButInfo.disabled=!0,s.popUpCredit({member_ids:t,credit:e.creditInfo.sum,reason:e.creditInfo.info},function(t){t.success?(e.cancel(),o.create("success","积分设置成功"),r()):o.create("danger","积分设置失败"),e.creditButInfo.text="保存",e.creditButInfo.disabled=!1}))},e.cancel=function(){t.close(),e.memberInfo.id="",e.memberInfo.levelId="",e.memberInfo.type=0,e.radioRank.id="",e.radioRank.level_expire_at="",e.creditButInfo.text="保存",e.creditButInfo.disabled=!1,e.creditInfo.sum="",e.creditInfo.info="",e.levelButInfo.text="保存",e.levelButInfo.disabled=!1},e.sorting={credit:"",balance:""},e.$watch("searchInfo.order_type + searchInfo.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.searchInfo.column?e.sorting[a]="sorting-"+("desc"==e.searchInfo.order_type?"asc":"desc"):e.sorting[a]=""})})}])}),define("apps/member/controllers/credit",["apps/common/controllers/controllers"],function(e){e.controller("member.credit",["$scope","ngPopover","merchantSettingResource","Flash","creditList","$stateParams",function(e,t,a,o,s,n){var r=function(){s.query(function(t){e.lists=t.data})};r(),a.get(function(t){e.creditDisInfo=t,e.credit_rule={value:e.creditDisInfo.credit_rule}}),e.creditDisBut_text="保存",e.creditDisClick=function(){e.creditDisBut_text="保存中",a.update({credit_rule:e.credit_rule.value},function(a){1==a.success?(o.create("success","设置成功"),e.creditDisInfo.credit_rule=e.credit_rule.value,t.close()):o.create("danger","设置失败"),e.creditDisBut_text="保存"})},e.cancel=function(){t.close()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?(o.create("success","删除成功"),r()):o.create("danger","删除失败")})},e.IsOpenCredit=function(e,t){var a=1==t?0:1,o={id:e,enabled:a};s.update(o,function(e){r()})}}])}),define("apps/member/controllers/credit.info",["apps/common/controllers/controllers"],function(e){e.controller("member.credit.info",["$scope","Flash","creditItem","$location","$stateParams",function(e,t,a,o,s){s.id?(e.title="编辑积分规则",e.btn_text="修改",e.items=a.get({id:s.id})):(e.title="添加积分规则",e.btn_text="保存",e.items={condition:"",credit:"",type:1}),e.creditAddClick=function(){var n=!1,r=/^[1-9]+[0-9]*]*$/;""==e.items.type?t.create("danger","请选着奖励类型"):((1==e.items.type&&""==e.items.credit||2==e.items.type&&""==e.items.condition)&&(t.create("danger","请输入奖励条件"),n=!1),1==e.items.type&&""!=e.items.credit&&(r.test(e.items.credit)?n=!0:(t.create("danger","请输入大于0的整数"),e.items.credit="")),2==e.items.type&&""!=e.items.condition&&(r.test(e.items.condition)?n=!0:(t.create("danger","请输入大于0的整数"),e.items.condition=""))),n&&(s.id?a.update({id:s.id},e.items,function(e){e.success?(t.create("success","修改成功"),o.path("/member/credit")):t.create("danger","修改失败")}):a.save(e.items,function(e){e.success?(t.create("success","添加成功"),o.path("/member/credit")):t.create("danger","添加失败")}))},e.creditGoback=function(){o.path("/member/credit")}}])}),define("apps/member/controllers/credit.list",["apps/common/controllers/controllers"],function(e){e.controller("member.credit.list",["$scope","Flash","$stateParams","creditannal",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:10},e.creditRange="",e.searchInfo={nickname:"",creditStyle:"",startDate:"",endDate:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},a.id&&(e.searchInfo.level_id=a.id,e.isMemberList=!0);var s=function(){var t=$('input[name="created_range"]').val();""!=t&&(t=t.split("/"),e.searchInfo.startDate=t[0],e.searchInfo.endDate=t[1]),a.id&&(e.searchInfo.member_id=a.id),e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.query(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.creditList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/member/controllers/vipcard",["apps/common/controllers/controllers"],function(e){e.controller("member.vipcard",["$scope","vipCardList","Flash",function(e,t,a){var o=function(){t.query(function(t){e.cardList=t.data})};o(),e.confirmDelete=function(e){t.delete({id:e},function(e){e.success?(a.create("success","删除成功"),o()):a.create("danger","删除失败")})}}])}),define("apps/member/controllers/vipcard.info",["apps/common/controllers/controllers"],function(e){e.controller("member.vipcard.info",["$scope","vipCardItem","Flash","$location","$stateParams",function(e,t,a,o,s){function n(){""==e.vipCardItem.background_img?e.showBgColor.text="background-color:"+e.vipCardItem.background_color.value+";":e.showBgColor.text="background-image:url("+_global.url.ms+e.vipCardItem.background_img+");background-size:100% 100%;"}e.people=[{name:"Color001",value:"#55bd47"},{name:"Color002",value:"#10ad61"},{name:"Color003",value:"#35a4de"},{name:"Color004",value:"#3d78da"},{name:"Color005",value:"#de9c33"},{name:"Color006",value:"#35a4de"},{name:"Color007",value:"#ebac16"},{name:"Color008",value:"#f9861f"},{name:"Color009",value:"#f08500"},{name:"Color010",value:"#e75735"},{name:"Color011",value:"#d54036"},{name:"Color012",value:"#cf3e36"}],e.showBgColor={text:""},e.editorOptions=angular.extend({},window._editorOptions,{extraPlugins:"uploadimage",height:"150px"}),s.id?(e.title="编辑会员卡",e.butInfo={text:"修改",status:!1},e.IsEditCard={type:!0},t.query({id:s.id},function(t){e.vipCardItem=t,n()})):(e.IsEditCard={type:!1},e.title="新加会员卡",e.butInfo={text:"保存",status:!1},e.IsOpenFree=!1,e.vipCardItem={background_color:{name:"Color001",value:"#55bd47"},background_img:"",level_name:"",level_num:"",discount:"",is_postage_free:0,points_limit:"",amount_limit:"",trade_limit:"",description:"",type:1,service_tel:"",card_buy:[]},n());var r=function(){var t=new Date,a=t.getFullYear()+"-",o=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",s=(t.getDate()-1<10?"0"+(t.getDate()-1):t.getDate()-1)+" ",n=t.getHours()+":",r=t.getMinutes()+":",i=t.getSeconds();e.currentTime=a+o+s+n+r+i};r(),e.addVipItem=function(){var t={price:"",member_time:""};e.vipCardItem.card_buy.push(t)},e.deleteItem=function(t){e.vipCardItem.card_buy.splice(t,1)},e.$watch("upload",function(){angular.isUndefined(e.upload)||(e.upload.length>0?e.vipCardItem.background_img=e.upload[0].url:e.vipCardItem.background_img="",n())},!0),e.isPostageFreeClick=function(){0==e.vipCardItem.is_postage_free?e.vipCardItem.is_postage_free=1:e.vipCardItem.is_postage_free=0},e.cardBgColorClick=function(t,a){e.vipCardItem.background_color.name=t,e.vipCardItem.background_color.value=a,n()},e.VipCardSave=function(n){var r=!0;if(n.vipCard_title.$invalid)return n.vipCard_title.$dirty=!0,$("input[name='vipCard_title']").focus(),!1;if(n.vipCard_level_num.$invalid)return n.vipCard_level_num.$dirty=!0,$("input[name='vipCard_level_num']").focus(),!1;if(2==e.vipCardItem.type){for(var i=[],c=e.vipCardItem.card_buy,l=0;l<c.length;l++){var d=c[l];if(i.push(d.member_time),!/^[1-9]\d*$/.test(d.member_time)){a.create("danger","购买月份请输入正整数"),r=!1;break}if(!/^[0-9]+(.[0-9]{1,3})?$/.test(d.price)){a.create("danger","请输入正确的购买价格"),r=!1;break}}for(var p=i.sort(),l=0;l<p.length;l++)if(p[l]==p[l+1]){a.create("danger","购买月份不能重复"),r=!1;break}r?n.$dirty=!0:n.$dirty=!1}else e.vipCardItem.card_buy="";n.$dirty&&(e.butInfo.text="保存中...",e.butInfo.status=!0,s.id?t.update(e.vipCardItem,function(t){t.success?(a.create("success","修改成功"),o.path("/member/vipcard")):a.create("danger","修改失败"),e.butInfo.text="修改",e.butInfo.status=!1}):t.save(e.vipCardItem,function(t){e.form.$invalid=!1,t.success?(a.create("success","添加成功"),o.path("/member/vipcard")):a.create("danger","添加失败"),e.butInfo.text="保存",e.butInfo.status=!1}))},e.VipCardGoback=function(){o.path("/member/vipcard")}}])}),define("apps/member/controllers/vipcard.discount",["apps/common/controllers/controllers"],function(e){e.controller("member.vipcard.discount",["$scope","Flash","memberDiscount","$modal",function(e,t,a,o){e.goodsSearchTypes=[{type:"title",name:"商品标题"}],e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={title:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var s=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.list=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.addDiscountGoods=function(){var e=o.open({animation:!1,templateUrl:"assets/js/apps/member/templates/add_goods_tpl.html",controller:"discount.add_goods.tpl",windowClass:"modal-open"});e.result.then(function(e){s()})},e.editDiscountGoods=function(e){e.type="edit";var t=o.open({animation:!1,templateUrl:"assets/js/apps/member/templates/choice_goods_tpl.html",controller:"discount.choice_goods.tpl",resolve:{item:function(){return e}}});t.result.then(function(e){s()})},e.deleteDiscountGoods=function(e){a.delete({id:e},function(e){1==e.success?(t.create("success","删除成功"),s()):t.create("danger","删除失败")})}}])}),define("apps/member/controllers/member.balance",["apps/common/controllers/controllers"],function(e){e.controller("member.balance",["$scope","Flash","$stateParams","balanceRecord",function(e,t,a,o){function s(){var t=$('input[name="created_range"]').val(),o={};return""!=t&&(t=t.split("/"),o.startDate=t[0],o.endDate=t[1]),1==e.searchInfo.stype?o.user_id=e.searchInfo.search_val:o.phone_num=e.searchInfo.search_val,a.id&&(o.member_id=a.id),o.detail=e.searchInfo.detail,o.type="请选择"==e.searchInfo.type?"":e.searchInfo.type,o.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,o.limit=e.paginationConf.itemsPerPage,o.column=e.searchInfo.column,o.direction=e.searchInfo.direction,o}e.paginationConf={currentPage:1,itemsPerPage:10},e.exportInfo={limit_from:0,limit_to:100},e.export=function(){var a="/merchant/balanceDetails.json?",o=s(),n="";o.export="yes",o.limit_from=e.exportInfo.limit_from,o.limit_to=e.exportInfo.limit_to;for(var r in o){var i=o[r];n+=encodeURIComponent(r)+"="+encodeURIComponent(i)+"&"}n.length>0&&(n=n.substring(0,n.length-1),a+=n),t.create("success","余额记录导出成功"),window.location.href=a},
e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.creditRange="",e.searchInfo={stype:"1",search_val:"",detail:"",style:"",type:"",startDate:"",endDate:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,direction:"desc",column:"date"};var n=function(){var t=s();o.query(t,function(t){e.paginationConf.totalItems=t._count,e.balanceList=t.data,e.balanceType=t.type})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.sortClass=function(t,a){return e.searchInfo.column==t&&e.searchInfo.direction==a},e.swtichSort=function(t){e.searchInfo.column==t?e.searchInfo.direction="desc"==e.searchInfo.direction?"asc":"desc":(e.searchInfo.column=t,e.searchInfo.direction="desc"),n()}}])}),define("apps/member/controllers/member.withdraw",["apps/common/controllers/controllers"],function(e){e.controller("member.withdraw",["$scope","memberWithdrawSource","memberRemarkSource","Flash","ngPopover","cashierResult","transferResult","withdrawStatusRes","memberWithdrawBatchPass",function(e,t,a,o,s,n,r,i,c){e.searchInfo={stype:"1",keyword:"",status:"-1"},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.searchType="提现编号";var l=function(){var a=$('input[name="created_range"]').val();if(""!=a){a=a.split("/");var o=a[0],s=a[1]}if(""!=e.searchInfo.status)var n=e.searchInfo.status;var r={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,stype:e.searchInfo.stype,keyword:e.searchInfo.keyword,startDate:o,endDate:s,status:n};e.withdraws=[],t.get(r,function(t){e.paginationConf.totalItems=t._count,angular.forEach(t.data,function(t,a){t.okStatus=!1,t.refuseStatus=!1,t.checked=!1,t.isEachRepeat=!1,t.isWxRepeatItem=!1,e.withdraws.push(t)}),d()})};e.paginationConf={currentPage:1,itemsPerPage:50},e.checkedAll={checked:!1,repeatArr:[]};var d=function(){angular.forEach(e.withdraws,function(t,a){1!=t.type||t.isEachRepeat||0!=t.status&&10!=t.status||e.withdraws.filter(function(e,o){e.member_mobile==t.member_mobile&&o!=a&&(e.isEachRepeat=!0,e.isWxRepeatItem=!0)})})};e.checked=function(t,a,s){switch(a){case"one":e.withdraws[t].checked?1==s.type&&angular.forEach(e.withdraws,function(e,a){t!=a&&s.member_mobile==e.member_mobile&&(e.checked=!1,o.create("warning","由于微信限制，同一用户微信钱包提现只能选择一项"))}):e.checkedAll.checked=!1;break;case"all":e.checkedAll.checked?angular.forEach(e.withdraws,function(e,t){0!=e.status&&10!=e.status||0!=e.okStatus||e.isWxRepeatItem||(e.checked=!0)}):angular.forEach(e.withdraws,function(e,t){e.checked=!1})}},e.bacthPassDisabled=!1,e.bacthPassDisabledText="通过提现申请",e.confirmCheckAll=function(){e.bacthPassDisabled=!0,e.bacthPassDisabledText="正在通过提现申请...";var t=[];return angular.forEach(e.withdraws,function(e,a){if(e.checked){var o={id:e.id};10==e.status?o.repeat=1:o.repeat=0,t.push(o)}}),0==t.length?(o.create("warning","请先勾选提现申请选项"),e.bacthPassDisabled=!1,e.bacthPassDisabledText="通过提现申请",!1):void c.put({status:1,data:t},function(t){t.status?(o.create("success",t.msg),l(),e.checkedAll.checked=!1):o.create("danger",t.msg),e.bacthPassDisabled=!1,e.bacthPassDisabledText="通过提现申请"})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.$watch("searchInfo.stype",function(t){switch(e.searchInfo.keyword="",t){case"1":e.searchType="提现编号";break;case"2":e.searchType="开户姓名";break;case"3":e.searchType="会员账号";break;case"4":e.searchType="手机号"}}),e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.export=function(){var t="/member/member_withdraws.json?";if($('input[name="keyword"]').val()&&(t+="stype="+e.searchInfo.stype+"&keyword="+$('input[name="keyword"]').val()+"&"),$('input[name="created_range"]').val()){var a=$('input[name="created_range"]').val(),s=a.split("/");t+="startDate="+s[0]+"&endDate="+s[1]+"&"}$('select[name="status"]').val()&&(t+="status="+$('select[name="status"]').val()),t+="&export=yes",window.location.href=t,o.create("success","会员提现纪录正在导出...")},e.updateStatus=function(a,s){t.checkMoney({id:a.id},function(t){e.withdraws[s].status_name=t.status_name,e.withdraws[s].status=t.status,o.create("success","验证成功，提现状态:"+t.status_name)})},e.refresh=function(t,a){var s=t.type?r:n;6==t.status&&(s=i),e.withdraws[a].disabled=1,s.get({id:t.id},function(t){return e.withdraws[a].disabled=0,t.status?(l(),void o.create("success",t.msg)):(o.create("danger",t.error),e.withdraws[a].is_validate=0,!1)},function(t){return e.withdraws[a].disabled=0,e.withdraws[a].is_validate=0,o.create("danger",t.data.error),!1})},e.confirmCross=function(e){e.okStatus=!0,e.refuseStatus=!0;var a={id:e.id,status:1};10==e.status&&(a.repeat=1),t.putWithdraw(a,function(e){e.success?(o.create("success","操作成功"),l()):(o.create("danger",e.error),l())})},e.refuseInfo={id:"",cashpay_err:""},e.set_RefuseInfo=function(t,a){e.refuseInfo.id=t.id,e.refuseInfo.status=t.status,e.refuseInfo.cashpay_err=t.cashpay_err,e.refuseInfo.index=a},e.disabledRefuseStatus=!1,e.confirmRefuse=function(){if(""==e.refuseInfo.cashpay_err)return o.create("danger","请填写拒绝原因"),!1;e.disabledRefuseStatus=!0;var a={id:e.refuseInfo.id,status:2,cashpay_err:e.refuseInfo.cashpay_err};10==e.refuseInfo.status&&(a.repeat=1),t.putWithdraw(a,function(t){t.success?(e.disabledRefuseStatus=!1,o.create("success","操作成功"),s.close(),l()):(e.disabledRefuseStatus=!1,o.create("danger",t.error),s.close(),l())})},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a},e.set_remark=function(){var t={id:e.remarkInfo.id,content:e.remarkInfo.text};t.content?a.update(t,function(t){t.success&&(o.create("success","提交成功"),s.close(),e.withdraws[e.remarkInfo.index].remark=e.remarkInfo.text)}):o.create("danger","请填写备注")},e.cancel=function(){s.close(),e.remarkInfo={id:"",text:""}}}])}),define("apps/member/controllers/member.setting",["apps/common/controllers/controllers"],function(e){e.controller("member.setting",["$scope","Flash","merchantSettingResource",function(e,t,a){e.data=a.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.update(e.data,function(o){e.form.$invalid=!1,e.merchant_info=a.get(),e.btn_text="保存",t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/member/controllers/member.withdraw_setting",["apps/common/controllers/controllers"],function(e){e.controller("member.withdraw_setting",["$scope","memberWithdrawSettingSource","merchantSettingSource","Flash","ngPopover",function(e,t,a,o,s){e.entity={disable:!1,enabled:!0,min_money:1,wx_enabled:1},t.get(function(t){t&&(e.entity={disable:!t.withdraw_enabled,enabled:t.setting&&!t.setting.withdraw_enabled?0:1,wx_enabled:t.setting&&!t.setting.wx_withdraw_enabled?0:1,min_money:t.setting&&t.setting.min_money?t.setting.min_money:1})}),e.submitForm=function(){if(!e.entity.enabled&&!e.entity.wx_enabled)return o.create("danger","请至少选择一种提现方式"),!1;var t={member_withdraw:{withdraw_enabled:e.entity.enabled,min_money:e.entity.min_money,wx_withdraw_enabled:e.entity.wx_enabled}};e.form.$invalid=!0,a.save(t,function(t){return e.form.$invalid=!1,t.success?void o.create("success","保存成功"):(o.create("danger","修改失败"),!1)})}}])}),define("apps/member/controllers/discount.add_goods",["apps/common/controllers/controllers"],function(e){e.controller("discount.add_goods.tpl",["$scope","getDiscountGoods","tagResource","$modalInstance","$modal",function(e,t,a,o,s){function n(){a.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.cancel=function(){o.dismiss("cancel")},e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},n();var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){r()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",r()},e.choice=function(e){var t={id:"",discount:[],goods_id:e.id,img:e.img,price:e.price,title:e.title},a=s.open({animation:!1,templateUrl:"assets/js/apps/member/templates/choice_goods_tpl.html",controller:"discount.choice_goods.tpl",resolve:{item:function(){return t}}});a.result.then(function(e){o.close(1)})}}])}),define("apps/member/controllers/discount.choice_goods.tpl",["apps/common/controllers/controllers"],function(e){e.controller("discount.choice_goods.tpl",["$scope","Flash","$modalInstance","item","memberDiscount","vipCardList",function(e,t,a,o,s,n){e._global=_global,e.data=o;var r=/(^-?\d{1})+(.\d{1,2})?$/;n.query(function(t){for(var a=t.data,s=o.discount,n=0;n<a.length;n++){a[n].checked=!1;for(var r=0;r<s.length;r++)a[n].id==s[r].vipcard_id&&(a[n].checked=!0)}e.cardList=a}),e.selectCard=function(t){var a={discount:"",name:t.level_name,vipcard_id:t.id};t.checked?angular.forEach(e.data.discount,function(a,o){t.id==a.vipcard_id&&(e.data.discount.splice(o,1),t.checked=!1)}):(t.checked=!0,e.data.discount.push(a))},e.cancel=function(){a.dismiss("cancel")},e.btn_text="保存",e.submitForm=function(){var o=!1;return angular.forEach(e.data.discount,function(e,a){return r.test(e.discount)&&e.discount>0?void(o=!0):(t.create("danger",'请输入"'+e.name+'"的正确折扣.'),!1)}),0==e.data.discount.length?(t.create("danger","请至少选择一个会员卡"),!1):void(o&&(e.btn_text="保存中...",e.form.$invalid=!0,""==e.data.id?s.add(e.data,function(o){1==o.success?(t.create("success","保存成功"),a.close(1)):t.create("danger","保存失败"),e.btn_text="保存",e.form.$invalid=!1}):s.edit(e.data,function(o){1==o.success?(t.create("success","保存成功"),a.close(1)):t.create("danger","保存失败"),e.btn_text="保存",e.form.$invalid=!1})))}}])}),define("apps/member/controllers/member.extend",["apps/common/controllers/controllers"],function(e){e.controller("member.extend",["$scope","vipExtendList","vipExtendListHeaders","Flash",function(e,t,a,o){var s=function(){a.get(function(t){e.extendheaders=t.data})};s(),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.query(e.searchInfo,function(t){e.paginationConf.totalItems=t.count,e.extendlist=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.confirmDelete=function(e){vipCardList.delete({id:e},function(e){e.success?(o.create("success","删除成功"),getVipCard()):o.create("danger","删除失败")})}}])}),define("apps/member/controllers/member.extend.setting",["apps/common/controllers/controllers"],function(e){e.controller("member.extend.setting",["$scope","vipExtend","vipExtendEdit","Flash",function(e,t,a,o){var s=function(){t.get(function(t){e.extend=t})};s(),e.btn_text="保存",e.submitForm=function(t){t&&(e.btn_text="保存中...",e.form.$invalid=!0,a.put(e.extend,function(){e.form.$invalid=!1,e.btn_text="保存",o.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/member/controllers/_base",["apps/member/controllers/main","apps/member/controllers/list","apps/member/controllers/credit","apps/member/controllers/credit.info","apps/member/controllers/credit.list","apps/member/controllers/vipcard","apps/member/controllers/vipcard.info","apps/member/controllers/vipcard.discount","apps/member/controllers/member.balance","apps/member/controllers/member.withdraw","apps/member/controllers/member.setting","apps/member/controllers/member.withdraw_setting","apps/member/controllers/discount.add_goods","apps/member/controllers/discount.choice_goods.tpl","apps/member/controllers/member.extend","apps/member/controllers/member.extend.setting"],function(){}),define("apps/member/directives/menu",["apps/common/directives/directives"],function(e){e.directive("memberMenu",[function(){return{restrict:"A",replace:!0,templateUrl:"assets/js/apps/member/templates/menu.html"}}])}),define("apps/member/directives/_base",["apps/member/directives/menu"],function(){}),define("apps/member/main",["apps/member/states/_base","apps/member/services/_base","apps/member/controllers/_base","apps/member/directives/_base"],function(){}),define("apps/credit/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("credit",{url:"/credit",abstract:!0,templateUrl:"assets/js/apps/credit/templates/layout.html"}).state("credit.dashboard",{url:"",templateUrl:"assets/js/apps/credit/templates/main.html",controller:"credit.main"}).state("credit.record",{url:"/record",templateUrl:"assets/js/apps/credit/templates/credit.record.html",controller:"credit.record"}).state("credit.recordDetail",{url:"/record/:id",templateUrl:"assets/js/apps/credit/templates/credit.record.html",controller:"credit.record"}).state("credit.setting",{url:"/setting",templateUrl:"assets/js/apps/credit/templates/credit.setting.html",controller:"credit.setting"})}])}),define("apps/credit/states/goods",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("credit.goods",{abstract:!0,url:"/goods",templateUrl:"assets/js/apps/credit/templates/credit.goods_tab.html"}).state("credit.goods.list",{url:"",templateUrl:"assets/js/apps/credit/templates/credit.goods.html",controller:"credit.goods_list"}).state("credit.goods.add",{url:"/goods_add/:goods_id",templateUrl:"assets/js/apps/credit/templates/credit.goods_add.html",controller:"credit.add_goods"}).state("credit.goods.edit",{url:"/goods_edit/:id",templateUrl:"assets/js/apps/credit/templates/credit.goods_add.html",controller:"credit.add_goods"}).state("credit.goods.design",{url:"/design",templateUrl:"assets/js/apps/credit/templates/credit.design.html",controller:"credit.design"})}])}),define("apps/credit/states/config",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("credit.config",{abstract:!0,url:"/config",template:"<div ui-view></div>"}).state("credit.config.main",{url:"",templateUrl:"assets/js/apps/credit/templates/credit.config.html",controller:"credit.config"})}])}),define("apps/credit/states/_base",["apps/credit/states/main","apps/credit/states/goods","apps/credit/states/config"],function(){}),define("apps/credit/controllers/main",["apps/common/controllers/controllers","echarts"],function(e,t){e.controller("credit.main",["$scope","creditMain","Flash",function(e,a,o){var s=t.init(document.getElementById("creditSendChart")),n=t.init(document.getElementById("creditSpendChart")),r=function(){var e={title:{text:"发放积分渠道概况",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:m},toolbox:{feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"积分",type:"pie",radius:"55%",center:["50%","60%"],data:u}]};s.setOption(e)},i=function(){var e={tooltip:{trigger:"axis"},legend:{data:["发放积分","消耗积分"]},grid:{x:80,x2:50,y:40,y2:30,borderWidth:0,containLabel:!0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:l}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"发放积分",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:p},{name:"消耗积分",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:d}]};n.setOption(e)},c=[],l=[],d=[],p=[],u=[],m=[];a.get(function(t){e.expendCredit=t.expendCredit,e.sendCredit=t.sendCredit,c=t.data,angular.forEach(c,function(e,t){l.push(e.time),d.push(e.spendCredit),p.push(e.sendCredit)}),u=t.sendData,angular.forEach(u,function(e,t){m.push(e.name)}),r(),i()}),e.updateCircle=function(){a.update(function(t){t.status?(e.sendCredit=t.data.sendCredit,e.expendCredit=t.data.expendCredit,o.create("success"," 更新成功！")):o.create("danger",t.msg)})}}])}),define("apps/credit/controllers/design",["apps/common/controllers/controllers"],function(e){e.controller("credit.design",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","creditDesignResource","creditGoodsResource",function(e,t,a,o,s,n,r,i,c){e.config={title:"积分商城"},e.slices=[{type:"credit_head"},{type:"credit_goods",content:{itemList:[]}}],e.data=[],i.get(function(t){t.data.length>0&&(e.slices=t.data,e.config.title=t.title||"积分商城")}),c.get(function(t){t.data.length>0&&(e.data=t.data.length>4?t.data.splice(0,4):t.data)}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.saveBtnDisabled=!1,e.saveBtnText="保存",e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.removeSlice=function(t){e.slices.splice(t,1),e.designs=!1},e.editSlice=function(t,o){return(!t.type||t.type.indexOf("credit_")==-1)&&(angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.designs=t,void a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200))},e.save=function(){var a=angular.copy(e.slices);for(var o in a){var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.saveBtnDisabled=!0,e.saveBtnText="保存中...",i.update({data:a,title:e.config.title},function(a){return e.saveBtnDisabled=!1,e.saveBtnText="保存",a.success?(t.create("success"," 保存成功！"),!1):(t.create("danger",a.error),!1)},function(a){t.create("danger",a.data.error.message),e.saveBtnDisabled=!1,e.saveBtnText="保存"})}}])}),define("apps/credit/controllers/setting",["apps/common/controllers/controllers"],function(e){e.controller("credit.setting",["$scope","Flash","ngPopover","creditSettingResource","rankUpdateResource","videoAddress",function(e,t,a,o,s,n){e.videoAddress=n,e.credit={credit_rule:100,credit_rank:{open:0,num:"10"}},e.rankUrl={url:""};var r=function(){o.get(function(t){e.rankUrl.url=t.credit_rank_url,e.credit.credit_rule=t.credit_rule,t.credit_rank&&(e.credit.credit_rank=t.credit_rank)})};r(),e.saveBtnDisabled=!1,e.saveBtnText="保存",e.submitForm=function(){e.saveBtnDisabled=!0,e.saveBtnText="保存中...",o.save(e.credit,function(a){return e.saveBtnDisabled=!1,e.saveBtnText="保存",a.error?(t.create("danger",a.msg||"保存失败"),!1):void t.create("success","保存成功")},function(a){return e.saveBtnDisabled=!1,e.saveBtnText="保存",t.create("danger",a.data.error),!1})},e.updateRank=function(){s.get(function(e){e.status?t.create("success",e.msg):t.create("danger",e.msg)})},e.showMessage=function(){a.close(),t.create("success"," 复制成功！")},e.fallback=function(){Utils.prompt("Press cmd+c to copy the text below.",e.rankUrl.url)}}])}),define("apps/credit/controllers/config",["apps/common/controllers/controllers"],function(e){e.controller("credit.config",["$scope","creditTool","Flash",function(e,t,a){var o=function(){t.get(function(t){t?(e.data=t,e.item=t.moneyCredit,e.credit=t.check,0==e.item.length&&(e.item=[{amount:0,credit:0}])):(e.credit={phoneCheck:0,confirmCheck:0,shareCheck:0,moneyCheck:0},e.item=[{amount:0,credit:0}],e.data={phoneCredit:0,confirmCredit:0,shareCredit:0,moneyCredit:e.item,check:e.credit})})};o(),e.addCreditItem=function(){return!(e.item.length>=5)&&void e.item.push({amount:0,credit:0})},e.deleteItem=function(t){e.item.splice(t,1)},e.submitDisabled=!1,e.saveButton="保存",e.submitForm=function(o){var s=1,n=[];if(e.submitDisabled=!0,e.saveButton="提交中...",e.credit.moneyCheck){angular.forEach(e.item,function(t,o){n.push(t.amount),parseFloat(t.amount)<=0&&(a.create("danger","订单金额必须大于0"),s=0,e.submitDisabled=!1,e.saveButton="保存"),t.credit<=0&&(a.create("danger","积分数必须大于0"),s=0,e.submitDisabled=!1,e.saveButton="保存")});var r=n.sort();angular.forEach(n,function(t,o){r[o]==r[o+1]&&(a.create("danger","消费金额不能重复"),e.submitDisabled=!1,e.saveButton="保存",s=0)})}else angular.forEach(e.item,function(e,t){parseFloat(e.amount)<=0&&(e.amount="1.00"),e.credit<=0&&(e.credit=1)});o&&s&&(e.data.moneyCredit=e.item,t.save(e.data,function(t){t&&(a.create("success","保存成功"),e.submitDisabled=!1,e.saveButton="保存")}))}}])}),define("apps/credit/controllers/record",["apps/common/controllers/controllers"],function(e){e.controller("credit.record",["$scope","Flash","recordList","$stateParams",function(e,t,a,o){function s(){var t=$('input[name="created_range"]').val(),a={};return""!=t&&(t=t.split("/"),a.startDate=t[0],a.endDate=t[1]),1==e.searchInfo.stype?a.user_id=e.searchInfo.search_val:a.phone_num=e.searchInfo.search_val,o.id&&(a.member_id=o.id,e.isDetail=!0),2==e.nickname.id_type?(a.phone_num=e.nickname.user_id,a.user_id=""):(a.user_id=e.nickname.user_id,a.phone_num=""),a.detail=e.searchInfo.detail,a.type="请选择"==e.searchInfo.type?"":e.searchInfo.type,a.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,a.limit=e.paginationConf.itemsPerPage,a.column=e.searchInfo.column,a.direction=e.searchInfo.direction,a.creditStyle=e.searchInfo.creditStyle,a}e.paginationConf={currentPage:1,itemsPerPage:10},e.exportInfo={limit_from:0,limit_to:100},e.export=function(){var a="/credit/details.json?",o=s(),n="";o.export="yes",o.limit_from=e.exportInfo.limit_from,o.limit_to=e.exportInfo.limit_to;for(var r in o){var i=o[r];n+=encodeURIComponent(r)+"="+encodeURIComponent(i)+"&"}n.length>0&&(n=n.substring(0,n.length-1),a+=n),t.create("success","积分记录导出成功"),window.location.href=a},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.searchInfo={creditStyle:"0",stype:"1",search_val:"",detail:"",style:"",type:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"time",startDate:"",endDate:"",direction:"desc"},e.nickname={id_type:"1",user_id:""},e.$watch("nickname.id_type",function(t){e.nickname.user_id="","2"==t?e.idTypeTip="请输入手机号":e.idTypeTip="请输入会员账号"}),e.dates="",e.saveBtnDisabled=!1;var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage;var t=($('input[name="created_range"]').val(),s());a.get(t,function(t){e.saveBtnDisabled=!1,t.data?(e.paginationConf.totalItems=t._count,e.creditList=t.data):e.creditList=[]})};e.sortClass=function(t,a){return e.searchInfo.column==t&&e.searchInfo.direction==a},e.sort=function(t){e.searchInfo.column==t?e.searchInfo.direction="desc"==e.searchInfo.direction?"asc":"desc":(e.searchInfo.column=t,e.searchInfo.direction="desc"),n()},e.search=function(){e.saveBtnDisabled=!0,1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage+paginationConf.itemsPerPage",n)}])}),define("apps/credit/controllers/goods",["apps/common/controllers/controllers"],function(e){e.controller("credit.goods_list",["$scope","$stateParams","$state","Flash","goodsResource","creditGoodsResource",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={title:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},e.saveBtnDisabled=!1,e.saveBtnText="筛选";var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,n.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.saveBtnDisabled=!1})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){e.saveBtnDisabled=!0,1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.removeItem=function(t,a){n.remove({id:t},function(t){return t.status?(e.data.splice(a,1),void o.create("success","删除成功")):(o.create("danger","删除失败"),!1)})}}]).controller("credit.add_goods",["$scope","$stateParams","$state","Flash","goodsResource","creditGoodsResource","creditGoodsDetailRes",function(e,t,a,o,s,n,r){var i=e.id=t.id;e.entity={goods_id:t.goods_id,is_enabled:1,is_forced:0},e.credit_text="积分最多可抵扣金额",e.$watch("entity.is_forced",function(t){"1"==t?e.credit_text="必须使用积分抵扣金额":e.credit_text="积分最多可抵扣金额"}),e.entity.is_enabled&&e.$watch("entity.discount",function(t,a){t<=0&&(e.form.$invalid=!0)}),i&&r.get({id:i},function(t){e.good={img:t.img,title:t.title,is_sku:t.is_sku,price:t.price,stock:t.stock,max_price:t.max_price},e.entity={id:i,is_enabled:t.is_enabled,is_forced:t.is_forced,discount:parseFloat(t.discount)}}),t.goods_id&&s.get({id:t.goods_id},function(t){e.good=t}),e.submitForm=function(t){t&&(e.form.$invalid=!0,i?n.update(e.entity,function(t){t.status?(o.create("success","保存成功"),a.go("credit.goods.list")):(e.form.$invalid=!1,o.create("danger",t.msg))},function(e){o.create("danger",e.data.error)}):n.save(e.entity,function(t){t.status?(o.create("success","保存成功"),a.go("credit.goods.list")):(e.form.$invalid=!1,o.create("danger",t.msg))},function(e){o.create("danger",e.data.error)}))}}])}),define("apps/credit/controllers/_base",["apps/credit/controllers/main","apps/credit/controllers/design","apps/credit/controllers/setting","apps/credit/controllers/config","apps/credit/controllers/record","apps/credit/controllers/goods"],function(){}),define("apps/credit/services/design",["apps/common/services/services"],function(e){e.factory("creditDesignResource",["$resource",function(e){return e("/credit/design.json",{},{update:{method:"PUT"}})}])}),define("apps/credit/services/extend",["apps/common/services/services"],function(e){e.factory("creditTool",["$resource",function(e){return e("/credit/rules.json ",{},{save:{method:"POST",url:"/credit/rule.json"},get:{method:"GET"}})}])}),define("apps/credit/services/setting",["apps/common/services/services"],function(e){e.factory("creditSettingResource",["$resource",function(e){return e("/merchant_setting.json",{},{})}]),e.factory("rankUpdateResource",["$resource",function(e){return e("/credit/credit_rank_statis.json",{},{})}])}),define("apps/credit/services/goods",["apps/common/services/services"],function(e){e.factory("creditGoodsListRes",["$resource",function(e){return e("/credit/choosecreditgoods.json",{},{})}]),e.factory("creditGoodsResource",["$resource",function(e){return e("/credit/creditgoods.json",{id:"@id"},{remove:{method:"DELETE",url:"/credit/creditgoods/:id.json"},update:{method:"PUT",url:"/credit/creditgoods/:id.json"}})}]),e.factory("creditGoodsDetailRes",["$resource",function(e){return e("/credit/getcreditgood/:id.json",{id:"@id"},{})}])}),define("apps/credit/services/record",["apps/common/services/services"],function(e){e.factory("recordList",["$resource",function(e){return e("/credit/details.json",{},{get:{method:"GET"}})}])}),define("apps/credit/services/main",["apps/common/services/services"],function(e){e.factory("creditMain",["$resource",function(e){return e("/credit/survey.json",{},{get:{method:"GET"},update:{method:"GET",url:"/credit/credit_survey_statis.json"}})}])}),define("apps/credit/services/_base",["apps/credit/services/design","apps/credit/services/extend","apps/credit/services/setting","apps/credit/services/goods","apps/credit/services/record","apps/credit/services/main"],function(){}),define("apps/credit/main",["apps/credit/states/_base","apps/credit/controllers/_base","apps/credit/services/_base"],function(){}),define("apps/trade/states/dashboard",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade",{abstract:!0,url:"/trade",templateUrl:"assets/js/apps/trade/templates/layout.html"}).state("trade.dashboard",{url:"",templateUrl:"assets/js/apps/trade/templates/dashboard.html",controller:"trade.dashboard"})}])}),define("apps/trade/states/payment",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.payment",{url:"/payment",templateUrl:"assets/js/apps/trade/templates/payment.html",controller:"trade.payment"})}])}),define("apps/trade/states/cashier",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.cashier",{abstract:!0,url:"/cashier",templateUrl:"assets/js/apps/trade/templates/cashier.tab.html"}).state("trade.cashier.main",{url:"",templateUrl:"assets/js/apps/trade/templates/cashier.html",controller:"trade.cashier"}).state("trade.cashier.qrcode",{url:"/qrcode",templateUrl:"assets/js/apps/trade/templates/cashier.qrcode.html",controller:"trade.qrcode"}).state("trade.cashier.records",{url:"/records",templateUrl:"assets/js/apps/trade/templates/cashier.records.html",controller:"trade.records"})}])}),define("apps/trade/states/record",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.record",{url:"/record/:type",templateUrl:"assets/js/apps/trade/templates/record.html",controller:"trade.record"})}])}),define("apps/trade/states/refund",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.refund",{url:"/refund",templateUrl:"assets/js/apps/trade/templates/refund.html",controller:"trade.refund"})}])}),define("apps/trade/states/qrcode",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade/qrcode",{url:"/trade/qrcode",templateUrl:"assets/js/apps/trade/templates/qrcode.html",controller:"trade.qrcode"})}])}),define("apps/trade/states/records",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.records",{url:"/records",templateUrl:"assets/js/apps/trade/templates/records.html",controller:"trade.records"})}])}),define("apps/trade/states/withdraw",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.withtab",{abstract:!0,url:"/withtab",templateUrl:"assets/js/apps/trade/templates/withtab.html"}).state("trade.withtab.list",{url:"/list",templateUrl:"assets/js/apps/trade/templates/withdraw.html",controller:"trade.withtab.list"}).state("trade.withtab.carry",{url:"/carry",templateUrl:"assets/js/apps/trade/templates/withtab.carry.html",controller:"trade.withtab.carry"}).state("trade.withdraw",{abstract:!0,url:"/withdraw",template:"<div ui-view></div>"}).state("trade.withdraw.add",{url:"/add",templateUrl:"assets/js/apps/trade/templates/withdraw.add.html",controller:"trade.withdraw.add",resolve:{incomeResourceLoader:["incomeResourceLoader",function(e){return e()}],merchantBankResourceLoader:["merchantBankResourceLoader",function(e){return e()}]}}).state("trade.withdraw.malladd",{
url:"/malladd",templateUrl:"assets/js/apps/trade/templates/withdraw.malladd.html",controller:"trade.withdraw.malladd"})}])}),define("apps/trade/states/recharge",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("trade.recharge",{url:"/recharge",templateUrl:"assets/js/apps/trade/templates/recharge.html",controller:"trade.recharge"})}])}),define("apps/trade/states/_base",["apps/trade/states/dashboard","apps/trade/states/payment","apps/trade/states/cashier","apps/trade/states/record","apps/trade/states/refund","apps/trade/states/qrcode","apps/trade/states/records","apps/trade/states/withdraw","apps/trade/states/recharge"],function(){}),define("apps/trade/services/payment",["apps/common/services/services"],function(e){e.factory("paymentResource",["$resource",function(e){return e("/trade/payment/:id.json",{id:"@id"},{update:{method:"PUT"},query:{isArray:!1}})}]),e.factory("paymentOpenResource",["$resource",function(e){return e("/trade/open/:id.json",{id:"@id"},{update:{method:"PUT"}})}]),e.factory("checkWXPayment",["$resource",function(e){return e("/trade/check_payment.json",{},{query:{isArray:!1}})}]),e.factory("settinginfoResource",["$resource",function(e){return e("/trade/paymentapply.json",{},{get:{method:"GET",url:"/trade/paymentapply.json"},update:{method:"POST",url:"/trade/paymentapply.json"}})}]),e.factory("rrdsPaymentResource",["$resource",function(e){return e("/trade/cashier_rrdPayment.json",{},{get:{method:"GET",url:"/trade/cashier_rrdPayment.json"}})}]),e.factory("rrdsPaymentRrdSData",["$resource",function(e){return e("/trade/cashier_getRrdSData.json",{},{get:{method:"GET",url:"/trade/cashier_getRrdSData.json"}})}]),e.factory("rrdsPaymentOpenRrdS",["$resource",function(e){return e("/trade/cashier_openRrdS.json",{},{get:{method:"GET",url:"/trade/cashier_openRrdS.json"}})}]),e.factory("rrdsPaymentRrdSDataUrl",["$resource",function(e){return e("/trade/cashier_getRrdSDataUrl.json",{},{get:{method:"GET",url:"/trade/cashier_getRrdSDataUrl.json"}})}])}),define("apps/trade/services/record",["apps/common/services/services"],function(e){e.factory("recordResource",["$resource",function(e){return e("/trade.json",{},{update:{method:"PUT"}})}]),e.factory("mallbalncelistResource",["$resource",function(e){return e("/mall/mallbalncelist.json",{get:{method:"GET"}})}])}),define("apps/trade/services/qrcode",["apps/common/services/services"],function(e){e.factory("qrCodeResource",["$resource",function(e){return e("/trade/cashier_qcodelist.json",{},{get:{method:"GET"}})}]),e.factory("createQrcodeResource",["$resource",function(e){return e("/trade/cashier_qcode.json",{},{create:{method:"POST"}})}])}),define("apps/trade/services/records",["apps/common/services/services"],function(e){e.factory("cashierRecordResource",["$resource",function(e){return e("/trade/cashier_recipient.json",{},{get:{method:"GET"}})}])}),define("apps/trade/services/casher",["apps/common/services/services"],function(e){e.factory("cashierResource",["$resource",function(e){return e("/trade/cashier_index.json",{},{update:{method:"GET"}})}])}),define("apps/trade/services/dashboard",["apps/common/services/services"],function(e){e.factory("dashboardResource",["$resource",function(e){return e("/stat/trade/day.json",{},{update:{method:"PUT"}})}]),e.factory("incomeResource",["$resource",function(e){return e("/trade/income.json",{},{update:{method:"PUT"}})}]),e.factory("incomeResourceLoader",["incomeResource","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}]),e.factory("mallIncomeResource",["$resource",function(e){return e("/mall/mallincome.json",{},{get:{method:"GET"}})}]),e.factory("MerchantWithdrawResource",["$resource",function(e){return e("/trade/cashier_MerchantWithdraw.json",{},{create:{method:"POST"}})}])}),define("apps/trade/services/merchant_bank",["apps/common/services/services"],function(e){e.factory("merchantBankResource",["$resource",function(e){return e("/trade/merchant_bank.json",{id:"@id"},{create:{method:"POST"},delete:{method:"DELETE",url:"/trade/merchant_bank/:id.json"},get:{method:"GET",url:"/trade/merchant_bank/:id.json"},update:{method:"PUT",url:"/trade/merchant_bank/:id.json"}})}]),e.factory("merchantBankResourceLoader",["merchantBankResource","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}])}),define("apps/trade/services/bank",["apps/common/services/services"],function(e){e.factory("bankResource",["$resource",function(e){return e("/bank.json",{},{get:{method:"GET",isArray:!0}})}])}),define("apps/trade/services/withdraw",["apps/common/services/services"],function(e){e.factory("withdrawResource",["$resource",function(e){return e("/trade/withdraw.json",{},{create:{method:"POST"}})}]),e.factory("getAccessInfo",["$resource",function(e){return e("/user/boss_auth.json",{})}]),e.factory("mallWithdrawResource",["$resource",function(e){return e("/mall/mallwithdraw.json",{get:{method:"GET"}})}]),e.factory("mallwithdrawResource",["$resource",function(e){return e("/mall/mallwithdraw.json",{},{create:{method:"POST"}})}]),e.factory("mallIncomeResource",["$resource",function(e){return e("/mall/mallincome.json",{},{get:{method:"GET"}})}])}),define("apps/trade/services/recharge",["apps/common/services/services"],function(e){e.factory("rechargeResource",["$resource",function(e){return e("/trade/income.json",{},{get:{method:"GET",url:"/trade/income.json"},update:{method:"POST",url:"/trade/recharge.json"},success:{method:"GET",url:"/trade/recharge_issuccess.json"}})}]),e.factory("rechargeResourceFactorage",["$resource",function(e){return e("/trade/recharge_rate.json?amount=:id",{id:"@id"},{get:{method:"GET"}})}])}),define("apps/trade/services/_base",["apps/trade/services/payment","apps/trade/services/record","apps/trade/services/qrcode","apps/trade/services/records","apps/trade/services/casher","apps/trade/services/dashboard","apps/trade/services/merchant_bank","apps/trade/services/bank","apps/trade/services/withdraw","apps/trade/services/recharge"],function(){}),define("apps/trade/controllers/dashboard",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("trade.dashboard",["$scope","dashboardResource","incomeResource","mallIncomeResource","$modal",function(e,a,o,s,n){var r=t.init(document.getElementById("chart")),i=[],c=[],l={tooltip:{trigger:"axis"},legend:{data:["交易总额"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:i}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"交易总额",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:c}]};a.query().$promise.then(function(e){angular.forEach(e,function(e,t){i.push(e.date),c.push(e.trade_amount)}),r.setOption(l)}),e.is_rrds=0,o.get(function(t){e.income=t,t.rrdshang&&(e.is_rrds=t.rrdshang)}),_global.is_mall_shop&&s.get(function(t){e.mallIncome=t}),e.withdrawConfirm=function(e){var t=n.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/withdrawctr.html",controller:"tradeWithdrawModelCtrl",resolve:{amounts:function(){return e}}});t.result.then(function(e){})}}]).controller("tradeWithdrawModelCtrl",["$scope","$location","$modalInstance","Flash","MerchantWithdrawResource","amounts",function(e,t,a,o,s,n){e.amountext=n,e.ok=function(n){n&&s.create({amount:e.amount},function(s){s.status?(e.is_disabled=!0,o.create("success","提交成功！"),a.close(!0),t.path("/trade/withtab/list")):(o.create("danger",s.msg),a.dismiss("cancel"))},function(e){o.create("danger",e.data.error.message)})},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/trade/controllers/qrcode",["apps/common/controllers/controllers"],function(e){e.controller("trade.qrcode",["$scope","qrCodeResource","ngPopover","Flash",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.copyOptions=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.copyUrl=function(){var e=document.getElementById("copy_url");e.select(),document.execCommand("Copy"),a.close(),o.create("success"," 复制成功！")},e.download=function(e){var e=encodeURIComponent(e),t="/trade/cashier_downqrcode.json?content="+e;window.location.href=t}}])}),define("apps/trade/controllers/cashier",["apps/common/controllers/controllers"],function(e){e.controller("trade.cashier",["$scope","Flash","cashierResource","createQrcodeResource","ngPopover",function(e,t,a,o,s){var n=function(){a.get(function(t){e.my_qrcode=t.qrcode,e.cashier={title:t.shop.name},e.data=t.record.data||[]})};n(),e.qrcode={stu:0},e.create=function(a){if(a){var s={};s.title=e.cashier.title,s.amount=e.cashier.amount,e.form.$invalid=!0,o.create(s,function(a){var o=a.data.code;e.form.$invalid=!1,a.error?t.create("danger",a.error):e.qrcode={price:o.amount,code:o.qrcode,url:o.code_url,stu:1}})}},e.open_copy=function(t){e.copy_text=t},e.copyUrl=function(){var e=document.getElementById("copy_url");e.select(),document.execCommand("Copy"),s.close(),t.create("success"," 复制成功！")},e.showMessage=function(){s.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.download=function(e){if(!e)return!1;var e=encodeURIComponent(e),t="/trade/cashier_downqrcode.json?content="+e;window.location.href=t}}])}),define("apps/trade/controllers/payment",["apps/common/controllers/controllers"],function(e){e.controller("trade.payment",["$scope","$modal","paymentResource","checkWXPayment","paymentOpenResource","settinginfoResource","Flash","rrdsPaymentResource","$sce","rrdsPaymentRrdSData","rrdsPaymentOpenRrdS",function(e,t,a,o,s,n,r,i,c,l,d){function p(e,a){var o=t.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/payment.model.html",controller:"paymentModelCtrl",resolve:{item:function(){return e},type:function(){return a}}});o.result.then(function(t){t&&1==a&&(e.enabled=!e.enabled,e.set=a)})}function u(e){s.update({id:e.id},function(t){r.create("success"," 操作成功！"),e.enabled=!e.enabled},function(e){r.create("danger",res.data.error.message)})}e.payment=a.query(),e.payConfig=function(e,t){"wxpay3"==e.code?o.query(function(a){a.status?(e.appid=a.appid,p(e,t)):r.create("danger","商户微信尚未授权，请先授权")},function(e){r.create("danger",e.data.error.message)}):p(e,t)},e.toggle_install=function(t){1!=t.set?e.payConfig(t,1):u(t)},e.is_apply=1,e.form_info={},e.is_disabled=!1,e.btn_save="申 请",e.is_rrds=0,e.is_rrd_fuck=!1,e.isSelected=!1,e.dzdf_status=0;var m=function(){l.get({},function(t){e.is_rrd_fuck=t.is_rrd_fuck,void 0!=t.data&&1==_global.is_rrds&&(e.dzdf_status=t.data.dzdf_status,1==e.dzdf_status?e.isSelected=!0:e.isSelected=!1,e.is_rrds=t.data.dzdf_status)})};m(),e.open_payment_trade_span=function(a){if(1==e.dzdf_status)return void r.create("danger","您的平台代收服务涉及到平台其它权益，暂时不能禁用，详情咨询客服：400-108-0803 ！");var o=t.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/payment.confirmmodel.html",controller:"paymentConfirmModelCtrl",resolve:{}});o.result.then(function(t){1==t&&(e.isSelected=!0,e.is_rrds=1)})},e.dzdfConfig=function(){var a=t.open({animation:!1,size:"lg",templateUrl:"assets/js/apps/trade/templates/payment.iframemodel.html",controller:"paymentIframemModelCtrl",resolve:{}});a.result.then(function(t){1==t&&(e.isSelected=!0,e.is_rrds=1)})},e.save=function(t){var a={name:e.form_info.apply_div_name,mobile:e.form_info.apply_div_tel,is_apply:e.is_apply};t&&n.update(a,function(t){t.success?(e.btn_save="正在申请……",e.is_disabled=!0,r.create("success","申请成功，请等待客服回复！")):r.create("danger",t.message)},function(e){r.create("danger",e.data.error.message)})}}]).controller("paymentConfirmModelCtrl",["$scope","$modalInstance","Flash","rrdsPaymentOpenRrdS",function(e,t,o,s){e.is_agree=1,e.cancel=function(){t.dismiss("cancel")},e.ok=function(){s.get({},function(a){0==a.errcode&&1==a.data.status?(e.is_rrds=1,t.close(e.is_rrds),o.create("success","设置成功！")):(t.dismiss("cancel"),o.create("danger",a.errmsg))},function(e){t.dismiss("cancel"),o.create("danger",a.data.error.message)})}}]).controller("paymentIframemModelCtrl",["$scope","$modalInstance","Flash","rrdsPaymentRrdSDataUrl","$sce",function(e,t,a,o,s){var n=function(){o.get({},function(t){e.rrdsinfourl=s.trustAsResourceUrl(t.url)})};n(),e.cancel=function(){t.dismiss("cancel")}}]).controller("paymentModelCtrl",["$scope","paymentResource","$modalInstance","item","type","Flash",function(e,t,a,o,s,n){t.get({id:o.id,code:o.code},function(t){e.data=t,"wxpay3"==e.data.code?e.data.is_sys=0:e.data.is_sys=t.is_sys||0,e._global=_global,e.data.code=o.code,e.form_info={apply_div_name:"",apply_div_tel:""},void 0!=_global.shop.supplier_id&&(e.data.is_sys=0),2==_global.is_rrds&&(e.data.is_sys=0),"llpay"!=e.data.code?t.config&&t.config!={}&&t.params!=[]?angular.forEach(t.config,function(e,a){""!=a&&(t.params[a].model=e)}):"wxpay3"==e.data.code&&(e.data.is_facilitator=0,e.data.config={app_id:o.appid,key:"",mchid:""},angular.forEach(t.config,function(e,a){""!=a&&(t.params[a].model=e)})):t.config&&t.config!={}&&t.params!=[]&&angular.forEach(t.config,function(e,a){angular.forEach(e,function(e,o){""!=o&&"risk_item"!=o&&(t.params[a][o].model=e)})})}),e.ok=function(r){if(r){var i={id:o.id,code:o.code,is_sys:e.data.is_sys,support_sys:e.data.support_sys,listorder:e.data.listorder,pem:e.data.pem};if("llpay"!=e.data.code)e.data.params&&1!=e.data.is_sys&&(i.config={},i.is_facilitator=e.data.is_facilitator,angular.forEach(e.data.params,function(e,t){i.config[t]=e.model}),"wxpay3"==e.data.code&&1==e.data.is_facilitator&&delete i.config.key);else if(e.data.params&&1!=e.data.is_sys){var c=0,l=0;if(i.config={},angular.forEach(e.data.params,function(t,a){i.config[a]={},angular.forEach(t,function(e,t){i.config[a][t]=e.model,"virtual"==a&&(""!=e.model&&null!=e.model||(c=1)),"physical"==a&&(""!=e.model&&null!=e.model||(l=1))}),void 0!=e.data.config&&(i.config[a].risk_item=e.data.config[a].risk_item),"physical"==a?i.config[a].busi_partner=109001:i.config[a].busi_partner=101001}),1==c&&1==l)return n.create("danger","请填写分类中的商户编号和安全检验码！"),!1}e.form.$invalid=!0,s?t.save(i,function(t){e.form.$invalid=!1,a.close(1)},function(t){e.form.$invalid=!1,a.close(0)}):t.update(i,function(t){t.success?(e.form.$invalid=!1,a.close(1)):(e.form.$invalid=!1,n.create("danger",t.message))},function(t){e.form.$invalid=!1,n.create("danger",t.data.error.message),a.close(0)})}},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/trade/controllers/records",["apps/common/controllers/controllers"],function(e){e.controller("trade.records",["$scope","cashierRecordResource",function(e,t){e.paginationConf={currentPage:1,itemsPerPage:20},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var a=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data||[]})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",a)}])}),define("apps/trade/controllers/record",["apps/common/controllers/controllers"],function(e){e.controller("trade.record",["$scope","ngPopover","recordResource","mallbalncelistResource","$stateParams",function(e,t,a,o,s){function n(e,t){t-=1;var a=e+"-"+t+"-01",o=new Date(e,t,0),s=e+"-"+t+"-"+o.getDate();return a+"~"+s}e.status=s.type?"0":"all",e.sorts="desc",e.mallbalnce_type=!1,e.mallbalnce_table=!0,e.mallbalnce_types=!1,e.paginationConf={currentPage:1,itemsPerPage:20},e.paginationConfs={currentPage:1,itemsPerPage:20},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_no:""};var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.status=e.status,e.params.sorts=e.sorts,a.get(e.params,function(t){if(e.paginationConf.totalItems=t._count,"rrds_refund"==e.params.type){e.sum_refund=t.rrds_amount;for(var a=t.data,o=0;o<a.length;o++){var s=new Date(a[o].created_at),r=s.getFullYear(),i=s.getMonth()+1;a[o].time_at=n(r,i)}}e.data=t.data})},i=function(){e.params.offset=(e.paginationConfs.currentPage-1)*e.paginationConfs.itemsPerPage,e.params.limit=e.paginationConfs.itemsPerPage,e.params.status=e.status,e.params.sorts=e.sorts,o.get(e.params,function(t){e.paginationConfs.totalItems=t._count,e.mallbalnce_table=!0,e.data=t.data})};e.params.type="all",e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.validations="",e.set_type=function(t){return $(".sort").attr("id",""+t),e.params.type=t,e.paginationConf.currentPage=1,e.validations=t,"mallbalnce"==t?(e.mallbalnce_type=!0,e.mallbalnce_types=!0,e.mallbalnce_table=!1,1==e.paginationConfs.currentPage&&i(),void(e.paginationConfs.currentPage=1)):"mall_withdraw"==t?(e.mallbalnce_types=!0,e.mallbalnce_type=!1,void r()):(e.mallbalnce_type=!1,e.mallbalnce_types=!1,void r())},e.exportInfo={limit_from:0,limit_to:100};var c=function(e,t){t.status=angular.element(document.getElementById("selectstatus"))[0].dataset.status;var a="";for(var o in t){var s=t[o];a+=encodeURIComponent(o)+"="+encodeURIComponent(s)+"&"}return a.length>0&&(a=a.substring(0,a.length-1),e=e+"?"+a),e};e.export=function(){e.params.export="yes",e.params.limit_from=e.exportInfo.limit_from,e.params.limit_to=e.exportInfo.limit_to;var t="/trade/recordExport";t=c(t,e.params),window.location.href=t},e.search=function(){e.status=angular.element(document.getElementById("selectstatus"))[0].dataset.status;var t=$('input[name="created_range"]').val();""!=t?(e.params.dates=null,t=t.split("/"),e.params.startTime=t[0],e.params.endTime=t[1]):(e.params.startTime="",e.params.endTime=""),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},_global.is_mall_shop&&e.$watch("paginationConfs.currentPage + paginationConfs.itemsPerPage",i),e.sort=function(t,a){"asc"==t?e.sorts="desc":e.sorts="asc","mallbalnce"==a?i():r()},e.toggleRow=function(t){e.data[t].sub=!e.data[t].sub,e.data[t].icon=e.data[t].sub?"minus":"plus"}}])}),define("apps/trade/controllers/refund",["apps/common/controllers/controllers"],function(e){e.controller("trade.refund",["$scope","ngPopover","recordResource","mallbalncelistResource",function(e,t,a,o){function s(e,t){t-=1;var a=e+"-"+t+"-01",o=new Date(e,t,0),s=e+"-"+t+"-"+o.getDate();return a+"~"+s}e.paginationConf={currentPage:1,itemsPerPage:20},e.params={type:"rrds_refund"};var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){if(e.paginationConf.totalItems=t._count,"rrds_refund"==e.params.type){e.sum_refund=t.rrds_amount;for(var a=t.data,o=0;o<a.length;o++){var n=new Date(a[o].created_at),r=n.getFullYear(),i=n.getMonth()+1;a[o].time_at=s(r,i)}}e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n)}])}),define("apps/trade/controllers/withdraw",["apps/common/controllers/controllers"],function(e){e.controller("trade.withtab.list",["$scope","$location","withdrawResource",function(e,t,a){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",created_at:"",status:"all",direction:"desc"};var o=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.withdraws=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1}}])}),define("apps/trade/controllers/withtab.carry",["apps/common/controllers/controllers"],function(e){e.controller("trade.withtab.carry",["$scope","mallWithdrawResource",function(e,t){e.tabList=!0,e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",created_at:"",status:"all",direction:"desc"};var a=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.withdraws=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",a),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?a():e.paginationConf.currentPage=1}}])}),define("apps/trade/controllers/withdraw.add",["apps/common/controllers/controllers","wxLogin"],function(e){e.controller("trade.withdraw.add",["$scope","$modal","$location","Flash","merchantBankResource","merchantBankResourceLoader","withdrawResource","incomeResourceLoader","getAccessInfo","$timeout",function(e,t,a,o,s,n,r,i,c,l){e.bank={},e.banks=[],e.withdraw=[],e.balance=0,e.rrdshang=0,e.balance=i.balance,e.banks=n.data,e.rrdshang=n.rrdshang;var d=function(){a.search().auth&&o.create("success","微信授权成功")};d(),e.confirmAccess=function(a,s,n){c.get(function(r){if(r.is_verification_mobile)if(r.status)switch(n){case"addBank":e.addBank(a,s);break;case"delBank":e.delBank(a,s);break;case"drawCash":e.drawCash(a,s)}else{var i=t.open({animation:!1,templateUrl:"validMobileModal.html",controller:"access.valid.mobile",resolve:{mobile:function(){return r.mobile},type:function(){return n},WxLogin:function(){return WxLogin}}});i.result.then(function(t){l(function(){if(t)switch(n){case"addBank":e.addBank(a,s);break;case"delBank":e.delBank(a,s);break;case"drawCash":e.drawCash(a,s)}},1e3)},function(){})}else _global.is_admin?o.create("warning","请在个人设置中验证手机号"):o.create("warning","主账号需在个人设置中验证手机号")})},e.addBank=function(a,o){var n=t.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/bank.add.html",controller:"bank.add",resolve:{data:function(){return a},type:function(){return o}}});n.result.then(function(t){e.newItem=t,s.get({},function(t){e.banks=t.data,angular.forEach(e.banks,function(t,a){t.id==e.newItem.id&&(e.bank.selected=t)})})})},e.delBank=function(t,a){s.delete({id:t},function(t){t.status?(e.banks.splice(a,1),o.create("success","删除成功")):o.create("success","删除失败")})},e.drawCash=function(a,o){var s=t.open({animation:!1,templateUrl:"drawCashModal.html",controller:"drawCashCtrl",resolve:{bank_id:function(){return a},bank_data:function(){return o}}});s.result.then(function(t){t.account_no&&e.addBank(t,"1")},function(){})},e.saveButStatus=!1,e.save=function(t){if(t){var s={};e.bank.hasOwnProperty("selected")&&(s.bank_id=e.bank.selected.id),s.amount=e.withdraw.amount,e.saveButStatus=!0,r.create(s,function(t){t.error?(o.create("danger",t.error),e.saveButStatus=!1):(o.create("success","提交成功"),a.path("/trade/withtab/list"))})}modalInstance.result.then(function(e){a.path("/trade/withdraw")})}}]),e.controller("access.valid.mobile",["$scope","$http","$state","$interval","Flash","$modalInstance","mobile","type","WxLogin",function(e,t,a,o,s,n,r,i,c){e.entity={mobile:r,captcha:"",check_code:"",type:"mobile",qFlag:1},e.getWechatQrcode=function(){e.entity.type="wechat",e.entity.qFlag&&t({url:"/user/trade_qrcode.json",method:"get"}).success(function(e){new c({id:"js-weixin-login",appid:e.appid,scope:"snsapi_login",redirect_uri:e.redirect_uri,state:e.state,style:"",href:_global.url.static_https+"build/css/weixin-login.css"})}).error(function(e){s.create("danger",e.error.message)}),e.entity.qFlag=0};var l=function(){var t=r.split("");for(var a in t)3!=a&&4!=a&&5!=a||(t[a]="*");switch(e.entity.mobile_display=t.join(""),i){case"addBank":e.entity.title="新增银行卡验证";break;case"delBank":e.entity.title="删除银行卡验证";break;case"drawCash":e.entity.title="提现验证"}};l(),e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.isCodeSend=!1,e.vlogin={text:"确认",clickTxt:"获取验证码",second:120,clickStatus:!1},e.verifiyForm=function(a){a&&(e.form.$invalid=!0,t({url:"/user/mobile_message_auth.json",method:"post",data:{mobile:e.entity.mobile,code:e.entity.check_code}}).success(function(t){e.form.$invalid=!1,t.status?(s.create("success",'<span><i class="fa fa-check"></i> <strong>恭喜您，验证成功！</strong></span>'),n.close(!0)):s.create("warning",t.message)}).error(function(t){e.form.$invalid=!1,s.create("danger",t.error.message)}))},e.getVerifiy=function(){t({url:"send_old_verfity_message.json",method:"put",data:{captcha:e.entity.captcha,mobile:e.entity.mobile,type:"5"}}).success(function(t){t&&(e.vlogin.timer=o(function(){e.vlogin.second>0?(e.isCodeSend=!0,e.vlogin.clickTxt="重新获取("+e.vlogin.second+")",e.vlogin.second--):(e.isCodeSend=!1,o.cancel(e.vlogin.timer),e.vlogin.clickTxt="重新获取",e.vlogin.second=120)},1e3))}).error(function(t){s.create("danger",t.error.message),e.vlogin.clickTxt="重新获取"})},e.cancel=function(){n.dismiss("cancel")}}])}),define("apps/trade/controllers/withdraw.malladd",["apps/common/controllers/controllers"],function(e){e.controller("trade.withdraw.malladd",["$scope","$modal","$location","Flash","merchantBankResource","withdrawResource","mallwithdrawResource","mallIncomeResource",function(e,t,a,o,s,n,r,i){e.bank={},e.banks=[],e.withdraw=[],e.balance=0;var c=function(){i.get({},function(t){e.balance=t.balance})};c();var l=function(){s.get({},function(t){e.banks=t.data})};l(),e.addBank=function(a,o){var n=t.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/bank.add.html",controller:"bank.add",resolve:{data:function(){return a},type:function(){return o}}});n.result.then(function(t){e.newItem=t,s.get({},function(t){e.banks=t.data,angular.forEach(e.banks,function(t,a){t.id==e.newItem.id&&(e.bank.selected=t)})})})},e.delBank=function(t,a){a.stopPropagation(),s.delete({id:t},function(a){a.status?angular.forEach(e.banks,function(a,s){if(a.id==t)return e.bank.hasOwnProperty("selected")&&e.bank.selected.id==t&&(e.bank={}),e.banks.splice(s,1),o.create("success","删除成功"),!1}):o.create("success","删除失败")})},e.saveButStatus=!1,e.save=function(t){if(!e.withdraw.type)return o.create("danger","请选择结算方式！"),!1;if("0"==e.withdraw.type&&t){var s={};s.amount=e.withdraw.amount,s.type=e.withdraw.type,e.saveButStatus=!0,r.create(s,function(t){t.error?(o.create("danger",t.error),e.saveButStatus=!1):(o.create("success","提交成功"),a.path("/trade/withtab/carry"))})}if("1"==e.withdraw.type&&t){var s={};e.bank.hasOwnProperty("selected")&&(s.bank_id=e.bank.selected.id),s.amount=e.withdraw.amount,s.type=e.withdraw.type,e.saveButStatus=!0,r.create(s,function(t){t.error?(o.create("danger",t.error),e.saveButStatus=!1):(o.create("success","提交成功"),a.path("/trade/withtab/carry"))})}}}])}),define("apps/trade/controllers/bank.add",["apps/common/controllers/controllers"],function(e){e.controller("bank.add",["$scope","Flash","data","type","merchantBankResource","bankResource","$modalInstance",function(e,t,a,o,s,n,r){e.type=o,e.bank={},e.merchantBank={type:0};var i=e.city=this;"0"==o?i.regions={country:1,province:"",city:"",district:""}:(e.merchantBank=a,i.regions={country:1,province:a.province_name,city:a.city_name,district:a.district_name}),i.start="province",i.end="district";var c=function(){n.get({},function(t){e.banks=t})};c(),e.cancel=function(){r.dismiss("cancel")},e.checkBank=function(){if(!e.bank.hasOwnProperty("selected"))return!0;var t=e.bank.selected.code;return(0!=e.merchantBank.type||"01020000"!=t&&"01030000"!=t&&"01040000"!=t&&"03080000"!=t&&"03030000"!=t&&"03100000"!=t)&&(1!=e.merchantBank.type||"01050000"!=t)},e.ok=function(n){var i=new RegExp("^[0-9]*$");if(n)if(e.bank.hasOwnProperty("selected")&&(e.merchantBank.bank_code=e.bank.selected.code),e.city.hasOwnProperty("selected")&&(e.merchantBank.province_code=e.city.selected[0]?e.city.selected[0].id:a.province_code,e.merchantBank.city_code=e.city.selected[0]?e.city.selected[1].id:a.city_code,e.merchantBank.district_code=e.city.selected[2]?e.city.selected[2].id:a.district_code),e.form.$invalid=!0,"0"!=o)e.merchantBank.id=a.id,s.update(e.merchantBank,function(a){e.form.$invalid=!1,a.error?t.create("danger",a.error):(t.create("success","保存成功"),r.close(a))});else{if(!i.test(e.merchantBank.account_no))return e.form.$invalid=!1,t.create("danger","银行卡卡号有误,请重新输入"),!1;s.create(e.merchantBank,function(a){e.form.$invalid=!1,a.error?t.create("danger",a.error):(t.create("success","保存成功"),r.close(a))})}}}])});define("apps/trade/controllers/recharge",["apps/common/controllers/controllers"],function(e){e.controller("trade.recharge",["$scope","rechargeResource","rechargeResourceFactorage","Flash","$modal",function(e,t,a,o,s){t.get(function(t){e.income=t}),e.rechargeInfo={money:""},e.setRecharge=function(){var t=parseFloat(e.rechargeInfo.money),a=!1;if(""==e.rechargeInfo.money)o.create("danger","请填写充值金额");else{var n=/^\d+(\.\d+)?$/;if(n.test(e.rechargeInfo.money))if(t>=.1){var r=e.rechargeInfo.money.indexOf("."),i=0;r>0?(i=e.rechargeInfo.money.split(".")[1].length,i>2&&o.create("danger","充值金额只能包含两位小数,并且大于0"),e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),t=parseFloat(e.rechargeInfo.money),a=t>0):r==-1?(e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),a=!0):(o.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00")}else o.create("danger","输入的金额必须大于或等于0.1元"),e.rechargeInfo.money="0.00";else o.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00",a=!1}if(a){var c=s.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/recharge.code.html",controller:"setRechargeCon",backdrop:!1,resolve:{data:function(){return e.rechargeInfo.money}}});c.result.then(function(e){})}},e.sactorage=function(){a.get({id:e.rechargeInfo.money},function(t){e.sactoragejosn=t})}}]),e.controller("setRechargeCon",["$scope","$modalInstance","rechargeResource","data","Flash","$location",function(e,t,a,o,s,n){e.IsSuccess={type:1},a.update({amount:o},function(t){t.success&&(e.rechargeInfo=t.data)}),e.paySuccess=function(){a.success({recharge_sn:e.rechargeInfo.recharge_sn},function(t){t.status?e.IsSuccess.type=2:s.create("danger",t.msg)})},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){n.path("/trade"),e.cancel()}}])});define("apps/trade/controllers/drawcash",["apps/common/controllers/controllers"],function(e){e.controller("drawCashCtrl",["$scope","Flash","withdrawResource","incomeResource","bank_id","bank_data","$modalInstance",function(e,t,a,o,s,n,r){e._global=_global,e.withdraw=[],e.balance=0;var i=function(){o.get({},function(t){e.balance=t.balance})};i(),e.saveButStatus=!1,e.ok=function(o){if(n.bank_mobile){if(o){var i={};i.amount=e.withdraw.amount,i.bank_id=s,e.saveButStatus=!0,a.create(i,function(a){a.error?(t.create("danger",a.error),e.saveButStatus=!1):(t.create("success","提交成功"),r.close(a))})}}else r.close(n),t.create("danger","请先完善手机号")},e.cancel=function(){r.dismiss("cancel")}}])}),define("apps/trade/controllers/_base",["apps/trade/controllers/dashboard","apps/trade/controllers/qrcode","apps/trade/controllers/cashier","apps/trade/controllers/payment","apps/trade/controllers/records","apps/trade/controllers/record","apps/trade/controllers/refund","apps/trade/controllers/withdraw","apps/trade/controllers/withtab.carry","apps/trade/controllers/withdraw.add","apps/trade/controllers/withdraw.malladd","apps/trade/controllers/bank.add","apps/trade/controllers/recharge","apps/trade/controllers/drawcash"],function(){}),
define("apps/trade/directives/upload",["apps/common/directives/directives","fileupload"],function(e,t){e.directive("upCacert",["Flash",function(e){return{restrict:"A",transclude:!0,scope:{cacert:"="},template:'<span><span ng-transclude></span><input type="file" name="file" multiple=""></span>',link:function(t,a,o){var s={url:"/trade/uploadpem.json",dataType:"json"};"alipay"==o.type?s.formData=function(e){return e.push({name:"file_type",value:2}),e}:s.formData=function(e){return e.push({name:"file_type",value:1}),e},s.add=function(a,o){o.submit().done(function(a,o,s){t.$apply(function(){t.cacert=a}),e.create("success"," 上传成功！")}).fail(function(t,a,o){e.create("danger",t.responseJSON.error.message)})},a.fileupload(s)}}}])}),define("apps/trade/directives/_base",["apps/trade/directives/upload"],function(){}),define("apps/trade/main",["apps/trade/states/_base","apps/trade/services/_base","apps/trade/controllers/_base","apps/trade/directives/_base"],function(){}),define("apps/weixin/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin",{abstract:!0,url:"/weixin",templateUrl:"assets/js/apps/weixin/templates/layout.html",controller:["$rootScope","$state","weixinInfo",function(e,t,a){e.weixinInfo=a,void 0!=a.id&&0!=a.is_authorized||t.go("weixin.setting")}],resolve:{weixinInfo:["$q","weixinInfoSrv",function(e,t){var a=e.defer();return t.get(function(e){a.resolve(e)}),a.promise}]}}).state("weixin.dashboard",{url:"",templateUrl:"assets/js/apps/weixin/templates/dashboard.html",controller:"weixin"})}])}),define("apps/weixin/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.setting",{url:"/setting",templateUrl:"assets/js/apps/weixin/templates/setting.html",controller:"weixin.setting"})}])}),define("apps/weixin/states/selfmenu",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.selfmenu",{url:"/selfmenu",templateUrl:"assets/js/apps/weixin/templates/selfmenu.html",controller:"weixin.selfmenu"})}])}),define("apps/weixin/states/autoreply",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.autoreply",{url:"/autoreply",templateUrl:"assets/js/apps/weixin/templates/autoreply.html",controller:"weixin.autoreply"})}])}),define("apps/weixin/states/media",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.media",{abstract:!0,url:"/media",template:"<div ui-view></div>"}).state("weixin.media.list",{url:"",templateUrl:"assets/js/apps/weixin/templates/media.html",controller:"weixin.media"}).state("weixin.media.add",{url:"/add",templateUrl:"assets/js/apps/weixin/templates/media_add.html",controller:"weixin.media.info"}).state("weixin.media.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/weixin/templates/media_add.html",controller:"weixin.media.info"})}])}),define("apps/weixin/states/mediaout",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.mediaout",{abstract:!0,url:"/mediaout",template:"<div ui-view></div>"}).state("weixin.mediaout.list",{url:"",templateUrl:"assets/js/apps/weixin/templates/mediaout.html",controller:"weixin.mediaout"}).state("weixin.mediaout.add",{url:"/add",templateUrl:"assets/js/apps/weixin/templates/mediaout_add.html",controller:"weixin.mediaout.info"}).state("weixin.mediaout.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/weixin/templates/mediaout_add.html",controller:"weixin.mediaout.info"})}])}),define("apps/weixin/states/template_msg",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.templatemsg",{abstract:!0,url:"/templatemsg",template:"<div ui-view></div>"}).state("weixin.templatemsg.list",{url:"",templateUrl:"assets/js/apps/weixin/templates/template_msg.html",controller:"weixin.templatemsg"})}])}),define("apps/weixin/states/flow",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("weixin.flow",{abstract:!0,url:"/flow",template:"<div ui-view></div>"}).state("weixin.flow.main",{url:"",templateUrl:"assets/js/apps/weixin/templates/flow.html",controller:"wxFlow_setting"})}])}),define("apps/weixin/states/_base",["apps/weixin/states/main","apps/weixin/states/setting","apps/weixin/states/selfmenu","apps/weixin/states/autoreply","apps/weixin/states/media","apps/weixin/states/mediaout","apps/weixin/states/template_msg","apps/weixin/states/flow"],function(){}),define("apps/weixin/controllers/main",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("weixin",["$scope","weixinInfoStat","$state","$stateParams",function(e,a,o,s){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||o.go("weixin.setting"),a.query(function(a){for(var o=[],s=[],n=[],r=[],i=[],c=a.length,l=c-1;l>=0;l--){var d=a[l];o.push(d.ref_date),s.push(d.new_user),n.push(d.cancel_user),r.push(d.surplus_user),i.push(d.int_page_read_count)}e.weixinInfoStr=a[0];var p=t.init(document.getElementById("member-chart")),u={tooltip:{trigger:"axis"},legend:{data:["新增粉丝","取消关注","净增粉丝"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:o}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"新增粉丝",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:s},{name:"取消关注",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:n},{name:"净增粉丝",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:r}]};p.setOption(u);var m=t.init(document.getElementById("media-chart")),u={tooltip:{trigger:"axis"},legend:{data:["图文阅读"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:o}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"图文阅读",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:i}]};m.setOption(u)})}])}),define("apps/weixin/controllers/setting",["apps/common/controllers/controllers"],function(e){e.controller("weixin.setting",["weixinInfoSrv","$scope","$modal","Flash","$http",function(e,t,a,o,s){s.get("/weixin/component/authurl.json").success(function(e){t.auth_url=e}),t.wxauthModal=function(){a.open({animation:!1,templateUrl:"wxAuthModal.html",controller:"wxAuthModalCtrl",resolve:{auth_url:function(){return t.auth_url}}})},t.saveSubscribeUrl=function(){e.update({subscribe_url:t.weixinInfo.subscribe_url},function(e){o.create("success"," 保存成功！")},function(){o.create("danger",res.data.error.message)})}}]).controller("wxAuthModalCtrl",["$scope","$state","$modalInstance","auth_url",function(e,t,a,o){e.auth_url=o,e.refresh=function(){a.close(),t.reload()}}])}),define("apps/weixin/controllers/autoreply",["apps/common/controllers/controllers"],function(e){e.controller("weixin.autoreply",["$scope","$state","autoreplyInfo","saveAttachment","$modal","$timeout","ngPopover","Flash","linkData","mallLinkData",function(e,t,a,o,s,n,r,i,c,l){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting"),e.magic_member_rank="{{member_rank}}",e.magic_member_rank_more="{{1000+member_rank}}",$.fn.extend({insertAtCaret:function(t){var a=$(this)[0];if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=t,e.autoReply_bakdata.data={},e.autoReply_bakdata.data.text=sel.text,this.focus();else if(a.selectionStart||"0"==a.selectionStart){var o=a.selectionStart,s=a.selectionEnd,n=a.scrollTop;a.value=a.value.substring(0,o)+t+a.value.substring(s,a.value.length),e.autoReply_bakdata.data={},e.autoReply_bakdata.data.text=a.value,this.focus(),a.selectionStart=o+t.length,a.selectionEnd=o+t.length,a.scrollTop=n}else this.value+=t,e.autoReply_bakdata.data={},e.autoReply_bakdata.data.text=this.value,this.focus()}}),e.radioDefaReply={id:"",name:""},e.radioAutoReply={id:"",name:""},e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var d=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.query(e.searchInfo,function(t){e.radioAutoReply.id=t.subscribe.id,e.radioAutoReply.name=t.subscribe.reply_name,e.radioDefaReply.id=t.default.id,e.radioDefaReply.name=t.default.reply_name,e.paginationConf.totalItems=t._count,e.autoreplyData=[],angular.forEach(t.msg,function(t,a){t.IsItemEdit=!1,e.autoreplyData.push(t)})})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.groupPopover_autoreply_status=!1,e.popover_autoreply=function(){""==e.radioAutoReply.id?i.create("danger","请选择规则"):(e.groupPopover_autoreply_status=!0,a.autoreply({reply_id:e.radioAutoReply.id},function(t){e.groupPopover_autoreply_status=!1,1==t.stats?(e.radioAutoReply={id:t.msg.id,name:t.msg.name},e.cancel(),i.create("success","设置成功")):i.create("danger","设置失败")}))},e.groupPopover_defaultreply_status=!1,e.popover_defaultreply=function(){""==e.radioDefaReply.id?i.create("danger","请选择规则"):(e.groupPopover_defaultreply_status=!0,a.defreply({reply_id:e.radioDefaReply.id},function(t){e.groupPopover_defaultreply_status=!1,1==t.stats?(e.radioDefaReply={id:t.msg.id,name:t.msg.name},e.cancel(),i.create("success","设置成功")):i.create("danger","设置失败")}))},e.cancel=function(){r.close()},e.addReply=function(){var t={id:"",merchant_id:"",name:"新加规则",send_type:1,is_default:0,is_subscribe:0,precise:{id:"",match_type:0,keywords:[]},vague:{id:"",match_type:1,keywords:[]},reply_data:[],IsItemEdit:!0};e.autoreplyData.splice(0,0,t)},e.editItemReply=function(e){e.IsItemEdit=!0,"block"==$("#ngpopover_autoreply").css("display")&&$("#ngpopover_autoreply").css("display","none")},e.confirmDeleteReply=function(t,o){""==t?e.autoreplyData.splice(o,1):a.delete({reply_id:t},function(e){1==e.stats?(d(),i.create("success","删除成功")):i.create("danger","删除失败")})};var p="",u="",m=!1;e.onPopoverEditClick=function(t,a,o,s){e.autoReply_data=t,e.autoReply_bakdata=angular.copy(e.autoReply_data),p=o,u=s;var n=$(a.target);$("#ngpopover_autoreply").css({top:n.offset().top-110,left:n.offset().left-410,display:"block"})},e.replyActionDelete=function(e,t){e.reply_data.splice(t,1)},e.replyActionAdd=function(t,a){p=a,m=!0,e.autoReply_bakdata={id:"",type:"text",data:""},$("#ngpopover_autoreply").removeClass("left").addClass("right");var o=$(t.target);$("#ngpopover_autoreply").css({top:o.offset().top-110,left:o.offset().left+85,display:"block"})},e.saveItemReply_status=!1,e.saveItemReply=function(t){var o=angular.copy(t);delete o.IsItemEdit;var s=!1;if((o.precise.keywords.length>0||o.vague.keywords.length>0)&&o.reply_data.length>0){for(var n=!0,r=0;r<o.precise.keywords.length;r++)for(var c=0;c<o.vague.keywords.length;c++)o.precise.keywords[r]==o.vague.keywords[c]&&(n=!1);1==n?s=!0:i.create("danger","精准匹配和模糊匹配关键字不能重复")}else 0==o.precise.keywords.length&&0==o.vague.keywords.length?(s=!1,i.create("danger","请填写关键字")):0==o.reply_data.length&&(s=!1,i.create("danger","请填写设置一个自动回复内容"));1==s&&(e.saveItemReply_status=!0,""==o.id?a.save({createVal:o},function(a){e.saveItemReply_status=!1,1==a.stats?(t.IsItemEdit=!1,d(),i.create("success","保存成功")):i.create("danger","保存失败")},function(t){e.saveItemReply_status=!1,i.create("danger",t.data.error.message)}):a.update({updateVal:o},function(a){e.saveItemReply_status=!1,1==a.stats?(t.IsItemEdit=!1,i.create("success","保存成功")):i.create("danger","保存失败")},function(t){e.saveItemReply_status=!1,i.create("danger",t.data.error.message)}))},e.quitItemReply=function(t,a){t.IsItemEdit=!1,""==t.id&&e.autoreplyData.splice(a,1),d()},e.replyActionShowClick=function(t){var a={temp:"",contr:""};switch(t){case"music":a={temp:"assets/js/apps/weixin/templates/directives_temp/musicAdd.html",contr:"replyAddMusic"};break;case"news":a={temp:"assets/js/apps/weixin/templates/directives_temp/mediaList.html",contr:"replyGetMediaList"}}if("music"==t||"news"==t){var o=s.open({animation:!1,templateUrl:a.temp,controller:a.contr});o.result.then(function(t){e.autoReply_bakdata.type=t.replyType,e.autoReply_bakdata.data={},e.autoReply_bakdata.data=angular.copy(t),delete e.autoReply_bakdata.data.replyType})}},e.selectEmotion=function(t){"text"!=e.autoReply_bakdata.type&&(e.autoReply_bakdata.data={},e.autoReply_bakdata.data.text="",$("#replyText").val("")),e.autoReply_bakdata.type="text",$("#replyText").insertAtCaret(t),e.cancelPopover()},e.insertUrl=function(){"text"!=e.autoReply_bakdata.type&&(e.autoReply_bakdata.data={},e.autoReply_bakdata.data.text="",$("#replyText").val(""));var t=$('input[name="insertUrl"]').val();e.autoReply_bakdata.type="text",$("#replyText").insertAtCaret(t),e.cancelPopover()},e.cancelPopover=function(){r.close()},e.$watch("images",function(){if(!angular.isUndefined(e.images)){var t=e.images[e.images.length-1];o.save({aid:t.id,url:t.url},function(t){e.autoReply_bakdata.type="image",e.autoReply_bakdata.data={id:t.msg.id,url:t.msg.url}},function(){})}}),e.$watch("voice",function(){if(!angular.isUndefined(e.voice)){var t=angular.copy(e.voice);o.save({aid:t.id,url:t.url},function(a){t.url=_global.url.ms+t.url,t.id=a.msg.id,e.autoReply_bakdata.type="voice",e.autoReply_bakdata.data=t},function(){})}}),e.getModelLink={},!_global.is_mall_shop&&_global.mall?e.select_link=angular.copy(l):e.select_link=angular.copy(c),e.$watch("getModelLink",function(t){if("link_url"in t){var a=t.link_title.split("|"),o={link_url:t.link_url,link_type:t.link_type,link_page:a[0],link_title:a[1],data:t.data};"home"!=t.link_type&&"ucenter"!=t.link_type&&"list"!=t.link_type&&"guider"!=t.link_type&&"guide"!=t.link_type&&"cart"!=t.link_type||(o.link_page=a[0],o.link_title=a[0]),e.autoReply_bakdata.type="system",e.autoReply_bakdata.data=o}},!0),e.delReplyItem=function(){e.autoReply_bakdata.type="text",e.autoReply_bakdata.data=""},e.voicePlayClick=function(e,t){var a=($(t.target),'<div id="audio_wrapper" style="display: none;"><audio id="audio_player" preload="" type="audio/mpeg" src="'+e.url+'"></audio></div>');$("#audio_wrapper").length>0?$("#audio_player").attr("src",e.url):$("body").append(a);var o=document.getElementById("audio_player");o.play()},e.autoRepluSave=function(){1==m?(n(function(){angular.forEach(e.autoreplyData,function(t,a){t.id==p&&t.reply_data.push(e.autoReply_bakdata)})},100),m=!1):n(function(){angular.forEach(e.autoreplyData,function(t,a){t.id==p&&(t.reply_data[u]=e.autoReply_bakdata)})},100),$("#ngpopover_autoreply").css("display","none")},e.popoverCustomCancel=function(){$("#ngpopover_autoreply").css("display","none"),m=!1}}]),e.controller("replyGetMediaList",["$scope","weixinMedia","$modalInstance",function(e,t,a){e.paginationConf={currentPage:1,itemsPerPage:12},e._global=_global,e.getInfo={type:0};var o=function(){t.query({type:1,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},function(t){e.paginationConf.totalItems=t._count,e.mediaList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.IsMediaTypeClick=function(t){e.getInfo.type=t,e.paginationConf.currentPage=1,o(),e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o)},e.search=function(){reGetProducts()},e.selected=function(e){e.replyType="news",a.close(e)},e.cancel=function(){a.dismiss("cancel")}}]),e.controller("replyAddMusic",["$scope","saveAttachment","Flash","$modalInstance",function(e,t,a,o){var s="";e.$watch("choice_pic + choice_pic_id",function(){if(!angular.isUndefined(e.choice_pic)&&!angular.isUndefined(e.choice_pic_id)){var a={id:e.choice_pic_id,url:e.choice_pic};t.save({aid:a.id,url:a.url},function(e){s={id:e.msg.id,url:e.msg.url}},function(e){})}}),e.musicItem={replyType:"music",wx_attachment_id:"",title:"",description:"",music_url:""},e.IsShowImgP=!1,e.saveMusic=function(t){e.musicItem.wx_attachment_id=s.id,""==e.musicItem.wx_attachment_id||""==e.musicItem.title||""==e.musicItem.description||""==e.musicItem.music_url?(""==e.musicItem.wx_attachment_id&&(e.IsShowImgP=!0),t.music_desc.$invalid&&(t.music_desc.$dirty=!0,$("input[name='music_desc']").focus()),t.music_url.$invalid&&(t.music_url.$dirty=!0,$("input[name='music_url']").focus()),t.music_title.$invalid&&(t.music_title.$dirty=!0,$("input[name='music_title']").focus())):(e.IsShowImgP=!1,o.close(e.musicItem))},e.cancel=function(){o.dismiss("cancel")}}])}),define("apps/weixin/controllers/selfmenu",["apps/common/controllers/controllers"],function(e){e.controller("weixin.selfmenu",["$http","$state","weixinInfoSrv","weixinMenuSrv","getLocalReply","autoreplyInfo","$scope","$timeout","Flash",function(e,t,a,o,s,n,r,i,c){function l(){for(var e=!0,t=r.menuJson.button,a=0;a<t.length;a++)if("sub_button"in t[a]&&t[a].sub_button.length>0)for(var o=t[a].sub_button,s=0;s<o.length;s++){var n=o[s];if(""==n.type||"scancode_push"==n.type||"location_select"==n.type||"pic_sysphoto"==n.type||"pic_weixin"==n.type){e=!1,d(a,s,n,1);break}if("view"==n.type&&""==n.link_url){e=!1,d(a,s,n,1);break}if("click"==n.type&&""==n.key){e=!1,d(a,s,n,1);break}"view"==n.type&&""!=n.link_url?""==n.key:"click"==n.type&&""!=n.key&&(n.link_title="",n.link_type="",n.link_url="",n.url="")}else{if(""==t[a].type||"scancode_push"==t[a].type||"location_select"==t[a].type||"pic_sysphoto"==t[a].type||"pic_weixin"==t[a].type){e=!1,d(a,0,t[a],0);break}if("view"==t[a].type&&""==t[a].link_url){e=!1,d(a,0,t[a],0);break}if("click"==t[a].type&&""==t[a].key){e=!1,d(a,0,t[a],0);break}"view"==t[a].type&&""!=t[a].link_url?""==t[a].key:"click"==t[a].type&&""!=t[a].key&&(t[a].link_title="",t[a].link_type="",t[a].link_url="",t[a].url="")}return e}function d(e,t,a,o){$(".om-side-content dl").each(function(){$(this).find("dt").removeClass("cur"),$(this).find("dd").removeClass("cur")}),c.create("danger","请编辑"+a.name+"的属性"),0==o?($(".om-side-content dl").eq(e).find("dt").addClass("cur"),r.$broadcast("eidtMenu_data",a)):($(".om-side-content dl").eq(e).find("dd").eq(t).addClass("cur"),r.$broadcast("eidtMenu_data",a))}void 0!=r.weixinInfo.id&&0!=r.weixinInfo.is_authorized||t.go("weixin.setting"),r.but_text="提交修改",r.saveClick=!1,void 0==r.weixinInfo.id&&e.get("/weixin/component/authurl").success(function(e){r.auth_url=e}),r.IsOpenMenu=!1,o.get(function(e){r.menuJson=e,null!=e.button&&""!=e.button||(r.menuJson.button=[]),0==r.menuJson.is_menu_open?r.IsOpenMenu=!1:r.IsOpenMenu=!0}),n.query(function(e){r.autoreplyData=e.msg}),r.sortableOptions={handle:".menu-stor",cursor:"move",zIndex:99999,opacity:.6,axis:"y"},r.openMenu_status=!1,r.openMenuClick=function(){var e=r.menuJson.is_menu_open,t=l();e=r.IsOpenMenu?1:0,0==r.menuJson.button.length?(c.create("danger","当前没有菜单,设置失败"),r.IsOpenMenu=!r.IsOpenMenu):0==t?r.IsOpenMenu=!r.IsOpenMenu:(r.openMenu_status=!0,o.save({is_menu_open:e},function(t){r.openMenu_status=!1,t.stats?(c.create("success","设置成功"),r.menuJson.is_menu_open=e):(c.create("danger",t.error.message),r.IsOpenMenu=!r.IsOpenMenu)},function(e){r.openMenu_status=!1,c.create("danger",e.data.error.message),r.IsOpenMenu=!r.IsOpenMenu}))};var p=0;r.menuClickPushJson=[];var u=function(e){"click"==e.type&&s.get({EventKey:e.key},function(e){r.menuClickPushJson.push(e),$(".wxmsg-list").animate({scrollTop:$("#scrollBottom").height()})}),"view"==e.type&&window.open(e.url)};r.weixin_MenuClick=function(e,t){p==t&&0!=e.IsShow||angular.forEach(r.menuJson.button,function(e,t){e.IsShow=!1}),e.IsShow=!e.IsShow,p=t,void 0!=e.type&&u(e)},r.weixin_MenuBClick=function(e){r.menuClickPushJson.push(e),angular.forEach(r.menuJson.button,function(e,t){e.IsShow=!1})},r.addMenuA=function(){if(r.menuJson.button.length>=3)c.create("warning","一级菜单只能设置3个");else{var e={type:"",name:"新加菜单",key:"",sub_button:[]};r.menuJson.button.push(e)}},r.addMenuB=function(e){if(void 0==e.type||""==e.type)if(!("sub_button"in e)||e.sub_button.length<5){var t={type:"",name:"新加菜单",key:""};delete e.type,delete e.key,"sub_button"in e||(e.sub_button=[]),e.sub_button.push(t)}else c.create("warning","二级菜单只能设置5个");else if(Utils.confirm("当前菜单已配置菜单属性，添加二级菜单会清楚此菜单属性，是否确定？")){delete e.type,delete e.key,e.sub_button=[];var t={type:"",name:"新加菜单",key:""};e.sub_button.push(t)}},r.delMenuA=function(e,t){"sub_button"in e&&e.sub_button.length>0?c.create("warning","当前菜单下有二级菜单，不能删除"):(r.menuJson.button.splice(t,1),i(function(){r.$broadcast("eidtMenu_data","")},200))},r.delMenuB=function(e,t){e.sub_button.splice(t,1),0==e.sub_button.length&&(delete e.sub_button,e.type="",e.key=""),i(function(){r.$broadcast("eidtMenu_data","")},100)},r.menuEditClickA=function(e,t){if(void 0==e.type)r.Is_flashWarin=!0,i(function(){r.Is_flashWarin=!1},1e3);else{$(".om-side-content dl").each(function(){$(this).find("dt").removeClass("cur"),$(this).find("dd").removeClass("cur")});var a=$(t.target);a.addClass("cur"),i(function(){r.$broadcast("eidtMenu_data",e)},200)}},r.menuEditClickB=function(e,t){$(".om-side-content dl").each(function(){$(this).find("dt").removeClass("cur"),$(this).find("dd").removeClass("cur")});var a=$(t.target);a.addClass("cur"),i(function(){r.$broadcast("eidtMenu_data",e)},200)},r.saveWxMenu=function(){r.but_text="提交中...",r.saveClick=!0,i(function(){var e=l();e?o.update({menuValue:r.menuJson},function(e){e.stats?c.create("success",e.msg):c.create("danger",e.error.message),r.but_text="提交修改",r.saveClick=!1},function(e){r.but_text="提交修改",r.saveClick=!1,c.create("danger",e.data.error.message)}):(r.but_text="提交修改",r.saveClick=!1)},100)}}])}),define("apps/weixin/controllers/editmenu",["apps/common/controllers/controllers"],function(e){e.controller("designEditMenu",["$scope","$state","linkData","mallLinkData",function(e,t,a,o){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting"),e.isShowCustom=!1,e.menuInfo={key:""},e.custominfo={key:""},e.$on("eidtMenu_data",function(t,a){e.eidtMenu_data=a;var o=a.key.split("_");"system"==o[2]?e.custominfo.key=a.key:(e.custominfo.key="custom",e.menuInfo.key=a.key,e.isShowCustom=!0)}),e.editMenuNavClick=function(t){e.eidtMenu_data.type=t},e.$watch("menuInfo.key",function(){0==angular.isUndefined(e.eidtMenu_data)&&(e.eidtMenu_data.key=e.menuInfo.key)}),e.$watch("custominfo.key",function(){0==angular.isUndefined(e.eidtMenu_data)&&("custom"==e.custominfo.key?e.isShowCustom=!0:(e.isShowCustom=!1,e.eidtMenu_data.key=e.custominfo.key))}),!_global.is_mall_shop&&_global.mall?e.select_link=angular.copy(o):e.select_link=angular.copy(a)}])}),define("apps/weixin/controllers/media",["apps/common/controllers/controllers"],function(e){e.controller("weixin.media",["$scope","$state","Flash","weixinMedia",function(e,t,a,o){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting");var s=function(){e.getInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.getInfo.limit=e.paginationConf.itemsPerPage,o.query(e.getInfo,function(t){e.paginationConf.totalItems=t._count,e.mediaList=t.data})};e.search=function(){s()},e.paginationConf={currentPage:1,itemsPerPage:12},e.getInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,type:0,key:""},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.confirmDelete=function(e){o.delete({id:e},function(){a.create("success","删除成功"),s()},function(e){a.create("danger",e.data.error.message)})}}])}),define("apps/weixin/controllers/media.info",["apps/common/controllers/controllers"],function(e){e.controller("weixin.media.info",["$scope","$state","Flash","weixinMedia","$location","$timeout","$stateParams",function(e,t,a,o,s,n,r){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting");var i=angular.copy(window._editorOptions);i.toolbar[0].splice(2,0,"Image"),i.toolbar[0].splice(3,0,"Flash"),e.editorOptions=i;var c=function(t){n(function(){e.$broadcast("eidtMedia_data",t)},100)};r.id?(e.title="编辑内链图文素材",e.but_text="修改",o.query({id:r.id},function(t){e.wxMediaItem=t,c(e.wxMediaItem)})):(e.title="新增内链图文素材",e.but_text="保存",e.wxMediaItem={type:0,title:"",author:"",pic:{url:"",forever:1,wx_mid:""},abstract:"",marerial_type:1,content:"",link_url:"",link_title:"",link_type:"",show_icon:0,list:[]},c(e.wxMediaItem)),e.editMediaBoxMarginTop={"margin-top":"132px"},e.mediaEditClick=function(t,a){var o=132;o=0==t?132:1==t?290:290+61*(t-1),e.editMediaBoxMarginTop={"margin-top":o},c(a)},e.delMediaSubClick=function(t,a){a.list.splice(t,1),e.editMediaBoxMarginTop={"margin-top":"143px"},e.wxMediaItem.marerial_type=0==e.wxMediaItem.list.length?1:2,c(a)},e.mediaAddSub=function(){if(e.wxMediaItem.list.length<9){var t={title:"",author:"",abstract:"",pic:{url:"",forever:1,wx_mid:""},content:"",link_url:"",link_title:"",link_type:"",show_icon:0};e.wxMediaItem.list.push(t)}else a.create("warning","只能有10条图文");e.wxMediaItem.marerial_type=0==e.wxMediaItem.list.length?1:2,c(e.wxMediaItem)},e.saveClick=!1,e.mediaSave=function(t){var s=!0;if(""==e.wxMediaItem.title||""==e.wxMediaItem.pic_url||null==e.wxMediaItem.content)e.wxMediaItem.IsFromDirty=!0,c(e.wxMediaItem),e.editMediaBoxMarginTop={"margin-top":"132px"},""==e.wxMediaItem.title&&(t.media_title.$dirty=!0,$("input[name='media_title']").focus()),s=!1;else for(var n=0;n<e.wxMediaItem.list.length;n++){var i=e.wxMediaItem.list[n];if(""==i.title||""==i.pic_url||null==i.content||""==i.content){var l=290;return l=0==n?290:290+61*n,e.editMediaBoxMarginTop={"margin-top":l},i.IsFromDirty=!0,c(i),""==i.title&&(t.media_title.$dirty=!0,$("input[name='media_title']").focus()),!1}s=!0}s&&(r.id?(e.but_text="提交中",e.saveClick=!0,o.update(e.wxMediaItem,function(t){t.success?(a.create("success","修改成功"),e.goback()):a.create("danger","修改失败"),e.but_text="修改",e.saveClick=!1})):(e.but_text="保存中",e.saveClick=!0,o.save(e.wxMediaItem,function(t){t.success?(a.create("success","添加成功"),e.goback()):a.create("danger","添加失败"),e.but_text="保存",e.saveClick=!1})))},e.goback=function(){s.path("/weixin/media")}}]),e.controller("designEditMedia",["$scope",function(e){e.$on("eidtMedia_data",function(t,a){e.eidtMedia_data=a})}])}),define("apps/weixin/controllers/mediaout",["apps/common/controllers/controllers"],function(e){e.controller("weixin.mediaout",["$scope","$state","Flash","weixinMedia",function(e,t,a,o){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting");var s=function(){e.getInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.getInfo.limit=e.paginationConf.itemsPerPage,o.query(e.getInfo,function(t){e.paginationConf.totalItems=t._count,e.mediaList=t.data})};e.paginationConf={currentPage:1,itemsPerPage:12},e.getInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,type:1,key:""},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){s()},e.confirmDelete=function(e){o.delete({id:e},function(){a.create("success","删除成功"),s()},function(e){a.create("danger",e.data.error.message)})}}])}),define("apps/weixin/controllers/mediaout.info",["apps/common/controllers/controllers"],function(e){e.controller("weixin.mediaout.info",["$scope","$state","Flash","weixinMedia","linkData","mallLinkData","$location","$timeout","$stateParams",function(e,t,a,o,s,n,r,i,c){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting");var l=function(t){i(function(){e.$broadcast("eidtMedia_data",t)},100)};c.id?(e.title="编辑外链图文素材",e.but_text="修改",o.query({id:c.id},function(t){e.wxMediaItem=t,l(e.wxMediaItem)})):(e.title="新增外链图文素材",e.but_text="保存",e.wxMediaItem={type:1,title:"",abstract:"",marerial_type:1,link_url:"",link_title:"",link_type:"",pic:{url:"",forever:1,wx_mid:""},list:[]},l(e.wxMediaItem)),e.editMediaBoxMarginTop={"margin-top":"132px"},e.mediaEditClick=function(t,a){var o=132;o=0==t?132:1==t?290:290+61*(t-1),e.editMediaBoxMarginTop={"margin-top":o},l(a)},e.delMediaSubClick=function(t,a){a.list.splice(t,1),e.editMediaBoxMarginTop={"margin-top":"143px"},e.wxMediaItem.marerial_type=0==e.wxMediaItem.list.length?1:2,l(a)},e.mediaAddSub=function(){if(e.wxMediaItem.list.length<9){var t={title:"",abstract:"",link_url:"",link_title:"",link_type:"",pic:{url:"",forever:1,wx_mid:""}};e.wxMediaItem.list.push(t)}else a.create("warning","只能有10条图文");e.wxMediaItem.marerial_type=0==e.wxMediaItem.list.length?1:2,l(e.wxMediaItem)},e.saveClick=!1,e.mediaSave=function(t){var s=!0;if(""==e.wxMediaItem.title||""==e.wxMediaItem.pic.url||""==e.wxMediaItem.link_url)e.wxMediaItem.IsFromDirty=!0,l(e.wxMediaItem),e.editMediaBoxMarginTop={"margin-top":"132px"},""==e.wxMediaItem.title&&(t.media_title.$dirty=!0,$("input[name='media_title']").focus()),s=!1;else for(var n=0;n<e.wxMediaItem.list.length;n++){var r=e.wxMediaItem.list[n];if(""==r.title||""==r.pic_url||null==r.link_url||""==r.link_url){var i=290;return i=0==n?290:290+61*n,e.editMediaBoxMarginTop={"margin-top":i},r.IsFromDirty=!0,l(r),""==r.title&&(t.media_title.$dirty=!0,$("input[name='media_title']").focus()),!1}s=!0}s&&(c.id?(e.but_text="提交中",e.saveClick=!0,o.update(e.wxMediaItem,function(t){t.success?(a.create("success","修改成功"),e.goback()):a.create("danger","修改失败"),e.but_text="修改",e.saveClick=!1})):(e.but_text="保存中",e.saveClick=!0,o.save(e.wxMediaItem,function(t){t.success?(a.create("success","添加成功"),e.goback()):a.create("danger","添加失败"),e.but_text="保存",e.saveClick=!1})))},e.goback=function(){r.path("/weixin/mediaout")}}]),e.controller("designEditMedia",["$scope","linkData","mallLinkData",function(e,t,a){e.$on("eidtMedia_data",function(t,a){e.eidtMedia_data=a}),e.getModelLink={},!_global.is_mall_shop&&_global.mall?e.select_link=angular.copy(a):e.select_link=angular.copy(t),e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)}}])}),define("apps/weixin/controllers/template_msg",["apps/common/controllers/controllers"],function(e){e.controller("weixin.templatemsg",["$scope","$state","template_msg","Flash",function(e,t,a,o){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting"),a.query(function(t){for(var a=0;a<t.length;a++)""!=t[a].template_id?t[a].isDisabled=!0:t[a].isDisabled=!1,t[a].remark||(t[a].remark="消息模版ID");e.templateData=t}),e.inputClick=function(e,t){e.isDisabled&&(e.isDisabled=!1)},e.saveTemplateClick=function(e){""==e.template_id?o.create("danger","消息模板ID不能为空"):a.update({type:e.type,template_id:e.template_id},function(t){t.success?(o.create("success","修改成功"),e.isDisabled=!0):o.create("success","修改失败")})}}])}),define("apps/weixin/controllers/template_msginfo",["apps/common/controllers/controllers"],function(e){e.controller("weixin.templatemsg.info",["$scope","$state","template_msg","template_msgtype","Flash","$location","$stateParams",function(e,t,a,o,s,n,r){void 0!=e.weixinInfo.id&&0!=e.weixinInfo.is_authorized||t.go("weixin.setting"),o.query(function(t){e.templateType=t}),r.id?(e.but_text="修改",a.query({id:r.id},function(t){e.templateData=t})):(e.but_text="提交",e.templateData={template_id:"",state:1,type:"order_submmit"}),e.$watch("templateData.type",function(){switch($(".msg pre").css("display","none"),e.templateData.type){case"order_submmit":$(".msg pre.msg_order_submmit").css("display","block");break;case"order_accepted":$(".msg pre.msg_order_accepted").css("display","block");break;case"order_shipped":$(".msg pre.msg_order_shipped").css("display","block");break;case"refund":$(".msg pre.msg_refund").css("display","block");break;case"refund_status":$(".msg pre.msg_refund_status").css("display","block");break;case"outlet_distributor":$(".msg pre.msg_outlet_distributor").css("display","block");break;case"outlet_member":$(".msg pre.msg_outlet_member").css("display","block");break;case"outlet_commission":$(".msg pre.msg_outlet_commission").css("display","block");break;case"outlet_cash":$(".msg pre.msg_outlet_cash").css("display","block");break;case"coupon_notice":$(".msg pre.msg_coupon_notice").css("display","block");
}}),e.goback=function(){n.path("/weixin/templatemsg")},e.saveClick=!1,e.msgtempSave=function(t){return t.template_id.$invalid?(t.template_id.$dirty=!0,$("input[name='template_id']").focus(),!1):void(r.id?(e.saveClick=!0,e.but_text="提交中",a.update(e.templateData,function(){s.create("success","添加成功"),e.but_text="修改",e.saveClick=!1,e.goback()},function(t){s.create("danger",t.error.message),e.but_text="修改",e.saveClick=!1})):(e.saveClick=!0,e.but_text="保存中",a.save(e.templateData,function(){s.create("success","添加成功"),e.but_text="保存",e.saveClick=!1,e.goback()},function(){s.create("danger",data.error.message),e.but_text="保存",e.saveClick=!1})))}}])}),define("apps/weixin/controllers/flow",["apps/common/controllers/controllers"],function(e){e.controller("wxFlow_setting",["$scope","Flash","flowSet",function(e,t,a){e.info={enabled:!1,status:!1,butText:"提交",butStatus:!1},e.fromItem={content:""},a.get(function(t){1==t.is_join_flow_treasure?e.info.enabled=!0:e.info.enabled=!1}),e.intelligent_open=function(){var o=1==e.info.enabled?1:0;e.info.status=!0,a.revise({is_join_flow_treasure:o},function(a){a.status?(e.info.status=!1,t.create("success"," 操作成功！"),e.info.enabled=1==o):(e.info.status=!1,t.create("danger",a.message),e.info.enabled=1!=o)},function(a){e.info.status=!1,t.create("danger",res.data.error.message)})},e.save=function(){""!=e.fromItem.content?(e.info.butText="提交中",e.info.butStatus=!0,a.feedback({content:e.fromItem.content},function(a){a.status?(t.create("success",a.message),e.fromItem.content=""):t.create("danger",a.message),e.info.butText="提交",e.info.butStatus=!1})):t.create("danger","意见不能为空")}}])}),define("apps/weixin/controllers/_base",["apps/weixin/controllers/main","apps/weixin/controllers/setting","apps/weixin/controllers/autoreply","apps/weixin/controllers/selfmenu","apps/weixin/controllers/editmenu","apps/weixin/controllers/media","apps/weixin/controllers/media.info","apps/weixin/controllers/mediaout","apps/weixin/controllers/mediaout.info","apps/weixin/controllers/template_msg","apps/weixin/controllers/template_msginfo","apps/weixin/controllers/flow"],function(){}),define("apps/weixin/directives/_base",[],function(){}),define("apps/weixin/services/weixin_info",["apps/common/services/services"],function(e){e.factory("weixinInfoStat",["$resource",function(e){return e("/stat/weixin/survey.json",{},{query:{method:"GET",isArray:!0}})}]),e.factory("weixinInfoSrv",["$resource",function(e){return e("/weixin/info.json",{},{update:{method:"PUT"}})}]),e.factory("weixinMenuSrv",["$resource",function(e){return e("/weixin/getmenu.json",{},{update:{method:"POST",url:"/weixin/menu.json"},save:{method:"PUT",url:"/weixin/menu.json"}})}]),e.factory("weixinMedia",["$resource",function(e){return e("/weixin/media/:id.json",{id:"@id"},{query:{method:"GET",url:"/weixin/meterial/:id.json",isArray:!1},save:{method:"POST",url:"/weixin/meterial.json"},update:{method:"PUT",url:"/weixin/meterial/:id.json"},delete:{method:"DELETE",url:"/weixin/meterial/:id.json"}})}]),e.factory("autoreplyInfo",["$resource",function(e){return e("/weixin/reply.json",{},{query:{method:"GET",url:"/weixin/reply.json",isArray:!1},save:{method:"POST",url:"/weixin/reply.json"},update:{method:"PUT",url:"/weixin/reply.json"},delete:{method:"DELETE",url:"/weixin/reply.json"},defreply:{method:"PUT",url:"/weixin/autoreply.json"},autoreply:{method:"PUT",url:"/weixin/subscribereply.json"}})}]),e.factory("template_msg",["$resource",function(e){return e("/weixin/template_msg.json",{},{query:{method:"GET",url:"/weixin/template_msg.json",isArray:!0},update:{method:"PUT",url:"/weixin/template_msg.json"}})}]),e.factory("template_msgtype",["$resource",function(e){return e("/weixin/template_msg_type.json",{},{query:{method:"GET",isArray:!0}})}]),e.factory("getLocalReply",["$resource",function(e){return e("/weixin/localreply.json",{},{query:{method:"GET",isArray:!0}})}]),e.factory("saveAttachment",["$resource",function(e){return e("/weixin/attachment.json",{},{save:{method:"POST",url:"/weixin/attachment.json"}})}])}),define("apps/weixin/services/_base",["apps/weixin/services/weixin_info"],function(){}),define("apps/weixin/main",["apps/weixin/states/_base","apps/weixin/controllers/_base","apps/weixin/directives/_base","apps/weixin/services/_base"],function(){}),define("apps/stat/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("stat",{url:"/stat",abstract:!0,templateUrl:"assets/js/apps/stat/templates/layout.html"}).state("stat.dashboard",{url:"",templateUrl:"assets/js/apps/stat/templates/main.html"})}])}),define("apps/stat/states/_base",["apps/stat/states/main"],function(){}),$(document).ready(function(){}),define("apps/stat/controllers/_base",function(){}),define("apps/stat/directives/_base",function(){}),define("apps/stat/main",["apps/stat/states/_base","apps/stat/controllers/_base","apps/stat/directives/_base"],function(){}),define("apps/merchant/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant",{url:"/merchant",templateUrl:"assets/js/apps/merchant/templates/layout.html"}).state("merchant.info",{abstract:!0,url:"/info",template:"<div ui-view></div>"}).state("merchant.info.main",{url:"",templateUrl:"assets/js/apps/merchant/templates/main.html",controller:"merchant.info",resolve:{merchantLoader:["merchantLoader",function(e){return e()}]}})}])}),define("apps/merchant/states/store",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant.store",{abstract:!0,url:"/store",template:"<div ui-view></div>"}).state("merchant.store.main",{url:"",templateUrl:"assets/js/apps/merchant/templates/store.list.html",controller:"merchant.store.list"}).state("merchant.store.add",{url:"/add",templateUrl:"assets/js/apps/merchant/templates/store.info.html",controller:"merchant.store.info"}).state("merchant.store.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/merchant/templates/store.info.html",controller:"merchant.store.info",resolve:{storeLoader:["storeLoader","$stateParams",function(e,t){return e(t)}]}}).state("merchant.store.account",{url:"/account/:id",templateUrl:"assets/js/apps/merchant/templates/store.account.html",controller:"merchant.store.account"})}])}),define("apps/merchant/states/admin",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant.admin",{abstract:!0,url:"/admin",template:"<div ui-view></div>"}).state("merchant.admin.main",{url:"",templateUrl:"assets/js/apps/merchant/templates/admin.list.html",controller:"merchant.admin.list"}).state("merchant.admin.add",{url:"/add",templateUrl:"assets/js/apps/merchant/templates/admin.info.html",controller:"merchant.admin.info",resolve:{rolesLoader:["rolesLoader",function(e){return e()}],storeList:["storeList",function(e){return e()}]}}).state("merchant.admin.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/merchant/templates/admin.info.html",controller:"merchant.admin.info",resolve:{userLoader:["userLoader","$stateParams",function(e,t){return e(t)}],rolesLoader:["rolesLoader",function(e){return e()}],storeList:["storeList",function(e){return e()}]}}).state("merchant.admin.role",{url:"/role",templateUrl:"assets/js/apps/merchant/templates/admin.role.html",controller:"merchant.admin.role"})}])}),define("apps/merchant/states/attachment",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant.attachment",{url:"/attachment/:type",templateUrl:"assets/js/apps/merchant/templates/attachment.list.html",controller:"merchant.attachment"})}])}),define("apps/merchant/states/serviceAccount",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant.account",{abstract:!0,url:"",template:"<div ui-view id='accountContent'></div>"}).state("merchant.account.survey",{url:"/account/survey",templateUrl:"assets/js/apps/merchant/templates/account.survey.html",controller:"account.survey"}).state("merchant.account.sms",{url:"/account/sms",templateUrl:"assets/js/apps/merchant/templates/account.sms.html",controller:"account.sms"}).state("merchant.account.express",{url:"/account/express",templateUrl:"assets/js/apps/merchant/templates/account.express.html",controller:"account.express"}).state("merchant.account.setting",{url:"/account/setting",templateUrl:"assets/js/apps/merchant/templates/account.setting.html",controller:"account.setting"}).state("merchant.account.recharge",{url:"/account/recharge",templateUrl:"assets/js/apps/merchant/templates/account.recharge.html",controller:"account.recharge"})}])}),define("apps/merchant/states/domain",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant.domain",{abstract:!0,url:"/domain",template:"<div ui-view></div>"}).state("merchant.domain.main",{url:"",templateUrl:"assets/js/apps/merchant/templates/domain.html",controller:"merchant.domain"})}])}),define("apps/merchant/states/description",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("merchant.description",{url:"/description",templateUrl:"assets/js/apps/merchant/templates/description.html",controller:"merchant.description"})}])}),define("apps/merchant/states/_base",["apps/merchant/states/main","apps/merchant/states/store","apps/merchant/states/admin","apps/merchant/states/attachment","apps/merchant/states/serviceAccount","apps/merchant/states/domain","apps/merchant/states/description"],function(){}),define("apps/merchant/controllers/store.list",["apps/common/controllers/controllers"],function(e){e.controller("merchant.store.list",["$scope","Flash","storeSrv",function(e,t,a){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={search:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var o=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.store=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.search=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1},e.remove=function(o,s){a.delete({id:s},function(a){a.success?(e.store.splice(o,1),t.create("success"," 删除成功！")):t.create("danger",a.error)},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/merchant/controllers/store.info",["apps/common/controllers/controllers","baiduMap"],function(e){e.controller("merchant.store.info",["$scope","storeSrv","storeLoader","Flash","$stateParams","$state",function(e,t,a,o,s,n){function r(e){var t=[];return angular.forEach(e,function(e,a){t.push(e.memo)}),t}function i(t){var a=[];angular.forEach(t,function(e,t){a.push(e.id)}),e.already=a.join(",")}function c(t){var a=new BMap.Geocoder;a.getPoint(t,function(t){t?(e.items.lng=t.lng,e.items.lat=t.lat,p.centerAndZoom(t,16),m=new BMap.Marker(t),m.enableDragging(),p.clearOverlays(),p.addOverlay(m),g(m)):o.create("danger","您选择地址没有解析到结果!")},e.cityname)}function l(){return"0"==e.items.type?(o.create("danger","请选择门店类型"),!1):0==e.items.img.length?(o.create("danger","请选择门店照片"),!1):!!e.items.selected_city||(o.create("danger","请选择所属区域"),!1)}if(e.setting={citySelectedInfo:[],cityList:[]},e.editorOptions=angular.extend({},window._editorOptions,{extraPlugins:"uploadimage",height:"150px"}),s.id){e.title="修改门店",e.items=a;var d=e.city=this;d.regions={country:1,province:e.items.province,city:e.items.city,district:e.items.district},d.start="province",d.end="district",e.setting.cityList=e.setting.cityList.concat(r(e.items.store_region)),e.items.realname=null!=a.account?a.account.realname:"",e.items.type=e.items.type.toString()}else{e.title="新增门店",e.items={type:"0",img:[]},e.items.lng=116.404,e.items.lat=39.915;var d=e.city=this;d.regions={country:1},d.start="province",d.end="district"}e.$watch("city",function(t){angular.isUndefined(t.selected)||(t.selected.length>2&&(e.cityname=t.selected[1].name),e.items.selected_city=t.selected)},!0),e.btn_text="保存",e.$watch("setting.citySelectedInfo",function(t){t&&(e.setting.cityList=e.setting.cityList.concat(t),e.form.$invalid=!1)},!0),e.$watch("setting.cityList",function(e){i(e)},!0),e.removeCity=function(t){e.setting.citySelectedInfo=[],e.setting.cityList.splice(t,1)},e.already="";var p=new BMap.Map("baiduMap");p.centerAndZoom(new BMap.Point(116.404,39.915),16),p.addControl(new BMap.NavigationControl),p.enableScrollWheelZoom(!0);var u=new BMap.Point(e.items.lng,e.items.lat);p.centerAndZoom(u,16);var m=new BMap.Marker(u);m.enableDragging(),p.addOverlay(m);var g=function(t){t.addEventListener("dragend",function(a){var o=t.getPosition();e.items.lng=o.lng,e.items.lat=o.lat})};g(m),e.searchAddress=function(){if(angular.isUndefined(e.cityname))return o.create("danger","请先选择城市"),!1;if(angular.isUndefined(e.items.address)||""==e.items.address)return o.create("danger","请输入地址"),!1;var t=e.items.selected_city[1].name+e.items.selected_city[2].name+e.items.address;c(t)},e.submitForm=function(a){e.items.store_region=e.setting.cityList,a&&l()&&(e.btn_text="保存中...",e.form.$invalid=!0,s.id?t.update({id:s.id},e.items,function(t){n.go("merchant.store.main"),e.btn_text="保存",o.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}):t.save(e.items,function(t){"undefined"==typeof t.status?(n.go("merchant.store.main"),e.btn_text="保存",o.create("success"," 保存成功！")):(o.create("danger",t.msg),e.btn_text="保存",e.form.$invalid=!1)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/merchant/controllers/store.account",["apps/common/controllers/controllers","baiduMap"],function(e){e.controller("merchant.store.account",["$scope","storeAccount","Flash","$stateParams","$state",function(e,t,a,o,s){t.get({id:o.id},function(t){""!==t.username&&t.username?(e.items=t,e.items.password="",e.isEdit=!0):(e.items={username:"",password:"",password_confirmation:""},e.isEdit=!1)}),e.btn_text="保存",e.submitForm=function(n){n.$valid&&(e.btn_text="保存中...",n.$invalid=!0,t.put({id:o.id},e.items,function(t){t.status?(a.create("success"," 保存成功！"),s.go("merchant.store.main"),e.btn_text="保存",n.$invalid=!1):(a.create("danger",t.msg),e.btn_text="保存",n.$invalid=!1)}))}}])}),define("apps/merchant/controllers/merchant",["apps/common/controllers/controllers"],function(e){e.controller("merchant.info",["$scope","merchant","merchantLoader","Flash","$location","videoAddress",function(e,t,a,o,s,n){e.videoAddress=n,e.merchant_info=a;var r=e.city={start:"province",end:"district"};r.regions={country:1,province:e.merchant_info.province,city:e.merchant_info.city,district:e.merchant_info.district},e.btn_text="保存",e.submitForm=function(a){r.selected&&r.selected.length>2?(e.merchant_info.province=r.selected[0].id,e.merchant_info.city=r.selected[1].id,e.merchant_info.district=r.selected[2].id):o.create("danger","请选择公司地址！"),a&&(e.btn_text="保存中...",e.form.$invalid=!0,t.update(e.merchant_info,function(a){e.merchant_info=t.get(),e.btn_text="保存",o.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/merchant/controllers/admin.list",["apps/common/controllers/controllers"],function(e){e.controller("merchant.admin.list",["$scope","user","Flash","$modal",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:12},e.searchInfo={search:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var s=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.remove=function(o,s){t.delete({id:s},function(t){e.data.splice(o,1),a.create("success"," 删除成功！")},function(e){a.create("danger",e.data.error.message)})},e.setPermission=function(e){var t=o.open({animation:!1,templateUrl:"assets/js/apps/merchant/templates/admin.set.permission.html",controller:"admin.set.permission",windowClass:"modal-open",resolve:{uid:function(){return e}}});t.result.then(function(e){})}}])}),define("apps/merchant/controllers/admin.info",["apps/common/controllers/controllers"],function(e){e.controller("merchant.admin.info",["$scope","user","storeSrv","userLoader","storeList","rolesLoader","Flash","$stateParams","$state",function(e,t,a,o,s,n,r,i,c){i.id?(e.title="修改管理员",e.user=o,e.passrequire=!1,e.isEdit=!0):(e.title="新增管理员",e.isEdit=!1,e.user={username:"",password:"",password_confirmation:"",realname:"",gender:"1",mobile:"",weixin:"",email:"",role_id:"",store_id:"",is_admin:0,virtual:0,check:0,underline:0},e.passrequire=!0,e.initUser=t.user_init()),e.roles=n,e.stores=s.data,angular.forEach(n.data,function(e,t){angular.forEach(o.role,function(t,a){e.id==t.id&&(e.checked=!0)})}),angular.forEach(e.stores,function(e,t){angular.forEach(o.store,function(t,a){e.id==t.id&&(e.checked=!0)})}),e.btn_text="保存",e.check=function(){e.user.role_id=[],angular.forEach(e.roles.data,function(t,a){1==t.checked&&e.user.role_id.push(t.id)}),e.user.role_id=e.user.role_id.join(","),e.user.role_id==[]?e.role=!0:e.role=!1},e.select=function(){e.user.store_id=[],angular.forEach(e.stores,function(t,a){1==t.checked&&e.user.store_id.push(t.id)}),e.user.store_id=e.user.store_id.join(","),e.user.store_id==[]?e.isShow=!0:e.isShow=!1},e.submitForm=function(a){a&&(e.btn_text="保存中...",e.form.$invalid=!0,i.id?t.update({userid:i.id},e.user,function(t){c.go("merchant.admin.main"),e.btn_text="保存",r.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,r.create("danger",t.data.error.message)}):t.save(e.user,function(t){c.go("merchant.admin.main"),e.btn_text="保存",r.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,r.create("danger",t.data.error.message)}))}}])}),define("apps/merchant/controllers/admin.set.permission",["apps/common/controllers/controllers"],function(e){e.controller("admin.set.permission",["$scope","user","$http","Flash","uid","$modalInstance",function(e,t,a,o,s,n){a.get("/user_privs/"+s+".json").success(function(t){e.user_privs=t}),a.get("/priv.json").success(function(t){e.tree=t,r(e.user_privs)}),a.get("/user/"+s+".json").success(function(t){e.user=t});var r=function(t){angular.forEach(e.tree,function(e,a){e.checked=!1,angular.forEach(t,function(t,a){t==e.code&&(e.checked=!0)})}),t.class=!0};e.choose_priv_child=function(t){angular.forEach(e.tree,function(e,a){t.checked&&e.id==t.parent_id&&(e.checked=t.checked)})},e.choose_priv=function(t){angular.forEach(e.tree,function(a,o){t.checked&&a.id==t.parent_id&&(a.checked=t.checked,e.choose_priv_child(a)),a.parent_id==t.id&&(a.checked=t.checked,e.choose_priv(a))})},e.btn_text="保存",e.save_priv=!0,e.save_priv=function(){if(angular.isUndefined(s))o.create("warning","管理员id错误！");else{var t=[];angular.forEach(e.tree,function(e,a){1==e.checked&&t.push(e.id)}),t=t.join(","),e.btn_text="保存中...",e.save_priv=!1,a.put("user_privs/"+s+".json",{priv_id:t}).success(function(t){e.btn_text="保存",e.save_priv=!0,o.create("success","修改成功！"),n.close(1)})}}}])}),define("apps/merchant/controllers/role",["apps/common/controllers/controllers"],function(e){e.controller("merchant.admin.role",["$scope","role","$http","Flash",function(e,t,a,o){e.roles=t.get(),a.get("/priv.json").success(function(t){e.tree=t}),e.set=function(t){e.saveid=t.id,angular.forEach(e.tree,function(e,a){e.checked=!1,angular.forEach(t.priv,function(t,a){t.id==e.id&&(e.checked=!0)})}),angular.forEach(e.roles.data,function(e,t){e.class=!1}),t.class=!0},e.add_status=!1,e.add_role=function(){t.save({name:e.role_name},function(t){e.cancel_add_role(),e.roles.data.unshift(t)})},e.cancel_add_role=function(){e.add_status=!1,e.role_name=""},e.del_role=function(a,s){t.delete({id:a.id},function(){o.create("success","删除成功！"),e.roles.data.splice(s,1)})},e.edit_role_name=function(e){e.show=!1,t.update(e,function(e){o.create("success","修改成功！")})},e.toggle_role_name=function(e){e.show=!0,setTimeout(function(){angular.element("#role_"+e.id).focus()},100)},e.save_priv=function(){if(angular.isUndefined(e.saveid))o.create("warning","请先选择角色！");else{var a=[];angular.forEach(e.tree,function(e,t){1==e.checked&&a.push(e.id)}),a=a.join(","),t.update({id:e.saveid,priv_id:a},function(a){o.create("success","修改成功！"),e.roles=t.get()})}},e.choose_priv_child=function(t){t.lv>1&&angular.forEach(e.tree,function(a,o){t.checked&&a.id==t.parent_id&&(a.checked=t.checked,e.choose_priv_child(a))})},e.choose_priv=function(t){angular.forEach(e.tree,function(a,o){t.checked&&a.id==t.parent_id&&(a.checked=t.checked,e.choose_priv_child(a)),a.parent_id==t.id&&(a.checked=t.checked,e.choose_priv(a))})}}])}),define("apps/merchant/controllers/merchant.attachment",["apps/common/controllers/controllers"],function(e){e.controller("merchant.attachment",["$scope","Flash","attachmentVirtualPersons","$http","$stateParams","ngPopover","attachment","deleteVirtuals","attachmentGroup","$state","attachmentSetGroup","$modal",function(e,t,a,o,s,n,r,i,c,l,d,p){function u(a,o){var s;switch(e.type){case"virtual":s=i;break;case"group":s=c;break;default:s=r}s.delete({id:a},function(e){1==e.success?(t.create("success"," 删除成功！"),"function"==typeof o&&o()):t.create("danger"," 删除失败！")},function(e){t.create("danger",e.data.error.message)})}function m(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:f()}e.type=s.type,e.searchParam={},e.searchParam.selected={id:0};var g=function(){c.get(function(t){e.groupList=t.data,e.dropdownGroups=angular.copy(e.groupList),e.dropdownGroups.unshift({id:0,name:"未分组"}),"undefined"!=typeof e.dropdownGroups[0]&&(e.searchParam.selected=e.dropdownGroups[0])})};g(),e.setGroup=function(a){var o={},s={groupList:e.groupList};a?(o.attachment_ids=[a.id],s.attachment=a):o.attachment_ids=e.checkedIds;var n={animation:!1,templateUrl:"assets/js/apps/merchant/templates/groups.html",controller:"attachGroupCtrl",windowClass:"attachGroup-Modal",resolve:{passData:function(){return s}}},r=p.open(n);r.result.then(function(e){o.group_id=e,d.setGroup(o,function(e){e.success?(t.create("success","设置成功"),m()):t.create("danger",e.error)})})},e.delGroup=function(t,a){a?e.groupList.splice(a,1):u(t,g)},e.addGroup=function(){var t={id:0,name:"",listorder:""};e.groupList.push(t)},e.saveList=function(){for(var a={ids:[],names:[],listorders:[]},o=0;o<e.groupList.length;o++){if(""==$.trim(e.groupList[o].name))return void t.create("danger","分组名称不能为空");a.ids.push(e.groupList[o].id),a.names.push(e.groupList[o].name),a.listorders.push(parseInt(e.groupList[o].listorder))}c.save(a,function(e){e.error?t.create("danger",e.error):(t.create("success","保存成功"),l.go(l.current,{},{reload:!0}))},function(e){})},e.paginationConf={currentPage:1,itemsPerPage:10};var f=function(){e.attachment={checkedAll:!1},e.checkedIds=[];var t={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};"all"!=s.type&&(t.type=s.type),e.searchParam.title&&(t.title=e.searchParam.title),e.searchParam.selected&&(t.group_id=e.searchParam.selected.id),"virtual"==e.type?a.get(t,function(t){e.paginationConf.totalItems=t._count,e.data=t.data}):r.getList(t,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",f),e.virtualDelete=function(e){u(e,m)},e.attachment={checkedAll:!1},e.checkedIds=[],e.$watch("attachment.checkedAll",function(t){t?e.checkedIds=e.data.map(function(e){return e.id}):e.checkedIds=[]}),e.toggleSelection=function(t){var a=e.checkedIds.indexOf(t);a>-1?e.checkedIds.splice(a,1):e.checkedIds.push(t)},e.checkFilename=function(e){if(""==e)return"文件名称不能为空!"},e.editFileName=function(e,a){r.update({id:a,file_name:e},function(e){1==e.success?t.create("success"," 修改成功！"):t.create("danger"," 修改失败！")},function(e){t.create("danger",e.data.error.message)})},e.confirmDelete=function(e){u(e,m)},e.delFile=function(){var t=e.checkedIds.join(",");u(t,m)},e.voicePlayClick=function(e){var t='<div id="audio_wrapper" style="display: none;"><audio id="audio_player" preload="" type="audio/mpeg" src="'+e+'"></audio></div>';$("#audio_wrapper").length>0?$("#audio_player").attr("src",e):$("body").append(t);var a=document.getElementById("audio_player");a.play()},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){n.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.search=function(){m()}}]),e.controller("attachGroupCtrl",["$scope","$modalInstance","passData",function(e,t,a){e.groupList=a.groupList,e.attachment=a.attachment,e.setGroup=function(e){t.close(e)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/merchant/controllers/account.express",["apps/common/controllers/controllers"],function(e){e.controller("account.express",["$scope","account_express","dateConstant",function(e,t,a){e.dateArrange="",e.ranges=a.ranges,e.paginationConf=a.paginationConf,e.searchInfo={type:"all",start_time:"",end_time:""};var o=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.expressData=t,e.expressItems=t.data})};e.$watch("paginationConf.currentPage",o),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1}}])}),define("apps/merchant/controllers/account.setting",["apps/common/controllers/controllers"],function(e){e.controller("account.setting",["$scope","Flash","account_setting",function(e,t,a){a.getPrice({},function(t){e.smsPrice=t.sms_price}),e.save_btn="保存";var o=function(){a.get(function(a){a.status?(e.settings={SMSStatus:{},expressStatus:{}},e.settings.SMSStatus=a.data.sms,e.settings.expressStatus=a.data.delivery,e.isCheckedAll()):t.create("danger",a.msg)})};o(),e.submitForm=function(){e.save_btn="保存中",e.settingSubmit={sms:[],delivery:[]},angular.forEach(e.settings.SMSStatus,function(t,a){1===t.val&&e.settingSubmit.sms.push(a)}),e.form.$invalid=!0,a.save(e.settingSubmit,function(a){e.form.$invalid=!1,a.status?(t.create("success","保存成功"),e.save_btn="保存",o()):(t.create("danger","保存失败"),e.save_btn="保存")},function(t){e.form.$invalid=!1,e.save_btn="保存"})},e.checkAllItems=function(){e.member.checkedAll?(angular.forEach(e.settings.SMSStatus,function(e,t){e.val=1}),angular.forEach(e.settings.expressStatus,function(e,t){e.val=1}),e.member.check_btn="取消全选"):(angular.forEach(e.settings.SMSStatus,function(e,t){e.val=0}),angular.forEach(e.settings.expressStatus,function(e,t){e.val=0}),e.member.check_btn="全选")},e.isCheckedAll=function(){var t=!0;angular.forEach(e.settings.SMSStatus,function(a,o){t&&0===a.val&&(e.member={check_btn:"全选",checkedAll:!1},t=!1)}),t&&angular.forEach(e.settings.expressStatus,function(a,o){t&&0===a.val&&(e.member={check_btn:"全选",checkedAll:!1},t=!1)}),t&&(e.member={check_btn:"取消全选",checkedAll:!0})}}])}),define("apps/merchant/controllers/account.sms",["apps/common/controllers/controllers"],function(e){e.controller("account.sms",["$scope","account_sms","dateConstant",function(e,t,a){e.dateArrange="",e.ranges=a.ranges,e.paginationConf=a.paginationConf,e.searchInfo={type:"all",start_time:"",end_time:""};var o=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.smsData=t,e.smsItems=t.data})};e.$watch("paginationConf.currentPage",o),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1}}])}),define("apps/merchant/controllers/account.survey",["apps/common/controllers/controllers"],function(e){e.controller("account.survey",["$scope","account_survey","dateConstant",function(e,t,a){e.dateArrange="",e.ranges=a.ranges,e.paginationConf=a.paginationConf,e.searchInfo={type:"all",start_time:"",end_time:""};var o=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.surveyData=t,e.surveyItems=t.data})};e.$watch("paginationConf.currentPage",o),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1}}])}),define("apps/merchant/controllers/account.recharge",["apps/common/controllers/controllers"],function(e){e.controller("account.recharge",["$scope","service_account","Flash","$modal",function(e,t,a,o){t.get(function(t){e.income=t}),e.rechargeInfo={money:""},e.setRecharge=function(){var t=parseFloat(e.rechargeInfo.money),s=!1;if(""==e.rechargeInfo.money)a.create("danger","请填写充值金额");else{var n=/^\d+(\.\d+)?$/;if(n.test(e.rechargeInfo.money))if(t>0){var r=e.rechargeInfo.money.indexOf("."),i=0;r>0?(i=e.rechargeInfo.money.split(".")[1].length,i>2&&a.create("danger","充值金额只能包含两位小数,并且大于0"),e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),t=parseFloat(e.rechargeInfo.money),s=t>0):r==-1?(e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),s=!0):(a.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00")}else a.create("danger","输入的金额不能为0"),e.rechargeInfo.money="0.00";else a.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00",s=!1}if(s){var c=o.open({animation:!1,templateUrl:"assets/js/apps/trade/templates/recharge.code.html",controller:"setAccountRechargeCon",backdrop:!1,resolve:{data:function(){return e.rechargeInfo.money}}});c.result.then(function(e){})}}}]),e.controller("setAccountRechargeCon",["$scope","$modalInstance","service_account_recharge","recharge_issuccess","data","Flash","$location",function(e,t,a,o,s,n,r){e.IsSuccess={type:1},a.update({amount:s},function(t){t.success&&(e.rechargeInfo=t.data)}),e.paySuccess=function(){o.get({recharge_sn:e.rechargeInfo.recharge_sn},function(t){t.status?e.IsSuccess.type=2:n.create("danger",t.msg)})},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){r.path("/merchant/account/survey"),e.cancel()}}])}),define("apps/merchant/controllers/domain",["apps/common/controllers/controllers"],function(e){e.controller("merchant.domain",["$scope","domain","Flash","$location",function(e,t,a,o){e.btn_text="保存",e.domain=t.get(),e.del=function(){t.delete(function(o){o.status?(e.domain=t.get(),a.create("success",o.msg)):a.create("danger",o.msg)})},e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,t.update(e.domain,function(o){e.btn_text="保存",e.form.$invalid=!1,o.status?(e.domain=t.get(),a.create("success",o.msg)):a.create("danger",o.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}))}}])}),define("apps/merchant/controllers/description",["apps/common/controllers/controllers"],function(e){e.controller("merchant.description",["$scope","merchant","merchantLoader","Flash","$location","videoAddress",function(e,t,a,o,s,n){}])}),define("apps/merchant/controllers/_base",["apps/merchant/controllers/store.list","apps/merchant/controllers/store.info","apps/merchant/controllers/store.account","apps/merchant/controllers/merchant","apps/merchant/controllers/admin.list","apps/merchant/controllers/admin.info","apps/merchant/controllers/admin.set.permission","apps/merchant/controllers/role","apps/merchant/controllers/merchant.attachment","apps/merchant/controllers/account.express","apps/merchant/controllers/account.setting","apps/merchant/controllers/account.sms","apps/merchant/controllers/account.survey","apps/merchant/controllers/account.recharge","apps/merchant/controllers/domain","apps/merchant/controllers/description"],function(){}),
define("apps/merchant/services/store",["apps/common/services/services"],function(e){e.factory("storeSrv",["$resource",function(e){return e("/store/:id.json",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!1},enabled:{method:"PUT",url:"/store/enabled/:id.json"}})}]),e.factory("storeAccount",["$resource",function(e){return e("/store/store_user/:id.json",{id:"@id"},{put:{method:"PUT"},get:{method:"GET"}})}]),e.factory("storeLoader",["storeSrv","$q",function(e,t){return function(a){var o=t.defer();return e.get({id:a.id},function(e){o.resolve(e)}),o.promise}}]),e.factory("storeList",["storeSrv","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}]),e.factory("storeSettingUtil",[function(){return{getRegion:function(e){if(e=e||{},!e)return{city:[{ids:"",names:""}],aleardy:""};var t={},a="";angular.forEach(e,function(e,a){t[e.region_percent]=t[e.region_percent]||{ids:[],names:[]},t[e.region_percent].ids.push(e.region_id),t[e.region_percent].names.push(e.region_name)});var o=[];for(var s in t){a+=t[s].ids.join(",")+",";var n={city:{ids:t[s].ids.join(","),names:t[s].names.join(",")},bonus_value:parseFloat(s)};o.push(n)}return a.substr(0,a.length-1),{city:o,already:a}}}}])}),define("apps/merchant/services/merchant",["apps/common/services/services"],function(e){e.factory("merchant",["$resource",function(e){return e("/merchant.json",{},{update:{method:"PUT"}})}]),e.factory("merchantLoader",["merchant","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}]),e.factory("domain",["$resource",function(e){return e("domain/config.json",{},{get:{method:"GET",url:"domain/config.json"},update:{method:"PUT",url:"domain/config.json"},delete:{method:"DELETE",url:"domain/config.json"}})}])}),define("apps/merchant/services/role",["apps/common/services/services"],function(e){e.factory("role",["$resource",function(e){return e("role/role.json",{id:"@id"},{get:{method:"GET",url:"role/role/:id.json"},update:{method:"PUT",url:"role/role/:id.json"},delete:{method:"DELETE",url:"role/role/:id.json"}})}]),e.factory("rolesLoader",["role","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}])}),define("apps/merchant/services/merchant.setting",["apps/common/services/services"],function(e){e.factory("merchantSettingResource",["$resource",function(e){return e("merchant_setting.json",{},{update:{method:"POST"},get:{method:"GET"}})}])}),define("apps/merchant/services/attachment",["apps/common/services/services"],function(e){e.factory("attachment",["$resource",function(e){return e("attachment/attachment.json",{id:"@id"},{update:{method:"PUT",url:"attachment/attachment/:id.json"},delete:{method:"DELETE",url:"attachment/attachment.json"},getList:{method:"GET",url:"attachment"}})}]),e.factory("attachmentVirtualPersons",["$resource",function(e){return e("order/virtual_member.json",{},{get:{method:"GET"}})}]),e.factory("deleteVirtuals",["$resource",function(e){return e("order/virtual_member.json",{},{delete:{method:"DELETE"}})}]),e.factory("attachmentGroup",["$resource",function(e){return e("attachment/group.json",{id:"@id"},{delete:{method:"DELETE",url:"attachment/group/:id.json"}})}]),e.factory("attachmentSetGroup",["$resource",function(e){return e("attachment/setGroup.json",{group_id:"@id",attachment_ids:"@attachment_ids"},{setGroup:{method:"POST",url:"attachment/setGroup.json"}})}]),e.factory("service_account",["$resource",function(e){return e("service_account/balance.json",{},{get:{method:"get",url:"service_account/balance.json"}})}]),e.factory("service_account_recharge",["$resource",function(e){return e("service_account/recharge.json",{},{update:{method:"POST",url:"service_account/recharge.json"}})}]),e.factory("recharge_issuccess",["$resource",function(e){return e("service_account/recharge_issuccess.json",{},{get:{method:"GET",url:"service_account/recharge_issuccess.json"}})}])}),define("apps/merchant/services/account",["apps/common/services/services"],function(e){e.factory("account_sms",["$resource",function(e){return e("service_account/service_account_sms_log.json",{})}]),e.factory("account_survey",["$resource",function(e){return e("service_account/service_account_recharge.json",{})}]),e.factory("account_express",["$resource",function(e){return e("service_account/service_account_delivery_log.json",{})}]),e.factory("account_setting",["$resource",function(e){return e("service_account/service_account_recharge_set.json",{},{getPrice:{method:"GET",url:"service_account/get_price.json"}})}]),e.constant("dateConstant",{ranges:{"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]},paginationConf:{currentPage:1,itemsPerPage:10}})}),define("apps/merchant/services/_base",["apps/merchant/services/store","apps/merchant/services/merchant","apps/merchant/services/role","apps/merchant/services/merchant.setting","apps/merchant/services/attachment","apps/merchant/services/account"],function(){}),define("apps/merchant/directives/store.city.select",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("storeCitySelect",["$modal",function(e){return{restrict:"EA",scope:{size:"@size",exist:"=exist",already:"=already"},require:"?^ngModel",link:function(t,a,o,s){a.bind("click",function(){var a=e.open({animation:!1,templateUrl:"assets/js/apps/merchant/templates/store.city.select.html",controller:"store.city.ctrl",size:t.size,resolve:{exist:function(){return t.exist},already:function(){return t.already}}});a.result.then(function(e){s.$setViewValue(e)})})}}}]),t.controller("store.city.ctrl",["$scope","$http","$modalInstance","Flash","exist","already",function(e,t,a,o,s,n){function r(t){angular.forEach(e.regions[t.prov].sub,function(a,o){t.status?a.child=a.sub.length:a.child=0,delete e.selected[a.id]}),t.status?e.regions[t.prov].child=e.regions[t.prov].sub.length:e.regions[t.prov].child=0}function i(t){angular.forEach(e.regions[t.prov].sub[t.city].sub,function(e,a){t.status&&(e.checked=!1)})}function c(e){var t=[];return angular.forEach(e,function(e,a){t.push(e.memo.id.toString())}),t}function l(t,a,o,s,n,r){var i=0;return!!a[o.id]&&(angular.forEach(a[o.id],function(r,c){s[r.id]&&(r.checked=!0,o.child=++i,"city"==t?(angular.forEach(a[r.id],function(e,t){e.checked=!0}),r.child=a[r.id].length,e.selected[r.id]={id:r.id,index:c,name:r.name,type:"city",prov:n.prov,provName:n.provName}):(e.regions[n.prov].child=0,angular.forEach(e.regions[n.prov].sub,function(t,a){t.child>0&&e.regions[n.prov].child++}),e.regions[n.prov].sub[n.city].sub[c].disabled||e.distAbleNum++,e.selected[r.id]={id:r.id,index:c,name:r.name,type:"dist",city:n.city,cityName:n.name,prov:n.prov,provName:n.name}))}),o.sub=a[o.id])}function d(a){t({method:"GET",url:"/regions.json"}).then(function(t){var o=t.data,i={},d={};if(s){s=s.split(",");for(var m in s)i[s[m]]=!0}var g=[],f=[];a.data.length&&(g=c(a.data)),n&&(f=n.split(",")),n=f.concat(g),n.length?(angular.forEach(n,function(e,t){d[e]=!0}),e.alreadys=d):e.alreadys={},e.regions=o[1];var h={};angular.forEach(e.regions,function(t,a){e.distAbleNum=0,h={},h.prov=a,h.provName=t.name,l("city",o,t,i,h,d),angular.forEach(t.sub,function(e,s){h.prov=a,h.provName=t.name,h.city=s,h.cityName=e.name,l("dist",o,e,i,h,d)}),i[t.id]?(t.checked=!0,e.selected[t.id]={id:t.id,index:a,name:t.name,type:"prov"},r({prov:a,status:!0})):d[t.id]&&(t.disabled=!0,r({prov:a,status:!1,disabled:!0})),t.dist_able=e.distAbleNum,p(),u()})},function(e){})}function p(){angular.forEach(e.regions,function(t,a){e.alreadys[t.id]&&(t.disabled=!0,angular.forEach(t.sub,function(e,t){e.disabled=!0,angular.forEach(e.sub,function(e,t){e.disabled=!0})})),angular.forEach(t.sub,function(a,o){e.alreadys[a.id]&&(a.disabled=!0,t.disabled=!0,angular.forEach(a.sub,function(e,t){e.disabled=!0})),angular.forEach(a.sub,function(o,s){e.alreadys[o.id]&&(o.disabled=!0,a.disabled=!0,t.disabled=!0)})})})}function u(){angular.forEach(e.regions,function(e,t){var a=0;angular.forEach(e.sub,function(e,t){angular.forEach(e.sub,function(e,t){e.disabled||a++})}),e.dist_able=a})}function m(t,a){var o=0,s=[];s=a||0==a?e.regions[t].sub[a].sub:e.regions[t].sub;for(var n in s){if(!s[n].checked)break;o++}return o==s.length}function g(t){e.selected[e.regions[t].id]={id:e.regions[t].id,index:t,name:e.regions[t].name,type:"prov"},angular.forEach(e.regions[t].sub,function(t,a){delete e.selected[t.id],angular.forEach(t.sub,function(t,a){delete e.selected[t.id]})}),e.regions[t].child=e.regions[t].sub.length}function f(t,a){e.selected[e.regions[t].sub[a].id]={id:e.regions[t].sub[a].id,index:a,name:e.regions[t].sub[a].name,type:"city",prov:t,provName:e.regions[t].name},delete e.selected[e.regions[t].id],angular.forEach(e.regions[t].sub[a].sub,function(t,a){delete e.selected[t.id]}),e.regions[t].sub[a].child=e.regions[t].sub[a].sub.length}e.selected={},t({method:"GET",url:"/store/selected.json"}).then(function(e){d(e)}),e.cityIn={},e.distsIn={},e.showCity=function(t,a,o){switch(t){case"city":e.provActive=a,e.cityIn.prov!=a&&(e.cityIn={prov:a},e.citys=e.regions[a].sub,e.distsIn={},e.dists={}),angular.forEach(e.regions[a].sub,function(e,t){var a=0;angular.forEach(e.sub,function(e,t){e.disabled||a++}),e.dist_able=a});break;case"dist":e.cityActive=o,e.distsIn.prov==a&&e.distsIn.city==o||(e.distsIn={prov:a,city:o},e.dists=e.regions[a].sub[o].sub);break;default:return!1}},e.selectCity=function(t,a){var o=!1,s=!1;switch(t){case"prov":e.regions[a].checked?(e.selected[e.regions[a].id]={id:e.regions[a].id,index:a,name:e.regions[a].name,type:"prov"},angular.forEach(e.regions[a].sub,function(t,o){t.child=t.child||0,t.checked?e.regions[a].dist_able+=t.sub.length:e.regions[a].dist_able+=t.child,t.child=0,t.checked=!1,delete e.selected[t.id],angular.forEach(e.regions[a].sub[o].sub,function(t,a){t.checked=!1,delete e.selected[t.id]})}),e.regions[a].child=0):delete e.selected[e.regions[a].id];break;case"city":e.regions[e.cityIn.prov].sub[a].checked&&(o=!0);var n=e.regions[e.cityIn.prov].sub[a].sub.length;o?(e.regions[e.cityIn.prov].sub[a].child=e.regions[e.cityIn.prov].sub[a].child||0,e.regions[e.cityIn.prov].dist_able=e.regions[e.cityIn.prov].dist_able-n+e.regions[e.cityIn.prov].sub[a].child,s=m(e.cityIn.prov),e.regions[e.cityIn.prov].checked=s,s?g(e.cityIn.prov):(f(e.cityIn.prov,a),e.regions[e.cityIn.prov].child=e.regions[e.cityIn.prov].child?e.regions[e.cityIn.prov].child+1:1),e.regions[e.cityIn.prov].sub[a].child=0):(e.regions[e.cityIn.prov].dist_able+=n,e.regions[e.cityIn.prov].checked=!1,e.regions[e.cityIn.prov].child=e.regions[e.cityIn.prov].child-1,e.regions[e.cityIn.prov].sub[a].child=0,delete e.selected[e.regions[e.cityIn.prov].id],delete e.selected[e.regions[e.cityIn.prov].sub[a].id],angular.forEach(e.regions[e.cityIn.prov].sub,function(t,o){t.checked&&(e.selected[t.id]={id:t.id,index:a,name:t.name,type:"city",prov:e.cityIn.prov,provName:e.regions[e.cityIn.prov].name})})),i({prov:e.cityIn.prov,city:a,status:o});break;case"dist":if(e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].checked&&(o=!0),o)if(e.regions[e.distsIn.prov].sub[e.distsIn.city].checked&&(e.regions[e.distsIn.prov].dist_able+=e.regions[e.distsIn.prov].sub[e.distsIn.city].sub.length),e.regions[e.distsIn.prov].dist_able--,s=m(e.distsIn.prov,e.distsIn.city),e.regions[e.distsIn.prov].sub[e.distsIn.city].checked=s,s){var r=m(e.distsIn.prov);e.regions[e.distsIn.prov].checked=r,r?g(e.distsIn.prov):f(e.distsIn.prov,e.distsIn.city)}else e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].id]={id:e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].id,index:a,name:e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].name,type:"dist",city:e.distsIn.city,cityName:e.regions[e.distsIn.prov].sub[e.distsIn.city].name,prov:e.distsIn.prov,provName:e.regions[e.distsIn.prov].name},delete e.selected[e.regions[e.distsIn.prov].id],delete e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].id],e.regions[e.distsIn.prov].checked=!1,e.regions[e.distsIn.prov].sub[e.distsIn.city].child=e.regions[e.distsIn.prov].sub[e.distsIn.city].child?e.regions[e.distsIn.prov].sub[e.distsIn.city].child+1:1,e.regions[e.distsIn.prov].child=0,angular.forEach(e.regions[e.distsIn.prov].sub,function(t,a){t.checked&&e.regions[e.distsIn.prov].child++});else e.regions[e.distsIn.prov].dist_able++,delete e.selected[e.regions[e.distsIn.prov].id],delete e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].id],delete e.selected[e.regions[e.distsIn.prov].sub[e.distsIn.city].sub[a].id],e.regions[e.distsIn.prov].checked=!1,e.regions[e.distsIn.prov].sub[e.distsIn.city].checked=!1,e.regions[e.distsIn.prov].sub[e.distsIn.city].child=e.regions[e.distsIn.prov].sub[e.distsIn.city].child-1,angular.forEach(e.regions[e.distsIn.prov].sub,function(t,o){t.checked&&(e.selected[t.id]={id:t.id,index:a,name:t.name,type:"city",prov:e.distsIn.prov,provName:e.regions[e.distsIn.prov].name})}),angular.forEach(e.regions[e.distsIn.prov].sub[e.distsIn.city].sub,function(t,o){t.checked&&(e.selected[t.id]={id:t.id,index:a,name:t.name,type:"dist",city:e.distsIn.city,cityName:e.regions[e.distsIn.prov].sub[e.distsIn.city].name,prov:e.distsIn.prov,provName:e.regions[e.distsIn.prov].name})}),0==e.regions[e.distsIn.prov].sub[e.distsIn.city].child&&e.regions[e.distsIn.prov].child--;break;default:return!1}},e.$watch("selected",function(t){var a=[];angular.forEach(t,function(e,t){switch(e.type){case"prov":a.push(e.name);break;case"city":a.push(e.provName+" "+e.name);break;case"dist":a.push(e.provName+" "+e.cityName+" "+e.name);break;default:return!1}}),e.selectInfo=a.join(",")},!0),e.selectedCancel=function(t){var a=e.selected[t],o=a.index,s=!1;switch(e.selected[t].type){case"prov":e.regions[o].checked=s,r({prov:o,status:s});break;case"city":e.regions[a.prov].sub[o].checked=s,i({prov:a.prov,city:o,status:s});break;case"dist":e.regions[a.prov].sub[a.city].sub[o].checked=s;break;default:return!1}delete e.selected[t]},e.save=function(){if(Object.keys(e.selected).length<=0)return void o.create("warning","请至少选择一个城市");var t=[];angular.forEach(e.selected,function(e,a){switch(e.type){case"prov":t.push({name:e.name,id:e.id,type:e.type,prov_name:e.name,city_name:"",dist_name:""});break;case"city":t.push({name:e.name,id:e.id,type:e.type,prov_name:e.provName,city_name:e.name,dist_name:""});break;case"dist":t.push({name:e.name,id:e.id,type:e.type,prov_name:e.provName,city_name:e.cityName,dist_name:e.name})}}),a.close(t)},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/merchant/directives/_base",["apps/merchant/directives/store.city.select"],function(){}),define("apps/merchant/main",["apps/merchant/states/_base","apps/merchant/controllers/_base","apps/merchant/services/_base","apps/merchant/directives/_base"],function(){}),define("apps/profile/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("profile",{abstract:!0,url:"/profile",templateUrl:"assets/js/apps/merchant/templates/layout.html"}).state("profile.setting",{url:"",templateUrl:"assets/js/apps/profile/templates/setting.html",controller:"profile"}),e.state("profile.password",{url:"/password",templateUrl:"assets/js/apps/profile/templates/password.html",controller:"profile.password"}),e.state("profile.add",{url:"/add",templateUrl:"assets/js/apps/profile/templates/profile.add.html",controller:"profile.add"}),e.state("profile.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/profile/templates/profile.edit.html",controller:"profile.edit"})}])}),define("apps/profile/states/_base",["apps/profile/states/main"],function(){}),define("apps/profile/controllers/profile",["apps/common/controllers/controllers","wxLogin"],function(e){e.controller("profile",["$scope","$modal","$q","wxFetchQrcodeUnbind","user","Flash","unbindLogin",function(e,t,a,o,s,n,r){e.user={},e.$watch("me",function(){if(!angular.isUndefined(e.me)){var t=a.defer();s.get({id:e.me.id},function(a){t.resolve(a),a.openid?(e.bindornot="解绑",e.binddesc="已绑定"):(e.bindornot="绑定微信",e.binddesc="未绑定"),e.user=a})}}),e.btn_text="保存",e.submitForm=function(t){t&&(e.btn_text="保存中...",e.form.$invalid=!0,s.update(e.user,function(t){e.btn_text="保存",n.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,n.create("danger",t.data.error.message)}))},e.openVaildMobile=function(){var a=t.open({animation:!1,controller:"auth.valid.mobile",templateUrl:"assets/js/apps/auth/templates/valid.mobile.modal.html",size:"big",resolve:{username:function(){return e.user.username},mobile:function(){return e.user.mobile}}});a.result.then(function(t){e.user.mobile=t})},e.changeVaildMobile=function(){var a=t.open({animation:!1,controller:"change.valid.mobile",templateUrl:"assets/js/apps/profile/templates/change.valid.mobile.html",size:"big",resolve:{mobile:function(){return e.user.mobile}}});a.result.then(function(t){e.user.mobile=t})},e.bind_wechat=function(e){t.open({animation:!1,backdrop:"static",size:e,templateUrl:"bind_wechat.html",controller:["$scope","$timeout",function(e,t){t(function(){new WxLogin({id:"js-weixin-login",appid:_global.url.weixin_qrconnect_id,scope:"snsapi_login",redirect_uri:_global.url.base+"/weixin/qrlogincode",state:"",style:"",href:_global.url.static_https+"build/css/weixin-login.css"})},50)}]})},e.unbind_wechat=function(){r.get(function(t){t.stats?(n.create("success"," 保存成功！"),e.user.unionid=""):n.create("danger","解绑失败")})},e.bind_adminwechat=function(a){if(4==a.length){t.open({animation:!1,backdrop:"static",size:"sm",templateUrl:"bind_adminwechat.html",controller:"profile.bindadminwechat"})}else o.get({id:e.user.id},function(t){t.status?(n.create("success","解绑成功"),e.bindornot="绑定微信",e.binddesc="未绑定"):(n.create("danger","解绑失败"),e.bindornot="解绑",e.binddesc="已绑定")})}}]),e.controller("profile.bindadminwechat",["$scope","$modalInstance","wxFetchQrcodeBind",function(e,t,a){a.get({},function(t){e.qrcode=t})}]),e.controller("change.valid.mobile",["$scope","$http","$state","$interval","Flash","$modalInstance","mobile",function(e,t,a,o,s,n,r){e.valid={step:1},e.entity={mobile:"",old_mobile:r,captcha:"",old_code:"",code:""},e.changeCaptcha=function(){e.captcha_src="/captcha?"+Math.random()},e.changeCaptcha(),e.isCodeSend=!1,e.vlogin={text:"确认",clickTxt:"获取验证码",second:120,clickStatus:!1},e.valid_step_one_step=!1,e.verifiyOldForm=function(a){a&&(e.valid_step_one_step=!0,t({url:"/user/verify_mobile_message.json",method:"post",data:{old_mobile:e.entity.old_mobile,old_code:e.entity.old_code}}).success(function(t){e.valid_step_one_step=!1,e.valid.step=2,t.status?(s.create("success",t.message),e.isCodeSend=!1,o.cancel(e.vlogin.timer),e.vlogin.clickTxt="获取验证码",e.vlogin.second=120,e.entity.captcha="",e.changeCaptcha(),e.valid.step=2):s.create("warning",t.message)}).error(function(t){e.valid_step_one_step=!1,s.create("danger",t.error.message)}))},e.valid_step_two_step=!1,e.verifiyNewForm=function(a){a&&(e.valid_step_two_step=!0,t({url:"/user/admin_mobile.json",method:"put",data:{mobile:e.entity.mobile,code:e.entity.code,old_mobile:e.entity.old_mobile}}).success(function(t){e.valid_step_two_step=!1,t.status?(s.create("success","更改手机号成功"),n.close(e.entity.mobile)):s.create("warning",t.message)}).error(function(t){e.valid_step_two_step=!1,s.create("danger",t.error.message)}))},e.getVerifiy=function(){if(e.entity.mobile==e.entity.old_mobile)return s.create("warning","手机号不能相同"),!1;var a=1==e.valid.step?e.entity.old_mobile:e.entity.mobile,n=1==e.valid.step?"send_old_verfity_message.json":"send_verfity_message.json";t({url:n,method:"put",data:{captcha:e.entity.captcha,mobile:a,type:"5"}}).success(function(t){e.changeCaptcha(),t&&(e.vlogin.timer=o(function(){e.vlogin.second>0?(e.isCodeSend=!0,e.vlogin.clickTxt="重新获取("+e.vlogin.second+")",e.vlogin.second--):(e.isCodeSend=!1,o.cancel(e.vlogin.timer),e.vlogin.clickTxt="重新获取",e.vlogin.second=120)},1e3))}).error(function(t){s.create("danger",t.error.message),e.vlogin.clickTxt="重新获取",e.changeCaptcha()})},e.cancel=function(){n.dismiss("cancel")}}])}),define("apps/profile/controllers/profile.password",["apps/common/controllers/controllers"],function(e){e.controller("profile.password",["$scope","$resource","Flash",function(e,t,a){var o=t("/pass.json",{},{update:{method:"PUT"}});e.pass={},e.$watch("pass.password_confirmation+pass.password",function(){e.pass.password!=e.pass.password_confirmation?e.confirm=!0:e.confirm=!1}),e.btn_text="保存",e.submitForm=function(t){t&&(e.btn_text="保存中...",e.form.$invalid=!0,o.update(e.pass,function(t){e.btn_text="保存",a.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}))}}])}),define("apps/profile/controllers/profile.add",["apps/common/controllers/controllers"],function(e){e.controller("profile.add",["$scope","Flash","$location","virtualAdd","$timeout","levelNameVirtual",function(e,t,a,o,s,n){e.isSubmit=!1,e.virtual_info={nick_name:"",portrait:"",level_id:""},n.get(function(t){e.data=t}),e.submitForm=function(){return e.virtual_info.nick_name?e.virtual_info.portrait?(e.isSubmit=!0,e.virtual_info.merchant_id=_global.shop.merchant_id,void o.post(e.virtual_info,function(e){t.create("success"," 保存成功！"),s(function(){a.path("/merchant/attachment/virtual")},1500)},function(a){t.create("danger"," 保存失败！"),e.isSubmit=!1})):(t.create("danger"," 请选择头像"),!1):(t.create("danger"," 请填写昵称"),$("input[name='nickname']").focus(),!1)}}])}),define("apps/profile/controllers/profile.edit",["apps/common/controllers/controllers"],function(e){e.controller("profile.edit",["$scope","Flash","$location","virtualAdd","$timeout","levelNameVirtual","virtualDetails","$stateParams",function(e,t,a,o,s,n,r,i){e.isSubmit=!1,r.get({id:i.id},function(t){e.virtual_info=t}),n.get(function(t){e.data=t}),e.submitForm=function(){return e.virtual_info.nick_name?e.virtual_info.portrait?(e.isSubmit=!0,e.virtual_info.merchant_id=_global.shop.merchant_id,void o.put(e.virtual_info,function(e){t.create("success"," 保存成功！"),s(function(){a.path("/merchant/attachment/virtual")},1500)},function(a){t.create("danger"," 保存失败！"),e.isSubmit=!1})):(t.create("danger"," 请选择头像"),!1):(t.create("danger"," 请填写昵称"),$("input[name='nickname']").focus(),!1)}}])}),define("apps/profile/controllers/_base",["apps/profile/controllers/profile","apps/profile/controllers/profile.password","apps/profile/controllers/profile.add","apps/profile/controllers/profile.edit"],function(){}),define("apps/profile/directives/_base",[],function(){}),define("apps/profile/services/user",["apps/common/services/services"],function(e){e.factory("user",["$resource",function(e){return e("/user.json",{id:"@id"},{get:{method:"GET",url:"/user/:id.json"},user_init:{method:"GET",url:"/user_init.json"},update:{method:"PUT",url:"/user/:id.json"},delete:{method:"DELETE",url:"/user/:id.json"}})}]),e.factory("userLoader",["user","$q",function(e,t){return function(a){var o=t.defer();return e.get({id:a.id},function(e){o.resolve(e)}),o.promise}}]),e.factory("wxFetchQrcodeBind",["$resource",function(e){return e("/shop/qrcodebind.json",{get:{method:"GET",url:"/shop/qrcodebind.json"}})}]),e.factory("wxFetchQrcodeUnbind",["$resource",function(e){return e("/cancel_bind.json",{get:{method:"GET",url:"/cancel_bind.json"}})}]),e.factory("unbindLogin",["$resource",function(e){return e("/weixin/unbind.json",{get:{method:"GET"}})}])}),define("apps/profile/services/virtual",["apps/common/services/services"],function(e){e.factory("virtualAdd",["$resource",function(e){return e("/order/virtual_member.json",{},{post:{method:"POST"},put:{method:"PUT"}})}]),e.factory("levelNameVirtual",["$resource",function(e){return e("/order/member_level.json",{},{get:{method:"GET",isArray:!0}})}]),e.factory("virtualDetails",["$resource",function(e){return e("order/virtual_detail/:id.json",{id:"@id"},{get:{method:"GET"}})}])}),define("apps/profile/services/_base",["apps/profile/services/user","apps/profile/services/virtual"],function(){}),define("apps/profile/main",["apps/profile/states/_base","apps/profile/controllers/_base","apps/profile/directives/_base","apps/profile/services/_base"],function(){}),define("apps/partner/controllers/main",["apps/common/controllers/controllers","echarts"],function(e,t){e.controller("partner.main",["$scope","PartnerStatResource",function(e,a){a.get(function(t){e.partnerStatDay=t});var o=["60%","65%"],s=t.init(document.getElementById("region_chart")),n=function(){var e={title:{text:"区域合伙人概况",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:r},toolbox:{feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"分红",type:"pie",radius:"55%",center:o,data:i}]};s.setOption(e)},r=[],i=[];a.getPartnerRegionInfo(function(e){angular.forEach(e,function(e,t){r.push(e.region_name),i.push({value:e.bonus,name:e.region_name})}),n()});var c=t.init(document.getElementById("team_chart")),l=function(){var e={title:{text:"团队合伙人概况",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:d},toolbox:{feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"个人收益",type:"pie",radius:"55%",center:o,data:p}]};c.setOption(e)},d=[],p=[];a.getPartnerTeamInfo(function(e){angular.forEach(e,function(e,t){d.push(e.nickname),p.push({value:e.bonus,name:e.nickname})}),l()});var u=t.init(document.getElementById("shareholder_chart")),m=function(){var e={title:{text:"股东合伙人概况",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:g},toolbox:{feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"股东收益",type:"pie",radius:"55%",center:o,data:f}]};u.setOption(e)},g=[],f=[];a.getPartnerShareholderInfo(function(e){angular.forEach(e,function(e,t){g.push(e.nickname),f.push({value:e.bonus,name:e.nickname||""})}),m()});var h=t.init(document.getElementById("fellow_chart")),_=function(){var e={title:{text:"伙伴合伙人(共"+b+"人)",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:v},toolbox:{feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"伙伴类型",type:"pie",radius:"55%",center:o,data:y}]};h.setOption(e)},v=[],y=[],b=0;a.getPartnerFellowInfo(function(e){angular.forEach(e,function(e,t){v.push(e.title),y.push({value:e.count,name:e.title}),b+=e.count}),_()});var $=t.init(document.getElementById("cpartner_chart")),k=function(){var e={tooltip:{trigger:"axis"},legend:{data:["订单数","合伙人数"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:D}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"订单数",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:C},{name:"合伙人数",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:S}]};$.setOption(e)},P=t.init(document.getElementById("bonus_chart")),w=function(){var e={tooltip:{trigger:"axis"},legend:{data:["交易额","分红"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:D}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"交易额",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:R},{name:"分红",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:E}]};P.setOption(e)},D=[],C=[],x=[],I=[],S=[],j=[],T=[],E=[],R=[];a.getPartnerStatDays(function(e){angular.forEach(e,function(e,t){D.push(e.created_at),C.push(e.corder),x.push(e.cteampartner),I.push(e.cregionartner),S.push(e.cpartner),j.push(e.team_bonus),T.push(e.region_bonus),E.push(e.bonus),R.push(e.amount_sum)}),k(),w()})}])}),define("apps/partner/controllers/member",["apps/common/controllers/controllers"],function(e){e.controller("partner.member.list",["$scope","Flash","$modal","PartnerMemberResource","PartnerTypeResource","PartnerShareholderResource","PartnerFellowTypeResource",function(e,t,a,o,s,n,r){function i(a,s){o.putStatus(a,function(o){e.partnerList[s].status=a.status,t.create("success"," 操作成功！")},function(e){t.create("danger",e.data.error.message)})}s.get(null,function(t){var a=t.data;a.splice(0,0,{id:0,title:"默认"}),a.splice(0,0,{id:"all",title:"全部"}),e.models.typeList[1]=a}),n.get(null,function(t){var a=t.data;a.splice(0,0,{id:0,title:"默认"}),a.splice(0,0,{id:"all",title:"全部"}),e.models.typeList[2]=a}),r.get(null,function(t){var a=t.partner_fellow;a.splice(0,0,{id:"all",title:"全部"}),e.models.typeList[3]=a}),e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7).startOf("day"),moment().endOf("day")],"最近15天":[moment().subtract("days",15),moment().endOf("day")],"本月":[moment().startOf("month").startOf("day"),moment().endOf("day")],"上月":[moment().subtract("months",1).startOf("month"),moment().subtract("months",1).endOf("month")]},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",status:"all",type:"all",direction:"desc"},e.limit={limit_from:0,limit_to:5e3};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.partnerList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c);var l=function(){1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1};e.sorting={created_at:"",expect_bonus:"",total_bonus:"",bonus_coefficient:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),l()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.search=function(){var t=$('input[name="settled_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.params.type?(e.params.partner_team_type=e.models.model_id,delete e.params.partner_shareholder_type,delete e.params.partner_fellow_type):2==e.params.type?(e.params.partner_shareholder_type=e.models.model_id,delete e.params.partner_team_type,delete e.params.partner_fellow_type):3==e.params.type?(e.params.partner_fellow_type=e.models.model_id,delete e.params.partner_team_type,delete e.params.partner_shareholder_type):(delete e.params.partner_team_type,delete e.params.partner_shareholder_type,delete e.params.partner_fellow_type),l()},e.formatnum=function(a){a=parseInt(a),0!=a&&!a||a<0?(e.limit.limit_from=0,t.create("danger","开始行数最小为0")):e.limit.limit_from=a},e.limitnum=function(a){a=parseInt(a),a<=0||a>5e3||!a?(t.create("danger","导出行数最小为1,最大为5000"),
e.limit.limit_to=5e3):e.limit.limit_to=a},e.models={typeList:{},model_id:"all"},e.$watch("params.type",function(t,a){e.models.showModelTypes=t!==a&&("1"===t||"2"===t||"3"===t),e.models.showModelTypes&&(e.models.model_id="all",e.models.showModelTypes=!0,e.models.types=[],e.models.types=e.models.typeList[e.params.type],"1"===t?e.models.title="合伙人类型":"2"===t?e.models.title="股东类型":"3"===t&&(e.models.title="伙伴类型"))}),e.confirmThrough=function(e,t,a){var o={id:e,status:a};i(o,t)},e.showMembers=function(e){var t=a.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/team.member.list.html",controller:"team.member.list",windowClass:"modal-open",resolve:{id:function(){return e}}});t.result.then(function(e){e&&c()})},e.watch={},e.$watch("watch",function(t){t.isUpdateStatus&&(c(),e.watch.isUpdateStatus=!1)},!0)}])}),define("apps/partner/controllers/member.type",["apps/common/controllers/controllers"],function(e){e.controller("partner.member.type",["$scope","$stateParams","$modal","Flash","PartnerTypeResource","PartnerShareholderResource",function(e,t,a,o,s,n){var r=t.typeid;e.typeid=r;var i=function(){s.getPartnerType({},function(t){e.data=t.data})},c=function(){n.getShareholderType({},function(t){e.data=t.data})};1==r?i():2==r&&c(),e.addTeamType=function(){var e=a.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/add_type_tpl.html",controller:"member.type.add",resolve:{type_id:function(){return 0}}});e.result.then(function(e){1==r?i():2==r&&c()})},e.editTeamType=function(e){var t=a.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/add_type_tpl.html",controller:"member.type.add",resolve:{type_id:function(){return e}}});t.result.then(function(e){1==r?i():2==r&&c()})},e.remove=function(t,a){1==r?s.delete({id:a},function(a){e.data.splice(t,1),o.create("success"," 删除成功！")},function(e){o.create("danger",e.data.error.message)}):2==r&&n.delete({id:a},function(a){e.data.splice(t,1),o.create("success"," 删除成功！")},function(e){o.create("danger",e.data.error.message)})}}])}),define("apps/partner/controllers/member.type.add",["apps/common/controllers/controllers"],function(e){e.controller("member.type.add",["$scope","$stateParams","Flash","$modalInstance","$modal","type_id","PartnerTypeResource","PartnerSettingResource","PartnerShareholderResource",function(e,t,a,o,s,n,r,i,c){e.cancel=function(){o.dismiss("cancel")};var l=t.typeid;n?1==l?r.getPartnerType({id:n},function(t){e.partnerType={title:t.title,bonus_coefficient:parseFloat(t.bonus_coefficient)}}):c.getShareholderType({id:n},function(t){e.partnerType={title:t.title,bonus_coefficient:parseFloat(t.bonus_coefficient)}}):e.partnerType={type_id:0},e.partnerType_id=n,i.get({},function(t){1==l?e.setting={bonus_percent1:t.team_bonus_percent.bonus_percent1}:e.setting={bonus_percent1:t.shareholder_bonus_percent.bonus_percent1};var a=e.setting.bonus_percent1;e.bonus_coefficient_error=!1,e.$watch("partnerType.bonus_coefficient",function(t,o){if(!angular.isUndefined(t)){var s=a*t;s>100?(e.form.bonus_coefficient.$invalid=!0,e.bonus_coefficient_error=!0,e.form.$invalid=!0):e.bonus_coefficient_error=!1}},!0)}),e.btn_text="保存",e.submitForm=function(t){t&&(e.btn_text="保存中...",e.form.$invalid=!0,n?1==l?r.update({id:n},e.partnerType,function(t){e.btn_text="保存",a.create("success"," 保存成功！"),o.close(1)},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}):c.update({id:n},e.partnerType,function(t){e.btn_text="保存",a.create("success"," 保存成功！"),o.close(1)},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}):1==l?r.save(e.partnerType,function(t){e.btn_text="保存",a.create("success"," 保存成功！"),o.close(1)},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}):c.save(e.partnerType,function(t){e.btn_text="保存",a.create("success"," 保存成功！"),o.close(1)},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}))}}])}),define("apps/partner/controllers/member.detail",["apps/common/controllers/controllers"],function(e,t){e.controller("partner.member.detail",["$scope","PartnerMemberResource","$stateParams","$modal",function(e,t,a,o){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7).startOf("day"),moment().endOf("day")],"最近15天":[moment().subtract("days",15),moment().endOf("day")],"本月":[moment().startOf("month").startOf("day"),moment().endOf("day")],"上月":[moment().subtract("months",1).startOf("month"),moment().subtract("months",1).endOf("month")]},e.orderStatusClr={0:"clr-gray",1:"clr-green",2:"clr-red"},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,status:"all",column:"created_at",direction:"desc"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.getPartnerDetail(e.params,{id:a.id},function(t){e.paginationConf.totalItems=t._count,e.partnerDetailItem=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s);var n=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1};e.sorting={created_at:"",amount:"",team_bonus:"",region_bonus:"",bonus:"",bonus_coefficient:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),n()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.viewOrderInfo=function(e){o.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/order.goods.html",controller:"partner.order_goods.tpl",resolve:{orderId:function(){return e}}})},e.viewTeamBonus=function(e){o.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/order.teambonus.html",controller:"partner.team_bonus.tpl",resolve:{orderId:function(){return e}}})},e.viewRegionBonus=function(e){o.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/order.regionbonus.html",controller:"partner.region_bonus.tpl",resolve:{orderId:function(){return e}}})},e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),n()}}])}),define("apps/partner/controllers/team.member.list",["apps/common/controllers/controllers"],function(e){e.controller("team.member.list",["$scope","Flash","tagResource","TeamMemberResource","$modal","$modalInstance","id",function(e,t,a,o,s,n,r){e._global=_global;var i=!1;e.cancel=function(){i?n.close(i):n.dismiss("cancel")},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={id:r,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,nickname:"",member_account:""};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){c()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.moveMember=function(e){var t=s.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/move.team.member.html",controller:"move.team.member",windowClass:"modal-open",resolve:{moveId:function(){return e},partnerId:function(){return r}}});t.result.then(function(e){e&&(i=!0,c())})}}])}),define("apps/partner/controllers/move.team.member",["apps/common/controllers/controllers"],function(e){e.controller("move.team.member",["$scope","Flash","PartnerMemberResource","MemberChangeResource","$modal","$modalInstance","partnerId","moveId",function(e,t,a,o,s,n,r,i){e.partnerId=r,e.cancel=function(){n.dismiss("cancel")},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,member_account:"",nickname:"",column:"created_at",direction:"desc",partner_team_type:"all",status:"all",type:1};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){c()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.selected=function(a){e.isSelecting=!0,o.update({member_id:i,partner_id:a},function(a){e.isSelecting=!1,a.success?(t.create("success"," 移动团队成员成功！"),n.close(1)):t.create("danger",a.error)})},e.isSelecting=!1}])}),define("apps/partner/controllers/settled",["apps/common/controllers/controllers"],function(e,t){e.controller("partner.settled",["$scope","PartnerSettledResource",function(e,t){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7).startOf("day"),moment().endOf("day")],"最近15天":[moment().subtract("days",15),moment().endOf("day")],"本月":[moment().startOf("month").startOf("day"),moment().endOf("day")],"上月":[moment().subtract("months",1).startOf("month"),moment().subtract("months",1).endOf("month")]},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,status:"all",column:"settled_at",direction:"desc"},e.sorting={amount:"",settled_at:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),a()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})});var a=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1},o=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.settledList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.search=function(){var t=$('input[name="settled_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),a()}}])}),define("apps/partner/controllers/design.apply",["apps/common/controllers/controllers"],function(e){e.controller("partner.design.apply",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","PartnerDesignResource",function(e,t,a,o,s,n,r,i){e.config={entrance_enable:0,fields:[]},e.slices=[{type:"partner_banner"},{type:"partner_apply",content:{fields:e.config.fields}},{type:"partner_intro"}],i.applyGet({},function(t){if(e.config={entrance_enable:t.entrance_enable,fields:t.fields},t.data.length){e.slices=t.data;for(var a in e.slices){var o=e.slices[a];if("partner_apply"==o.type){o.content.fields=e.config.fields;break}}}}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],e.addField=function(){e.config.fields.push({type:"text"})},e.deleteFields=function(t){e.config.fields.splice(t,1)},e.save=function(){var a=angular.copy(e.slices);for(var o in a){var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.config.data=a,i.applySave(e.config,function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/partner/controllers/design.center",["apps/common/controllers/controllers"],function(e){e.controller("partner.design.center",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","PartnerDesignResource",function(e,t,a,o,s,n,r,i){e.slices=[{type:"partner_head"},{type:"partner_account"},{type:"partner_navs",content:{itemList:[]}}],e.config={},i.centerGet({},function(t){t.data.length>0&&(e.slices=t.data),e.config.is_anonymous=t.is_anonymous||0}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.btn_text="保存",e.btn_status=!1,e.save=function(){e.btn_text="保存中...";var a=angular.copy(e.slices);for(var o in a){"partner_navs"==a[o].type&&delete a[o].content.itemListLen;var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.btn_status=!0,i.centerSave({data:a,is_anonymous:e.config.is_anonymous},function(a){e.btn_status=!1,t.create("success"," 修改成功！"),e.btn_text="保存"},function(a){e.btn_status=!1,t.create("danger",a.data.error.message),e.btn_text="保存"})}}])}),define("apps/partner/controllers/order",["apps/common/controllers/controllers"],function(e){e.controller("partner.order",["$scope","PartnerOrderResource","$modal","Flash",function(e,t,a,o){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7).startOf("day"),moment().endOf("day")],"最近15天":[moment().subtract("days",15),moment().endOf("day")],"本月":[moment().startOf("month").startOf("day"),moment().endOf("day")],"上月":[moment().subtract("months",1).startOf("month"),moment().subtract("months",1).endOf("month")]},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",direction:"desc",status:"all"},e.orderStatusClr={0:"clr-gray",1:"clr-green",2:"clr-red"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.orderList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s);var n=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1};e.sorting={created_at:"",order_amount:"",team_bonus:"",region_bonus:"",shareholder_bonus:"",total_bonus:"",settled_at:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),n()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.search=function(){var t=$('input[name="settled_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate);var a=$('input[name="created_range"]').val();""!=a?(a=a.split("/"),e.params.createdStartDate=a[0],e.params.createdEndDate=a[1]):(delete e.params.createdStartDate,delete e.params.createdEndDate),n()},e.viewOrderInfo=function(e){a.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/order.goods.html",controller:"partner.order_goods.tpl",resolve:{orderId:function(){return e}}})}}])}),define("apps/partner/controllers/order.goods",["apps/common/controllers/controllers"],function(e){e.controller("partner.order_goods.tpl",["$scope","orderId","PartnerOrderResource","$modalInstance",function(e,t,a,o){e._global=_global,e.cancel=function(){o.dismiss("cancel")};var s=function(){a.getOrderGoods({id:t},function(t){e.orderGoods=t})};s()}])}),define("apps/partner/controllers/setting.base",["apps/common/controllers/controllers"],function(e){e.controller("partner.setting.base",["$scope","PartnerOrderResource","$http","PartnerSettingResource","Flash","$modal","PartnerSettingUtil","$state",function(e,t,a,o,s,n,r,i){e.cityList=[],e.$watch("setting.citySelectedInfo",function(t){t&&(e.cityList.push({city:t}),e.form.$invalid=!1)},!0),e.$watch("cityList",function(t){var a=[];angular.forEach(t,function(e,t){a.push(e.city.ids)}),e.already=a.join(",")},!0),e.removeCity=function(t){e.cityList.splice(t,1)},o.get({},function(t){3!=t.fellow_setting.length&&(t.fellow_enabled=0),e.setting=t;var a=r.getRegion(e.setting.region_bonus);e.cityList=a.city,e.already=a.already}),e.btn_text="保存",e.initFormStatus=!1,e.submitForm=function(t){t&&(e.btn_text="保存中...",e.initFormStatus=!0,e.param=r.getPartnerSettingParam(e.setting,e.cityList),o.update(e.param,function(t){i.reload(),e.btn_text="保存",e.initFormStatus=!1,s.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.initFormStatus=!1,s.create("danger",t.data.error.message)}))},e.openFellowSetting=function(t){event.preventDefault(),t&&!e.setting.fellow_enabled&&(e.setting.fellow_enabled=0);var a=n.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/setting.open.fellow.html",controller:"partner.setting.open.fellow",size:"lg",resolve:{fellowTypes:function(){return e.setting.fellow_setting}}});a.result.then(function(a){a.status&&(t&&(e.setting.fellow_enabled=t,$('input[name="fellow_enabled"]').prop("checked",!0)),e.setting.fellow_setting=a.data)})}}])}),define("apps/partner/controllers/setting.template",["apps/common/controllers/controllers"],function(e){e.controller("partner.setting.template",["$scope","Flash","PartnerSettingResource","$modal","PartnerSettingUtil",function(e,t,a,o,s){e.setting=a.get();var n=s.getRegion(e.setting.region_bonus);e.cityList=n.city,e.already=n.already,e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,e.param=s.getPartnerSettingParam(e.setting,e.cityList),a.update(e.param,function(o){e.setting=a.get(),e.btn_text="保存",t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/partner/controllers/setting.goods",["apps/common/controllers/controllers"],function(e){e.controller("partner.setting.goods",["$scope","Flash","$modal","PartnerSettingGoodsResource",function(e,t,a,o){e.search={},e.goodsSearchTypes=[{type:"title",name:"商品标题"}],e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.search.params&&e.search.params.input&&(e.params[e.search.params.type.type]=e.search.params.input),o.getBonusList(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.resources=o.get,e.reload=s,e.modelchoice={size:"lg",animation:!1,templateUrl:"assets/js/apps/partner/templates/setting.choice.goods.html",controller:"partner.setting.choice.goods",resolve:{id:function(){return null}}},e.editPartnerGoods=function(e,t){var o=a.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/partner/templates/setting.choice.goods.html",controller:"partner.setting.choice.goods",resolve:{id:function(){return e},goods_id:function(){return t}}});o.result.then(function(e){e&&s()})},e.remove=function(e,a){o.delete({id:a},function(e){s(),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})},e.$watch("search.params",function(e){e&&s()},!0)}])}),define("apps/partner/controllers/setting.choice.goods",["apps/common/controllers/controllers"],function(e){e.controller("partner.setting.choice.goods",["$scope","Flash","$modalInstance","id","goods_id","PartnerSettingUtil","PartnerSettingGoodsResource","PartnerFellowTypeResource",function(e,t,a,o,s,n,r,i){e.cancel=function(){a.dismiss("cancel")},i.get("",function(t){e.fellowInfo=t,e.$watch("getData",function(t){t&&angular.forEach(e.fellowInfo.partner_fellow,function(t,a){e.getData.fellow_bonus_percent["bonus_percent"+t.type]&&(t.bonus_percent=e.getData.fellow_bonus_percent["bonus_percent"+t.type])})})}),o&&r.getBonus({id:o},function(t){e.getData={status:!0,fellow_bonus_percent:t.fellow_bonus_percent},e.setting={team_bonus_percent:{bonus_percent1:t.team_bonus_percent.bonus_percent1},region_bonus_percent:{bonus_province:t.region_bonus_percent.bonus_province,bonus_city:t.region_bonus_percent.bonus_city,bonus_district:t.region_bonus_percent.bonus_district},shareholder_bonus_percent:{bonus_percent1:t.shareholder_bonus_percent.bonus_percent1},region_bonus:t.region_bonus};var a=n.getRegion(e.setting.region_bonus);e.cityList=a.city,e.already=a.alread}),e.cityList=[],e.$watch("setting.citySelectedInfo",function(t){t&&(e.cityList.push({city:t}),e.form.$invalid=!1)},!0),e.$watch("cityList",function(t){var a=[];angular.forEach(t,function(e,t){a.push(e.city.ids)}),e.already=a.join(",")},!0),e.removeCity=function(t){e.cityList.splice(t,1)},e.btn_text="保存",e.submitForm=function(i){e.btn_text="保存中...",e.form.$invalid=!0;var c=n.getPartnerSettingParam(e.setting,e.cityList);e.fellowInfo.fellow_enabled&&(c.fellow_bonus={},angular.forEach(e.fellowInfo.partner_fellow,function(e,t){e.bonus_percent&&(c.fellow_bonus["bonus_percent"+e.type]=e.bonus_percent)})),c.goods_id=s,o?(c.id=o,r.updateBonus(c,function(o){o.success?(e.btn_text="保存",t.create("success"," 保存成功！"),a.close(1)):(e.btn_text="保存",e.form.$invalid=!1,t.create("danger",o.data.error.message))})):r.post(c,function(o){o.success?(e.btn_text="保存",t.create("success"," 保存成功！"),a.close(1)):(e.btn_text="保存",e.form.$invalid=!1,t.create("danger",o.data.error.message))})}}])}),define("apps/partner/controllers/setting.open.fellow",["apps/common/controllers/controllers"],function(e){e.controller("partner.setting.open.fellow",["$scope","Flash","$modalInstance","fellowTypes","PartnerFellowTypeResource",function(e,t,a,o,s){e.cancel=function(){a.dismiss("cancel")},e._global=_global,e.btn_text="保存",e.submitValid=!1;var n=0;o&&3==o.length?(n=1,e.datas=angular.copy(o)):e.datas=[{title:"初级",type:1,rule:{}},{title:"中级",type:2,rule:{}},{title:"高级",type:3,rule:{}}],e.$watch("datas",function(t){if(t){var a=t[0];a.rule.total_commission_enabled||a.rule.personal_consume_enabled||a.rule.cguider_enabled||a.rule.order_amount_enabled?e.submitValid=!1:e.submitValid=!0}},!0),e.submitForm=function(o){if(o){e.btn_text="保存中...",e.form.$invalid=!0;var r=angular.copy(e.datas),i=["total_commission","personal_consume","cguider","order_amount"];angular.forEach(i,function(e,t){0===r[0].rule[e+"_enabled"]&&delete r[0].rule[e],delete r[0].rule[e+"_enabled"]}),n?s.update(r,function(t){e.btn_text="保存",t.success&&a.close({status:1,data:e.datas})},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error)}):s.save(r,function(t){e.btn_text="保存",t.success&&a.close({status:1,data:t.msg})},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error)})}}}])}),define("apps/partner/controllers/_base",["apps/partner/controllers/main","apps/partner/controllers/member","apps/partner/controllers/member.type","apps/partner/controllers/member.type.add","apps/partner/controllers/member.detail","apps/partner/controllers/team.member.list","apps/partner/controllers/move.team.member","apps/partner/controllers/settled","apps/partner/controllers/design.apply","apps/partner/controllers/design.center","apps/partner/controllers/order","apps/partner/controllers/order.goods","apps/partner/controllers/setting.base","apps/partner/controllers/setting.template","apps/partner/controllers/setting.goods","apps/partner/controllers/setting.choice.goods","apps/partner/controllers/setting.open.fellow"],function(){}),define("apps/partner/directives/type.setting",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("partnerTypeSetting",["$modal",function(e){return{restrict:"EA",scope:{size:"@size",partnerid:"@",type:"@",guiderid:"@"},require:"^?ngModel",link:function(t,a,o,s){a.bind("click",function(){var a=e.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/type.setting.html",controller:"type.setting.ctrl",size:t.size,resolve:{type:function(){return t.type},partnerid:function(){return t.partnerid},guiderid:function(){return t.guiderid}}});a.result.then(function(e){e&&s.$setViewValue(e)})})}}}]),t.controller("type.setting.ctrl",["$scope","$modalInstance","Flash","$rootScope","$state","type","partnerid","guiderid","PartnerMemberResource","PartnerToMemberResource","PartnerTypeResource","PartnerShareholderResource",function(e,t,a,o,s,n,r,i,c,l,d,p){function u(t){t?e.citySelectedInfo={ids:t.region_id,ida:t.region_parent,names:t.region_name}:e.citySelectedInfo={ids:"",names:""}}function m(){e.$watch("partnerItem.is_team_type",function(t){e.hasTeamTip=!t},!0)}e.type=n,e.partnerid=r,e.guiderid=i,e.data={},e.partnerItem={},d.get(null,function(t){e.types=t.data,!angular.isArray(e.types)&&(e.types=[]),e.types.unshift({id:0,title:"默认"})}),p.get(null,function(t){e.shareholder_types=t.data,!angular.isArray(e.shareholder_types)&&(e.shareholder_types=[]),e.shareholder_types.unshift({id:0,title:"默认"})}),"guider"===n?l.get({id:i},function(t){e.partnerItem.nickname=t.data.nickname,e.partnerItem.init_team=1,e.partnerItem.init_team_type=0,e.partnerItem.is_region_type=0,e.partnerItem.is_team_type=0,e.partnerItem.is_shareholder_type=0,e.partnerItem.partner_team_type=0,e.partnerItem.partner_shareholder_type=0,e.partnerItem.is_team_type_bak=e.partnerItem.is_team_type,e.partnerItem.memberid=t.data.id,u(t.data.region)}):c.getPerson({id:r},function(t){e.partnerItem=t.data,e.partnerItem.is_team_type_bak=e.partnerItem.is_team_type,u(t.data.region),e.partnerItem.is_team_type&&m(),angular.isDefined(e.partnerItem.partner_team_type)||(e.partnerItem.partner_team_type=0),angular.isDefined(e.partnerItem.partner_shareholder_type)||(e.partnerItem.partner_shareholder_type=0)}),e.btn_text="保存",e.submitForm=function(o){var s={};if(!(e.partnerItem.is_region_type||e.partnerItem.is_team_type||e.partnerItem.is_shareholder_type))return a.create("danger","至少选择一种合伙人模式"),!1;if(s.is_region_type=e.partnerItem.is_region_type,e.partnerItem.is_region_type){if(""==e.citySelectedInfo.ids)return a.create("danger","请选择地区"),!1;s.region=e.citySelectedInfo.ids,s.ida=e.citySelectedInfo.ida}if(s.is_team_type=e.partnerItem.is_team_type,e.partnerItem.is_team_type&&(s.init_team=e.partnerItem.init_team,s.init_team&&(s.init_team_type=e.partnerItem.init_team_type),e.partnerItem.is_team_type_bak&&delete s.init_team_type,s.partner_team_type=e.partnerItem.partner_team_type),s.is_shareholder_type=e.partnerItem.is_shareholder_type,s.is_shareholder_type&&(s.partner_shareholder_type=e.partnerItem.partner_shareholder_type),o)switch(e.btn_text="保存中...",e.form.$invalid=!0,n){case"guider":s.guider_id=e.guiderid,s.member_id=e.partnerItem.memberid,c.post(s,function(o){e.btn_text="保存",o.error?a.create("danger",o.error):(a.create("success"," 保存成功！"),t.close(!0))},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)});break;case"partner":s.id=e.partnerItem.id,c.update(s,function(o){e.btn_text="保存",o.error?a.create("danger",o.error):(a.create("success",o.msg||"保存成功!"),t.close(!0))},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)})}},e.cancel=function(){t.dismiss("cancel")},e.manageType=function(e){t.dismiss("cancel"),"team"===e?s.go("partner.member.type",{typeid:1}):"shareholder"===e&&s.go("partner.member.type",{typeid:2})},e.linkSetting=function(){e.cancel(),s.go("partner.setting.base")}}])}),define("apps/partner/directives/order.bonus",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("partnerOrderBonus",["$modal",function(e){return{restrict:"EA",scope:{size:"@size",type:"@",orderid:"@"},require:"^?ngModel",link:function(t,a,o,s){a.bind("click",function(){e.open({animation:!1,templateUrl:"assets/js/apps/partner/templates/order.bonus.html",controller:"partner.order.bonus",size:t.size,resolve:{type:function(){return t.type},orderId:function(){return t.orderid}}})})}}}]),t.controller("partner.order.bonus",["$scope","$modalInstance","type","orderId","$http",function(e,t,a,o,s){e._global=_global,e.type=a,e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",function(){n()}),e.cancel=function(){t.dismiss("cancel")};var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage;var t="partner/order_bonus/"+a+"/"+o+".json?";angular.forEach(e.params,function(e,a){angular.isUndefined(e)||(t+=a+"="+e+"&")}),t=t.substr(0,t.length-1),s({method:"GET",url:t}).then(function(t){angular.isArray(t.data.data)?e.orderBonuses=t.data.data:e.orderBonuses=[],e.paginationConf.totalItems=t.data._count},function(e){})}}])}),define("apps/partner/directives/_base",["apps/partner/directives/type.setting","apps/partner/directives/order.bonus"],function(){}),define("apps/partner/services/main",["apps/common/services/services"],function(e){}),define("apps/partner/services/member",["apps/common/services/services"],function(e){e.factory("PartnerMemberResource",["$resource",function(e){return e("/partner.json",{id:"@id"},{getPerson:{method:"GET",url:"partner/:id.json"},getPartnerDetail:{method:"GET",url:"partner/detail/:id.json"},update:{method:"PUT",url:"partner/:id.json"},post:{method:"POST",url:"partner.json"},putStatus:{method:"PUT",url:"partner/partner_status/:id.json"},getPartner:{method:"GET",url:"partner/partners.json"}})}]),e.factory("PartnerToMemberResource",["$resource",function(e){return e("partner/guider_member/:id.json",{})}]),e.factory("TeamMemberResource",["$resource",function(e){return e("/partner_member/:id.json",{},{})}]),e.factory("MemberChangeResource",["$resource",function(e){return e("/partner_member_change.json",{},{update:{method:"PUT"}})}])}),define("apps/partner/services/member.type",["apps/common/services/services"],function(e){e.factory("PartnerTypeResource",["$resource",function(e){return e("partner/partner_team_type.json",{id:"@id"},{get:{method:"GET",url:"partner/partner_team_type.json"},getPartnerType:{method:"GET",url:"partner/partner_team_type/:id.json"},update:{method:"PUT",url:"partner/partner_team_type/:id.json"},delete:{method:"DELETE",url:"partner/partner_team_type/:id.json"}})}])}),define("apps/partner/services/shareholder.type",["apps/common/services/services"],function(e){
e.factory("PartnerShareholderResource",["$resource",function(e){return e("partner/partner_shareholder_type.json",{id:"@id"},{get:{method:"GET",url:"partner/partner_shareholder_type.json"},getShareholderType:{method:"GET",url:"partner/partner_shareholder_type/:id.json"},update:{method:"PUT",url:"partner/partner_shareholder_type/:id.json"},delete:{method:"DELETE",url:"partner/partner_shareholder_type/:id.json"}})}])}),define("apps/partner/services/fellow.type",["apps/common/services/services"],function(e){e.factory("PartnerFellowTypeResource",["$resource",function(e){return e("/partner/partner_fellow_type.json",{id:"@id"},{update:{method:"PUT"}})}])}),define("apps/partner/services/order",["apps/common/services/services"],function(e){e.factory("PartnerOrderResource",["$resource",function(e){return e("/partner/order.json",{id:"@id",type:"@type"},{getOrderGoods:{method:"GET",url:"partner/order_goods/:id.json",isArray:!0},getOrderBonus:{method:"GET",url:"partner/order_bonus/:type/:id.json",isArray:!0}})}])}),define("apps/partner/services/settled",["apps/common/services/services"],function(e){e.factory("PartnerSettledResource",["$resource",function(e){return e("/partner/settled_records.json",{id:"@id"},{})}])}),define("apps/partner/services/stat",["apps/common/services/services"],function(e){e.factory("PartnerStatResource",["$resource",function(e){return e("/partner/partner_stat_day.json",{},{getPartnerStatDays:{method:"GET",url:"partner/partner_stat_days.json",isArray:!0},getPartnerRegionInfo:{method:"GET",url:"partner/partner_region_rank.json",isArray:!0},getPartnerTeamInfo:{method:"GET",url:"partner/partner_team_rank.json",isArray:!0},getPartnerShareholderInfo:{method:"GET",url:"partner/partner_shareholder_rank.json",isArray:!0},getPartnerFellowInfo:{method:"GET",url:"partner/partner_fellow_rank.json",isArray:!0}})}])}),define("apps/partner/services/setting",["apps/common/services/services"],function(e){e.factory("PartnerSettingResource",["$resource",function(e){return e("/partner/setting.json",null,{update:{method:"POST"}})}]),e.factory("PartnerSettingGoodsResource",["$resource",function(e){return e("/goods_partner.json",{id:"@id"},{post:{method:"POST",url:"partner/goods_bonus.json"},getBonusList:{method:"GET",url:"partner/goods_bonus.json"},getBonus:{method:"GET",url:"partner/goods_bonus/:id.json"},updateBonus:{method:"PUT",url:"partner/goods_bonus/:id.json"},delete:{method:"DELETE",url:"partner/goods_bonus/:id.json"}})}]),e.factory("PartnerSettingUtil",[function(){return{getPartnerSettingParam:function(e,t){var a={};a={partner_alias:e.partner_alias,partner_type_alias:e.partner_type_alias?{region_alias:e.partner_type_alias.region_alias||"",fellow_alias:e.partner_type_alias.fellow_alias||"",team_alias:e.partner_type_alias.team_alias||"",shareholder_alias:e.partner_type_alias.shareholder_alias||""}:{region_alias:"",fellow_alias:"",team_alias:"",shareholder_alias:""},bonus_percent1:e.team_bonus_percent.bonus_percent1,shareholder_bonus_percent:e.shareholder_bonus_percent.bonus_percent1,bonus_province:e.region_bonus_percent.bonus_province,bonus_city:e.region_bonus_percent.bonus_city,bonus_district:e.region_bonus_percent.bonus_district,template_bonus:e.template_bonus,template_new_partner:e.template_new_partner,template_upgrade:e.template_upgrade,fellow_enabled:e.fellow_enabled},a.region_bonus=[];for(var o in t){var s={regions:t[o].city.ids,bonus_value:t[o].bonus_value};a.region_bonus.push(s)}return a},getRegion:function(e){if(e=e||{},!e)return{city:[{ids:"",names:""}],aleardy:""};var t={},a="";angular.forEach(e,function(e,a){t[e.region_percent]=t[e.region_percent]||{ids:[],names:[]},t[e.region_percent].ids.push(e.region_id),t[e.region_percent].names.push(e.region_name)});var o=[];for(var s in t){a+=t[s].ids.join(",")+",";var n={city:{ids:t[s].ids.join(","),names:t[s].names.join(",")},bonus_value:parseFloat(s)};o.push(n)}return a.substr(0,a.length-1),{city:o,already:a}}}}])}),define("apps/partner/services/design",["apps/common/services/services"],function(e){e.factory("PartnerDesignResource",["$resource",function(e){var t="partner/partner_apply.json",a="partner/partner_center.json";return e("",{},{applyGet:{method:"GET",url:t},applySave:{method:"PUT",url:t},centerGet:{method:"GET",url:a},centerSave:{method:"PUT",url:a}})}])}),define("apps/partner/services/_base",["apps/partner/services/main","apps/partner/services/member","apps/partner/services/member.type","apps/partner/services/shareholder.type","apps/partner/services/fellow.type","apps/partner/services/order","apps/partner/services/settled","apps/partner/services/stat","apps/partner/services/setting","apps/partner/services/design"],function(){}),define("apps/partner/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("partner",{abstract:!0,url:"/partner",templateUrl:function(){var e;return $.ajax({type:"GET",url:"/partner/check_inited.json",async:!1,success:function(t){e=t?"assets/js/apps/partner/templates/layout.html":"assets/js/apps/partner/templates/init.html"}}),e}}).state("partner.dashboard",{url:"",templateUrl:"assets/js/apps/partner/templates/dashboard.html",controller:"partner.main"})}])}),define("apps/partner/states/member",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("partner.member",{abstract:!0,url:"/member",templateUrl:"assets/js/apps/partner/templates/member.html"}).state("partner.member.list",{url:"",templateUrl:"assets/js/apps/partner/templates/member.list.html",controller:"partner.member.list"}).state("partner.member.type",{url:"/type/:typeid",templateUrl:"assets/js/apps/partner/templates/member.type.html",controller:"partner.member.type"}).state("partner.member.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/partner/templates/member.detail.html",controller:"partner.member.detail"})}])}),define("apps/partner/states/order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("partner.order",{url:"/order",templateUrl:"assets/js/apps/partner/templates/order.html",controller:"partner.order"})}])}),define("apps/partner/states/settled",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("partner.settled",{url:"/settled",templateUrl:"assets/js/apps/partner/templates/settled.html",controller:"partner.settled"})}])}),define("apps/partner/states/design",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("partner.design",{abstract:!0,url:"/design",templateUrl:"assets/js/apps/partner/templates/design.html"}).state("partner.design.apply",{url:"",templateUrl:"assets/js/apps/partner/templates/design.apply.html",controller:"partner.design.apply"}).state("partner.design.center",{url:"/center",templateUrl:"assets/js/apps/partner/templates/design.center.html",controller:"partner.design.center"})}])}),define("apps/partner/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("partner.setting",{abstract:!0,url:"/setting",templateUrl:"assets/js/apps/partner/templates/setting.html",controller:["$scope","videoAddress",function(e,t){e.videoAddress=t}]}).state("partner.setting.base",{url:"",templateUrl:"assets/js/apps/partner/templates/setting.base.html",controller:"partner.setting.base"}).state("partner.setting.template",{url:"/template",templateUrl:"assets/js/apps/partner/templates/setting.template.html",controller:"partner.setting.template"}).state("partner.setting.goods",{url:"/goods",templateUrl:"assets/js/apps/partner/templates/setting.goods.html",controller:"partner.setting.goods"})}])}),define("apps/partner/states/_base",["apps/partner/states/main","apps/partner/states/member","apps/partner/states/order","apps/partner/states/settled","apps/partner/states/design","apps/partner/states/setting"],function(){}),define("apps/partner/main",["apps/partner/controllers/_base","apps/partner/directives/_base","apps/partner/services/_base","apps/partner/states/_base"],function(){}),define("apps/announce/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("announce",{url:"/announce",templateUrl:"assets/js/apps/announce/templates/layout.html"}).state("announce.info",{abstract:!0,url:"/info",template:"<div ui-view></div>"}).state("announce.info.announce_list",{url:"/list",templateUrl:"assets/js/apps/announce/templates/announce.list.html",controller:"announce.announce.list"}).state("announce.info.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/announce/templates/announce.detail.html",controller:"announce.announce.detail"})}])}),define("apps/announce/states/_base",["apps/announce/states/main"],function(){}),define("apps/announce/controllers/announce.list",["apps/common/controllers/controllers"],function(e){e.controller("announce.announce.list",["$scope","$state","Flash","$location","announceList","announceDetail",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:12},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},e.postNum=function(t){2==t&&e.$emit("to-topbar",!0)};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,s.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,angular.forEach(t.data,function(e){e.url&&e.url.indexOf("http")==-1&&(e.url="http://"+e.url)}),e.data=t.data})};e.postId=function(t,a){angular.forEach(e.data,function(e,t){t==a&&(e.new=1)}),n.get({id:t},function(e){})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r)}])}),define("apps/announce/controllers/announce.detail",["apps/common/controllers/controllers"],function(e){e.controller("announce.announce.detail",["$scope","Flash","$modal","announceDetail","$stateParams","$sce",function(e,t,a,o,s,n){var r=function(){o.get({id:s.id},function(t){e.data=t.data,e.html=n.trustAsHtml(t.data.text),e.$emit("to-topbar",!0)})};r()}])}),define("apps/announce/controllers/_base",["apps/announce/controllers/announce.list","apps/announce/controllers/announce.detail"],function(){}),define("apps/announce/directives/_base",[],function(){}),define("apps/announce/services/announce",["apps/common/services/services"],function(e){e.factory("announceList",["$resource",function(e){return e("affiche/afficheList",[],{get:{method:"GET"}})}]),e.factory("announceDetail",["$resource",function(e){return e("affiche/afficheInfo",[],{get:{method:"GET"}})}])}),define("apps/announce/services/_base",["apps/announce/services/announce"],function(){}),define("apps/announce/main",["apps/announce/states/_base","apps/announce/controllers/_base","apps/announce/directives/_base","apps/announce/services/_base"],function(){}),define("apps/mall/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall",{abstract:!0,url:"/mall",templateUrl:"assets/js/apps/mall/templates/layout.html"}).state("mall.dashboard",{url:"",templateUrl:"assets/js/apps/mall/templates/dashboard.html",controller:"mall"})}])}),define("apps/mall/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.setting",{abstract:!0,url:"/setting",templateUrl:"assets/js/apps/mall/templates/setting.tab.html"}).state("mall.setting.base",{url:"",templateUrl:"assets/js/apps/mall/templates/setting.html",controller:"mall.setting"}).state("mall.setting.kefu",{url:"/kefu",templateUrl:"assets/js/apps/mall/templates/setting.kefu.html",controller:"mall.setting.kefu"})}])}),define("apps/mall/states/_base",["apps/mall/states/main","apps/mall/states/setting"],function(){}),define("apps/mall/controllers/main",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("mall",["$scope","mall_shopResource","mall_baseinfoResource","mall_topSalesResource","mall_qrcodeResource","Flash","videoAddress",function(e,a,o,s,n,r,i){e.videoAddress=i,e.isShow=!1;var c=t.init(document.getElementById("chart")),l=[],d=[],p=[],u=[],m={tooltip:{trigger:"axis"},legend:{data:["总订单","已成功","已发货"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:l}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"总订单",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:d},{name:"已成功",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:p},{name:"已发货",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:u}]};a.query(function(e){angular.forEach(e,function(e,t){l.push(e.date),d.push(e.trade_count),u.push(e.c_send_num),p.push(e.c_success_num)}),c.setOption(m)}),o.get(function(t){e.baseinfo=t}),s.get(function(t){e.goods=t.data}),n.get(function(t){e.qrcode=t,e.copy_text=e.qrcode.url}),e.fallback=function(t){Utils.prompt("Press cmd+c to copy the text below.",e.copy_text),e.isShow=!e.isShow},e.previewMall=function(){e.isShow=!e.isShow}}])}),define("apps/mall/controllers/mall.setting",["apps/common/controllers/controllers"],function(e){e.controller("mall.setting",["$scope","mall","Flash","$stateParams",function(e,t,a,o){e.shop_info=t.get(),e.domain=location.host.replace("mch",""),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,t.update(e.shop_info,function(o){return e.shop_info=t.get(),e.btn_text="保存",e.form.$invalid=!1,o.status===!1?void a.create("danger",o.msg):void a.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,a.create("danger",t.data.error.message)}))}}])}),define("apps/mall/controllers/_base",["apps/mall/controllers/main","apps/mall/controllers/mall.setting"],function(){}),define("apps/mall/services/shop",["apps/common/services/services"],function(e){e.factory("mall",["$resource",function(e){return e("/mall/mall.json",{},{update:{method:"PUT"}})}])}),define("apps/mall/services/main",["apps/common/services/services"],function(e){e.factory("mall_shopResource",["$resource",function(e){return e("/mall/day.json",{},{update:{method:"PUT"},query:{method:"GET",isArray:!0}})}]),e.factory("mall_baseinfoResource",["$resource",function(e){return e("/mall/baseinfo.json",{},{update:{method:"PUT"}})}]),e.factory("mall_topSalesResource",["$resource",function(e){return e("/mall/top_sales.json",{},{update:{method:"PUT"}})}]),e.factory("mall_qrcodeResource",["$resource",function(e){return e("/mall/qrcode.json",{},{})}])}),define("apps/mall/services/_base",["apps/mall/services/shop","apps/mall/services/main"],function(){}),define("apps/mall/main",["apps/mall/states/_base","apps/mall/controllers/_base","apps/mall/services/_base"],function(){}),define("apps/mall_design/states/feature",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design",{url:"/mall_design",templateUrl:"assets/js/apps/mall_design/templates/layout.html"}).state("mall.mall_design.feature",{abstract:!0,url:"/feature",template:"<div ui-view></div>"}).state("mall.mall_design.feature.list",{url:"",templateUrl:"assets/js/apps/mall_design/templates/feature.list.html",controller:"mall.designer.feature.list"}).state("mall.mall_design.feature.add",{url:"/add/:id",templateUrl:"assets/js/apps/mall_design/templates/feature.info.html",controller:"mall.designer.feature.info"}).state("mall.mall_design.feature.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/mall_design/templates/feature.info.html",controller:"mall.designer.feature.info"})}])}),define("apps/mall_design/states/tag",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design.tag",{abstract:!0,url:"/tag",template:"<div ui-view></div>"}).state("mall.mall_design.tag.list",{url:"",templateUrl:"assets/js/apps/mall_design/templates/tag.list.html",controller:"mall.designer.tag.list"}).state("mall.mall_design.tag.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/mall_design/templates/tag.info.html",controller:"mall.designer.tag.info"})}])}),define("apps/mall_design/states/goods",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design.goods",{abstract:!0,url:"/goods",template:"<div ui-view></div>"}).state("mall.mall_design.goods.list",{url:"",templateUrl:"assets/js/apps/mall_design/templates/goods.list.html",controller:"mall.designer.goods.list"}).state("mall.mall_design.goods.add",{url:"/add",templateUrl:"assets/js/apps/mall_design/templates/goods.info.html",controller:"mall.designer.goods.info"}).state("mall.mall_design.goods.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/mall_design/templates/goods.info.html",controller:"mall.designer.goods.info"})}])}),define("apps/mall_design/states/component",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design.component",{abstract:!0,url:"/component",template:"<div ui-view></div>"}).state("mall.mall_design.component.list",{url:"",templateUrl:"assets/js/apps/mall_design/templates/component.list.html",controller:"mall.designer.component.list"}).state("mall.mall_design.component.add",{url:"/add",templateUrl:"assets/js/apps/mall_design/templates/component.info.html",controller:"mall.designer.component.info"}).state("mall.design.component.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/mall_design/templates/component.info.html",controller:"mall.designer.component.info"})}])}),define("apps/mall_design/states/nav",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design.nav",{url:"/nav",templateUrl:"assets/js/apps/mall_design/templates/nav.html",controller:"mall.designer.nav"})}])}),define("apps/mall_design/states/classification",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design.classification",{abstract:!0,url:"/classification",template:"<div ui-view></div>"}).state("mall.mall_design.classification.list",{url:"",templateUrl:"assets/js/apps/mall_design/templates/classification.list.html",controller:"mall.designer.classification.list"}).state("mall.mall_design.classification.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/mall_design/templates/classification.info.html",controller:"mall.designer.classification.info"})}])}),define("apps/mall_design/states/search",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_design.search",{url:"/search",templateUrl:"assets/js/apps/mall_design/templates/search.html",controller:"mall_designerSearch"})}])}),define("apps/mall_design/states/_base",["apps/mall_design/states/feature","apps/mall_design/states/tag","apps/mall_design/states/goods","apps/mall_design/states/component","apps/mall_design/states/nav","apps/mall_design/states/classification","apps/mall_design/states/search"],function(){}),define("apps/mall_design/services/feature",["apps/common/services/services"],function(e){e.factory("mall_feature",["$resource",function(e){return e("/designmall/feature.json",{id:"@id"},{get:{method:"GET",url:"/designmall/feature/:id.json"},update:{method:"PUT",url:"/designmall/feature/:id.json"},save:{method:"POST",url:"/designmall/feature.json"},delete:{method:"DELETE",url:"/designmall/feature/:id.json"}})}])}),define("apps/mall_design/services/template",["apps/common/services/services"],function(e){e.factory("mallTemplateResource",["$resource",function(e){return e("/designmall/template/:id.json",{id:"@id"},{})}])}),define("apps/mall_design/services/nav",["apps/common/services/services"],function(e){e.factory("mall_navgation",["$resource",function(e){return e("/designmall/nav.json",{id:"@id"},{get:{method:"GET",url:"/designmall/nav/:id.json"},add:{method:"POST",url:"/designmall/nav.json"},update:{method:"POST",url:"/designmall/navs.json"},delete:{method:"DELETE",url:"/designmall/nav/:id.json"},navEnabled:{method:"PUT",url:"/designmall/nav_enabled/:id.json"}})}])}),define("apps/mall_design/services/classification",["apps/common/services/services"],function(e){e.factory("goodsAllCateResources",["$resource",function(e){return e("designmall/cat.json",{},{get:{method:"GET",url:"designmall/cat.json",isArray:!0}})}]),e.factory("goodsAllCateResourceSearch",["$resource",function(e){return e("designmall/cat.json",{title:"@title"},{get:{method:"GET",url:"designmall/cat.json",isArray:!0}})}]),e.factory("goodsCateOneResources",["$resource",function(e){return e("designmall/cat.json",{},{get:{method:"GET",url:"designmall/cat.json"},put:{method:"PUT",url:"designmall/cat.json"},delete:{method:"DELETE",url:"designmall/cat.json"}})}]),e.factory("goodsCateOneResourcesAll",["$resource",function(e){return e("designmall/cat.json",{id:"@id"},{delete:{method:"DELETE",url:"designmall/cat/:id.json"}})}]),e.factory("goodsCateSelectResources",["$resource",function(e){return e("designmall/cat.json",{},{query:{method:"GET",url:"designmall/cat.json",isArray:!1}})}]),e.factory("getDesignMallCatResources",["$resource",function(e){return e("designmall/cat/:id.json",{id:"@id"},{get:{method:"GET",url:"designmall/cat/:id.json"}})}]),e.factory("eidtDesignMallCateResources",["$resource",function(e){return e("designmall/cat/:id.json",{id:"@id"},{put:{method:"PUT",url:"designmall/cat/:id.json"}})}]),e.factory("mall_design_qrcodeResource",["$resource",function(e){return e("/mall/mallcatqrcode.json",{},{})}])}),define("apps/mall_design/services/mall.design.component",["apps/common/services/services"],function(e){e.factory("mallDesignComponentRes",["$resource",function(e){return e("/design/component.json",{id:"@id"},{get:{method:"GET",url:"/design/component/:id.json"},update:{method:"PUT",url:"/design/component/:id.json"},delete:{method:"DELETE",url:"/design/component/:id.json"}})}])}),define("apps/mall_design/services/mall.design.data",["apps/common/services/services"],function(e){e.factory("mallDesignerData",[function(){return[{type:"nav",icon:"fa fa-bars",name:"导航",content:{style:"nav",display_icon:"",item_list:[{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"},{title:"导航",img:"image/tag-icon.png"}]}},{type:"search",icon:"fa fa-search",name:"搜索框",content:{style:1,bg_color:"#f63",active_color:"#e64514"}},{type:"goods",icon:"fa fa-thumbs-o-up",name:"推荐商品",content:{size:"small",show_title:!0,show_cart:!1,show_price:!0}},{type:"goods",icon:"fa fa-cubes",name:"搭配",content:{style:1}},{type:"slide",icon:"fa fa-file-image-o",name:"图片模板",content:{style:0,item_list:[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}]}},{type:"image",icon:"fa fa-picture-o",name:"图片组合",content:{item_list:[]}},{type:"text",icon:"fa fa-font",name:"富文本",content:{}},{type:"title",icon:"fa fa-bold",name:"标题",content:{}},{type:"video",icon:"fa fa-film",name:"视频",content:{}},{type:"voice",icon:"fa fa-volume-up",name:"语音",content:{style:1,align:1,play:1}},{type:"notice",icon:"fa fa-bullhorn",name:"公告",content:{}},{type:"phone",icon:"fa fa-phone",name:"客服电话",content:{}},{type:"white",icon:"fa fa-square-o",name:"辅助空白",content:{height:30}}]}])}),define("apps/mall_design/services/mall.design.goods",["apps/common/services/services"],function(e){e.factory("mallDesignGoodsRes",["$resource",function(e){return e("/design/goods.json",{id:"@id"},{get:{method:"GET",url:"/design/goods/:id.json"}})}])}),define("apps/mall_design/services/mall.design.validate",["apps/common/services/services"],function(e){e.factory("mallDesignValidate",[function(){var e={banner:function(e){return!1},nav:function(e){return e.item_list.length<1&&"nav"},search:function(e){return!1},notice:function(e){return!(!angular.isUndefined(e.notice)&&""!=e.notice)&&"notice"},goods:function(e){return angular.isUndefined(e.goods)||e.goods==[]?"goods":(e.goods=e.goods.map(function(e){return e.id}),!1)},goods_tag:function(e){return!!(angular.isUndefined(e.selected_tag)||e.selected_tag.length<1)&&"tags"},slide:function(e){return e.item_list.length<1&&"image"},scene:function(e){return e.item_list.length<1&&"image"},image:function(e){return!1},text:function(e){return!(!angular.isUndefined(e.text)&&""!=e.text)&&"text"},title:function(e){return!(!angular.isUndefined(e.title)&&""!=e.title)&&"title"},phone:function(e){return!(!angular.isUndefined(e.phone)&&""!=e.phone)&&"phone"},voice:function(e){return!!angular.isUndefined(e.voice_audio)&&"voice_audio"},video:function(e){return!(!angular.isUndefined(e.code)&&""!=e.code)&&"code"},component:function(e){return!(!angular.isUndefined(e.selected)&&""!=e.selected)&&"selected"},goods_head:function(e){return!1},goods_info:function(e){},white:function(e){return!1},guider_head:function(e){return!1},guider_nav:function(e){return!1},guider_banner:function(e){return!1},guider_apply:function(e){return!1},guider_text:function(e){return!1}};return e}])}),define("apps/mall_design/services/mall.link.data",["apps/common/services/services"],function(e){e.factory("mallLinkData",[function(){return[{type:"home",title:"首页",url:"/super/home"},{type:"mall_feature",title:"微页面",url:""},{type:"cart",title:"购物车",url:"/mall/cart"},{type:"buy",title:"直接购买",url:""},{type:"ucenter",title:"个人中心",url:"/super/user"},{type:"list",title:"列表页",url:"/super/list"},{type:"custom",title:"自定义外链",url:""}]}])}),define("apps/mall_design/services/search",["apps/common/services/services"],function(e){e.factory("mall_search",["$resource",function(e){return e("/designmall/mall_search.json",{},{get:{method:"GET",url:"/designmall/mall_search.json"},update:{method:"POST",url:"/designmall/mall_search.json"},put:{method:"PUT",url:"/designmall/mall_search_enabled.json"}})}])}),define("apps/mall_design/services/_base",["apps/mall_design/services/feature","apps/mall_design/services/template","apps/mall_design/services/nav","apps/mall_design/services/classification","apps/mall_design/services/mall.design.component","apps/mall_design/services/mall.design.data","apps/mall_design/services/mall.design.goods","apps/mall_design/services/mall.design.validate","apps/mall_design/services/mall.link.data","apps/mall_design/services/search"],function(){}),define("apps/mall_design/controllers/feature.info",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.feature.info",["$scope","Flash","$timeout","$state","$stateParams","mallDesignerData","mallDesignValidate","mall_feature","mallTemplateResource",function(e,t,a,o,s,n,r,i,c){s.id?o.includes("mall.mall_design.feature.add")?c.get({id:s.id},function(t){e.slices=t.data,e.config={side_pendant:1,homepage_type:0}}):i.get({id:s.id},function(t){e.slices=t.data,e.config={title:t.title,description:t.description,side_pendant:t.side_pendant,bgcolor:t.bgcolor,homepage_type:t.homepage_type}}):(e.slices=[],e.config={}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),null==t.content||t.content==[]?t.content={}:1==t.content.style&&(t.content.bar_bg=t.content.bar_bg||"",t.content.left_logo=t.content.left_logo||"",t.content.but_bg=t.content.but_bg||"",t.content.but_text=t.content.but_text||"",t.content.box_bg=t.content.box_bg||""),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(){if(""==$.trim(e.config.title))return e.form.title.$dirty=!0,!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var a=angular.copy(e.slices);for(var n in a){var c=r[a[n].type](a[n].content);if(c)return e.editSlice(e.slices[n],c),!1}e.config.data=a,s.id&&o.includes("mall.mall_design.feature.edit")?(e.config.id=s.id,i.update(e.config,function(e){o.go("mall.mall_design.feature.list"),t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("mall.mall_design.feature.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/mall_design/controllers/feature.list",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.feature.list",["$scope","Flash","mall_feature","$resource","ngPopover","$modal",function(e,t,a,o,s,n){var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",r()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,title:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})};var i=o("designmall/feature/copy/:id.json",{id:"@id"});e.copy=function(e){i.get({id:e},function(e){t.create("success"," 复制成功！"),r()},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),r()},function(e){t.create("danger",e.data.error.message)})};var c=o("designmall/feature/homepage/:id.json",{id:"@id"});e.setHomePage=function(e,a){c.save({id:e.id,homepage_type:a},function(o){e.homepage_type=a,t.create("success"," 设置成功！"),r()},function(e){t.create("danger",e.data.error.message)})};var l=o("designmall/feature/unsetHomepage/:id.json",{id:"@id"});e.unSetHomePage=function(e,a){l.save({id:e.id,homepage_type:a},function(o){e.homepage_type=a,t.create("success"," 设置成功！"),r()},function(e){t.create("danger",e.data.error.message)})},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){s.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.choose_template=function(){n.open({animation:!1,size:"lg",templateUrl:"assets/js/apps/mall_design/templates/model_template.html",controller:"mall_modelTemplateCtrl"})},e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}]).controller("mall_modelTemplateCtrl",["$scope","$modalInstance","mallTemplateResource","Flash","$state",function(e,t,a,o,s){e._global=_global;var n=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.choose=function(e){t.dismiss("cancel"),s.go("mall.mall_design.feature.add",{id:e})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/mall_design/controllers/component.info",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.component.info",["$scope","Flash","$timeout","$state","$stateParams","mallDesignerData","mallDesignValidate","mallDesignComponentRes",function(e,t,a,o,s,n,r,i){s.id?i.get({id:s.id},function(t){e.slices=t.data,e.config={title:t.title,desc:t.description}}):(e.slices=[],e.config={}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,
axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(){if(""==$.trim(e.config.title))return e.form.title.$dirty=!0,!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var a=angular.copy(e.slices);for(var n in a){var c=r[a[n].type](a[n].content);if(c)return e.editSlice(e.slices[n],c),!1}e.config.data=a,s.id?(e.config.id=s.id,i.update(e.config,function(e){o.go("mall.designer.component.list"),t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("mall.designer.component.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/mall_design/controllers/component.list",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.component.list",["$scope","Flash","mallDesignComponentRes","$resource",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",s()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,title:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,n){a.delete({id:n},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),s()},function(e){t.create("danger",e.data.error.message)})},e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/mall_design/controllers/tag.list",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.tag.list",["$scope","Flash","$resource","ngPopover",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};tagResource.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",s()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,a){tagResource.update({id:a,name:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(a,o){tagResource.delete({id:o},function(o){e.data.splice(a,1),t.create("success"," 删除成功！"),s()},function(e){t.create("danger",e.data.error.message)})},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){o.close(),t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/mall_design/controllers/tag.info",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.tag.info",["$scope","Flash","$timeout","$state","$stateParams","mallDesignerData","mallDesignValidate","tagResource",function(e,t,a,o,s,n,r,i){e.slices=[],e.config={content:{locked:!0,size:"small",sort:"created_at",show_title:!0,show_cart:!0,show_price:!0}},s.id&&i.get({id:s.id},function(t){e.slices=t.goods_tag_components,e.config={name:t.name,description:t.description},""==t.content?e.config.content={locked:!0,size:"small",sort:"created_at",show_title:!0,show_cart:!0,show_price:!0}:e.config.content=t.content}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.editTagInfo=function(t){angular.forEach(e.slices,function(e,t){e.class=!1});var o={type:"goods_tag",content:t};e.design=o,a(function(){e.$broadcast("design_data",o)},200)},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(){if(""==$.trim(e.config.name))return e.form.title.$dirty=!0,!1;var a=angular.copy(e.slices);for(var n in a){var c=r[a[n].type](a[n].content);if(c)return e.editSlice(e.slices[n],c),!1}e.config.data=a,s.id?(e.config.id=s.id,i.update(e.config,function(e){o.go("mall.designer.tag.list"),t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("mall.designer.tag.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/mall_design/controllers/goods.list",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.goods.list",["$scope","Flash","mallDesignGoodsRes","$resource",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.get({offset:(t.offset-1)*t.limit,limit:t.limit,sort:e.paginationConf.sort,title:e.title},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10,sort:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sort=function(t){"asc"==t?e.paginationConf.sort="desc":e.paginationConf.sort="asc",s()},e.checkTitle=function(e){if(""==e)return"不能为空!"},e.saveTitle=function(e,o){a.update({id:o,title:e},function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})},e.removePage=function(o,n){a.delete({id:n},function(a){e.data.splice(o,1),t.create("success"," 删除成功！"),s()},function(e){t.create("danger",e.data.error.message)})},e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/mall_design/controllers/goods.info",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.goods.info",["$scope","Flash","$timeout","$state","$stateParams","mallDesignerData","mallDesignValidate","mallDesignGoodsRes",function(e,t,a,o,s,n,r,i){s.id?i.get({id:s.id},function(t){e.slices=t.design_goods_components,e.config={title:t.title}}):(e.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!1}}],e.config={}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save=function(){if(""==$.trim(e.config.title))return e.form.title.$dirty=!0,!1;if(0==e.slices.length)return t.create("danger","您还没拖动模块到手机！"),!1;var a=angular.copy(e.slices);for(var n in a){var c=r[a[n].type](a[n].content);if(c)return e.editSlice(e.slices[n],c),!1}e.config.data=a,s.id?(e.config.id=s.id,i.update(e.config,function(e){o.go("mall.designer.goods.list"),t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})):i.save(e.config,function(e){o.go("mall.designer.goods.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/mall_design/controllers/design.banner.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designBannerCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.guider.banner.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designGuiderBannerCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.guider.apply.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGuiderApplyCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.goods.tag.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("designGoodsTagCtrl",["$scope","tagResource","Flash",function(e,t,a){function o(){t.get({},function(t){e.tags=t.data,e.tags.unshift(e.defaultTag)})}e.content={selected_tag:[]},e.$on("design_data",function(t,a){e.content=a.content,a.content.valid=e.form.$valid}),e.defaultTag={id:0,name:"所有商品"},o(),e.$watch("content",function(e){angular.isUndefined(e.selected_tag)||e.selected_tag.length>4&&(e.selected_tag.splice(3,1),a.create("danger","最多只能选择四个分组"))},!0)}])}),define("apps/mall_design/controllers/design.goods.info.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designGoodsInfoCtrl",["$scope","tagResource","Flash",function(e,t,a){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.editorOptions={extraPlugins:"uploadimage,widgets",height:"200px",toolbar:[["Widgets","Uploadimage","Table","Link","Unlink","Blockquote","HorizontalRule"],["Find","Preview","Source"],["FontSize","Bold","Italic","Underline","TextColor","BGColor","-","NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]],allowedContent:!0}}])}),define("apps/mall_design/controllers/design.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designGoodsCtrl",["$scope","$modal",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.sortableOptions={cursor:"move",zIndex:99999,axis:"x"},e.remove=function(t){e.content.goods.splice(t.$index,1)},e.add_goods=function(){var a=t.open({animation:!1,templateUrl:"assets/js/apps/mall_design/templates/model_goods_list.html",controller:"mall_modelGoodsCtrl"});a.result.then(function(t){"undefined"==typeof e.content.goods?e.content.goods=t:e.content.goods=e.content.goods.concat(t),e.content.goods=angular.extend(t,e.content.goods)})}}]).controller("mall_modelGoodsCtrl",["$scope","$modalInstance","mall_goodsResource","Flash",function(e,t,a,o){e._global=_global,e.goods={checkedAll:!1},e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){s()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",s()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.$watch("goods.checkedAll",function(t){t?e.selected=e.goods.map(function(e){return e}):e.selected=[]}),e.ok=function(){angular.isUndefined(e.selected)?t.dismiss("cancel"):t.close(e.selected)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/mall_design/controllers/design.image.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designImageCtrl",["$scope","$modal","$timeout","mallLinkData",function(e,t,a,o){function s(e){for(var t={layout_width:4,layout_height:4},a=new Array(t.layout_width),o=[],s=0;s<t.layout_height;s++)o.push(angular.copy(a));return angular.forEach(e,function(e,t){e.index=t;for(var a=e.y;a<e.height+e.y;a++)for(var s=e.x;s<e.width+e.x;s++)o[a][s]=e}),o}function n(t){for(var a={layout_width:4,layout_height:4},o=s(t),n=[],r=0;r<a.layout_height;r++){n.push("<tr>");for(var i=0;i<a.layout_width;i++){var c=o[r][i];if(c){if(r===c.y&&i===c.x){var l=0;e.content.border_width>0&&(l=e.content.border_width);var d='<td style="border-width:'+l+'px" class="not-empty cols-'+c.width+" rows-"+c.height+'" colspan="'+c.width+'" rowspan="'+c.height+'">';if(""!=c.image_url)d+=""!=c.link_url?'<a href="'+c.link_url+'"><img width="100%" src="'+e._global.url.ms+c.image_url+'"></a>':'<img width="100%" src="'+e._global.url.ms+c.image_url+'">';else{var p=160*c.width,u=160*c.height;d+="<span>"+p+"x"+u+"</span>"}d+="</td>",n.push(d)}}else n.push('<td style="border-width:'+e.content.border_width+'px" class="empty" data-x="'+i+'" data-y="'+r+'"></td>')}n.push("</tr>")}e.content.tableContent=n.join(""),$("#layout-table").html(n.join(""))}function r(e,t,a,o){for(var s in e)if(e[s].rows===t-a.y&&e[s].cols===o-a.x+1)return e[s]}e.$on("design_data",function(t,a){e.content=a.content,e.entry=e.content.item_list}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.select_link=angular.copy(o),e.$watch("content",function(e){angular.isUndefined(e)||n(e.item_list)},!0),e.cube_selection={type:"cube_selection",title:"",image_url:"",link_type:"",link_title:"",link_url:""},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)},$("#layout-table").on("click",".empty",function(){var o=$(this),n=angular.copy(e.cube_selection);n.x=o.data("x"),n.y=o.data("y");for(var i=s(e.entry),c=n,l=[],d=[],p=c.y;p<i.length;p++){for(var u=c.x;u<i[p].length;u++){var m=i[p][u];if(m&&(c.x!==m.x||c.y!==m.y))break;if(p-c.y>0){var g=r(l,p,c,u);if(!g)break}d.push({cols:u-c.x+1,rows:p-c.y+1})}if(!d.length)break;l=l.concat(d),d=[]}if(1==l.length)n.width=1,n.height=1,a(function(){e.entry.push(n)},0);else{var f=t.open({animation:!1,templateUrl:"assets/js/apps/design/templates/design/model.table.html",controller:"choiceModelCtrl",size:"sm",resolve:{option:function(){return n},position:function(){return l}}});f.result.then(function(t){e.entry.push(t)})}})}]).controller("choiceModelCtrl",["$scope","option","position","$modalInstance",function(e,t,a,o){for(var s=[],n=0;n<a.length;n++)s[a[n].cols]=a[n].rows;var r=[];angular.forEach(s,function(e,t){r.push(e)}),e.result=r,e.add=function(e){var a=angular.element(e.currentTarget);t.width=a.data("cols"),t.height=a.data("rows"),o.close(t)},e.enter_li=function(e){var t=angular.element(e.currentTarget),a=+t.data("cols"),o=+t.data("rows");$(".layout-table li").removeClass("selected").filter(function(e,t){return selected=$(t),+selected.data("cols")<=a&&+selected.data("rows")<=o}).addClass("selected")},e.cancel=function(){o.dismiss("cancel")},e.getNumber=function(e){return new Array(e)}}])}),define("apps/mall_design/controllers/design.nav.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designNavCtrl",["$scope","mallLinkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content,void 0==e.content.icon_size&&(e.content.icon_size=30)}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_nav=function(e){e.item_list.push({img:"image/tag-icon.png"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)}}])}),define("apps/mall_design/controllers/design.phone.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designPhoneCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.search.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designSearchCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/mall_design/controllers/design.slide.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designSlideCtrl",["$scope","mallLinkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_image=function(){e.content.item_list.push({img:"/image/placehold/image.png"})},e.set_style=function(t){switch(t){case 2:e.content.item_list=[{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X300.png"}];break;case 3:e.content.item_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"}];break;case 4:e.content.item_list=[{img:"/image/placehold/300X320.png"},{img:"/image/placehold/300X150.png"},{img:"/image/placehold/300X150.png"}];break;case 5:e.content.item_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/400X200.png"},{img:"/image/placehold/400X200.png"},{img:"/image/placehold/200X200.png"}];break;case 6:e.content.item_list=[{img:"/image/placehold/300X150.png"},{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X300.png"},{img:"/image/placehold/300X150.png"}];break;case 7:e.content.item_list=[{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X200.png"},{img:"/image/placehold/200X420.png"}];break;default:e.content.item_list=[{img:"/image/placehold/640X.png"},{img:"/image/placehold/640X.1.png"}]}e.content.style=t},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)},e.select_link=angular.copy(t)}])}),define("apps/mall_design/controllers/design.scene.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designSceneCtrl",["$scope","mallLinkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_image=function(){e.content.item_list.push({img:"image/placehold/640X1010.png"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)},e.select_link=angular.copy(t)}])}),define("apps/mall_design/controllers/design.text.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designTextCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.editorOptions={extraPlugins:"uploadimage,widgets",height:"200px",toolbar:[["Widgets","Uploadimage","Table","Link","Unlink","Blockquote","HorizontalRule"],["Find","Preview","Source"],["FontSize","Bold","Italic","Underline","TextColor","BGColor","-","NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]],allowedContent:!0}}])}),define("apps/mall_design/controllers/design.video.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designVideoCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content,void 0!=e.content.code&&""!=e.content.code||(e.content.code='<iframe frameborder="0" height="200" src="http://v.qq.com/iframe/player.html?vid=e0120ax4ltc&height=200&auto=0" style="z-index: 1; " width="100%"></iframe>')}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.voice.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designVoiceCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.notice.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designNoticeCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0})}])}),define("apps/mall_design/controllers/design.conpoment.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designComponentCtrl",["$scope","mallDesignComponentRes",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),t.get(function(t){e.data=t.data})}])}),define("apps/mall_design/controllers/design.white.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designWhiteCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/mall_design/controllers/design.guider.nav.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designGuiderNavCtrl",["$scope","mallLinkData",function(e,t){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.add_nav=function(e){e.item_list.push({img:"image/tag-icon.png"})},e.sortableOptions={cursor:"move",zIndex:99999,axis:"y"},e.select_link=angular.copy(t),e.removeSlide=function(t,a){t.preventDefault(),t.stopPropagation(),e.content.item_list.splice(a,1)}}])}),define("apps/mall_design/controllers/nav",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.nav",["$scope","mall_navgation","Flash","$timeout","$modal","mallLinkData",function(e,t,a,o,s,n){function r(){var o=s.open({animation:!1,templateUrl:"assets/js/apps/mall_design/templates/design/navlist.html",controller:"getNavType"});o.result.then(function(o){var s={};switch(o){case 1:s={id:"",name:"新加方案",style:1,scope:["home","ucenter","feature","list"],enabled:0,data:[{name:"新加导航",link_title:"",link_type:"",link_url:"",sub_button:[{link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}}]},{name:"新加导航",link_title:"",link_type:"",link_url:"",sub_button:[{link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}}]},{name:"新加导航",link_title:"",link_type:"",link_url:"",sub_button:[{link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}}]}]};break;case 2:s={id:"",name:"新加方案",style:2,scope:["home","ucenter","feature","list"],enabled:0,data:{bgcolor:"#eee",fontColor:"#999",fontHoverColor:"#333",list:[{bgimg:"",bghoverimg:"",data:{},link_title:"",link_type:"",link_url:"",name:"新加菜单"},{bgimg:"",bghoverimg:"",data:{},link_title:"",link_type:"",link_url:"",name:"新加菜单"},{bgimg:"",bghoverimg:"",data:{},link_title:"",link_type:"",link_url:"",name:"新加菜单"}]}};break;case 3:}t.add({data:s},function(t){1==t.success?(a.create("success","添加成功"),s.id=t.data,e.navList.plans.push(s),i=s.id,e.$broadcast("eidtNav_data",e.navList.plans[e.navList.plans.length-1])):a.create("warning",t.error)})})}e.select_link=angular.copy(n),e.navList=t.get(function(t){e.isable=t.enabled_nav});var i="";e.showMenuList=function(e){var t=$(e.target),a=t.parent();enentPars=t.parents("ul"),"block"==a.find(".submenu").css("display")?a.find(".submenu").css("display","none"):(enentPars.find("li .submenu").css("display","none"),a.find(".submenu").css("display","block"))},e.mallNavOpen=function(){var o=0;o=0==e.isable?1:0,t.navEnabled({enabled_nav:o},function(t){e.isable=o},function(e){a.create("warning",e.error)})},e.navOpen=function(o){t.navEnabled({id:o},function(){angular.forEach(e.navList.plans,function(e,t){o==e.id?e.enabled=1:e.enabled=0})},function(e){a.create("warning",e.error)})},e.navEdit=function(t){o(function(){i=t.id,e.$broadcast("eidtNav_data",t)},100)},e.navDelete=function(o,s){t.delete({id:o},function(t){1==t.success?(o==i&&e.$broadcast("eidtNav_data",void 0),e.navList.plans.splice(s,1)):a.create("warning","删除失败")})},e.saveNav=function(){t.update({data:e.navList},function(t){1==t.success?(e.$broadcast("eidtNav_data",void 0),a.create("success","修改成功")):a.create("warning",t.error)})},e.showNavList=function(){r()}}]),e.controller("getNavType",["$scope","$modalInstance",function(e,t){e.navType={type:""},e.saveNavType=function(){t.close(e.navType.type)},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("editNav",["$scope","Flash",function(e,t){e.$on("eidtNav_data",function(t,a){e.eidtNavData=a}),e.sortableOptions={handle:".menu-stor",cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.toggleSelection=function(t){var a=e.eidtNavData.scope.indexOf(t);a>-1?e.eidtNavData.scope.splice(a,1):e.eidtNavData.scope.push(t)},e.addStyleNav=function(){if(1==e.eidtNavData.style){var a={name:"新加菜单",link_url:"",link_type:"",link_title:"",data:{},sub_button:[]};e.eidtNavData.data.length>=3?t.create("danger","此类型最多只能添加3个一级菜单"):e.eidtNavData.data.push(a)}if(2==e.eidtNavData.style)if(e.eidtNavData.data.list.length>=5)t.create("danger","此类型最多只能添加5个一级菜单");else{var a={name:"新加菜单",link_url:"",link_type:"",link_title:"",data:{},bgimg:"",bghoverimg:""};e.eidtNavData.data.list.push(a)}},e.addStyleOneNavB=function(e){if(e.sub_button.length>=5)t.create("danger","最多只能添加5个子菜单");else{var a={link_title:"",link_type:"",link_url:"",name:"新加菜单",data:{}};e.sub_button.push(a)}},e.firstNavDelete=function(a,o){1==o&&(0==e.eidtNavData.data[a].sub_button?(e.eidtNavData.data.splice(a,1),t.create("success","删除成功")):t.create("danger","当前导航拥有二级导航，不能删除！")),2==o&&(e.eidtNavData.data.list.splice(a,1),t.create("success","删除成功"))},e.twoNavDelete=function(e,t){e.sub_button.splice(t,1)}}])}),define("apps/mall_design/controllers/search",["apps/common/controllers/controllers"],function(e){e.controller("mall_designerSearch",["$scope","Flash","mall_search",function(e,t,a){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),a.get(function(t){e.id=t.id,e.isable=t.enabled_search,void 0!=t.error?e.content={bar_bg:"#333",box_bg:"#eee",but_text:"#fff",but_bg:"#c33",left_logo:"#fff"}:e.content=t.data,e.name=t.name}),e.saves=function(){e.date={data:e.content,name:e.name},e.id&&(e.date.id=e.id),e.date.name?a.update(e.date,function(e){e.success?t.create("success"," 设置成功！"):t.create("danger",e.error)}):t.create("success"," 未填写搜索标题")},e.restore=function(){e.content={bar_bg:"#333",box_bg:"#eee",but_text:"#fff",but_bg:"#c33",left_logo:"#fff"}},e.off=function(){0==e.isable?e.isable=!0:e.isable=!1,e.enabled={enabled_search:Number(e.isable)},a.put(e.enabled,function(e){e.success?t.create("success"," 设置成功！"):t.create("danger",e.error)})}}])}),define("apps/mall_design/controllers/design.title.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designTitleCtrl",["$scope","$modal","$timeout","mallLinkData",function(e,t,a,o){e.$on("design_data",function(t,a){e.content=a.content}),e.$on("design_dirty",function(t,a){e.form[a].$dirty=!0}),e.select_link=angular.copy(o)}])}),define("apps/mall_design/controllers/design.snatch.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("mall_designSnatchGoodsCtrl",["$scope",function(e){e.$on("design_data",function(t,a){e.content=a.content})}])}),define("apps/mall_design/controllers/classification.list",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.classification.list",["$scope","Flash","mall_design_qrcodeResource","goodsAllCateResourceSearch","goodsAllCateResources","goodsCateOneResources","goodsCateOneResourcesAll","ngPopover","$modal",function(e,t,a,o,s,n,r,i,c){e.isShow=!1,e.checkName=function(e){if(""==e)return"商品名称不能为空!"},e.checkSort=function(e){if(!/^[0-9]*[1-9][0-9]*$/.test(e))return"格式不正确!"},e.checkRecommend=function(e){if(!/^[0+1]{1}$/.test(e))return"格式不正确!"},e.plusClassify={},e.saveField=function(e,a,o){var s={id:o};s[e]=a,n.put(s,function(e){e.success?t.create("success","保存成功"):t.create("danger","编辑失败")})},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(){t.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)};var l=function(){s.get("",function(t){e.Classificationlist=t})};l(),e.confirmDelete=function(e){n.delete({id:e},function(e){e.success?(t.create("success","删除成功"),l()):e.error&&t.create("danger",e.error)})},e.confirmDeleteAll=function(e){r.delete({id:e},function(e){e.success?(t.create("success","删除成功"),l()):e.error&&t.create("danger",e.error)})},e.search=function(t){o.get({title:t},function(t){e.Classificationlist=t})},a.get(function(t){e.qrcode=t,e.copy_texts=e.qrcode.url}),e.previewList=function(){e.isShow=!e.isShow},e.fallbacks=function(){Utils.prompt("Press cmd+c to copy the text below.",e.copy_texts),e.isShow=!e.isShow}}])}),define("apps/mall_design/controllers/classification.info",["apps/common/controllers/controllers"],function(e){e.controller("mall.designer.classification.info",["$scope","Flash","getDesignMallCatResources","eidtDesignMallCateResources","$timeout","$state","$stateParams","mallDesignerData","mallDesignValidate","tagResource",function(e,t,a,o,s,n,r,i,c,l){e.slices=[],e.config={content:{locked:!0,size:"small",sort:"created_at",show_title:!0,show_cart:!0,show_price:!0}},r.id&&a.get({id:r.id},function(t){0==t.data.length||(e.slices=t.data),e.config={name:t.name,description:t.description},""==t.content?e.config.content={locked:!0,size:"small",sort:"created_at",show_title:!0,show_cart:!0,show_price:!0}:e.config.content=t.content}),e.icon_list=i.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=i.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},e.editTagInfo=function(t){angular.forEach(e.slices,function(e,t){e.class=!1});var a={type:"goods_tag",content:t};e.design=a,s(function(){e.$broadcast("design_data",a)},200)},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,a){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,s(function(){e.$broadcast("design_data",t),angular.isUndefined(a)||e.$broadcast("design_dirty",a)},200)},e.save=function(){if(""==$.trim(e.config.name))return e.form.title.$dirty=!0,!1;var a=angular.copy(e.slices);for(var s in a){var i=c[a[s].type](a[s].content);if(i)return e.editSlice(e.slices[s],i),!1}e.config.data=a,r.id?(e.config.id=r.id,o.put(e.config,function(e){n.go("mall.mall_design.classification.list"),t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})):o.put(e.config,function(e){n.go("mall.mall_design.classification.list"),t.create("success"," 添加成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/mall_design/controllers/_base",["apps/mall_design/controllers/feature.info","apps/mall_design/controllers/feature.list","apps/mall_design/controllers/component.info","apps/mall_design/controllers/component.list","apps/mall_design/controllers/tag.list","apps/mall_design/controllers/tag.info","apps/mall_design/controllers/goods.list","apps/mall_design/controllers/goods.info","apps/mall_design/controllers/design.banner.ctrl","apps/mall_design/controllers/design.guider.banner.ctrl","apps/mall_design/controllers/design.guider.apply.ctrl","apps/mall_design/controllers/design.goods.tag.ctrl","apps/mall_design/controllers/design.goods.info.ctrl","apps/mall_design/controllers/design.goods.ctrl","apps/mall_design/controllers/design.image.ctrl","apps/mall_design/controllers/design.nav.ctrl","apps/mall_design/controllers/design.phone.ctrl","apps/mall_design/controllers/design.search.ctrl","apps/mall_design/controllers/design.slide.ctrl","apps/mall_design/controllers/design.scene.ctrl","apps/mall_design/controllers/design.text.ctrl","apps/mall_design/controllers/design.video.ctrl","apps/mall_design/controllers/design.voice.ctrl","apps/mall_design/controllers/design.notice.ctrl","apps/mall_design/controllers/design.conpoment.ctrl","apps/mall_design/controllers/design.white.ctrl","apps/mall_design/controllers/design.guider.nav.ctrl","apps/mall_design/controllers/nav","apps/mall_design/controllers/search","apps/mall_design/controllers/design.title.ctrl","apps/mall_design/controllers/design.snatch.goods.ctrl","apps/mall_design/controllers/classification.list","apps/mall_design/controllers/classification.info"],function(){}),
define("apps/mall_design/directives/mallInputRange",["apps/common/directives/directives"],function(e){e.directive("mallInputRange",[function(){return{restrict:"AE",require:"?ngModel",scope:{value:"=ngModel"},link:function(e,t,a,o){var s=1;e.$watch("value",function(n){angular.isUndefined(n)||1!=s||(s++,t.slider({range:"max",min:parseInt(a.min),max:parseInt(a.max),value:e.value,slide:function(e,t){o.$setViewValue(t.value)}}))})}}}])}),define("apps/mall_design/directives/_base",["apps/mall_design/directives/mallInputRange"],function(){}),define("apps/mall_design/main",["apps/mall_design/states/_base","apps/mall_design/services/_base","apps/mall_design/controllers/_base","apps/mall_design/directives/_base"],function(){}),define("apps/mall_shop/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.mall_shop",{abstract:!0,url:"",templateUrl:"assets/js/apps/mall_shop/templates/layout.html"}).state("mall.mall_shop.home",{url:"/mall_shop/home",templateUrl:"assets/js/apps/mall_shop/templates/shops.home.html",controller:"shops.home"}).state("mall.mall_shop.manage",{url:"/mall_shop/manage",templateUrl:"assets/js/apps/mall_shop/templates/shops.manage.html",controller:"shops.manage"}).state("mall.mall_shop.add",{url:"/mall_shop/add",templateUrl:"assets/js/apps/mall_shop/templates/shops.add.html",controller:"shops.add"}).state("mall.mall_shop.edit",{url:"/mall_shop/edit/:id",templateUrl:"assets/js/apps/mall_shop/templates/shops.edit.html",controller:"shops.edit",resolve:{shopDetails:["shopDetails","$stateParams",function(e,t){return e(t)}]}}).state("mall.mall_shop.cash",{url:"/mall_shop/cash",templateUrl:"assets/js/apps/mall_shop/templates/shops.cash.html",controller:"shops.cash"})}])});define("apps/mall_shop/states/_base",["apps/mall_shop/states/main"],function(){});define("apps/mall_shop/controllers/shops.home",["apps/common/controllers/controllers","echarts","echarts/chart/pie"],function(e,t){e.controller("shops.home",["$scope","GetMallstat","GetSinglestat","Flash",function(e,a,o,s){var n=t.init(document.getElementById("level-chart"),"macarons");o.query(function(e){var t=[],a=[];angular.forEach(e,function(e){e.name=e.name+":　"+e.tradeNum}),angular.forEach(e,function(e,o){t.push(e.name);var s={value:e.tradeNum,name:e.name};a.push(s)});var o={tooltip:{trigger:"item",formatter:"{a} <br/>{b} :  ({d}%)"},legend:{orient:"vertical",x:"left",data:t},calculable:!0,series:[{type:"pie",radius:"55%",center:["50%","60%"],data:a}]};n.setOption(o)}),e.profiles={},e.GetMallst=function(){a.get(function(t){t.error?s.create("danger",t.error):e.profiles=t})},e.GetMallst()}])}),define("apps/mall_shop/controllers/shops.manage",["apps/common/controllers/controllers"],function(e){e.controller("shops.manage",["$scope","$state","service","shopCate","shopsCode","getShopList","Flash","ngPopover","$modal","$location",function(e,t,a,o,s,n,r,i,c,l){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var d=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,n.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data},function(t){e.data=[],r.create("danger",t.data.error)})};d(),e.sort=function(){"desc"==e.searchInfo.sorts?(e.searchInfo={},e.searchInfo.sorts="asc"):(e.searchInfo={},e.searchInfo.sorts="desc"),d()},e.sortbalance=function(){"desc"==e.searchInfo.sortbalance?(e.searchInfo={},e.searchInfo.sortbalance="asc"):(e.searchInfo={},e.searchInfo.sortbalance="desc"),d()},e.sortincome=function(){"desc"==e.searchInfo.sortincome?(e.searchInfo={},e.searchInfo.sortincome="asc"):(e.searchInfo={},e.searchInfo.sortincome="desc"),d()},e.sorttime=function(){"desc"==e.searchInfo.leftdays?(e.searchInfo={},e.searchInfo.leftdays="asc"):(e.searchInfo={},e.searchInfo.leftdays="desc"),d()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.showQrcode=function(t){s.code({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){i.close(),r.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},e.clickPopover=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/mall_shop/templates/revise_Pwd.html",controller:"shops.manage.revise_Pwd",resolve:{Pwd_id:function(){return e}}});t.result.then(function(e){})},e.renewClick=function(e){var t=c.open({animation:!1,templateUrl:"assets/js/apps/mall_shop/templates/shops.renew.html",controller:"renewCont",resolve:{data:function(){return e}}});t.result.then(function(e){e&&d()})};var p=function(e,t){var a="";for(var o in t){var s=t[o];a+=encodeURIComponent(o)+"="+encodeURIComponent(s)+"&"}return a.length>0&&(a=a.substring(0,a.length-1),e=e+"?"+a),e};e.export=function(){e.searchInfo.export="yes";var t="/merchantmall/merchant.json";t=p(t,e.searchInfo),window.location.href=t,delete e.searchInfo.export},e.addNewShop=function(){var e=new Date(_global.mall.shop_startline),t=new Date(_global.mall.shop_deadline),a=e.getTime(),o=t.getTime(),s=new Date,n=s.getTime();n<o&&n>a?l.path("/mall/mall_shop/add"):r.create("danger","您不在有效开店时间之内，请联系管理员")}}]),e.controller("renewCont",["$scope","$modalInstance","shops","data","Flash",function(e,t,a,o,s){e.data=o,e.renewalInfo={id:o.id,shop_id:o.shop_id,expire_at:"",give_at:""},e.butText="提交",e.butStatus=!1,e.confirm=function(){return""==e.renewalInfo.expire_at?(s.create("danger","请选择购买时间"),!1):(e.butText="提交中",e.butStatus=!0,void a.renewal(e.renewalInfo,function(a){a.success?(s.create("success","续费成功"),t.close(!0),e.cancel()):s.create("danger",a.error),e.butText="提交",e.butStatus=!1},function(t){s.create("danger",t.data.error),e.butText="提交",e.butStatus=!1}))},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("shops.manage.revise_Pwd",["$scope","$modalInstance","Pwd_id","shops","Flash",function(e,t,a,o,s){e.editPwdInfo={id:"",password:"",password_confirmation:"",btn_stutas:!1},e.cancel=function(){t.dismiss("cancel")},e.editPwdClick=function(n){return n.updatePwd.$invalid?(n.updatePwd.$dirty=!0,$("input[name='updatePwd']").focus(),!1):e.editPwdInfo.password!=e.editPwdInfo.password_confirmation?(n.updatePwd_confirmation.$dirty=!0,$("input[name='updatePwd_confirmation']").focus(),s.create("danger","两次输入密码不一致"),!1):(e.editPwdInfo.btn_stutas=!0,void o.editPwd({id:a,password:e.editPwdInfo.password},function(a){a.success?(s.create("success","修改成功"),t.close()):s.create("danger",a.msg),e.editPwdInfo.btn_stutas=!1},function(e){s.create("danger",e.data.error)}))}}])}),define("apps/mall_shop/controllers/shops.cash",["apps/common/controllers/controllers"],function(e){e.controller("shops.cash",["$scope","getWithdrawList","addRemark","withdrawAudit","Flash","ngPopover",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,t.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.cancel=function(){n.close()},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remark,e.remarkInfo.index=a},e.set_remark=function(){e.remarkInfo.text?a.setRemark({id:e.remarkInfo.id,remark:e.remarkInfo.text},function(t){t.status?(s.create("success","提交成功"),n.close(),e.data[e.remarkInfo.index].remark=e.remarkInfo.text):s.create("danger","提交失败")}):s.create("danger","请填写备注")},e.isPassInfo={id:"",index:""},e.set_isPassClick=function(t,a){e.isPassInfo.id=t.id,e.isPassInfo.index=a},e.pass_ok=function(t,a){e.isPassInfo.id=t.id,e.isPassInfo.index=a,o.setAudit({id:e.isPassInfo.id,audit_status:1},function(t){t.status?(s.create("success","提交成功"),r(),n.close(),e.data[e.isPassInfo.index].audit_status=1):s.create("danger",t.error)})},e.set_refusePassClick=function(t,a){e.isPassInfo.id=t.id,e.isPassInfo.index=a,o.setAudit({id:e.isPassInfo.id,audit_status:-1},function(t){t.status?(s.create("success","提交成功"),r(),n.close(),e.data[e.isPassInfo.index].audit_status=-1):s.create("danger",t.error)})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.searchInfo.start_at=t[0],e.searchInfo.end_at=t[1]):(delete e.searchInfo.start_at,delete e.searchInfo.end_at),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1}}])}),define("apps/mall_shop/controllers/shops.edit",["apps/common/controllers/controllers"],function(e){e.controller("shops.edit",["$scope","$state","$stateParams","shops","$modal","shopDetails","Flash",function(e,t,a,o,s,n,r){e.btn_text="保存",e.isEdit=!0;var i=e.city=this;a.id?(o.detail({id:a.id},function(t){e.shopInfo=t}),e.title="修改店铺",e.shopInfo=n,i.regions={country:1,province:e.shopInfo.province,city:e.shopInfo.city,district:e.shopInfo.district}):(e.title="新增店铺",e.shopInfo={company:"",country:"1",province:"",city:"",district:"",address:"",contact:"",mobile:"",expire_at:"",give_at:"",name:"",type:"",username:"",password:"",email:"",weixin:"",payment_type:"",is_recommend:"",enabled:"",remarks:""},i.regions={country:1}),i.start="province",i.end="city",e.butStatus=!1,e.butSave=function(s){return s.inp_company.$invalid?(s.inp_company.$dirty=!0,$("input[name='inp_company']").focus(),!1):angular.isUndefined(e.city.selected)?(r.create("danger","请选择地址"),!1):(angular.isUndefined(a.id)&&(e.shopInfo.province=e.city.selected[0].id,e.shopInfo.city=e.city.selected[1].id),s.inp_address.$invalid?(s.inp_address.$dirty=!0,$("input[name='inp_address']").focus(),!1):s.inp_contact.$invalid?(s.inp_contact.$dirty=!0,$("input[name='inp_contact']").focus(),!1):s.inp_mobile.$invalid?(s.inp_mobile.$dirty=!0,$("input[name='inp_mobile']").focus(),!1):s.inp_name.$invalid?(s.inp_name.$dirty=!0,$("input[name='inp_name']").focus(),!1):s.inp_username.$invalid?(s.inp_username.$dirty=!0,$("input[name='inp_username']").focus(),!1):0==e.isEdit&&s.inp_password.$invalid?(s.inp_password.$dirty=!0,$("input[name='inp_password']").focus(),!1):void(a.id?(e.butStatus=!0,o.edit(e.shopInfo,function(a){a.success?(r.create("success","修改成功"),t.go("mall.mall_shop.manage")):r.create("danger",a.error),e.butStatus=!1},function(t){r.create("danger",t.data.error),e.butStatus=!1})):(e.butStatus=!0,o.add(e.shopInfo,function(a){a.success?(r.create("success","添加成功"),t.go("mall.mall_shop.manage")):r.create("danger",a.error),e.butStatus=!1}))))}}])}),define("apps/mall_shop/controllers/shops.add",["apps/common/controllers/controllers"],function(e){e.controller("shops.add",["$scope","$state","$stateParams","shops","$modal","shopDetails","Flash",function(e,t,a,o,s,n,r){e.btn_text="保存",e.isEdit=!!a.id;var i=e.city=this;a.id?(e.title="修改店铺",i.regions={country:1,province:e.shopInfo.province,city:e.shopInfo.city,district:e.shopInfo.district}):(e.title="新增店铺",e.shopInfo={company:"",country:"1",province:"",city:"",district:"",address:"",contact:"",mobile:"",expire_at:"",give_at:"",name:"",type:"1",username:"",password:"",email:"",weixin:"",payment_type:1,is_recommend:"0",enabled:"1",remarks:""},_global.mall.mall_type&&(e.shopInfo.payment_type=0),i.regions={country:1}),i.start="province",i.end="city",e.butStatus=!1,e.butSave=function(s){return s.inp_company.$invalid?(s.inp_company.$dirty=!0,$("input[name='inp_company']").focus(),!1):angular.isUndefined(e.city.selected)?(r.create("danger","请选择地址"),!1):(angular.isUndefined(a.id)&&(e.shopInfo.province=e.city.selected[0].id,e.shopInfo.city=e.city.selected[1].id),s.inp_address.$invalid?(s.inp_address.$dirty=!0,$("input[name='inp_address']").focus(),!1):s.inp_contact.$invalid?(s.inp_contact.$dirty=!0,$("input[name='inp_contact']").focus(),!1):s.inp_mobile.$invalid?(s.inp_mobile.$dirty=!0,$("input[name='inp_mobile']").focus(),!1):s.inp_name.$invalid?(s.inp_name.$dirty=!0,$("input[name='inp_name']").focus(),!1):s.inp_username.$invalid?(s.inp_username.$dirty=!0,$("input[name='inp_username']").focus(),!1):0==e.isEdit&&s.inp_password.$invalid?(s.inp_password.$dirty=!0,$("input[name='inp_password']").focus(),!1):void(a.id?(e.butStatus=!0,o.edit(e.shopInfo,function(a){a.success?(r.create("success","修改成功"),t.go("mall.mall_shop.manage")):r.create("danger",a.error),e.butStatus=!1})):(e.butStatus=!0,o.add(e.shopInfo,function(a){a.success&&(r.create("success","添加成功"),t.go("mall.mall_shop.manage")),e.butStatus=!1},function(t){r.create("danger",t.data.error),e.butStatus=!1}))))}}])}),define("apps/mall_shop/controllers/_base",["apps/mall_shop/controllers/shops.home","apps/mall_shop/controllers/shops.manage","apps/mall_shop/controllers/shops.cash","apps/mall_shop/controllers/shops.edit","apps/mall_shop/controllers/shops.add"],function(){}),define("apps/mall_shop/services/shops.home",["apps/common/services/services"],function(e){e.factory("sixsettingResource",["$resource",function(e){return e("guider/six_setting/:id.json",{id:"@id"},{update:{method:"PUT"},get:{method:"GET",isArray:!1}})}]),e.factory("GetMallstat",["$resource",function(e){return e("/mall/mallstat.json",{},{get:{method:"GET",url:"/mall/mallstat.json"}})}]),e.factory("GetSinglestat",["$resource",function(e){return e("/mall/singlestat.json",{},{query:{method:"GET",isArray:!0}})}])}),define("apps/mall_shop/services/shops.manage",["apps/common/services/services"],function(e){e.factory("shops",["$resource",function(e){return e("",{},{get:{method:"GET",url:"/merchantmall/merchant.json"},add:{method:"POST",url:"/merchantmall/merchant.json"},code:{method:"GET",url:"/merchantmall/shop_qrcode/:id.json"},detail:{method:"GET",url:"/merchantmall/merchant/:id.json"},edit:{method:"PUT",url:"/merchantmall/merchant.json"},editPwd:{method:"PUT",url:"/merchantmall/reset_pwd.json"},renewal:{method:"PUT",url:"/merchantmall/renewal.json"}})}]),e.factory("services",["$resource",function(e){return e("/merchantmall/service.json",{},{get:{method:"GET"},add:{method:"POST"},edit:{method:"PUT"},delete:{method:"DELETE"}})}]),e.factory("shopsCode",["$resource",function(e){return e("/merchantmall/shop_qrcode/:id.json",{id:"@id"},{code:{method:"GET"}})}]),e.factory("shopDetails",["shops","$q",function(e,t){return function(a){var o=t.defer();return e.detail({id:a.id},function(e){o.resolve(e)}),o.promise}}]),e.factory("shopCates",["$resource",function(e){return e("/merchantmall/shop_cate.json",{id:"@id"},{update:{method:"PUT",url:"/merchantmall/shop_cate/:id.json"},delete:{method:"DELETE",url:"/merchantmall/shop_cate/:id.json"}})}]),e.factory("getShopList",["$resource",function(e){return e("/merchantmall/merchant.json",{},{get:{method:"GET",url:"/merchantmall/merchant.json"}})}])}),define("apps/mall_shop/services/shops.cash",["apps/common/services/services"],function(e){e.factory("getWithdrawList",["$resource",function(e){return e("/mall/applywithdraw.json",{},{get:{method:"GET",url:"/mall/applywithdraw.json"}})}]),e.factory("addRemark",["$resource",function(e){return e("/mall/:id.json",{id:"@id"},{setRemark:{method:"PUT",url:"/mall/addremark.json"}})}]),e.factory("withdrawAudit",["$resource",function(e){return e("/mall/:id.json",{id:"@id"},{setAudit:{method:"PUT",url:"/mall/applyaudit.json"}})}])}),define("apps/mall_shop/services/shops.add",["apps/common/services/services"],function(e){e.factory("ssshops",["$resource",function(e){return e("",{},{get:{method:"GET",url:"/merchant/merchant.json"},add:{method:"POST",url:"/merchantmall/merchant.json"},code:{method:"GET",url:"/merchant/shop_qrcode/:id.json"},detail:{method:"GET",url:"/merchant/merchant/:id.json"},edit:{method:"PUT",url:"/merchant/merchant.json"},editPwd:{method:"PUT",url:"/merchant/reset_pwd.json"},renewal:{method:"PUT",url:"/merchant/renewal.json"}})}]),e.factory("service",["$resource",function(e){return e("/merchant/service.json",{},{get:{method:"GET"},add:{method:"POST"},edit:{method:"PUT"},delete:{method:"DELETE"}})}]),e.factory("shopCode",["$resource",function(e){return e("/merchant/shop_qrcode/:id.json",{id:"@id"},{code:{method:"GET"}})}]),e.factory("shopDetail",["shop","$q",function(e,t){return function(a){var o=t.defer();return e.detail({id:a.id},function(e){o.resolve(e)}),o.promise}}]),e.factory("shopCate",["$resource",function(e){return e("/merchant/shop_cate.json",{id:"@id"},{update:{method:"PUT",url:"/merchant/shop_cate/:id.json"},delete:{method:"DELETE",url:"/merchant/shop_cate/:id.json"}})}])}),define("apps/mall_shop/services/_base",["apps/mall_shop/services/shops.home","apps/mall_shop/services/shops.manage","apps/mall_shop/services/shops.cash","apps/mall_shop/services/shops.add"],function(){}),define("apps/mall_shop/main",["apps/mall_shop/states/_base","apps/mall_shop/controllers/_base","apps/mall_shop/services/_base"],function(){}),define("apps/mall_goods/states/auction",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.category",{url:"/category",templateUrl:"assets/js/apps/mall_goods/templates/layout.html"}).state("mall.category.auction",{abstract:!0,url:"/auction",template:"<div ui-view></div>"}).state("mall.category.auction.list",{url:"",templateUrl:"assets/js/apps/mall_goods/templates/auction.html",controller:"mall.goodes.auction"})}])}),define("apps/mall_goods/states/add",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("mall.category.add",{url:"/add",controller:"mall.goodes.form",templateUrl:"assets/js/apps/mall_goods/templates/form.html"}).state("mall.category.add.step",{controller:"mall.goodes.form",url:"/step/:step",templateUrl:"assets/js/apps/mall_goods/templates/form.html"})}])}),define("apps/mall_goods/states/_base",["apps/mall_goods/states/auction","apps/mall_goods/states/add"],function(){}),define("apps/mall_goods/controllers/auction",["apps/common/controllers/controllers"],function(e){e.controller("mall.goodes.auction",["$scope","$filter","ngPopover","Flash","goodsResource","tagResource","$modal","cityData",function(e,t,a,o,s,n,r,i){function c(){n.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){a.close()},e.cancel=function(){a.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var n={id:a};n[e]=t,s.editField(n,function(e){e.success||o.create("danger",e.error)})},e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,c(),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),l()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?l():o.create("danger","删除失败")})},e.confirmBatchDelete=function(){s.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(l(),e.goods.checkedAll=!1):o.create("danger","删除失败")})},e.confirmBatchOffSale=function(){s.batchToggleSale({ids:e.selectedIds,sale:0},function(t){t.success?(l(),e.goods.checkedAll=!1):o.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){s.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),a.close(),o.create("success","分组成功")):o.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){s.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","区域设置成功")):o.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){s.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]});var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.setArea=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"},region_id:function(){}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/goods_tpl.html",controller:"mall.goodes.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/price_tpl.html",controller:"shop.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){l()})},e.setProductStock=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/stock_tpl.html",controller:"shop.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){l()})},e.showQrcode=function(t){s.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/mall_goods/controllers/form",["apps/common/controllers/controllers"],function(controllers){controllers.controller("mall.goodes.form",["$location","$scope","$modal","mall_deleteMallcat","$stateParams","$compile","$state","Flash","ngPopover","mall_GoodsData","mall_catResource","designGoodsRes","$timeout",function($location,$scope,$modal,mall_deleteMallcat,$stateParams,$compile,$state,Flash,ngPopover,mall_GoodsData,mall_catResource,designGoodsRes,$timeout){var vm=$scope.vm={},cson=[],step=$stateParams.step;step=1,vm.cates=[],vm.activeTab=step,$scope.isGetProp=!1,vm.goodsData=mall_GoodsData,$scope.confirmDelete=function(e,t,a){mall_deleteMallcat.delete({id:e},function(o){if(o.success){if(Flash.create("success","删除成功"),vm.cates[t].splice(a,1),$scope.isHide=e,0==t&&(vm.cates=[],$scope.SelectCate(0,1,0,0)),1==t){if(0==vm.cates[1].length)return $scope.showinfoindex=!0,vm.cates=[],void $scope.SelectCate(0,1,0,0);$scope.SelectCate($scope.infoindex,1,$scope.default_level,1,$scope.parentObject,0)}if(2==t){if(0==vm.cates[2].length)return $scope.showinfoindex=!0,$scope.SelectCate($scope.parentObject.partent_id,1,1,0,$scope.parentObject,0),void $scope.SelectCate($scope.parentObject.id,1,1,1,$scope.parentObject,0);$scope.SelectCate($scope.infoindex,1,$scope.default_level,1,$scope.parentObject,0)}}else Flash.create("danger","删除失败")})};var catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),vm.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),vm.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),vm.catesHistoryList.unshift({ids:-1,strs:"请选择"}),vm.catesHistorySelect=-1;var partent_id=0;$scope.infoindex=1,$scope.parentObject={},$scope.showinfoindex=!1,$scope.newcchild=1,$scope.default_level=0,$scope.SelectCate=function(e,t,a,o,s,n){if(!(a>=2)){cson.push(t),$scope.default_level=a,o&&a<2&&($scope.parentObject=s);var r=vm.cates.length,i=a+1;3!=i&&(partent_id=e),1==i&&(partent_id=0),$scope.infoindex=e,$scope.newcchild=t,vm.goodsData.cate[a]={},vm.goodsData.cate[a].data=s,vm.goodsData.cate.splice(i,vm.goodsData.cate.length-i),t>0?mall_catResource.get({partent_id:e},function(e){o?e._count>0?(angular.isUndefined(vm.goodsData.cate[i])&&(vm.goodsData.cate[i]={}),vm.goodsData.cate[a].collections=vm.cates[i]=e.data,vm.cates.splice(i+1,r-i-1),n||(vm.goodsData.isCateSelect=!1)):(vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0):vm.goodsData.cate[a].collections=vm.cates[a]=e.data},function(e){}):(a<2&&0==t&&($scope.showinfoindex=!0),a<2&&0==cson[cson.length-1]&&($scope.showinfoindex=!0),vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)}},$scope.newmodalcategory=function(e,t){var a=$modal.open({animation:!1,templateUrl:"assets/js/apps/mall_goods/templates/goodes.modal.html",controller:"mall.goodes.modal",resolve:{itemCate:function(){return e},partents_id:function(){return t}}});a.result.then(function(e){e&&(0==$scope.default_level&&(vm.cates=[],$scope.SelectCate(0,1,0,0),$scope.SelectCate(t,1,$scope.default_level,1,$scope.parentObject,0)),1==$scope.default_level&&($scope.SelectCate($scope.infoindex,1,$scope.default_level,1,$scope.parentObject,1),$scope.SelectCate($scope.parentObject.partent_id,1,1,0,$scope.parentObject,1)))})},$scope.modalcategory=function(e,t,a){if(localStorage.removeItem("oldGoodesData"),0==t){var o=$modal.open({animation:!1,templateUrl:"assets/js/apps/mall_goods/templates/goodes.modal.html",controller:"mall.goodes.modal",resolve:{itemCate:function(){return e},partents_id:function(){return 0}}});o.result.then(function(e){e&&(vm.goodsData.cate=[],vm.cates=[],$scope.SelectCate(0,1,0,0))})}else if(2==t){var o=$modal.open({animation:!1,templateUrl:"assets/js/apps/mall_goods/templates/goodes.modal.html",controller:"mall.goodes.modal",resolve:{itemCate:function(){return e},partents_id:function(){return vm.goodsData.cate[1].data.id}}});o.result.then(function(e){e&&$scope.SelectCate(vm.goodsData.cate[1].data.id,1,1,1,vm.goodsData.cate[1].data,0)}),$scope.showinfoindex=!1}else{var o=$modal.open({animation:!1,templateUrl:"assets/js/apps/mall_goods/templates/goodes.modal.html",controller:"mall.goodes.modal",resolve:{itemCate:function(){return e},partents_id:function(){return vm.goodsData.cate[0].data.id}}});o.result.then(function(e){e&&$scope.SelectCate(vm.goodsData.cate[0].data.id,1,0,1,vm.goodsData.cate[0].data,1)})}},$scope.$watch("vm.goodsData.cate",function(e){e.length>0&&(vm.goodsData.props={})},!0),$scope.$watch("newcchild",function(e){e>0&&($scope.showinfoindex=!1)}),0==vm.goodsData.cate.length?$scope.SelectCate(0,1,0,0):($scope.SelectCate(0,1,0,0),angular.forEach(vm.goodsData.cate,function(e,t){vm.cates[t]=e.collections}),vm.goodsData.isCateSelect=!0)}])}),define("apps/mall_goods/controllers/goodes.modal",["apps/common/controllers/controllers"],function(e){e.controller("mall.goodes.modal",["$scope","$modalInstance","Flash","itemCate","mall_addMallcat","mall_editMallcat","partents_id",function(e,t,a,o,s,n,r){angular.isUndefined(o)?(e.title="添加分类",e.goodesData={},e.goodesData.partent_id=0,e.goodesData.is_recommend=0):(e.title="编辑分类",e.goodesData=o),localStorage.getItem("oldGoodesData")||localStorage.setItem("oldGoodesData",JSON.stringify(e.goodesData)),e.ok=function(i){i&&($(".btn-submit")[0].disabled=!0,angular.isUndefined(o)?(e.goodesData.is_recommend=parseInt(e.goodesData.is_recommend),e.goodesData.listorder=parseInt(e.goodesData.listorder),e.goodesData.partent_id=parseInt(r),s.save(e.goodesData,function(o){o.error?(a.create("danger",o.error),$(".btn-submit")[0].disabled=!1):(a.create("success"," 添加成功！"),t.close(e.goodesData))},function(e){a.create("danger","添加失败"),t.dismiss("cancel")})):(e.goodesData.is_recommend=parseInt(e.goodesData.is_recommend),e.goodesData.listorder=parseInt(e.goodesData.listorder),n.update(e.goodesData,function(o){if(o.error){a.create("danger","修改失败！"),t.dismiss("cancel");var s=new Function("return "+localStorage.getItem("oldGoodesData"))();e.goodesData.name=s.name}else a.create("success"," 修改成功！"),t.close(e.goodesData)},function(e){a.create("danger","修改失败！"),t.dismiss("cancel")})))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/mall_goods/controllers/_base",["apps/mall_goods/controllers/auction","apps/mall_goods/controllers/form","apps/mall_goods/controllers/goodes.modal"],function(){}),define("apps/mall_goods/services/goods",["apps/common/services/services"],function(e){e.factory("mall_goodsResource",["$resource",function(e){return e("goods.json",{id:"@id"},{get:{method:"GET",url:"designmall/mallgoods.json"},update:{method:"PUT",url:"goods/:id.json"},delete:{method:"DELETE",url:"goods/:id.json"},onSale:{method:"PUT",url:"goods/sale/:id.json"},batchDelete:{method:"DELETE",url:"goods/batch.json"},batchToggleSale:{method:"PUT",url:"goods/batch_sale.json"},batchTag:{method:"PUT",url:"goods/batch_tag.json"},batchRegion:{method:"PUT",url:"goods/batch_region.json"},batchDesignGoods:{method:"PUT",url:"goods/batch_design_goods.json"},batchDiscount:{method:"PUT",url:"goods/batch_discount.json"},editField:{method:"PUT",url:"goods/field/:id.json"},editProductField:{method:"PUT",url:"goods/product_field/:id.json"},getProducts:{method:"GET",url:"goods/products/:id.json"},getGuiderGoods:{method:"GET",url:"goods_guider.json"},getQrcodeInfo:{method:"GET",url:"goods/qrcode_info/:id.json"}})}]),e.factory("mall_GoodsData",[function(){var e={selectedGoodsTags:[],cate:[],isCateSelect:!1,goods_cat_id:0,prop:[],props:{},title:"",imgs:[],is_sku:0,skus:[],skuData:[],skuStock:[],products:{},tags:[],price:null,stock:null,goods_sn:null,barcode:null,shipment_type:0,shipmentType:0,shipments:[],shipment:null,postage:null,weight:null,volume:null,stockType:0,stock_type:0,onsale_type:0,onsale_at:"",collect_fields:[],intro:"",components_data:[],designGoodsTpl:0,cquota:0,slices:[],description:"",external_type:0},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t.isStep=!1,t}])}),define("apps/mall_goods/services/cat",["apps/common/services/services"],function(e){e.factory("mall_catResource",["$resource",function(e){return e("mall/cat.json",{id:"@id"},{})}]),e.factory("mall_deleteMallcat",["$resource",function(e){return e("mall/cat/:id.json",{id:"@id"},{delete:{method:"DELETE",url:"mall/cat/:id.json"}})}]),e.factory("mall_addMallcat",["$resource",function(e){return e("mall/cat.json",{id:"@id"},{save:{method:"POST",url:"mall/cat.json"}})}]),e.factory("mall_getMallcat",["$resource",function(e){return e("mall/cat/:id.json",{id:"@id"},{get:{method:"GET",url:"mall/cat/:id.json"}})}]),e.factory("mall_editMallcat",["$resource",function(e){return e("mall/cat/:id.json",{id:"@id"},{update:{method:"PUT",url:"mall/cat/:id.json"}})}])}),define("apps/mall_goods/services/_base",["apps/mall_goods/services/goods","apps/mall_goods/services/cat"],function(){}),define("apps/mall_goods/main",["apps/mall_goods/states/_base","apps/mall_goods/controllers/_base","apps/mall_goods/services/_base"],function(){}),define("apps/supplier/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier",{abstract:!1,url:"/supplier",templateUrl:"assets/js/apps/supplier/templates/layoutBar.html"
})}])}),define("apps/supplier/states/dashboard",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell",{url:"/sell",templateUrl:"assets/js/apps/supplier/templates/layout_supplier.html"}).state("supplier.sell.dashboard",{url:"/dashboard",templateUrl:"assets/js/apps/supplier/templates/dashboard/dashboard.tab.html"}).state("supplier.sell.dashboard.supplier",{url:"/supplier",templateUrl:"assets/js/apps/supplier/templates/dashboard/dashboard.supplier.html",controller:"dashboard.supplier"}).state("supplier.sell.dashboard.purchase",{url:"/purchase",templateUrl:"assets/js/apps/supplier/templates/dashboard/dashboard.purchase.html",controller:"dashboard.purchase"}).state("supplier.sell.dashboard.income",{url:"/income",templateUrl:"assets/js/apps/supplier/templates/dashboard/dashboard.income.html",controller:"dashboard.income"})}])}),define("apps/supplier/states/rank",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell.rank",{abstract:!0,url:"/rank",template:"<div ui-view></div>"}).state("supplier.sell.rank.list",{url:"/list",templateUrl:"assets/js/apps/supplier/templates/rank/rank.list.html",controller:"supplier.rank.list"}).state("supplier.sell.rank.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/supplier/templates/rank/rank.info.html",controller:"supplier.rank.info"})}])}),define("apps/supplier/states/suppliers",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell.suppliers",{abstract:!1,url:"/suppliers",template:"<div ui-view></div>"}).state("supplier.sell.suppliers.list",{url:"/list/:level",templateUrl:"assets/js/apps/supplier/templates/suppliers/suppliers.list.html",controller:"supplier.suppliers.list"}).state("supplier.sell.suppliers.add",{url:"/add",templateUrl:"assets/js/apps/supplier/templates/suppliers/suppliers.info.html",controller:"supplier.suppliers.info"}).state("supplier.sell.suppliers.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/supplier/templates/suppliers/suppliers.info.html",controller:"supplier.suppliers.info",resolve:{suppliersResourceLoder:["suppliersResourceLoder","$stateParams",function(e,t){return e(t)}]}}).state("supplier.sell.suppliers.dispatcts",{url:"/dispatcts/:id/:shopName",templateUrl:"assets/js/apps/supplier/templates/dispatct/dispatct.list.html",controller:"supplier.dispatct.list"}).state("supplier.sell.suppliers.dispatct",{url:"/dispatct/:shopId/:shopName",templateUrl:"assets/js/apps/supplier/templates/dispatct/dispatct.info.html",controller:"supplier.dispatct.info"})}])}),define("apps/supplier/states/withdraw",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell.withdraw",{url:"/withdraw",templateUrl:"assets/js/apps/supplier/templates/withdraw/withdraw.tab.html"}).state("supplier.sell.withdraw.account",{url:"/account",templateUrl:"assets/js/apps/supplier/templates/withdraw/withdraw.account.html",controller:"withdraw.account"}).state("supplier.sell.withdraw.manage",{url:"/manage",templateUrl:"assets/js/apps/supplier/templates/withdraw/withdraw.manage.html",controller:"withdraw.manage"}).state("supplier.sell.withdraw.account.details",{url:"/account/details/:id",templateUrl:"assets/js/apps/supplier/templates/withdraw/withdraw.account.details.html",controller:"withdraw.account.details"})}])}),define("apps/supplier/states/purchaseorder",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell.purchaseorder",{url:"/purchaseorder",templateUrl:"assets/js/apps/supplier/templates/purchaseorder/purchaseorder.tab.html"}).state("supplier.sell.purchaseorder.list",{url:"/list",templateUrl:"assets/js/apps/supplier/templates/purchaseorder/purchaseorder.list.html",controller:"purchaseorder.list"}).state("supplier.sell.purchaseorder.setting",{url:"/setting",templateUrl:"assets/js/apps/supplier/templates/purchaseorder/purchaseorder.setting.html",controller:"purchaseorder.setting"}).state("supplier.sell.purchaseorder.add",{url:"/add",templateUrl:"assets/js/apps/supplier/templates/purchaseorder/purchaseorder.add.html",controller:"purchaseorder.add"}).state("supplier.sell.purchaseorder.details",{url:"/details/:order_sn",templateUrl:"assets/js/apps/supplier/templates/purchaseorder/purchaseorder.list.details.html",controller:"purchaseorder.list.details",resolve:{deliveryLoader:["deliveryLoader",function(e){return e()}]}})}])}),define("apps/supplier/states/auction",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.auction",{abstract:!0,url:"/auction",templateUrl:"assets/js/apps/supplier/templates/layout_goods.html"}).state("supplier.auction.list",{url:"",templateUrl:"assets/js/apps/supplier/templates/goods/auction.html",controller:"supplier.auction"}).state("supplier.auction.edit",{url:"/:original_id/step/:step",templateUrl:"assets/js/apps/supplier/templates/goods/form.html",controller:"supplier.auction.form"}).state("supplier.auction.comments",{url:"/add",templateUrl:"assets/js/apps/goods/templates/comments.add.html",controller:"shop.goods.auction.comments.add"}).state("supplier.auction.commentsedit",{url:"/edit",templateUrl:"assets/js/apps/goods/templates/comments.edit.html",controller:"shop.goods.auction.comments.edit"})}])}),define("apps/supplier/states/forsale",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.forsale",{abstract:!0,url:"/forsale",templateUrl:"assets/js/apps/supplier/templates/layout_goods.html"}).state("supplier.forsale.list",{url:"",templateUrl:"assets/js/apps/supplier/templates/goods/forsale.html",controller:"supplier.forsale"})}])}),define("apps/supplier/states/soldout",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.soldout",{abstract:!0,url:"/soldout",templateUrl:"assets/js/apps/supplier/templates/layout_goods.html"}).state("supplier.soldout.list",{url:"",templateUrl:"assets/js/apps/supplier/templates/goods/soldout.html",controller:"supplier.soldout"})}])}),define("apps/supplier/states/apply",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell.apply",{abstract:!0,url:"/apply",template:"<div ui-view></div>"}).state("supplier.sell.apply.list",{url:"",templateUrl:"assets/js/apps/supplier/templates/apply/apply.html",controller:"supplier.sell.apply"}).state("supplier.sell.apply.add",{url:"/add",templateUrl:"assets/js/apps/supplier/templates/apply/apply.add.html",controller:"supplier.sell.apply.add"})}])}),define("apps/supplier/states/goodslog",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.goodslog",{abstract:!0,url:"/goodslog",templateUrl:"assets/js/apps/supplier/templates/layout_goods.html"}).state("supplier.goodslog.list",{url:"",templateUrl:"assets/js/apps/supplier/templates/goodslog.html",controller:"supplier.goodslog"})}])}),define("apps/supplier/states/record",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("supplier.sell.record",{abstract:!0,url:"/record",template:"<div ui-view></div>"}).state("supplier.sell.record.list",{url:"/list/:type",templateUrl:"assets/js/apps/supplier/templates/record/record.html",controller:"supplier.sell.record"})}])}),define("apps/supplier/states/_base",["apps/supplier/states/main","apps/supplier/states/dashboard","apps/supplier/states/rank","apps/supplier/states/suppliers","apps/supplier/states/withdraw","apps/supplier/states/purchaseorder","apps/supplier/states/auction","apps/supplier/states/forsale","apps/supplier/states/soldout","apps/supplier/states/apply","apps/supplier/states/goodslog","apps/supplier/states/record"],function(){}),define("apps/supplier/services/dashboard",["apps/common/services/services"],function(e){e.factory("supplierDashboardResource",["$resource",function(e){return e("/suppliers/supplierGeneral.json",{},{get:{method:"GET"}})}]),e.factory("sincomeResource",["$resource",function(e){return e("/suppliers/suppliers/0.json",{},{update:{method:"PUT"}})}]),e.factory("incomeGraphResource",["$resource",function(e){return e("/suppliers/trade/day.json",{},{update:{method:"PUT"},query:{method:"GET",isArray:!0}})}]),e.factory("purchaseGraphResource",["$resource",function(e){return e("/suppliers/order/day.json",{},{update:{method:"PUT"},query:{method:"GET",isArray:!0}})}])}),define("apps/supplier/services/suppliers",["apps/common/services/services"],function(e){e.factory("suppliersResource",["$resource",function(e){return e("/suppliers/suppliers/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT"},save:{method:"post"}})}]),e.factory("suppliersResourceLoder",["suppliersResource","$q",function(e,t){return function(a){var o=t.defer();return e.get({id:a.id},function(e){o.resolve(e)}),o.promise}}]),e.factory("suppliersPasswordResource",["$resource",function(e){return e("/suppliers/suppliers_resetPass/:id.json",{id:"@id"},{setPassword:{method:"PUT"}})}]),e.factory("suppliersGoodsLineResource",["$resource",function(e){return e("/suppliers/supplier_goods_line.json",{},{get:{method:"GET"}})}]),e.factory("suppliersMaxCagentResource",["$resource",function(e){return e("/suppliers/check_max_cagent.json",{},{get:{method:"GET"}})}])}),define("apps/supplier/services/withdraw",["apps/common/services/services"],function(e){e.factory("accountResource",["$resource",function(e){return e("/suppliers/suppliers_cash.json",{id:"@id"},{get:{method:"GET",url:"/suppliers/suppliers_cash.json",isArray:!1}})}]),e.factory("accountDetailsResource",["$resource",function(e){return e("/bank.json",{},{get:{method:"GET",isArray:!0}})}]),e.factory("manageResource",["$resource",function(e){return e("/bank.json",{},{get:{method:"GET",isArray:!0}})}])}),define("apps/supplier/services/purchaseorder",["apps/common/services/services"],function(e){e.factory("purchaseAddResource",["$resource",function(e){return e("/suppliers/supplier_order_temp.json",{},{add:{method:"post"}})}]),e.factory("payOKResource",["$resource",function(e){return e("/suppliers/supplier_order_temp.json",{},{add:{method:"post"}})}]),e.factory("goodSkuDetailsResource",["$resource",function(e){return e("/suppliers/get_goods_sku_cg/:goods_id.json",{},{get:{method:"GET"}})}]),e.factory("goodSkuDetailscgResource",["$resource",function(e){return e("/suppliers/get_goods_sku_cg/:goods_id/:from_supplier_id.json",{},{get:{method:"GET"}})}]),e.factory("manageResource",["$resource",function(e){return e("/bank.json",{},{get:{method:"GET",isArray:!0}})}]),e.factory("supplierLineGoodsPurchasesResource",["$resource",function(e){return e("/suppliers/purchases.json",{},{getlist:{method:"GET"}})}]),e.factory("purchaseListResource",["$resource",function(e){return e("/suppliers/supplier_orders.json",{get:{method:"GET",isArray:!0}})}]),e.factory("purchaseDetailResource",["$resource",function(e){return e("/suppliers/order/:order_sn.json",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT"},save:{method:"post"}})}]),e.factory("applyDeliveryResource",["$resource",function(e){return e("/suppliers/post_refund_goods.json",{},{add:{method:"post"}})}]),e.factory("cancelRefundApplyResource",["$resource",function(e){return e("/suppliers/put_cancel_refund.json",{},{update:{method:"put"}})}]),e.factory("getRefundAmountResource",["$resource",function(e){return e("/suppliers/get_refund_amount.json",{},{get:{method:"GET",isArray:!1}})}]),e.factory("applyRefundResource",["$resource",function(e){return e("/suppliers/post_refund.json",{},{add:{method:"post"}})}]),e.factory("confirmGoodsResource",["$resource",function(e){return e("/suppliers/post_delivery.json",{},{update:{method:"post"}})}]),e.factory("orderPayResource",["$resource",function(e){return e("/cashier_supplier.json",{},{pay:{method:"post"}})}])}),define("apps/supplier/services/goods",["apps/common/services/services"],function(e){e.factory("sgoodsResource",["$resource",function(e){return e("suppliers/supplierGoods.json",{original_id:"@id"},{get:{method:"GET",url:"suppliers/goods_stat/:original_id.json"},query:{method:"GET",url:"suppliers/supplierGoods.json"},update:{method:"PUT",url:"suppliers/goods_stat/:original_id.json"},delete:{method:"DELETE",url:"suppliers/goods/:original_id.json"},onSale:{method:"PUT",url:"suppliers/goods/sale/:original_id.json"},batchDelete:{method:"DELETE",url:"suppliers/goods/batch.json"},batchToggleSale:{method:"PUT",url:"suppliers/goods/batch_upper_shelve.json"},batchTag:{method:"PUT",url:"suppliers/goods/batch_tag.json"},batchRegion:{method:"PUT",url:"suppliers/goods/batch_region.json"},batchDesignGoods:{method:"PUT",url:"suppliers/goods/batch_design_goods.json"},batchDiscount:{method:"PUT",url:"suppliers/goods/batch_discount.json"},editField:{method:"PUT",url:"suppliers/goods/field/:original_id.json"},editProductField:{method:"PUT",url:"suppliers/goods/product_field/:original_id.json"},getProducts:{method:"GET",url:"suppliers/goods/products/:original_id.json"},getGuiderGoods:{method:"GET",url:"suppliers/goods_guider.json"},getQrcodeInfo:{method:"GET",url:"suppliers/goods/qrcode_info/:id.json"},goodsOnsale:{method:"GET",url:"suppliers/check_parent_goods_onsale/:id.json"}})}]),e.factory("sproductResource",["$resource",function(e){return e("suppliers/products.json",{original_id:"@original_id"},{get:{method:"GET",url:"suppliers/products/:original_id.json",isArray:!0},update:{method:"PUT",url:"suppliers/products/:original_id.json"}})}])}),define("apps/supplier/services/sku",["apps/common/services/services"],function(e){e.factory("skuResource",["$resource",function(e){return e("suppliers/products.json",{id:"@id"},{get:{method:"GET",url:"suppliers/products/:id.json",isArray:!0},update:{method:"PUT",url:"suppliers/products/:id.json"}})}])}),define("apps/supplier/services/apply",["apps/common/services/services"],function(e){e.factory("swithdrawResource",["$resource",function(e){return e("/suppliers/supplier_withdraw.json",{},{create:{url:"/suppliers/supplier_withdraw_add.json",method:"POST"}})}]),e.factory("sincomeResource",["$resource",function(e){return e("/suppliers/suppliers/0.json",{},{update:{method:"PUT"}})}])}),define("apps/supplier/services/record",["apps/common/services/services"],function(e){e.factory("srecordResource",["$resource",function(e){return e("/suppliers/getTrades.json",{},{update:{method:"PUT"}})}])}),define("apps/supplier/services/recharge",["apps/common/services/services"],function(e){e.factory("sRechargeResource",["$resource",function(e){return e("/suppliers/recharge.json",{},{update:{method:"POST",url:"/suppliers/recharge.json"}})}])}),define("apps/supplier/services/dispatct",["apps/common/services/services"],function(e){e.factory("dispatctResource",["$resource",function(e){return e("/suppliers/offlinePurchases.json",{},{getlist:{method:"GET"}})}])}),define("apps/supplier/services/_base",["apps/supplier/services/dashboard","apps/supplier/services/suppliers","apps/supplier/services/withdraw","apps/supplier/services/purchaseorder","apps/supplier/services/goods","apps/supplier/services/sku","apps/supplier/services/apply","apps/supplier/services/record","apps/supplier/services/recharge","apps/supplier/services/dispatct"],function(){}),define("apps/supplier/controllers/dashboard.purchase",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("dashboard.purchase",["$scope","purchaseGraphResource","supplierDashboardResource",function(e,a,o){var s=t.init(document.getElementById("purchase-chart")),n=[],r=[],i=[],c=[],l={tooltip:{trigger:"axis"},legend:{data:["总订单","已成功","已发货"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:n}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"总订单",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:r},{name:"已成功",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:i},{name:"已发货",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:c}]};a.query(function(e){angular.forEach(e,function(e,t){n.push(e.date),r.push(e.trade_count),c.push(e.c_send_num),i.push(e.c_success_num)}),s.setOption(l)}),o.get(function(t){e.data=t})}])}),define("apps/supplier/controllers/dashboard.supplier",["apps/common/controllers/controllers","echarts"],function(e,t){e.controller("dashboard.supplier",["$scope","Flash","$modal","$filter","supplierDashboardResource",function(e,a,o,s,n){var r=t.init(document.getElementById("suppliers-chart"));n.get(function(t){e.data=t;var a=[],o=[];angular.forEach(t.agent,function(e,t){a.push(e.company_name),o.push(e.supplier_amount)});var s={title:{subtext:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",splitLine:{show:!1},data:a}],yAxis:[{type:"value"}],series:[{name:"供货额",type:"bar",stack:"总量",itemStyle:{normal:{label:{show:!0,position:"inside"}}},data:o}]};r.setOption(s)})}])}),define("apps/supplier/controllers/dashboard.income",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("dashboard.income",["$scope","incomeGraphResource","sincomeResource","Flash","$modal","ngPopover",function(e,a,o,s,n,r){var i=t.init(document.getElementById("chart")),c=[],l=[],d={tooltip:{trigger:"axis"},legend:{data:["收入总额"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:c}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"收入总额",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:l}]};a.query().$promise.then(function(e){angular.forEach(e,function(e,t){c.push(e.date),l.push(e.supplier_amount)}),i.setOption(d)}),o.get(function(t){e.income=t}),e.cancel=function(){r.close(),e.remarkInfo={id:"",text:""}},e.rechargeInfo={money:""},e.setRecharge=function(){var t=parseFloat(e.rechargeInfo.money),a=!1;if(""==e.rechargeInfo.money)s.create("danger","请填写充值金额");else{var o=/^\d+(\.\d+)?$/;if(o.test(e.rechargeInfo.money))if(t>0){var i=e.rechargeInfo.money.indexOf("."),c=0;i>0?(c=e.rechargeInfo.money.split(".")[1].length,c>2&&s.create("danger","充值金额只能包含两位小数,并且大于0"),e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),t=parseFloat(e.rechargeInfo.money),a=t>0):i==-1?(e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),a=!0):(s.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00")}else s.create("danger","输入的金额不能为0"),e.rechargeInfo.money="0.00";else s.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00",a=!1}if(a){r.close();var l=n.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/recharge.code.html",controller:"supplierSetRechargeCon",backdrop:!1,resolve:{data:function(){return e.rechargeInfo.money}}});l.result.then(function(e){})}}}]).controller("supplierSetRechargeCon",["$scope","$modalInstance","sRechargeResource","data","Flash","$location",function(e,t,a,o,s,n){e.IsSuccess={type:1},a.update({amount:o},function(t){t.success&&(e.rechargeInfo=t.data)}),e.paySuccess=function(){window.location.reload(),e.cancel()},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){window.location.reload(),e.cancel()}}])}),define("apps/supplier/controllers/suppliers.list",["apps/common/controllers/controllers"],function(e){e.controller("supplier.suppliers.list",["$scope","ngPopover","$resource","suppliersResource","rankResource","Flash","$stateParams","$state","suppliersPasswordResource","$location",function(e,t,a,o,s,n,r,i,c,l){e.enable="all",e.level="all"==r.level?"all":parseInt(r.level),e._global=_global;var d=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,enable:e.enable,shop_name:e.shop_name,level:e.level},function(t){e.paginationConf.totalItems=t._count,e.data=t.data}),s.query({offset:(t.offset-1)*t.limit,limit:t.limit,search_level:!0},function(t){e.levelData=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.passwordInfo={password:"",id:"",user_id:"",merchant_id:""},e.set_passwordClick=function(t){e.passwordInfo.id=t.merchant_id,e.passwordInfo.user_id=t.user_id,e.passwordInfo.merchant_id=t.merchant_id},e.set_password=function(){e.passwordInfo.password?c.setPassword(e.passwordInfo,function(e){e.status?(n.create("success","修改成功"),t.close()):n.create("danger","修改失败")}):n.create("danger","请填写新密码")},e.cancel=function(){t.close()},e.over=function(t,a){1==a.enabled?a.enabled=0:a.enabled=1,o.update({id:a.id},{enabled:a.enabled},function(t){t.success&&(n.create("success"," 保存成功！"),e.btn_text="保存"),t.error&&n.create("danger",t.error.message)},function(t){e.btn_text="保存",n.create("danger",t.data.error)})},e.showQrcode=function(t){e.qrcodeInfo=t},e.goDispatct=function(e,t){l.path("/supplier/sell/suppliers/dispatcts/"+e+"/"+encodeURI(t))}}])}),define("apps/supplier/controllers/suppliers.info",["apps/common/controllers/controllers"],function(e){e.controller("supplier.suppliers.info",["$scope","suppliersResource","suppliersMaxCagentResource","$stateParams","Flash","$state","rankResource","suppliersResourceLoder","suppliersGoodsLineResource",function(e,t,a,o,s,n,r,i,c){if(e.items={},o.id){e.isEdit=!0;var l=e.city=this;e.title="编辑经销商",e.data=i,a.get(function(t){t.status?1==t.is_cj?e.mcagent=t.mcagent:e.mcagent=t.mcagent+e.data.max_cagent:s.create("danger","接口请求超时!")}),c.get({enable:1},function(t){e.GoodsLineData=t.data}),l.regions={country:e.data.country,province:e.data.province,city:e.data.city,district:e.data.district},l.start="country",l.end="district",e.items={selected_city:[{id:e.data.country},{id:e.data.province},{id:e.data.city},{id:e.data.district}],address:e.data.address}}else{a.get(function(t){t.status?0==t.mcagent?e.mcagent=t.mcagent:e.mcagent=t.mcagent-1:s.create("danger","接口请求超时!")}),e.title="新增经销商",e.isEdit=!1;var l=e.city=this;l.regions={country:1},l.start="country",l.end="district",r.get({is_limit_level:!0},function(t){e.data={has_shop:0,receive_money:0,goods_deliver:0,level_discount:100,add_agent:1,design_feature_copy:0},t.data[0]&&(e.data.level=t.data[0].level),e.levelData=t.data}),c.get({enable:1},function(t){e.GoodsLineData=t.data})}e.$watch("city",function(t){angular.isUndefined(t.selected)||(t.selected.length>2&&(e.cityname=t.selected[1].name),e.items.selected_city=t.selected)},!0),e.submitForm=function(a){if(a){if(!(e.items.selected_city[0]&&e.items.selected_city[1]&&e.items.selected_city[2]&&e.items.selected_city[3]&&e.items.selected_city[0].id&&e.items.selected_city[1].id&&e.items.selected_city[2].id&&e.items.selected_city[3].id))return void s.create("danger","请填写完整的所属区域!");if(e.form.$invalid=!0,e.data.country=e.items.selected_city[0].id,e.data.province=e.items.selected_city[1].id,e.data.city=e.items.selected_city[2].id,e.data.district=e.items.selected_city[3].id,e.data.address=e.items.address,o.id){if(1==e.data.add_agent){if(e.data.max_cagent>e.mcagent)return void s.create("danger","输入可开店铺数不可大于最大可开店铺数!");if(e.data.max_cagent<e.data.cagent)return void s.create("danger","输入可开店铺数不可小于已开店铺数!");if(""==e.data.max_cagent)return void s.create("danger","请输入可开店铺数!")}}else if(1==e.data.add_agent){if(e.data.max_cagent>e.mcagent)return void s.create("danger","输入可开店铺数不可大于最大可开店铺数!");if(""==e.data.max_cagent)return void s.create("danger","请输入可开店铺数!")}o.id||(e.data.username=document.getElementById("username").value),o.id?t.update({id:o.id},e.data,function(t){t.status?(s.create("success"," 保存成功！"),e.btn_text="保存",n.go("supplier.sell.suppliers.list",{level:"all"})):s.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)}):t.save(e.data,function(t){t.status?(s.create("success"," 保存成功！"),e.btn_text="保存",n.go("supplier.sell.suppliers.list",{level:"all"})):s.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)})}}}])}),define("apps/supplier/controllers/purchaseorder.list",["apps/common/controllers/controllers"],function(e){e.controller("purchaseorder.list",["$scope","Flash","$modal","$filter","purchaseListResource","rankResource","ngPopover",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,consignee:"",status:"all",order_sn:""};var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.order_status=t.order_status})};e.search=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.upOrder=function(e){var t=a.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/supplier_offline_order.html",controller:"supplierofflineOrderModalCtrl"});t.order_id=e,t.result.then(function(e){})}}])}),define("apps/supplier/controllers/purchaseorder.list.details",["apps/common/controllers/controllers"],function(e){e.controller("purchaseorder.list.details",["$scope","order","saveDeliver","reviseprice","orderpick","$resource","$stateParams","$modal","$http","Flash","deliveryLoader","cancelRefundApplyResource","confirmGoodsResource","orderPayResource","orderQureyPay",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m,g){function f(){v.get({id:r.order_sn},function(t){e.orderdetail=t,h(t.status,t.is_selffetch_type,t.payment_code),_()})}function h(t,a,o){switch(0==a&&("cod"==o?e.orderType=2:e.orderType=1),1==a&&("cod"==o?e.orderType=4:e.orderType=3),t){case 10:e.orderStatus={title:"订单关闭",text:"自动过期;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"自动过期"};break;case 11:e.orderStatus={title:"订单关闭",text:"买家取消订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"买家取消订单"};break;case 12:e.orderStatus={title:"订单关闭",text:"订单关闭原因："+e.orderdetail.explain,style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"商家关闭订单"};break;case 13:e.orderStatus={title:"订单关闭",text:"维权完成关闭订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"维权完成关闭订单"};break;case 20:e.orderStatus={title:"待付款",text:"",style:"success",icon:"fa-clock-o",statusInfo:"待付款"};break;case 30:e.orderStatus={title:"待发货",text:"等待卖家发货，买家可选择申请退款;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"};break;case 31:e.orderStatus={title:"货到付款 待发货",text:"买家选择了货到付款，等待卖家发货;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"};break;case 32:e.orderStatus={title:"针对上门自提，待取货",text:"已选择上门自提，请尽快上门自提;",style:"success",icon:"fa-clock-o",statusInfo:"待买家上门自提"};break;case 40:e.orderStatus={title:"商家发货 买家待收货",text:"买家如在 发货后7天内 没有申请退款，交易将自动完成；",style:"success",icon:"fa-clock-o",statusInfo:"待收货"};break;case 50:e.orderStatus={title:"已完成",text:"交易成功",style:"success",icon:"fa-check-circle-o",statusInfo:"已完成"}}}function _(){if(""!==e.orderdetail.finished_at&&"0000-00-00 00:00:00"!==e.orderdetail.finished_at){var t=new Date(e.orderdetail.finished_at).getTime()+6048e5,a=(new Date).getTime();t<a&&(e.isIn7days=!1)}}e.toPayBtn=!1;var v=n("/suppliers/order/:id.json",{id:"@id"},{});f(),e.isIn7days=!0,e.over=function(t,a){p.update({id:t},function(t){t.status?(l.create("success","撤销成功"),e.orderdetail=t.order_detail):l.create("danger",t.message)})},e.saveDelivery=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/purchaseorder/refund.delivery.html",controller:"apply_express",resolve:{data:function(){return e},refund_id:function(){return t},deliveryLoader:function(){return d}}});a.result.then(function(e){window.location.reload()})},e.refund_log=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/purchaseorder/refund_record.html",controller:"refund_log",resolve:{data:function(){return e}}});t.result.then(function(e){window.location.reload()})},e.apply_refund=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/purchaseorder/apply_refund.html",controller:"reundApplyModalCtrl",resolve:{data:function(){return{data:e,type:t}}}});a.result.then(function(e){f()})},e.confirm_goods=function(){u.update({order_id:e.orderdetail.id},function(t){t.status?(l.create("success","确认收货成功"),e.orderdetail=t.order_detail,h(t.order_detail.status,t.order_detail.is_selffetch_type,t.order_detail.payment_code)):l.create("danger",t.message)})},e.pay=function(t){e.toPayBtn=!0,m.pay({order_id:t},function(e){e.status?(l.create("success","付款成功"),f()):l.create("danger",e.msg)})},e.expressSet=function(t,a,o){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},g.save(e.orderQureyData,function(e){if(e.status){i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return o}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})}}]),e.controller("apply_express",["$scope","$modalInstance","data","Flash","deliveryLoader","applyDeliveryResource","refund_id",function(e,t,a,o,s,n,r){e.modalData=a,e.deliveryList=s.data,e.deliveryInfo={type:0,isOther:0,id:"",name:"",otherName:"",code:"",number:""},e.set_delivery=function(t,a,o,s){e.deliveryInfo.isOther=t,e.deliveryInfo.otherName=o,0==t?(e.deliveryInfo.id=a,e.deliveryInfo.name=o,e.deliveryInfo.code=s):(e.deliveryInfo.id="",e.deliveryInfo.name="",e.deliveryInfo.code="")},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){n.add({refund_id:r,delivery:e.deliveryInfo.code,waybill_num:e.deliveryInfo.number},function(e){e.status?(o.create("success","提交成功"),t.close(!0)):o.create("danger",e.message)})}}]),e.controller("refund_log",["$scope","$modalInstance","data",function(e,t,a){e.modalData=a,e._global=_global,e.cancel=function(){t.dismiss("cancel")},e.ok=function(){t.dismiss("cancel")}}]),e.controller("reundApplyModalCtrl",["$scope","$stateParams","Flash","$state","$modal","$modalInstance","data","getRefundAmountResource","applyRefundResource",function(e,t,a,o,s,n,r,i,c){e.goodData=r.data,e.type=r.type,e.applyData={type:0,reason:"",refund_quantity:e.goodData.quantity,amount:e.goodData.price*e.goodData.quantity,max_amount:e.goodData.price*e.goodData.quantity,memo:""},e.refundReasonList=[{id:0,reason:"买/卖双方协商一致"},{id:1,reason:"买错/不想要"},{id:2,reason:"商品质量问题"},{id:3,reason:"未收到货"},{id:4,reason:"其他"}],e.cancel=function(){n.dismiss("cancel")},e.$watch("applyData.refund_quantity",function(t){i.get({package_id:"undefined"==typeof e.goodData.package_id?0:e.goodData.package_id,order_goods_id:e.goodData.order_goods_id,goods_id:e.goodData.goods_id,product_id:e.goodData.product_id,order_id:e.goodData.order_id,quantity:t},function(t){t.status&&(e.applyData.max_amount=t.can_refund_amount)})},!0),e.chooseReason=function(t,a){e.applyData.reason=t,e.applyData.reasonText=a},e.ok=function(){return""===e.applyData.reason||null==e.applyData.reason?void a.create("danger","请选择退款原因"):(e.applyData.id=e.goodData.order_goods_id,e.applyData.package_id="undefined"==typeof e.goodData.package_id?0:e.goodData.package_id,void c.add(e.applyData,function(e){e.status?(a.create("success","提交成功"),n.close({order_detail:e.order_detail})):a.create("danger",e.msg)}))}}])}),define("apps/supplier/controllers/purchaseorder.setting",["apps/common/controllers/controllers"],function(e){e.controller("purchaseorder.setting",["$scope","suppliersResource","$stateParams","Flash",function(e,t,a,o){e.data=t.query({id:0}),e.btn_text="保存",e.submitForm=function(a){a&&(e.btn_text="保存中...",e.data.id=_global.shop.supplier_id,e.data.is_cur_supplier=!0,t.update(e.data,function(t){t.status?(e.btn_text="保存",o.create("success"," 保存成功！")):(e.btn_text="保存",
o.create("danger",t.msg))},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.msg)}))}}])}),define("apps/supplier/controllers/purchaseorder.add",["apps/common/controllers/controllers"],function(e){e.controller("purchaseorder.add",["$scope","suppliersResource","$stateParams","Flash","$state","purchaseAddResource","$modal",function(e,t,a,o,s,n,r){e.title="采购申请",e.items={},e.data={goods_amount:0};var i=e.city=this;i.regions={country:1},i.start="country",i.end="district",e.$watch("city",function(t){angular.isUndefined(t.selected)||(t.selected.length>2&&(e.cityname=t.selected[1].name),e.items.selected_city=t.selected)},!0),e.sortableOptions={cursor:"move",zIndex:8e3,axis:"x"},e.removeGoodsItem=function(t,a){if(e.goods.splice(a,1),l[t.goods_id]=l[t.goods_id]-1,t.prop){var o=c.indexOf(t.prop);c.splice(o,1)}},e.goods=[];var c=[],l=[];e.add_goods=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/purchaseorder/goods_list.html",controller:"chooseGoodsModalCtrl"});t.selectedGoodAll=e.goods,t.selectedGoodProp=c,t.chooseGoodArr=l,t.result.then(function(t){e.goods=t.selectedGood,c=t.selectedGood_prop,l=t.chooseGoodArr})},e.$watch("goods",function(){var t=0;angular.forEach(e.goods,function(e){t+=e.price*e.quantity}),e.data.goods_amount=t.toFixed(2)},!0),e.submitForm=function(t){if(t){if(e.goods.length<=0)return void o.create("danger"," 请选择采购商品！");if(!(e.items.selected_city[0]&&e.items.selected_city[1]&&e.items.selected_city[2]&&e.items.selected_city[3]))return void o.create("danger"," 请选择具体的收货地址！");angular.forEach(e.goods,function(e,t){if(!e.stock)return void o.create("danger","选择的商品存在库存为0的商品，请先删除库存为0的商品")});var a=/^[0-9]\d{5}$/;if(!a.test(e.data.zipcode))return void o.create("danger","请填写正确的邮政编码");e.form.$invalid=!0,e.data.country=e.items.selected_city[0].id,e.data.province=e.items.selected_city[1].id,e.data.city=e.items.selected_city[2].id,e.data.district=e.items.selected_city[3].id,e.data.country_name=e.items.selected_city[0].name,e.data.province_name=e.items.selected_city[1].name,e.data.city_name=e.items.selected_city[2].name,e.data.district_name=e.items.selected_city[3].name,e.data.address=e.items.address,e.data.goods=e.goods,n.add(e.data,function(t){if(t.status){e.btn_text="保存";var a=r.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/purchaseorder/payment.html",controller:"paymentModalCtrl"});a.data=t,a.result.then(function(e){})}else o.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.msg)})}}}]).controller("paymentModalCtrl",["$scope","payOKResource","$stateParams","Flash","$state","$modal","$modalInstance",function(e,t,a,o,s,n,r){e.data=r.data,e.ok=function(){r.close(),s.go("supplier.sell.purchaseorder.list")},e.cancel=function(){r.close()}}])}),define("apps/supplier/controllers/goods.list",["apps/common/controllers/controllers"],function(e){e.controller("chooseGoodsModalCtrl",["$scope","$modalInstance","supplierLineGoodsPurchasesResource","tagResource","Flash","$modal","goodSkuDetailsResource",function(e,t,a,o,s,n,r){e._global=_global,e.goods=[],e.selectedGood=t.selectedGoodAll,e.selectedGood_prop=t.selectedGoodProp;var i=t.chooseGoodArr,c=0;e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,goods_title:""};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.getlist(e.params,function(t){$(".js-search-btn").removeClass("disabled"),e.paginationConf.totalItems=t._count,e.goods=t.data,angular.forEach(e.goods,function(e){e.selectedCount=i[e.goods_id]?i[e.goods_id]:0,e.chooseclick=!1})})};e.search=function(){$(".js-search-btn").hasClass("disabled")||($(".js-search-btn").addClass("disabled"),l())},e.choose=function(t,a){if(!t.stock)return void s.create("danger"," 该商品没有库存没有了，请采购其他商品！");var o=function(a){e.selectedGood.push({goods_id:t.goods_id,goods_title:t.title,img:t.img,price:"undefined"!=typeof a.price?a.price:t.price,stock:"undefined"!=typeof a.stock?a.stock:t.stock,quantity:1,prop:"undefined"!=typeof a.prop?a.prop:"",product_id:"undefined"!=typeof a.product_id?a.product_id:"",product_sn:"undefined"!=typeof a.product_sn?a.product_sn:"",props_str:"undefined"!=typeof a.props_str?a.props_str:"无",allstock:"undefined"!=typeof a.allstock?a.allstock:t.stock})};if(e.goods[c].chooseclick=!1,c=a,t.is_sku){r.get({goods_id:t.goods_id},function(a){e.goodsku=a.data,t.chooseclick=!0,e.goodsku.skuSelectCount=0,e.bSkuSelectCount=!1,angular.forEach(e.goodsku.props,function(e){e.choose=!1,angular.forEach(e.gps,function(e){e.choose=!1})})});var n=[];e.chooseSku=function(t,a){1==t.choose?(t.choose=!1,e.goodsku.props[a].choose=!1,e.goodsku.skuSelectCount--,n[a]=""):(angular.forEach(e.goodsku.props[a].gps,function(e){e.choose=!1}),n[a]=e.goodsku.props[a].id+":"+t.id,t.choose=!0,0==e.goodsku.props[a].choose&&e.goodsku.skuSelectCount++,e.goodsku.props[a].choose=!0),e.bSkuSelectCount=e.goodsku.skuSelectCount==e.goodsku.props.length},e.chooseOk=function(t){var a="",r=n.length;angular.forEach(n,function(e,t){a+=t==r-1?e:e+";"});var c=function(t){for(var a=0;a<e.goodsku.products.length;a++)if(e.goodsku.products[a].props==t){var o={product_id:e.goodsku.products[a].id,product_sn:e.goodsku.products[a].product_sn,props_str:e.goodsku.products[a].props_str,stock:e.goodsku.products[a].stock,price:e.goodsku.products[a].price,prop:e.goodsku.products[a].props,allstock:e.goodsku.products[a].stock};return o}};if(0==e.selectedGood_prop.length)e.selectedGood_prop.push(a),t.selectedCount++,i[t.goods_id]=t.selectedCount,o(c(a));else{var l=!1;angular.forEach(e.selectedGood,function(e){c(a).product_id==e.product_id&&(l=!0)}),l?s.create("danger"," 您已选择过该规格组合！"):(e.selectedGood_prop.push(a),t.selectedCount++,i[t.goods_id]=t.selectedCount,o(c(a)))}n=[],e.bSkuSelectCount=!1,e.goodsku.skuSelectCount=0,angular.forEach(e.goodsku.props,function(e){e.choose=!1,angular.forEach(e.gps,function(e){e.choose=!1})})}}else{var l=!1;angular.forEach(e.selectedGood,function(e){e.goods_id==t.goods_id&&(l=!0)}),l?s.create("danger"," 您已选择过商品！"):(t.selectedCount++,i[t.goods_id]=t.selectedCount,o({allstock:t.stock}))}},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",l()},e.ok=function(){angular.isUndefined(e.selectedGood)?t.dismiss("cancel"):t.close({selectedGood:e.selectedGood,selectedGood_prop:e.selectedGood_prop,chooseGoodArr:i})},e.cancel=function(){t.close({selectedGood:e.selectedGood,selectedGood_prop:e.selectedGood_prop,chooseGoodArr:i})}}])}),define("apps/supplier/controllers/auction",["apps/common/controllers/controllers"],function(e){e.controller("supplier.auction",["$scope","$filter","ngPopover","Flash","sgoodsResource","tagResource","$modal","cityData","lineResource",function(e,t,a,o,s,n,r,i,c){function l(){c.getlist({enable:1},function(t){e.goods_lines=t.data})}e.item=!1,e.goods_line_id="all",e.toggle=function(t){e.item=!t},e.save=function(){a.close()},e.cancel=function(){a.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),d()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?(o.create("success",e.msg),d()):o.create("danger",e.msg)})},e.confirmBatchDelete=function(){s.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(d(),o.create("success",t.msg),e.goods.checkedAll=!1):o.create("danger",t.msg)})},e.confirmBatchOffSale=function(){s.batchToggleSale({ids:e.selectedIds,sale:0},function(t){t.success?(o.create("success","下架成功"),d(),e.goods.checkedAll=!1):o.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){s.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),a.close(),o.create("success","分组成功")):o.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){s.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","区域设置成功")):o.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){s.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.original_id}):e.selectedIds=[]});var d=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.goods_line_id=e.goods_line_id,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),s.query(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",goods_sn:"",sale:1,column:"created_at",direction:"desc"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.setArea=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"},region_id:function(){}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/goods_tpl.html",controller:"distributor.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductJuniorPrice=function(e,t){var a=r.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/goods/junior_price_tpl.html",controller:"supplier.auction.juniorPrice.tpl",resolve:{goodsId:function(){return e},num:function(){return t}}});a.result.then(function(){d()})},e.setProductStock=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/goods/stock_tpl.html",controller:"supplier.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){d()})},e.showQrcode=function(t){s.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},l()}])}),define("apps/supplier/controllers/forsale",["apps/common/controllers/controllers"],function(e){e.controller("supplier.forsale",["$scope","$filter","$state","ngPopover","Flash","sgoodsResource","dtagResource","$modal","cityData","lineResource",function(e,t,a,o,s,n,r,i,c,l){e.item=!1,e.goods_line_id="all",e.toggle=function(t){e.item=!t},e.save=function(){o.close()},e.cancel=function(){o.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var o={id:a};o[e]=t,n.editField(o,function(e){e.success||s.create("danger",e.error)})},e.goods={checkedAll:!1},e.tab=0,e.selectedIds=[],e.Ids=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",goods_sn:"",goods_line_id:e.goods_line_id,sale:0,column:"created_at",direction:"desc"},e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),d()},e.confirmDelete=function(e){n.delete({id:e},function(e){e.success?(d(),s.create("success","删除成功")):s.create("danger","删除失败")})},e.confirmOnSale=function(t,a){e.Ids.push(t),n.batchToggleSale({ids:e.Ids,sale:1,supplier_level:a},function(e){e.success?(s.create("success","上架成功"),d()):s.create("danger",e.error)})},e.confirmBatchDelete=function(){n.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(s.create("success","删除成功"),d(),e.goods.checkedAll=!1):s.create("danger","删除失败")})},e.confirmBatchOnSale=function(t){n.batchToggleSale({ids:e.selectedIds,sale:1,supplier_level:t},function(t){t.success?(d(),s.create("success","上架成功"),e.goods.checkedAll=!1):s.create("danger",t.error)})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){n.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(d(),e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),o.close(),s.create("success","分组成功")):s.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){n.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","区域设置成功")):s.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){n.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","设置成功")):s.create("danger","设置失败")}),o.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.original_id}):e.selectedIds=[]}),e.toggleTab=function(t){e.tab=t,1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1};var d=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),0==e.tab?(delete e.params.stock,delete e.params.onsale_type):1==e.tab?(delete e.params.onsale_type,e.params.stock=0):2==e.tab&&(delete e.params.stock,e.params.onsale_type=1),n.query(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.setArea=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/goods_tpl.html",controller:"distributor.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductJuniorPrice=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/goods/junior_price_tpl.html",controller:"supplier.auction.juniorPrice.tpl",resolve:{goodsId:function(){return e},num:function(){return t}}});a.result.then(function(){d()})},e.setProductStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){d()})},e.setProductEtid=function(e,t){n.goodsOnsale({id:e},function(e){e.success?a.go("supplier.auction.edit",{original_id:t,step:2}):s.create("danger",e.msg)})}}])}),define("apps/supplier/controllers/soldout",["apps/common/controllers/controllers"],function(e){e.controller("supplier.soldout",["$scope","$filter","ngPopover","Flash","sgoodsResource","merchantSettingResource","dtagResource","$modal","cityData","lineResource",function(e,t,a,o,s,n,r,i,c,l){function d(){n.get({},function(t){e.setting.warningStock=angular.isDefined(t.warning_stock)?t.warning_stock:10,e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",u)})}function p(){l.getlist({enable:1},function(t){e.goods_lines=t.data})}e.title="库存紧张商品",e.goods_line_id="all",e.setting={},e.setting.warningStock=10,e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",goods_sn:"",stock:e.setting.warningStock,sale:1,goods_line_id:e.goods_line_id,column:"created_at",direction:"desc"},e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),u()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?u():o.create("danger","删除失败")})},e.confirmBatchDelete=function(){s.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(u(),e.goods.checkedAll=!1):o.create("danger","删除失败")})},e.confirmBatchOffSale=function(){s.batchToggleSale({ids:e.selectedIds,sale:0},function(t){t.success?(u(),e.goods.checkedAll=!1):o.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){s.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),a.close(),o.create("success","分组成功")):o.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){s.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","区域设置成功")):o.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){s.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.original_id}):e.selectedIds=[]}),e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var n={id:a};n[e]=t,s.editField(n,function(e){e.success||o.create("danger",e.error)})},e.save=function(){n.save({warning_stock:e.setting.warningStock},function(e){e.success?(u(),o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.cancel=function(){a.close()},d();var u=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),e.params.stock=e.setting.warningStock,s.query(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?u():e.paginationConf.currentPage=1},e.setArea=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/goods_tpl.html",controller:"distributor.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductJuniorPrice=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/goods/junior_price_tpl.html",controller:"supplier.auction.juniorPrice.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.setProductStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.showQrcode=function(t){s.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},p()}])}),define("apps/supplier/controllers/form",["apps/common/controllers/controllers"],function(controllers){controllers.controller("supplier.auction.form",["$location","$scope","$http","$stateParams","$compile","$state","Flash","ngPopover","GoodsData","shopServerData","dcatResource","dpropResource","dpropValueResource","dtagResource","dshipmentResource","sgoodsResource","designData","ddesignGoodsRes","lineResource","$timeout","designValidate",function($location,$scope,$http,$stateParams,$compile,$state,Flash,ngPopover,GoodsData,shopServerData,catResource,propResource,propValueResource,tagResource,shipmentResource,goodsResource,designData,designGoodsRes,lineResource,$timeout,designValidate){function getGoodslines(){lineResource.getlist({enable:1,limit:1e3},function(e){$scope.goods_lines=e.data,$scope.goods_lines.unshift($scope.defaultTag)})}var vm=$scope.vm={},step=$stateParams.step;vm.cates=[],vm.activeTab=step,$scope.isGetProp=!1,$http.get("/user/me.json").then(function(e){$scope.supplier_level=e.data.shop.supplier_level},function(e){});var shopServer=shopServerData.get();switch(shopServer.then(function(e){$scope.shopServerData=e}),vm.goodsData=GoodsData,angular.isDefined($stateParams.original_id)?(vm.is_edit=!!$stateParams.original_id,vm.goodsData.isStep||(angular.forEach(GoodsData.init(),function(e,t){vm.goodsData[t]=e}),goodsResource.get({original_id:$stateParams.original_id},function(e){vm.goodsData.cate[0]={},vm.goodsData.cate[0].data={},vm.goodsData.isCateSelect=!0,vm.goodsData.cate[0].data.id=e.goods_cat_id,vm.goodsData.cate[0].data.name=e.cat_name,$scope.isGetProp||$scope.getProp();for(var t in e.props){var a=e.props[t];0==a.type&&vm.goodsData.prop.push(a)}vm.goodsData.title=e.title,vm.goodsData.id=e.id,angular.forEach(e.imgs,function(e,t){vm.goodsData.imgs[t]={id:e.id,url:e.img}}),vm.goodsData.serve_label=e.serve_label,e.label_ids||(e.label_ids=[]),vm.goodsData.label_ids=e.label_ids;for(var o=0;o<e.label_ids.length;o++)for(var t=0;t<$scope.shopServerData.length;t++)e.label_ids[o]==$scope.shopServerData[t].id&&($scope.shopServerData[t].checked=!0);if(vm.goodsData.selectedGoodsTags=angular.copy(e.tags),vm.goodsData.goods_line_id=e.goods_line_id,vm.goodsData.is_sku=e.is_sku,vm.goodsData.is_discount=e.is_discount||0,vm.goodsData.goods_sn=e.goods_sn,vm.goodsData.barcode=e.barcode,vm.goodsData.original_id=e.original_id,vm.goodsData.supplier_goods_id=e.supplier_goods_id,vm.goodsData.parent_supplier_price=e.parent_supplier_price,e.is_sku){var s=e.products[0].props.split(";").length,n=[];vm.goodsData.skuStock[s]={},angular.forEach(e.products,function(e,t){var a=e.props;vm.goodsData.skuStock[s][a]={id:e.id,img:e.img,price:e.price,parent_supplier_price:e.parent_supplier_price,supplier_price:e.supplier_price,min_retail_price:e.min_retail_price,max_retail_price:e.max_retail_price,stock:e.stock,product_sn:e.product_sn,barcode:e.barcode,supplier_product_id:e.supplier_product_id},vm.goodsData.skuStock[s][a].str=e.porps_str;var o="";angular.forEach(a.split(";"),function(e,t){o+=e.split(":").join("")}),vm.goodsData.skuStock[s][a].sn=o,n.push(e.props)});var r=n.join(";")+";",i=[],c=$scope.$watch("vm.goodsData.skus",function(e,t){e.length>0&&c(),angular.forEach(vm.goodsData.skus,function(e,t){i=[],angular.forEach(e.prop_values,function(t,a){r.indexOf(e.id+":"+t.id+";")!=-1&&(t.checked=!0,i.push(t))}),i.length>0&&vm.goodsData.skuData.push(i)})},!0)}else vm.goodsData.price=e.price,vm.goodsData.supplier_price=e.supplier_price,vm.parent_supplier_price=e.parent_supplier_price,vm.goodsData.min_retail_price=e.min_retail_price,vm.goodsData.max_retail_price=e.max_retail_price,vm.goodsData.stock=e.stock;if(vm.goodsData.original_price=e.original_price,vm.goodsData.shipmentType=0!=e.shipment_id?1:0,vm.goodsData.shipmentType){var l=$scope.$watch("vm.goodsData.shipments",function(t,a){angular.forEach(t,function(t,a){t.id==e.shipment_id&&(vm.goodsData.shipment=t,l())})});vm.goodsData.weight=e.weight,vm.goodsData.volume=e.volume}else vm.goodsData.postage=e.postage;vm.goodsData.weight=e.weight,vm.goodsData.volume=e.volume,vm.goodsData.stockType=e.stock_type,angular.forEach(e.collect_fields,function(e,t){vm.goodsData.collect_fields.push({name:e.name,type:e.type,multiple:!!e.multiple,required:!!e.required})}),vm.goodsData.intro=e.intro,vm.goodsData.components_data=e.components_data,vm.goodsData.designGoodsTpl=e.design_goods_id,vm.goodsData.onsale_type=e.onsale_type,vm.goodsData.onsale_type&&(vm.goodsData.onsale_at=e.onsale_at),vm.goodsData.cquota=e.cquota,vm.goodsData.base_csale=e.base_csale},function(e){}))):vm.goodsData.isStep||angular.forEach(GoodsData.init(),function(e,t){vm.goodsData[t]=e}),vm.goodsData.isStep=!1,vm.click={addProp:!1,addPropValue:!1,addSku:!1,editSku:!1},vm.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],$scope.shopServerClick=function(e){var t=vm.goodsData.label_ids.indexOf(e.id);t>-1?(vm.goodsData.label_ids.splice(t,1),e.checked=!1):(vm.goodsData.label_ids.push(e.id),e.checked=!0)},$scope.ngPopoverClose=function(){ngPopover.close()},$scope.nextStep=function(e){switch(vm.goodsData.isStep=!0,e){case 1:angular.isUndefined($stateParams.original_id)?$state.go("distributor.add.step",{step:e}):Flash.create("danger","商品编辑暂不支持修改类目");break;case 2:$scope.saveValidity(1)?angular.isDefined($stateParams.original_id)?$state.go("supplier.auction.edit",{original_id:$stateParams.original_id,step:e}):$state.go("distributor.add.step",{step:e}):vm.goodsData.isStep=!1;break;case 3:$scope.saveValidity(2)?angular.isDefined($stateParams.original_id)?$state.go("supplier.auction.edit",{original_id:$stateParams.original_id,step:e}):$state.go("distributor.add.step",{step:e}):vm.goodsData.isStep=!1}},$scope.defaultTag={id:0,name:"所有商品线"},getGoodslines(),$scope.getProp=function(){$scope.isGetProp=!0,propResource.get({goods_cat_id:vm.goodsData.cate[vm.goodsData.cate.length-1].data.id},function(e,t){if(Object.keys(e).length>2)for(var a=0;a<Object.keys(e).length-2;a++)0==e[a].type||vm.goodsData.skus.push(e[a])})},$scope.showAdd=function(e){$(".input-"+e+"-name").val(""),vm.showValue[e]=!vm.showValue[e]},$scope.addProp=function(e){if(GoodsData.cate.length>0){var t=$.trim($("#input-addProp-name").val()),a=$.trim($("#input-addProp-value").val());""!=t?""!=a?(vm.click.addProp=!0,$(e.currentTarget).addClass("btn-submiting-sm"),propResource.save({name:t,input_value:a,goods_cat_id:GoodsData.cate[GoodsData.cate.length-1].data.id,type:0},function(t){Flash.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),t.inputValues=t.input_values,t.input_values=[],t.input_values.push(t.inputValues),GoodsData.prop.push(t),vm.goodsData.prop=GoodsData.prop,vm.goodsData.props[vm.goodsData.prop.length-1]=t.inputValues,vm.showValue.addProp=!1,vm.click.addProp=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addProp=!1})):Flash.create("warning","请填写属性值"):Flash.create("warning","请填写属性名称")}else Flash.create("warning","请先选择品类")},$scope.deleteProp=function(){vm.deletePropID?propResource.delete({id:vm.deletePropID},function(e){e.success?(Flash.create("success","删除成功"),vm.goodsData.prop.splice(vm.deletePropIndex,1),$scope.ngPopoverClose()):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","无法获取到属性ID")},$scope.addPropValue=function(e){var t=$.trim($("#input-addProp-name-pop").val());""!=t?vm.addPropValueID?($(e.currentTarget).addClass("btn-submiting-sm"),vm.click.addPropValue=!0,propValueResource.save({value:t,prop_id:vm.addPropValueID},function(e){vm.goodsData.prop[vm.addPropValueIndex].input_values.push(e),vm.goodsData.props[vm.addPropValueIndex]=e,$scope.ngPopoverClose(),vm.click.addPropValue=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addPropValue=!1})):Flash.create("warning","无法获取到属性ID"):Flash.create("warning","请填写属性值内容")},$scope.deletePropValue=function(e,t,a){t.stopPropagation(),propValueResource.delete({id:e},function(t){t.success?angular.forEach(vm.goodsData.prop,function(t,o){if(t.id==a)return angular.forEach(t.input_values,function(t,a){if(t.id==e)return vm.goodsData.prop[o].input_values.splice(a,1),"undefined"!=typeof vm.goodsData.props[o]&&vm.goodsData.props[o].id==e&&delete vm.goodsData.props[o],!1}),!1}):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)})},$scope.getTags=function(){tagResource.get({},function(e){e._count>0?angular.forEach(e.data,function(e,t){GoodsData.tags.push(e)}):GoodsData.tags=[],vm.goodsData.tags=GoodsData.tags},function(e){Flash.create("danger",e.data.error.message)})},$scope.addTag=function(){var e=$.trim($("#input-addTag-name-pop").val());""!=e?tagResource.save({name:e},function(e){Flash.create("success","操作成功"),vm.goodsData.tags.push(e),vm.goodsData.selectedGoodsTags.push(e),$scope.ngPopoverClose()},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","请填写分组名称")},$scope.addTempSkuValue=function(e,t){if(t&&13!=e.keyCode)return!1;var a=$.trim($("#input-addSku-value").val()),o=!1;""!=a?(angular.forEach(vm.skuValueTemp,function(e,t){if(e==a)return o=!0,!1}),o?Flash.create("danger","输入的规格值已存在"):(vm.skuValueTemp.push(a),$("#input-addSku-value").val(""))):Flash.create("warning","规格值名称不能为空")},$scope.deleteTempSkuValue=function(e){vm.skuValueTemp.splice(e,1)},$scope.addSku=function(e){if(GoodsData.cate.length>0){var t={name:$.trim($("#input-addSku-name").val()),goods_cat_id:GoodsData.cate[GoodsData.cate.length-1].data.id,prop_value:vm.skuValueTemp,type:1};""!=t.name?t.prop_value.length>0?(vm.click.addSku=!0,propResource.save(t,function(e){vm.goodsData.skus.push(e),vm.showValue.addSku=!1,vm.click.addSku=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addSku=!1})):Flash.create("warning","至少添加一个规格值"):Flash.create("warning","规格名称不能为空")}else Flash.create("warning","请先选择品类")},$scope.openEditSku=function(e){vm.skuEditTemp[e]=jQuery.extend(!0,{},vm.goodsData.skus[e])},$scope.editAddTempSkuValue=function(e,t,a){if(a&&13!=t.keyCode)return!1;var o=$.trim($("#input-editAddSku-value-"+e).val()),s=!1;""!=o?(angular.forEach(vm.skuEditTemp[e].prop_values,function(e,t){if(e.name==o)return s=!0,!1}),s?Flash.create("danger","输入的规格值已存在"):(vm.skuEditTemp[e].prop_values.push({name:o}),$("#input-editAddSku-value-"+e).val(""))):Flash.create("warning","规格值名称不能为空")},$scope.deleteEditTempSkuValue=function(e,t){var a=$(t.currentTarget).parent("label").data("pid");vm.skuEditTemp[a].prop_values[e].id&&(vm.skuEditTemp[a].is_del=vm.skuEditTemp[a].is_del?++vm.skuEditTemp[a].is_del:1),
vm.skuEditTemp[a].prop_values.splice(e,1)},$scope.editSku=function(e,t){var a="";if(a=0!=vm.skuEditTemp[t].merchant_id?vm.skuEditTemp[t].name=$.trim($("#input-editSku-name-"+vm.skuEditTemp[t].id).val()):vm.skuEditTemp[t].name,vm.skuEditTemp[t].is_del){var o=Utils.confirm("您删除的已有属性值将可能影响到店铺中的其他商品规格");if(!o)return}$(e.currentTarget).addClass("btn-submiting-sm"),vm.click.editSku=!0,propResource.update({id:vm.skuEditTemp[t].id,name:a,prop_values:vm.skuEditTemp[t].prop_values},function(o){o.success?(Flash.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),vm.showValue.editSku[t]=!1,vm.goodsData.skus[t].name=a,angular.forEach(o.data,function(e,a){angular.forEach(vm.goodsData.skus[t].prop_values,function(t,a){e.id==t.id&&t.checked&&(e.checked=!0)})}),vm.goodsData.skus[t].prop_values=o.data):Flash.create("danger",o.error),vm.click.editSku=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.editSku=!1})},$scope.deleteSku=function(){vm.deleteSkuID?propResource.delete({id:vm.deleteSkuID},function(e){e.success?(vm.goodsData.skus.splice(vm.deleteSkuIndex,1),$scope.ngPopoverClose(),$(".sku-list").eq(vm.deleteSkuIndex).remove(),$scope.skuSelect()):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","无法获取到属性ID")},$scope.$watch("vm.goodsData.skus",function(e,t){if(e.length>0){vm.goodsData.skuData=[],vm.goodsData.skuThead=[],$(".sku-list").each(function(){var e=[],t=$(this).index();$(this).children(".sku-tree").children("li").each(function(){$(this).children(".checkbox").children("label").children("input[type='checkbox']").is(":checked")&&e.push(vm.goodsData.skus[t].prop_values[$(this).index()])}),e.length>0&&(vm.goodsData.skuData.push(e),vm.goodsData.skuThead.push(vm.goodsData.skus[t]))}),angular.forEach(vm.goodsData.skuStock[vm.goodsData.skuData.length],function(e,t){e.checked=!1});var a=$scope.renderTable(),o=$(".js-sku-table");o.html(a),$compile(o)($scope)}},!0),$scope.renderTable=function(){var e="";return e+=$scope.renderHeader(),e+=$scope.renderBody(),e+=$scope.renderFooter(),e},$scope.renderHeader=function(){var e="";return angular.forEach(vm.goodsData.skuThead,function(t,a){e+="<td>"+t.name+"</td>"}),3==$scope.supplier_level?"<thead><tr>"+e+'<td>商品图片</td><td>零售价区间</td><td>价格</td><td>采购价</td><td class="hide">下级供货价</td><td>库存</td><td>商家编码</td><td>条形码</td></tr></thead>':"<thead><tr>"+e+"<td>商品图片</td><td>零售价区间</td><td>价格</td><td>采购价</td><td>下级供货价</td><td>库存</td><td>商家编码</td><td>条形码</td></tr></thead>"},$scope.renderBody=function(){return vm.combine=$scope.calcCombine(vm.goodsData.skuData),$scope.generateRows()},$scope.renderFooter=function(){return""},$scope.calcCombine=function(e){for(var t=[],a=e.length,o=0;a>o;o++){t[o]=1;for(var s=o+1;a>s;s++)t[o]=t[o]*e[s].length}return t},$scope.generateRows=function(){return vm.tableHtml="<tbody>",vm.outputTrTag=0,vm.trIndex=0,vm.skuStringArr=[],vm.skuStringArrNum=[],vm.skuStringArrStr=[],$scope.printRow(0,vm.outputTrTag),vm.tableHtml+"</tbody>"},$scope.printRow=function(e,t){var a=vm.goodsData.skuData,o=a.length;return e!==o&&void(a[e]&&angular.forEach(a[e],function(a,s){if(vm.skuStringArr[e]=a.prop_id+":"+a.id,vm.skuStringArrNum[e]=a.prop_id.toString()+a.id.toString(),vm.skuStringArrStr[e]=a.name,t||(vm.tableHtml+="<tr class='js-sku-content'>",t=1),vm.tableHtml+='<td data-atom-id="'+a.id+'" rowspan="'+vm.combine[e]+'">'+a.name+"</td>",e==o-1){var n=vm.skuStringArr.join(";"),r=vm.skuStringArrNum.join(""),i=vm.skuStringArrStr.join(":"),c=$scope.getAtomStockData(o,n);""!=c.img?vm.tableHtml+='<td><img style="width: 80px;height: 80px;" ng-src="'+_global.url.ms+c.img+'"></td>':vm.tableHtml+="<td>无</td>",vm.tableHtml+=$scope.tdTemplate(c,n,r)+"</tr>",vm.trIndex+=1,t=0,"undefined"==typeof vm.goodsData.skuStock[o]&&(vm.goodsData.skuStock[o]={}),"undefined"==typeof vm.goodsData.skuStock[o][n]?vm.goodsData.skuStock[o][n]={id:0,img:"",price:"",parent_supplier_price:"",supplier_price:"",min_retail_price:"",max_retail_price:"",stock:"",product_sn:"",sn:r,barcode:"",str:i}:vm.goodsData.skuStock[o][n].str=i,vm.goodsData.skuStock[o][n].checked=!0}var l=e+1;$scope.printRow(l,t)}))},$scope.getAtomStockData=function(e,t){return angular.isUndefined(vm.goodsData.skuStock[e])||angular.isUndefined(vm.goodsData.skuStock[e][t])?{id:0,price:"",parent_supplier_price:"",supplier_price:"",min_retail_price:"",max_retail_price:"",stock:"",product_sn:"",barcode:"",str:""}:vm.goodsData.skuStock[e][t]},$scope.tdTemplate=function(e,t,a){var o=vm.goodsData.skuData.length,s="has-error";return 3==$scope.supplier_level?'<td><input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].min_retail_price" type="hidden" name="min_retail_price_'+a+'" value="'+e.min_retail_price+'" />'+e.min_retail_price+"--"+e.max_retail_price+'<input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].max_retail_price" type="hidden" name="max_retail_price_'+a+'" value="'+e.max_retail_price+'" /></td><td><div class="validator-form" ng-class="{\''+s+"': form.sku_price_"+a+".$invalid && form.sku_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm sku-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].price" type="text" name="sku_price_'+a+'" value="'+e.price+'" /></div></td><td><input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].parent_supplier_price" type="hidden" name="parent_supplier_price_'+a+'" value="'+e.parent_supplier_price+'" />'+e.parent_supplier_price+'</td><td class="hide"><div class="validator-form" style="width: 100px;" ng-class="{\''+s+"': form.supplier_price_"+a+".$invalid && form.supplier_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].supplier_price" type="text" name="supplier_price_'+a+'" value="'+e.supplier_price+'" /></div></td><td>'+e.stock+"</td><td>"+e.product_sn+"</td><td>"+e.barcode+"</td>":'<td><input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].min_retail_price" type="hidden" name="min_retail_price_'+a+'" value="'+e.min_retail_price+'" />'+e.min_retail_price+"--"+e.max_retail_price+'<input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].max_retail_price" type="hidden" name="max_retail_price_'+a+'" value="'+e.max_retail_price+'" /></td><td><div class="validator-form" ng-class="{\''+s+"': form.sku_price_"+a+".$invalid && form.sku_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm sku-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].price" type="text" name="sku_price_'+a+'" value="'+e.price+'" /></div></td><td><input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].parent_supplier_price" type="hidden" name="parent_supplier_price_'+a+'" value="'+e.parent_supplier_price+'" />'+e.parent_supplier_price+'</td><td><div class="validator-form" style="width: 100px;" ng-class="{\''+s+"': form.supplier_price_"+a+".$invalid && form.supplier_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm  supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].supplier_price" type="text" name="supplier_price_'+a+'" value="'+e.supplier_price+'" /></div></td><td>'+e.stock+"</td><td>"+e.product_sn+"</td><td>"+e.barcode+"</td>"},$scope.openSkuBatch=function(e){var t=vm.goodsData.skuData.length;vm.openSkuBatchString=e,vm.isOpenBatchPrice=!("undefined"!=typeof vm.goodsData.skuStock[t][e].price&&""!=vm.goodsData.skuStock[t][e].price),vm.isOpenBatchStock=!("undefined"!=typeof vm.goodsData.skuStock[t][e].stock&&""!=vm.goodsData.skuStock[t][e].stock)},$scope.skuBatch=function(e,t){var a=vm.openSkuBatchString.split(";"),o=vm.goodsData.skuData.length;angular.forEach(vm.goodsData.skuStock[o],function(s,n){n.indexOf(a[t])!=-1&&("price"==e?vm.goodsData.skuStock[o][n][e]=parseFloat(vm.goodsData.skuStock[o][vm.openSkuBatchString][e]).toFixed(2):vm.goodsData.skuStock[o][n][e]=vm.goodsData.skuStock[o][vm.openSkuBatchString][e])})},$scope.getShipment=function(e){("undefined"==typeof vm.shipments||e)&&shipmentResource.get({},function(e){vm.goodsData.shipments=e.data})},$scope.addCollectFields=function(){var e={name:"",type:"text",multiple:!1,required:!0};vm.goodsData.collect_fields.push(e)},$scope.deleteCollectFields=function(e){vm.goodsData.collect_fields.splice(e,1)},$scope.$watch("vm.goodsData",function(e,t){vm.goodsData.is_sku||($("input[name='parent_supplier_price']").val()-$("input[name='goods_price']").val()>0?($("input[name='goods_price']").parent().find(".custom-number-error-info").remove(),$("input[name='goods_price']").after('<p class="custom-number-error-info error-text">输入价格小于采购价！</p>')):$("input[name='goods_price']").parent().find(".custom-number-error-info").remove()),vm.goodsData.is_sku||3==$scope.supplier_level||($("input[name='parent_supplier_price']").val()-$("input[name='supplier_price']").val()>0?($("input[name='supplier_price']").parent().find(".custom-number-error-info").remove(),$("input[name='supplier_price']").after('<p class="custom-number-error-info error-text">输入下级供货价小于采购价！</p>')):$("input[name='supplier_price']").parent().find(".custom-number-error-info").remove())},!0),vm.goodsData.products=vm.goodsData.skuStock[vm.goodsData.skuData.length],$scope.$watch("vm.goodsData.skuStock",function(e,t){if(vm.goodsData.is_sku){var a=vm.goodsData.skuData.length;for(var o in vm.goodsData.skuStock[a]){var s=vm.goodsData.skuStock[a][o];if(s.checked){var n="sku_price_"+s.sn,r="supplier_price_"+s.sn,i="parent_supplier_price_"+s.sn;"min_retail_price_"+s.sn,"max_retail_price_"+s.sn;$("input[name='"+n+"']").val()-$("input[name='"+i+"']").val()<0?($("input[name='"+n+"']").parent().find(".custom-number-error-info").remove(),$("input[name='"+n+"']").after('<p class="custom-number-error-info error-text">输入价格小于采购价！</p>')):$("input[name='"+n+"']").parent().find(".custom-number-error-info").remove(),3!=$scope.supplier_level&&($("input[name='"+r+"']").val()-$("input[name='"+i+"']").val()<0?($("input[name='"+r+"']").parent().find(".custom-number-error-info").remove(),$("input[name='"+r+"']").after('<p class="custom-number-error-info error-text">输入下级供货价小于采购价！</p>')):$("input[name='"+r+"']").parent().find(".custom-number-error-info").remove())}}}},!0),$scope.save=function(){var e=$scope.saveValidity(0);if(!e)return!1;var t=[],a={};vm.goodsData.products=vm.goodsData.skuStock[vm.goodsData.skuData.length],angular.forEach(vm.goodsData.props,function(e,o){a={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.value},t.push(a)}),angular.forEach(vm.goodsData.skuData,function(e,o){angular.forEach(e,function(e,o){a={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.name},t.push(a)})}),vm.goodsData.onsale_type=0;var o={barcode:vm.goodsData.barcode||"",goods_cat_id:vm.goodsData.cate[vm.goodsData.cate.length-1].data.id,goods_sn:vm.goodsData.goods_sn||"",img:vm.goodsData.imgs[0].url,imgs:vm.goodsData.imgs,tags:[],postage:vm.goodsData.postage||0,original_price:vm.goodsData.original_price||0,price:vm.goodsData.price||0,serve_label:vm.goodsData.serve_label,label_ids:vm.goodsData.label_ids,is_sku:vm.goodsData.is_sku,is_discount:vm.goodsData.is_discount,products:{},props:t,shipment_id:null!=vm.goodsData.shipment?vm.goodsData.shipment.id:0,stock:vm.goodsData.stock||0,stock_type:vm.goodsData.stockType,title:vm.goodsData.title,volume:vm.goodsData.volume||0,weight:vm.goodsData.weight||0,intro:vm.goodsData.intro,design_goods_id:vm.goodsData.designGoodsTpl,onsale_type:vm.goodsData.onsale_type,cquota:vm.goodsData.cquota,base_csale:vm.goodsData.base_csale,goods_line_id:vm.goodsData.goods_line_id||0,supplier_price:vm.goodsData.supplier_price||"",parent_supplier_price:vm.goodsData.parent_supplier_price||"",min_retail_price:vm.goodsData.min_retail_price||"",max_retail_price:vm.goodsData.max_retail_price||"",original_id:vm.goodsData.original_id,supplier_goods_id:vm.goodsData.supplier_goods_id,onsale:1,supplier_level:$scope.supplier_level};o.component_data=[];var s=angular.copy($scope.slices);for(var n in s){var r=designValidate[s[n].type](s[n].content);if(r)return $scope.editSlice(s[n],r),!1}angular.forEach(s,function(e,t){"goods_head"!=e.type&&o.component_data.push({type:e.type,content:e.content||""})}),o.is_sku&&angular.forEach(vm.goodsData.products,function(e,t){e.checked&&(o.products[t]={id:e.id,img:e.img,price:e.price,parent_supplier_price:e.parent_supplier_price,supplier_price:e.supplier_price,min_retail_price:e.min_retail_price,max_retail_price:e.max_retail_price,stock:e.stock,props_str:e.str,product_sn:e.product_sn,barcode:e.barcode,supplier_product_id:e.supplier_product_id})}),vm.goodsData.collect_fields&&(o.collect_fields=[],angular.forEach(vm.goodsData.collect_fields,function(e,t){o.collect_fields.push({name:e.name,type:e.type,required:e.required?1:0})})),vm.goodsData.selectedGoodsTags.length>0&&angular.forEach(vm.goodsData.selectedGoodsTags,function(e,t){o.tags.push(e.id)}),vm.goodsData.shipmentType||(o.shipment_id=0),vm.goodsData.onsale_type&&(o.onsale_at=vm.goodsData.onsale_at),$scope.save.disabled=!0,angular.isDefined($stateParams.original_id)?(o.id=vm.goodsData.id,goodsResource.update(o,function(e){e.error?(Flash.create("danger",e.error),$scope.save.disabled=!1):"0"==o.onsale_type?$state.go("supplier.auction.list"):$state.go("supplier.forsale.list")},function(e){$scope.save.disabled=!1})):($scope.catesHistory(),goodsResource.save(o,function(e){"0"==o.onsale_type?$state.go("supplier.auction.list"):$state.go("supplier.forsale.list")},function(e){$scope.save.disabled=!1}))},$scope.catesHistory=function(){var catesHistory=localStorage.getItem("catesHistory"),currentCates=[],currentIds=[];catesHistory=catesHistory?eval("("+catesHistory+")"):[],angular.forEach(vm.goodsData.cate,function(e,t){currentCates.push({id:e.data.id,name:e.data.name,parent_id:e.data.parent_id,cchild:e.data.cchild}),currentIds.push(e.data.id)});var distinct=!1,tempIds=[];for(var i in catesHistory)if(tempIds=[],angular.forEach(catesHistory[i],function(e,t){tempIds.push(e.id)}),currentIds.join(",")==tempIds.join(",")){distinct=!0;break}distinct||(catesHistory.length>=5&&catesHistory.splice(4,catesHistory.length-4),catesHistory.unshift(currentCates),localStorage.setItem("catesHistory",JSON.stringify(catesHistory)))},$scope.saveValidity=function(e){var t=$scope.form;if(!vm.goodsData.isCateSelect)return Flash.create("danger","请选择商品类目"),!1;if(0==e||2==e||3==e){if(0==vm.goodsData.imgs.length)return Flash.create("danger","请至少上传一张商品图片"),!1;if(!vm.goodsData.is_sku){if(t.goods_price.$invalid)return t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1;if(t.supplier_price.$invalid)return t.supplier_price.$dirty=!0,$("input[name='supplier_price']").focus(),!1;if(vm.goodsData.max_retail_price-$("input[name='goods_price']").val()<0||$("input[name='goods_price']").val()-vm.goodsData.min_retail_price<0)return t.goods_price.$invalid=!0,t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),Flash.create("danger","输入价格不在零售价区间之内！"),!1;if($("input[name='supplier_price']").val()<0&&3!=$scope.supplier_level)return t.supplier_price.$invalid=!0,t.supplier_price.$dirty=!0,$("input[name='supplier_price']").focus(),Flash.create("danger","下级供货价需不小于0.00！"),!1}if(vm.goodsData.is_sku){var a=!1,o=vm.goodsData.skuData.length;if(0==o)return Flash.create("danger","请至少选择一个商品规格"),!1;for(var s in vm.goodsData.skuStock[o]){var n=vm.goodsData.skuStock[o][s];if(n.checked){var r="sku_price_"+n.sn,i="supplier_price_"+n.sn,c=("parent_supplier_price_"+n.sn,"min_retail_price_"+n.sn),l="max_retail_price_"+n.sn;if(t[i].$invalid&&3!=$scope.supplier_level)return t[i].$dirty=!0,$("input[name='"+i+"']").focus(),a=!0,!1;if($("input[name='"+l+"']").val()-$("input[name='"+r+"']").val()<0||$("input[name='"+r+"']").val()-$("input[name='"+c+"']").val()<0)return t[r].$invalid=!0,t[r].$dirty=!0,$("input[name='"+r+"']").focus(),Flash.create("danger","输入价格不在零售价区间之内！"),a=!0,!1}}if(a)return!1}if(!vm.goodsData.shipmentType&&t.shipping_price.$invalid)return t.shipping_price.$dirty=!0,$("input[name='shipping_price']").focus(),!1;if(vm.goodsData.shipmentType){if(null==vm.goodsData.shipment)return Flash.create("danger","请选择运费模版"),!1;if(t.weight.$invalid)return t.weight.$dirty=!0,$("input[name='weight']").focus(),!1;if(t.volume.$invalid)return t.volume.$dirty=!0,$("input[name='volume']").focus(),!1}if(t.base_csale.$invalid)return t.base_csale.$dirty=!0,$("input[name='base_csale']").focus(),!1;if(1==vm.goodsData.onsale_type&&("000-00-00 00:00:00"==vm.goodsData.onsale_at||""==vm.goodsData.onsale_at))return Flash.create("danger","请选择上架时间"),!1;if(vm.goodsData.collect_fields){var d=!1;if(angular.forEach(vm.goodsData.collect_fields,function(e,a){var o="collectFieldsName"+a;if(t[o].$invalid)return t[o].$dirty=!0,$('input[name="'+o+'"]').focus(),d=!0,!1}),d)return!1}}return!0},$scope.catesHistoryChange=function(e){for(var t in e){t=parseInt(t);var a=e[t];angular.isUndefined(vm.goodsData.cate[t])&&(vm.goodsData.cate[t]={}),$scope.SelectCate(a.id,a.cchild,t,1,a,1)}},step){case"1":var catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),vm.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),vm.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),vm.catesHistoryList.unshift({ids:-1,strs:"请选择"}),vm.catesHistorySelect=-1,$scope.$watch("vm.catesHistorySelect",function(e,t){if(e!=-1)for(var a in vm.catesHistoryList){var o=vm.catesHistoryList[a];e==o.ids&&$scope.catesHistoryChange(catesHistory[a-1])}}),$scope.SelectCate=function(e,t,a,o,s,n){var r=vm.cates.length,i=a+1;t>0?catResource.get({parent_id:e},function(e){o?(vm.goodsData.cate[a].data=s,e._count>0?(angular.isUndefined(vm.goodsData.cate[i])&&(vm.goodsData.cate[i]={}),vm.goodsData.cate[i].collections=vm.cates[i]=e.data,vm.cates.splice(i+1,r-i-1),n||(vm.goodsData.isCateSelect=!1)):(vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)):(vm.goodsData.cate[a]={},vm.goodsData.cate[a].collections=vm.cates[a]=e.data)},function(e){}):(vm.goodsData.cate[a].data=s,vm.goodsData.cate.splice(i,vm.goodsData.cate.length-i),vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)},$scope.$watch("vm.goodsData.cate",function(e,t){e.length>0&&(vm.goodsData.props={})},!0),0==vm.goodsData.cate.length?$scope.SelectCate(0,1,0,0):(angular.forEach(vm.goodsData.cate,function(e,t){vm.cates[t]=e.collections}),vm.goodsData.isCateSelect=!0);break;case"2":vm.goodsData.tags=[],vm.skuValueTemp=[],vm.skuEditTemp=[],vm.showValue={addProp:!1,addSku:!1,editSku:!1},vm.skuSelectObject={},vm.isSkuSelect=!1,vm.skuType=0;var cateLn=vm.goodsData.cate.length;cateLn>0&&(0==vm.goodsData.skus.length||vm.goodsData.skus.length>0&&vm.goodsData.cate[cateLn-1].data.id!=vm.goodsData.skus[0].goods_cat_id)&&(vm.goodsData.prop=[],vm.goodsData.skus=[],vm.goodsData.skuStock={},$scope.getProp()),$scope.getTags(),$scope.$watch("vm.goodsData.shipmentType",function(e,t){1==e&&0==vm.goodsData.shipments.length&&$scope.getShipment()}),$scope.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},$scope.nowFormatDate=$scope.getNowFormatDate();break;case"3":$scope.save.disabled=!1,designGoodsRes.get({},function(e){vm.designGoodsList=angular.copy(e.data),vm.designGoodsList.unshift({id:0,title:"普通版"})}),$scope.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],$scope.$watch("vm.goodsData.components_data",function(e,t){if(e.length>0){$scope.slices=e,"goods_head"!=$scope.slices[0].type&&$scope.slices.unshift({type:"goods_head"});for(var a in $scope.slices)"goods_info"==$scope.slices[a].type&&($scope.slices[a].class=!0,$scope.editSlice($scope.slices[a]))}}),$scope.config={},$scope.icon_list=designData.concat(),$scope.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,t){t.item.sortable.droptarget&&e.target!=t.item.sortable.droptarget[0]&&($scope.icon_list=designData.concat(),"mouseup"==e.handleObj.type&&$scope.editSlice(t.item.sortable.moved))}},$scope.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},$scope.goods_info=function(e){"goods_info"==e.type&&($scope.design={type:"text"})},$scope.removeSlice=function(e){$scope.slices.splice(e,1),$scope.design=!1},$scope.editSlice=function(e,t){"goods_head"!=e.type&&($scope.design=e,angular.forEach($scope.slices,function(e,t){e.class=!1}),e.class=!0,$timeout(function(){$scope.$broadcast("design_data",e),angular.isUndefined(t)||$scope.$broadcast("design_dirty",t)},200))},$scope.editSlice($scope.slices[1])}}])}),define("apps/supplier/controllers/junior_price_tpl",["apps/common/controllers/controllers"],function(e){e.controller("supplier.auction.juniorPrice.tpl",["$scope","Flash","skuResource","goodsId","num","$modalInstance",function(e,t,a,o,s,n){function r(){a.get({id:o,field:"price"},function(t){e.products=t})}e.skuDatas=[],e.cancel=function(){n.dismiss("cancel")},e.num=s,1==s?e.title="查看一级供货价":e.title="查看零售价区间",r()}])}),define("apps/supplier/controllers/stock_tpl",["apps/common/controllers/controllers"],function(e){e.controller("supplier.stock.tpl",["$scope","Flash","dproductResource","goodsId","$modalInstance",function(e,t,a,o,s){function n(){a.get({id:o,field:"stock"},function(t){e.products=t})}e.products=[],e.cancel=function(){s.dismiss("cancel")},e.saveProductStock=function(){a.update({original_id:o,products:e.products},function(e){e.success?(t.create("success","保存成功"),s.close()):t.create("danger",e.error)})},n()}])}),define("apps/supplier/controllers/apply",["apps/common/controllers/controllers"],function(e){e.controller("supplier.sell.apply",["$scope","swithdrawResource",function(e,t){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,column:"created_at",created_at:"",status:"all",direction:"desc"};var a=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.withdraws=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",a),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?a():e.paginationConf.currentPage=1}}])}),define("apps/supplier/controllers/apply.add",["apps/common/controllers/controllers","wxLogin"],function(e){e.controller("supplier.sell.apply.add",["$scope","$modal","$location","Flash","merchantBankResource","swithdrawResource","sincomeResource","getAccessInfo",function(e,t,a,o,s,n,r,i){e.bank={},e.banks=[],e.withdraw=[],e.balance=0;var c=function(){r.get({},function(t){e.balance=t.balance})};c();var l=function(){s.get({},function(t){e.banks=t.data})};l(),e.addBank=function(){type="addBank",i.get(function(a){if(a.is_verification_mobile)if(a.status)e.Bank();else{var s=t.open({animation:!1,templateUrl:"validMobileModal.html",controller:"access.valid.mobile",resolve:{mobile:function(){return a.mobile},type:function(){return type},WxLogin:function(){return WxLogin}}});s.result.then(function(t){$timeout(function(){t&&e.Bank()},1e3)},function(){})}else _global.is_admin?o.create("warning","请在个人设置中验证手机号"):o.create("warning","主账号需在个人设置中验证手机号")})},e.Bank=function(){var a=t.open({animation:!1,templateUrl:"assets/js/apps/supplier/templates/apply/bank.add.html",controller:"supplier.bank.add",resolve:{selectedIds:function(){return e.selectedIds}}});a.result.then(function(t){e.newItem=t,s.get({},function(t){e.banks=t.data,angular.forEach(e.banks,function(t,a){t.id==e.newItem.id&&(e.bank.selected=t)})})})},e.delBank=function(t,a){a.stopPropagation(),s.delete({id:t},function(a){a.status?angular.forEach(e.banks,function(a,s){if(a.id==t)return e.bank.hasOwnProperty("selected")&&e.bank.selected.id==t&&(e.bank={}),e.banks.splice(s,1),o.create("success","删除成功"),!1}):o.create("success","删除失败")})},e.save=function(t){if(t){var s={};e.bank.hasOwnProperty("selected")&&(s.bank_id=e.bank.selected.id),s.amount=e.withdraw.amount,e.form.$invalid=!0,n.create(s,function(t){t.status?(o.create("success","提交成功"),a.path("/supplier/sell/apply")):(o.create("danger",t.msg),e.form.$invalid=!1)})}}}])}),define("apps/supplier/controllers/goodslog",["apps/common/controllers/controllers"],function(e){e.controller("supplier.goodslog",["$scope","$filter","ngPopover","Flash","lineslogResource","synchronizationResource","$modal","cityData",function(e,t,a,o,s,n,r,i){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={type:0,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,goods_title:"",sale:0,column:"created_at",direction:"desc"},e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.add_time=t[0]+" 00:00:00",e.params.end_time=t[1]+" 23:59:59"):(delete e.params.add_time,delete e.params.end_time),1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.getlist(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c)}])}),define("apps/supplier/controllers/record",["apps/common/controllers/controllers"],function(e){e.controller("supplier.sell.record",["$scope","ngPopover","srecordResource","$stateParams",function(e,t,a,o){e.status="all",e.sorts="desc",e.paginationConf={currentPage:1,itemsPerPage:20},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_no:""},o.type&&(e.params.type=o.type,"supplier_foraccount"==e.params.type&&(e.status="0",e.params.is_supplier=1));var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.status=e.status,e.params.sorts=e.sorts,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.sort=function(t){"asc"==t?e.sorts="desc":e.sorts="asc",s()},e.toggleRow=function(t){e.data[t].sub=!e.data[t].sub,e.data[t].icon=e.data[t].sub?"minus":"plus"}}])}),define("apps/supplier/controllers/supplier.bank.add",["apps/common/controllers/controllers"],function(e){e.controller("supplier.bank.add",["$scope","Flash","merchantBankResource","bankResource","$modalInstance",function(e,t,a,o,s){e.merchantBank={type:0},e.bank={};var n=function(){o.get({},function(t){e.banks=t})};n(),e.cancel=function(){s.dismiss("cancel")};var r=e.city=this;r.regions={country:1},r.start="province",r.end="district",e.checkBank=function(){if(!e.bank.hasOwnProperty("selected"))return!0;var t=e.bank.selected.code;return(0!=e.merchantBank.type||"01020000"!=t&&"01030000"!=t&&"01040000"!=t&&"03080000"!=t&&"03030000"!=t&&"03100000"!=t)&&(1!=e.merchantBank.type||"01050000"!=t)},e.ok=function(o){o&&(e.bank.hasOwnProperty("selected")&&(e.merchantBank.bank_code=e.bank.selected.code),e.city.hasOwnProperty("selected")&&(e.merchantBank.province_code=e.city.selected[0].id,e.merchantBank.city_code=e.city.selected[1].id,e.merchantBank.district_code=e.city.selected[2].id),a.create(e.merchantBank,function(e){e.error?t.create("danger",e.error):(t.create("success","保存成功"),s.close(e))}))}}])}),define("apps/supplier/controllers/dispatct.info",["apps/common/controllers/controllers"],function(e){e.controller("supplier.dispatct.info",["$scope","suppliersResource","$stateParams","Flash","$state","dispatctAddResource","$modal","$location",function(e,t,a,o,s,n,r,i){e.shopId=a.shopId,e.shopName=decodeURI(a.shopName),e.title="出货",e.items={},e.data={goods_amount:0};var c=e.city=this;c.regions={country:1},c.start="country",c.end="district",e.$watch("city",function(t){angular.isUndefined(t.selected)||(t.selected.length>2&&(e.cityname=t.selected[1].name),e.items.selected_city=t.selected)},!0),e.sortableOptions={cursor:"move",zIndex:8e3,axis:"x"},e.removeGoodsItem=function(t,a){if(e.goods.splice(a,1),d[t.goods_id]=d[t.goods_id]-1,t.prop){var o=l.indexOf(t.prop);l.splice(o,1)}},e.goods=[];var l=[],d=[];e.add_goods=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/goods_list.html",controller:"dispatctChooseGoodsModalCtrl"});t.selectedGoodAll=e.goods,t.selectedGoodProp=l,t.chooseGoodArr=d,t.shopId=e.shopId,t.result.then(function(t){e.goods=t.selectedGood,l=t.selectedGood_prop,d=t.chooseGoodArr})},e.$watch("goods",function(){var t=0;angular.forEach(e.goods,function(e){t+=e.price*e.quantity}),e.data.goods_amount=t.toFixed(2)},!0),e.submitForm=function(t){if(t){if(e.goods.length<=0)return void o.create("danger"," 请选择出货商品！");angular.forEach(e.goods,function(e,t){if(!e.stock)return void o.create("danger","选择的商品存在库存为0的商品，请先删除库存为0的商品")}),e.form.$invalid=!0,e.btn_text="出货中...",e.data.goods=e.goods,e.data.from_supplier_id=e.shopId,n.add(e.data,function(t){t.status?(e.btn_text="出货",o.create("success","出货成功！对应自有商品库存会减，目标经销商库存会加。"),i.path("/supplier/sell/suppliers/dispatcts/"+a.shopId+"/"+a.shopName)):o.create("danger",t.msg)},function(t){e.btn_text="出货",e.form.$invalid=!1,o.create("danger",t.msg)})}}}])}),define("apps/supplier/controllers/dispatct.list",["apps/common/controllers/controllers"],function(e){e.controller("supplier.dispatct.list",["$scope","Flash","$modal","$filter","dispatctListResource","rankResource","ngPopover","$stateParams","$location",function(e,t,a,o,s,n,r,i,c){e.shopId=i.id,e.shopName=decodeURI(i.shopName),e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,consignee:"",status:"all",order_sn:""};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.from_supplier_id=e.shopId,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.order_status=t.order_status})};e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.goDispatct=function(e,t){c.path("/supplier/sell/suppliers/dispatct/"+e+"/"+encodeURI(t))},e.upOrder=function(e){var t=a.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/supplier_offline_order.html",controller:"supplierofflineOrderModalCtrl"});t.order_id=e,t.result.then(function(e){})}}])}),define("apps/supplier/controllers/_base",["apps/supplier/controllers/dashboard.purchase","apps/supplier/controllers/dashboard.supplier","apps/supplier/controllers/dashboard.income","apps/supplier/controllers/suppliers.list","apps/supplier/controllers/suppliers.info","apps/supplier/controllers/purchaseorder.list","apps/supplier/controllers/purchaseorder.list.details","apps/supplier/controllers/purchaseorder.setting","apps/supplier/controllers/purchaseorder.add","apps/supplier/controllers/goods.list","apps/supplier/controllers/auction","apps/supplier/controllers/forsale","apps/supplier/controllers/soldout","apps/supplier/controllers/form","apps/supplier/controllers/junior_price_tpl","apps/supplier/controllers/stock_tpl","apps/supplier/controllers/apply","apps/supplier/controllers/apply.add","apps/supplier/controllers/goodslog","apps/supplier/controllers/record","apps/supplier/controllers/supplier.bank.add","apps/supplier/controllers/dispatct.info","apps/supplier/controllers/dispatct.list"],function(){}),
define("apps/supplier/directives/_base",[],function(){}),define("apps/supplier/main",["apps/supplier/states/_base","apps/supplier/services/_base","apps/supplier/controllers/_base","apps/supplier/directives/_base"],function(){}),define("apps/distributor/states/auction",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor",{url:"/distributor",templateUrl:"assets/js/apps/distributor/templates/layout.html"}).state("distributor.auction",{abstract:!1,url:"/auction",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.auction.list",{url:"/list",templateUrl:"assets/js/apps/distributor/templates/auction.html",controller:"distributor.auction"}).state("distributor.auction.comments",{url:"/add",templateUrl:"assets/js/apps/goods/templates/comments.add.html",controller:"shop.goods.auction.comments.add"}).state("distributor.auction.commentsedit",{url:"/edit",templateUrl:"assets/js/apps/goods/templates/comments.edit.html",controller:"shop.goods.auction.comments.edit"})}])}),define("apps/distributor/states/add",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.add",{abstract:!0,url:"/add",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.add.step",{controller:"distributor.form",url:"/step/:step",templateUrl:"assets/js/apps/distributor/templates/form.html"})}])}),define("apps/distributor/states/edit",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.edit",{abstract:!0,url:"/edit",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.edit.step",{controller:"distributor.form",url:"/:id/step/:step",templateUrl:"assets/js/apps/distributor/templates/form.html"})}])}),define("apps/distributor/states/forsale",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.forsale",{abstract:!0,url:"/forsale",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.forsale.list",{url:"",templateUrl:"assets/js/apps/distributor/templates/forsale.html",controller:"distributor.forsale"})}])}),define("apps/distributor/states/material",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.material",{abstract:!0,url:"/material",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.material.list",{url:"/:type",controller:"distributor.material",templateUrl:"assets/js/apps/distributor/templates/material.html"}).state("distributor.material.edit",{url:"/edit/:id/step/:step",controller:"distributor.material.edit",templateUrl:"assets/js/apps/distributor/templates/material.edit.html"})}])}),define("apps/distributor/states/soldout",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.soldout",{abstract:!0,url:"/soldout",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.soldout.list",{url:"",templateUrl:"assets/js/apps/distributor/templates/soldout.html",controller:"distributor.soldout"})}])}),define("apps/distributor/states/line",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.line",{abstract:!0,url:"/line",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.line.list",{url:"",templateUrl:"assets/js/apps/distributor/templates/line.html",controller:"distributor.line"}).state("distributor.line.add",{url:"/add",templateUrl:"assets/js/apps/distributor/templates/line.info.html",controller:"distributor.line.info"}).state("distributor.line.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/distributor/templates/line.info.html",controller:"distributor.line.info"}).state("distributor.line.linegoods",{url:"/linegoods/:id",templateUrl:"assets/js/apps/distributor/templates/linegoods.html",controller:"distributor.line.linegoods"})}])}),define("apps/distributor/states/supplier",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.supplier",{abstract:!1,url:"/supplier",templateUrl:"assets/js/apps/distributor/templates/layout_supplier.html"}).state("distributor.supplier.dashboard",{url:"/dashborad",templateUrl:"assets/js/apps/distributor/templates/supplier/dashboard.tab.html"}).state("distributor.supplier.dashboard.income",{url:"/income",templateUrl:"assets/js/apps/distributor/templates/supplier/dashboard.income.html",controller:"distributor.dashboard.income"}).state("distributor.supplier.dashboard.supply",{url:"/supply",templateUrl:"assets/js/apps/distributor/templates/supplier/dashboard.supply.html",controller:"dashboard.supply"}).state("distributor.supplier.suppliers",{abstract:!1,url:"/suppliers",template:"<div ui-view></div>"}).state("distributor.supplier.suppliers.list",{url:"/list/:level",templateUrl:"assets/js/apps/distributor/templates/supplier/suppliers.list.html",controller:"distributor.supplier.suppliers.list"}).state("distributor.supplier.suppliers.add",{url:"/add",templateUrl:"assets/js/apps/distributor/templates/supplier/suppliers.info.html",controller:"distributor.supplier.suppliers.info"}).state("distributor.supplier.suppliers.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/distributor/templates/supplier/suppliers.info.html",controller:"distributor.supplier.suppliers.info",resolve:{suppliersResourceLoder:["suppliersResourceLoder","$stateParams",function(e,t){return e(t)}]}}).state("distributor.supplier.suppliers.dispatcts",{url:"/dispatcts/:id/:shopName",templateUrl:"assets/js/apps/distributor/templates/supplier/dispatct.list.html",controller:"dispatct.list"}).state("distributor.supplier.suppliers.dispatct",{url:"/dispatct/:shopId/:shopName",templateUrl:"assets/js/apps/distributor/templates/supplier/dispatct.info.html",controller:"dispatct.info"}).state("distributor.supplier.withdraw",{url:"/withdraw",templateUrl:"assets/js/apps/distributor/templates/supplier/withdraw.tab.html"}).state("distributor.supplier.withdraw.account",{url:"/account",templateUrl:"assets/js/apps/distributor/templates/supplier/withdraw.account.html",controller:"withdraw.account"}).state("distributor.supplier.withdraw.manage",{url:"/manage",templateUrl:"assets/js/apps/distributor/templates/supplier/withdraw.manage.html",controller:"withdraw.manage"}).state("distributor.supplier.rank",{abstract:!1,url:"/rank",template:"<div ui-view></div>"}).state("distributor.supplier.rank.list",{url:"/list",templateUrl:"assets/js/apps/distributor/templates/supplier/rank.list.html",controller:"supplier.rank.list"}).state("distributor.supplier.rank.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/distributor/templates/supplier/rank.info.html",controller:"supplier.rank.info"}).state("distributor.supplier.record",{url:"/record",templateUrl:"assets/js/apps/distributor/templates/supplier/record.html",controller:"distributor.supplier.record"}).state("distributor.supplier.feedback",{abstract:!1,url:"/feedback",template:"<div ui-view></div>"}).state("distributor.supplier.feedback.list",{url:"/list",templateUrl:"assets/js/apps/distributor/templates/supplier/feedback.list.html",controller:"distributor.supplier.feedback.list"}).state("distributor.supplier.feedback.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/distributor/templates/supplier/feedback.detail.html",controller:"distributor.supplier.feedback.detail"}).state("distributor.supplier.feedback.refund",{url:"/refund/:id",templateUrl:"assets/js/apps/distributor/templates/supplier/feedback.refund.html",controller:"distributor.supplier.feedback.refund"})}])}),define("apps/distributor/states/goodslog",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("distributor.goodslog",{abstract:!0,url:"/goodslog",templateUrl:"assets/js/apps/distributor/templates/layout_two.html"}).state("distributor.goodslog.list",{url:"",templateUrl:"assets/js/apps/distributor/templates/goodslog.html",controller:"distributor.goodslog"})}])}),define("apps/distributor/states/_base",["apps/distributor/states/auction","apps/distributor/states/add","apps/distributor/states/edit","apps/distributor/states/forsale","apps/distributor/states/material","apps/distributor/states/soldout","apps/distributor/states/line","apps/distributor/states/supplier","apps/distributor/states/goodslog"],function(){}),define("apps/distributor/controllers/auction",["apps/common/controllers/controllers"],function(e){e.controller("distributor.auction",["$scope","$filter","ngPopover","Flash","dgoodsResource","dtagResource","$modal","cityData","$rootScope",function(e,t,a,o,s,n,r,i,c){function l(){n.get({limit:100},function(t){t._count>100?e.loadAll=!1:e.loadAll=!0,e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e.item=!1,e.loadAll=!0,e.toggle=function(t){e.item=!t},e.save=function(){a.close()},e.cancel=function(){a.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var n={id:a};n[e]=t,s.editField(n,function(e){e.success?o.create("success","修改成功"):e.error?o.create("danger",e.error):o.create("danger",e.message)})},e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,l(),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),d()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?(o.create("success","删除成功"),d()):o.create("danger",e.msg)})},e.confirmBatchDelete=function(){s.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(o.create("success","删除成功"),d(),e.goods.checkedAll=!1):o.create("danger",t.msg)})},e.confirmOnSaleUp=function(e,t){s.onSale({id:e,sale:0,onsale_act:t},function(e){e.success?(o.create("success","解除经销商锁定成功"),d()):o.create("danger","解除经销商锁定失败")})},e.confirmOnSale=function(e,t){s.onSale({id:e,sale:0,onsale_act:t},function(e){e.success?(o.create("success","下架成功"),d()):o.create("danger","下架失败")})},e.confirmBatchOffSale=function(t){s.batchToggleSale({ids:e.selectedIds,sale:0,onsale_act:t},function(t){t.success?(o.create("success","下架成功"),d(),e.goods.checkedAll=!1):o.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){s.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),a.close(),o.create("success","分组成功")):o.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},c.$on("updateTag2",function(t,a){n.get({title:a},function(t){e.tags=t.data})}),e.$on("$destroy",function(){c.$$listeners.updateTag2=null}),e.batchSetRegions=function(){s.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","区域设置成功")):o.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){s.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]});var d=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",goods_sn:"",sale:1,column:"created_at",direction:"desc",onsale_act:"all"},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.setArea=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"},region_id:function(){}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/goods_tpl.html",controller:"distributor.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/price_tpl.html",controller:"distributor.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){d()})},e.setProductStock=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){d()})},e.setProductListStock=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/list_stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){d()})},e.showQrcode=function(t){s.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/distributor/controllers/forsale",["apps/common/controllers/controllers"],function(e){e.controller("distributor.forsale",["$scope","$filter","ngPopover","Flash","dgoodsResource","dtagResource","$modal","cityData",function(e,t,a,o,s,n,r,i){function c(){n.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){a.close()},e.cancel=function(){a.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var n={id:a};n[e]=t,s.editField(n,function(e){e.success?o.create("success","保存成功"):o.create("danger",e.error)})},e.goods={checkedAll:!1},e.tab=0,e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",goods_sn:"",sale:0,column:"created_at",direction:"desc",onsale_act:"all"},c(),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),l()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?(o.create("success","删除成功"),l()):o.create("danger",e.msg)})},e.confirmOnSale=function(e,t,a){s.onSale({id:e,sale:t,onsale_act:a},function(e){e.success?(0==a?o.create("success","上架成功"):o.create("success","经销商下架成功"),l()):o.create("danger",e.error)})},e.confirmBatchDelete=function(){s.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(o.create("success","删除成功"),l(),e.goods.checkedAll=!1):o.create("danger","删除失败")})},e.confirmBatchOnSale=function(){s.batchToggleSale({ids:e.selectedIds,sale:1,onsale_act:0},function(t){t.success?(o.create("success","上架成功"),l(),e.goods.checkedAll=!1):o.create("danger",t.error)})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){s.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(l(),e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),a.close(),o.create("success","分组成功")):o.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){s.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","区域设置成功")):o.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){s.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]}),e.toggleTab=function(t){e.tab=t,1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),0==e.tab?(delete e.params.stock,delete e.params.onsale_type):1==e.tab?(delete e.params.onsale_type,e.params.stock=0):2==e.tab&&(delete e.params.stock,e.params.onsale_type=1),s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.setArea=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/goods_tpl.html",controller:"distributor.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/price_tpl.html",controller:"distributor.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){l()})},e.setProductStock=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){l()})}}])}),define("apps/distributor/controllers/soldout",["apps/common/controllers/controllers"],function(e){e.controller("distributor.soldout",["$scope","$filter","ngPopover","Flash","dgoodsResource","dmerchantSettingResource","dtagResource","$modal","cityData","$rootScope",function(e,t,a,o,s,n,r,i,c,l){function d(){r.get({limit:100},function(t){t._count>100?e.loadAll=!1:e.loadAll=!0,e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}function p(){n.get({},function(t){e.setting.warningStock=angular.isDefined(t.warning_stock)?t.warning_stock:10,e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",u)})}e.title="库存紧张商品",e.setting={},e.setting.warningStock=10,e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.setting={},e.setting.is_discount=1,e.paginationConf={currentPage:1,itemsPerPage:10},e.loadAll=!0,e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",goods_sn:"",stock:e.setting.warningStock,sale:1,column:"created_at",direction:"desc",onsale_act:"all"},d(),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),u()},e.confirmDelete=function(e){s.delete({id:e},function(e){e.success?u():o.create("danger",e.msg)})},e.confirmBatchDelete=function(){s.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(u(),e.goods.checkedAll=!1):o.create("danger","删除失败")})},e.confirmOnSaleUp=function(e,t){s.onSale({id:e,sale:0,onsale_act:t},function(e){e.success?(o.create("success","解除经销商锁定成功"),u()):o.create("danger","解除经销商锁定失败")})},e.confirmOnSale=function(e,t){s.onSale({id:e,sale:0,onsale_act:t},function(e){e.success?(o.create("success","下架成功"),u()):o.create("danger","下架失败")})},e.confirmBatchOffSale=function(t){s.batchToggleSale({ids:e.selectedIds,sale:0,onsale_act:t},function(t){t.success?(o.create("success","下架成功"),u(),e.goods.checkedAll=!1):o.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.batchGoodsTags=function(){s.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),a.close(),o.create("success","分组成功")):o.create("danger","分组失败")})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){s.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","区域设置成功")):o.create("danger","区域设置失败")})},e.batchGoodsDiscount=function(){s.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]}),l.$on("updateTag1",function(t,a){r.get({title:a},function(t){e.tags=t.data})}),e.$on("$destroy",function(){l.$$listeners.updateTag1=null}),e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var n={id:a};n[e]=t,s.editField(n,function(e){e.success?o.create("success","修改成功"):e.error?o.create("danger",e.error):o.create("danger",e.message)})},e.save=function(){n.save({warning_stock:e.setting.warningStock},function(e){e.success?(u(),o.create("success","设置成功")):o.create("danger","设置失败")}),a.close()},e.cancel=function(){a.close()},p();var u=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),e.params.stock=e.setting.warningStock,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.search=function(){1==e.paginationConf.currentPage?u():e.paginationConf.currentPage=1},e.setArea=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/delivery/templates/model.area.html",controller:"areaModalCtrl",resolve:{title:function(){return"选择不配送区域"}}});t.result.then(function(t){e.selectedRegionIds=t.region_id.split(","),e.batchSetRegions()})},e.setGoodsTpl=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/goods_tpl.html",controller:"distributor.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductPrice=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/price_tpl.html",controller:"distributor.price.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.setProductStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.setProductListStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/list_stock_tpl.html",controller:"distributor.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){u()})},e.showQrcode=function(t){s.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){a.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/distributor/controllers/form",["apps/common/controllers/controllers"],function(controllers){controllers.controller("distributor.form",["$location","$scope","$stateParams","$compile","$state","Flash","ngPopover","GoodsData","shopServerData","dcatResource","dpropResource","dpropValueResource","dtagResource","dshipmentResource","dgoodsResource","designData","ddesignGoodsRes","lineResource","$timeout","designValidate","$rootScope",function($location,$scope,$stateParams,$compile,$state,Flash,ngPopover,GoodsData,shopServerData,catResource,propResource,propValueResource,tagResource,shipmentResource,goodsResource,designData,designGoodsRes,lineResource,$timeout,designValidate,$rootScope){function getGoodslines(){lineResource.getlist({enable:1,limit:1e3},function(e){$scope.goods_lines=e.data,$scope.goods_lines.unshift($scope.defaultTag)})}var vm=$scope.vm={},step=$stateParams.step;vm.cates=[],vm.activeTab=step,$scope.isGetProp=!1,$scope.loadAll=!0;var shopServer=shopServerData.get();switch(shopServer.then(function(e){$scope.shopServerData=e}),vm.goodsData=GoodsData,angular.isDefined($stateParams.id)?(vm.is_edit=!!$stateParams.id,vm.goodsData.isStep||(angular.forEach(GoodsData.init(),function(e,t){vm.goodsData[t]=e}),goodsResource.get({id:$stateParams.id},function(e){vm.goodsData.cate[0]={},vm.goodsData.cate[0].data={},vm.goodsData.isCateSelect=!0,vm.goodsData.cate[0].data.id=e.goods_cat_id,vm.goodsData.cate[0].data.name=e.cat_name,$scope.isGetProp||$scope.getProp();var t=$scope.$watch("vm.goodsData.prop",function(a,o){a.length>0&&(t(),angular.forEach(e.props,function(e,t){for(var a in vm.goodsData.prop){var o=vm.goodsData.prop[a];if(e.id==o.id)return vm.goodsData.props[a]={id:e.prop_vid,merchant_id:e.merchant_id,prop_id:e.id,value:e.prop_value},!1}}))},!0);vm.goodsData.title=e.title,angular.forEach(e.imgs,function(e,t){vm.goodsData.imgs[t]={id:e.id,url:e.img}}),vm.goodsData.serve_label=e.serve_label,vm.goodsData.label_ids=e.label_ids;for(var a=0;a<e.label_ids.length;a++)for(var o=0;o<$scope.shopServerData.length;o++)e.label_ids[a]==$scope.shopServerData[o].id&&($scope.shopServerData[o].checked=!0);if(vm.goodsData.selectedGoodsTags=angular.copy(e.tags),vm.goodsData.goods_line_id=e.goods_line_id,vm.goodsData.original_goods_line_id=e.original_goods_line_id,vm.goodsData.is_sku=e.is_sku,vm.goodsData.is_discount=e.is_discount||0,vm.goodsData.goods_sn=e.goods_sn,vm.goodsData.barcode=e.barcode,vm.goodsData.original_id=e.original_id,vm.goodsData.supplier_goods_id=e.supplier_goods_id,e.is_sku){var s=e.products[0].props.split(";").length,n=[];vm.goodsData.skuStock[s]={},angular.forEach(e.products,function(e,t){var a=e.props;vm.goodsData.skuStock[s][a]={id:e.id,img:e.img,price:e.price,supplier_price:e.supplier_price,min_retail_price:e.min_retail_price,max_retail_price:e.max_retail_price,stock:e.stock,product_sn:e.product_sn,barcode:e.barcode,supplier_product_id:e.supplier_product_id},vm.goodsData.skuStock[s][a].str=e.porps_str;var o="";angular.forEach(a.split(";"),function(e,t){o+=e.split(":").join("")}),vm.goodsData.skuStock[s][a].sn=o,n.push(e.props)});var r=n.join(";")+";",i=[],c=$scope.$watch("vm.goodsData.skus",function(e,t){e.length>0&&c(),angular.forEach(vm.goodsData.skus,function(e,t){i=[],angular.forEach(e.prop_values,function(t,a){r.indexOf(e.id+":"+t.id+";")!=-1&&(t.checked=!0,i.push(t))}),i.length>0&&vm.goodsData.skuData.push(i)})},!0)}else vm.goodsData.price=e.price,vm.goodsData.supplier_price=e.supplier_price,vm.goodsData.min_retail_price=e.min_retail_price,vm.goodsData.max_retail_price=e.max_retail_price,vm.goodsData.stock=e.stock;if(vm.goodsData.original_price=e.original_price,vm.goodsData.shipmentType=0!=e.shipment_id?1:0,vm.goodsData.shipmentType){var l=$scope.$watch("vm.goodsData.shipments",function(t,a){angular.forEach(t,function(t,a){t.id==e.shipment_id&&(vm.goodsData.shipment=t,l())})});vm.goodsData.weight=e.weight,vm.goodsData.volume=e.volume}else vm.goodsData.postage=e.postage;vm.goodsData.stockType=e.stock_type,angular.forEach(e.collect_fields,function(e,t){vm.goodsData.collect_fields.push({name:e.name,type:e.type,multiple:!!e.multiple,required:!!e.required})}),vm.goodsData.intro=e.intro,vm.goodsData.components_data=e.components_data,vm.goodsData.designGoodsTpl=e.design_goods_id,vm.goodsData.onsale_type=e.onsale_type,vm.goodsData.onsale_type&&(vm.goodsData.onsale_at=e.onsale_at),vm.goodsData.cquota=e.cquota,vm.goodsData.base_csale=e.base_csale},function(e){}))):(vm.goodsData.original_goods_line_id=0,vm.goodsData.isStep||angular.forEach(GoodsData.init(),function(e,t){vm.goodsData[t]=e})),vm.goodsData.isStep=!1,vm.click={addProp:!1,addPropValue:!1,addSku:!1,editSku:!1},vm.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],$scope.shopServerClick=function(e){var t=vm.goodsData.label_ids.indexOf(e.id);t>-1?(vm.goodsData.label_ids.splice(t,1),e.checked=!1):(vm.goodsData.label_ids.push(e.id),e.checked=!0)},$scope.ngPopoverClose=function(){ngPopover.close()},$scope.nextStep=function(e){switch(vm.goodsData.isStep=!0,e){case 1:angular.isUndefined($stateParams.id)?$state.go("distributor.add.step",{step:e}):Flash.create("danger","商品编辑暂不支持修改类目");break;case 2:$scope.saveValidity(1)?angular.isDefined($stateParams.id)?$state.go("distributor.edit.step",{id:$stateParams.id,step:e}):(vm.goodsData.goods_line_id=0,$state.go("distributor.add.step",{step:e})):vm.goodsData.isStep=!1;break;case 3:$scope.saveValidity(2)?angular.isDefined($stateParams.id)?$state.go("distributor.edit.step",{id:$stateParams.id,step:e}):$state.go("distributor.add.step",{step:e}):vm.goodsData.isStep=!1}},$scope.defaultTag={id:0,name:"所有商品线"},getGoodslines(),$scope.getProp=function(){$scope.isGetProp=!0,propResource.get({goods_cat_id:vm.goodsData.cate[vm.goodsData.cate.length-1].data.id},function(e,t){if(Object.keys(e).length>2)for(var a=0;a<Object.keys(e).length-2;a++)0==e[a].type?vm.goodsData.prop.push(e[a]):vm.goodsData.skus.push(e[a])})},$scope.showAdd=function(e){$(".input-"+e+"-name").val(""),vm.showValue[e]=!vm.showValue[e]},$scope.addProp=function(e){if(GoodsData.cate.length>0){var t=$.trim($("#input-addProp-name").val()),a=$.trim($("#input-addProp-value").val());""!=t?""!=a?(vm.click.addProp=!0,$(e.currentTarget).addClass("btn-submiting-sm"),propResource.save({name:t,input_value:a,goods_cat_id:GoodsData.cate[GoodsData.cate.length-1].data.id,type:0},function(t){Flash.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),t.inputValues=t.input_values,t.input_values=[],t.input_values.push(t.inputValues),GoodsData.prop.push(t),vm.goodsData.prop=GoodsData.prop,vm.goodsData.props[vm.goodsData.prop.length-1]=t.inputValues,vm.showValue.addProp=!1,vm.click.addProp=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addProp=!1})):Flash.create("warning","请填写属性值"):Flash.create("warning","请填写属性名称")}else Flash.create("warning","请先选择品类")},$scope.deleteProp=function(){vm.deletePropID?propResource.delete({id:vm.deletePropID},function(e){e.success?(Flash.create("success","删除成功"),vm.goodsData.prop.splice(vm.deletePropIndex,1),$scope.ngPopoverClose()):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","无法获取到属性ID")},$scope.addPropValue=function(e){var t=$.trim($("#input-addProp-name-pop").val());""!=t?vm.addPropValueID?($(e.currentTarget).addClass("btn-submiting-sm"),
vm.click.addPropValue=!0,propValueResource.save({value:t,prop_id:vm.addPropValueID},function(e){vm.goodsData.prop[vm.addPropValueIndex].input_values.push(e),vm.goodsData.props[vm.addPropValueIndex]=e,$scope.ngPopoverClose(),vm.click.addPropValue=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addPropValue=!1})):Flash.create("warning","无法获取到属性ID"):Flash.create("warning","请填写属性值内容")},$scope.deletePropValue=function(e,t,a){t.stopPropagation(),propValueResource.delete({id:e},function(t){t.success?angular.forEach(vm.goodsData.prop,function(t,o){if(t.id==a)return angular.forEach(t.input_values,function(t,a){if(t.id==e)return vm.goodsData.prop[o].input_values.splice(a,1),"undefined"!=typeof vm.goodsData.props[o]&&vm.goodsData.props[o].id==e&&delete vm.goodsData.props[o],!1}),!1}):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)})},$scope.getTags=function(){tagResource.get({limit:100},function(e){e._count>0?angular.forEach(e.data,function(e,t){GoodsData.tags.push(e)}):GoodsData.tags=[],e._count>100?$scope.loadAll=!1:$scope.loadAll=!0,vm.goodsData.tags=GoodsData.tags},function(e){Flash.create("danger",e.data.error.message)})},$scope.addTag=function(){var e=$.trim($("#input-addTag-name-pop").val());""!=e?tagResource.save({name:e},function(e){Flash.create("success","操作成功"),vm.goodsData.tags.push(e),vm.goodsData.selectedGoodsTags.push(e),$scope.ngPopoverClose()},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","请填写分组名称")},$scope.addTempSkuValue=function(e,t){if(t&&13!=e.keyCode)return!1;var a=$.trim($("#input-addSku-value").val()),o=!1;""!=a?(angular.forEach(vm.skuValueTemp,function(e,t){if(e==a)return o=!0,!1}),o?Flash.create("danger","输入的规格值已存在"):(vm.skuValueTemp.push(a),$("#input-addSku-value").val(""))):Flash.create("warning","规格值名称不能为空")},$scope.deleteTempSkuValue=function(e){vm.skuValueTemp.splice(e,1)},$scope.addSku=function(e){if(GoodsData.cate.length>0){var t={name:$.trim($("#input-addSku-name").val()),goods_cat_id:GoodsData.cate[GoodsData.cate.length-1].data.id,prop_value:vm.skuValueTemp,type:1};""!=t.name?t.prop_value.length>0?(vm.click.addSku=!0,propResource.save(t,function(e){vm.goodsData.skus.push(e),vm.showValue.addSku=!1,vm.click.addSku=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.addSku=!1})):Flash.create("warning","至少添加一个规格值"):Flash.create("warning","规格名称不能为空")}else Flash.create("warning","请先选择品类")},$scope.openEditSku=function(e){vm.skuEditTemp[e]=jQuery.extend(!0,{},vm.goodsData.skus[e])},$scope.editAddTempSkuValue=function(e,t,a){if(a&&13!=t.keyCode)return!1;var o=$.trim($("#input-editAddSku-value-"+e).val()),s=!1;""!=o?(angular.forEach(vm.skuEditTemp[e].prop_values,function(e,t){if(e.name==o)return s=!0,!1}),s?Flash.create("danger","输入的规格值已存在"):(vm.skuEditTemp[e].prop_values.push({name:o}),$("#input-editAddSku-value-"+e).val(""))):Flash.create("warning","规格值名称不能为空")},$scope.deleteEditTempSkuValue=function(e,t){var a=$(t.currentTarget).parent("label").data("pid");vm.skuEditTemp[a].prop_values[e].id&&(vm.skuEditTemp[a].is_del=vm.skuEditTemp[a].is_del?++vm.skuEditTemp[a].is_del:1),vm.skuEditTemp[a].prop_values.splice(e,1)},$scope.editSku=function(e,t){var a="";if(a=0!=vm.skuEditTemp[t].merchant_id?vm.skuEditTemp[t].name=$.trim($("#input-editSku-name-"+vm.skuEditTemp[t].id).val()):vm.skuEditTemp[t].name,vm.skuEditTemp[t].is_del){var o=Utils.confirm("您删除的已有属性值将可能影响到店铺中的其他商品规格");if(!o)return}$(e.currentTarget).addClass("btn-submiting-sm"),vm.click.editSku=!0,propResource.update({id:vm.skuEditTemp[t].id,name:a,prop_values:vm.skuEditTemp[t].prop_values},function(o){o.success?(Flash.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),vm.showValue.editSku[t]=!1,vm.goodsData.skus[t].name=a,angular.forEach(o.data,function(e,a){angular.forEach(vm.goodsData.skus[t].prop_values,function(t,a){e.id==t.id&&t.checked&&(e.checked=!0)})}),vm.goodsData.skus[t].prop_values=o.data):Flash.create("danger",o.error),vm.click.editSku=!1},function(e){Flash.create("danger",e.data.error.message),vm.click.editSku=!1})},$scope.deleteSku=function(){vm.deleteSkuID?propResource.delete({id:vm.deleteSkuID},function(e){e.success?(vm.goodsData.skus.splice(vm.deleteSkuIndex,1),$scope.ngPopoverClose(),$(".sku-list").eq(vm.deleteSkuIndex).remove(),$scope.skuSelect()):Flash.create("danger","删除失败")},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","无法获取到属性ID")},$scope.$watch("vm.goodsData.skus",function(e,t){if(e.length>0){vm.goodsData.skuData=[],vm.goodsData.skuThead=[],$(".sku-list").each(function(){var e=[],t=$(this).index();$(this).children(".sku-tree").children("li").each(function(){$(this).children(".checkbox").children("label").children("input[type='checkbox']").is(":checked")&&e.push(vm.goodsData.skus[t].prop_values[$(this).index()])}),e.length>0&&(vm.goodsData.skuData.push(e),vm.goodsData.skuThead.push(vm.goodsData.skus[t]))}),angular.forEach(vm.goodsData.skuStock[vm.goodsData.skuData.length],function(e,t){e.checked=!1});var a=$scope.renderTable(),o=$(".js-sku-table");o.html(a),$compile(o)($scope)}},!0),$scope.renderTable=function(){var e="";return e+=$scope.renderHeader(),e+=$scope.renderBody(),e+=$scope.renderFooter(),e},$scope.renderHeader=function(){var e="";return angular.forEach(vm.goodsData.skuThead,function(t,a){e+="<td>"+t.name+"</td>"}),"<thead><tr>"+e+'<td>商品图片</td><td>价格</td><td>一级供货价</td><td>零售价区间</td><td>库存</td><td>商家编码</td><td>条形码</td><td width="80">批量操作</td></tr></thead>'},$scope.renderBody=function(){return vm.combine=$scope.calcCombine(vm.goodsData.skuData),$scope.generateRows()},$scope.renderFooter=function(){return""},$scope.calcCombine=function(e){for(var t=[],a=e.length,o=0;a>o;o++){t[o]=1;for(var s=o+1;a>s;s++)t[o]=t[o]*e[s].length}return t},$scope.generateRows=function(){return vm.tableHtml="<tbody>",vm.outputTrTag=0,vm.trIndex=0,vm.skuStringArr=[],vm.skuStringArrNum=[],vm.skuStringArrStr=[],$scope.printRow(0,vm.outputTrTag),vm.tableHtml+"</tbody>"},$scope.printRow=function(e,t){var a=vm.goodsData.skuData,o=a.length;return e!==o&&void(a[e]&&angular.forEach(a[e],function(a,s){if(vm.skuStringArr[e]=a.prop_id+":"+a.id,vm.skuStringArrNum[e]=a.prop_id.toString()+a.id.toString(),vm.skuStringArrStr[e]=a.name,t||(vm.tableHtml+="<tr class='js-sku-content'>",t=1),vm.tableHtml+='<td data-atom-id="'+a.id+'" rowspan="'+vm.combine[e]+'">'+a.name+"</td>",e==o-1){var n=vm.skuStringArr.join(";"),r=vm.skuStringArrNum.join(""),i=vm.skuStringArrStr.join(":"),c=$scope.getAtomStockData(o,n);vm.tableHtml+='<td data-atom-id="'+a.id+'"><div class="thumbnail no-margin" style="width: 80px;height: 80px;" choice-image src="vm.goodsData.skuStock[\''+vm.goodsData.skuData.length+"']['"+n+"'].img\"></div></td>",vm.tableHtml+=$scope.tdTemplate(c,n,r)+"</tr>",vm.trIndex+=1,t=0,"undefined"==typeof vm.goodsData.skuStock[o]&&(vm.goodsData.skuStock[o]={}),"undefined"==typeof vm.goodsData.skuStock[o][n]?vm.goodsData.skuStock[o][n]={id:0,img:"",price:"",supplier_price:"",min_retail_price:"",max_retail_price:"",stock:"",product_sn:"",sn:r,barcode:"",str:i}:vm.goodsData.skuStock[o][n].str=i,vm.goodsData.skuStock[o][n].checked=!0}var l=e+1;$scope.printRow(l,t)}))},$scope.getAtomStockData=function(e,t){return angular.isUndefined(vm.goodsData.skuStock[e])||angular.isUndefined(vm.goodsData.skuStock[e][t])?{id:0,price:"",supplier_price:"",min_retail_price:"",max_retail_price:"",stock:"",product_sn:"",barcode:"",str:""}:vm.goodsData.skuStock[e][t]},$scope.tdTemplate=function(e,t,a){var o=vm.goodsData.skuData.length,s="has-error";return'<td><div class="validator-form" ng-class="{\''+s+"': form.sku_price_"+a+".$invalid && form.sku_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm sku-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].price" type="text" name="sku_price_'+a+'" value="'+e.price+'" /></div></td><td><div style="width: 100px;" class="validator-form" ng-class="{\''+s+"': form.supplier_price_"+a+".$invalid && form.supplier_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm supplier-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].supplier_price" type="text" name="supplier_price_'+a+'" value="'+e.supplier_price+'" /></div></td><td class="lingshou"><div style="width: 100px;float: left;" class="validator-form" ng-class="{\''+s+"': form.min_retail_price_"+a+".$invalid && form.min_retail_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm min-retail-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].min_retail_price" type="text" name="min_retail_price_'+a+'" value="'+e.min_retail_price+'" /></div><div class="" style="width: 20px;float: left;text-align: center;line-height: 30px;">--</div><div style="width: 100px;float: left;" class="validator-form" ng-class="{\''+s+"': form.max_retail_price_"+a+".$invalid && form.max_retail_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm max-retail-price-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].max_retail_price" type="text" name="max_retail_price_'+a+'" value="'+e.max_retail_price+'" /></div></td><td><div class="validator-form" ng-class="{\''+s+"': form.sku_stock_"+a+".$invalid && form.sku_stock_"+a+'.$dirty}"><input custom-number class="form-control input-sm sku-stock-input" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].stock" type="text" name="sku_stock_'+a+'" value="'+e.stock+'" /></div></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].product_sn" type="text" name="sku_product_sn" value="'+e.product_sn+'" /></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="vm.goodsData.skuStock[\''+o+"']['"+t+'\'].barcode" type="text" name="sku_barcode" value="'+e.barcode+'" /></td><td class="setting"><a data-ids="'+t+'" ng-click="openSkuBatch(\''+t+'\')" ng-popover="skuBatch.html" placement="bottom" maximize="true"><i class="fa fa-cog"></i></a></td>'},$scope.openSkuBatch=function(e){var t=vm.goodsData.skuData.length;vm.openSkuBatchString=e,vm.isOpenBatchPrice=!("undefined"!=typeof vm.goodsData.skuStock[t][e].price&&""!=vm.goodsData.skuStock[t][e].price),vm.isOpenBatchStock=!("undefined"!=typeof vm.goodsData.skuStock[t][e].stock&&""!=vm.goodsData.skuStock[t][e].stock)},$scope.skuBatch=function(e,t){var a=vm.openSkuBatchString.split(";"),o=vm.goodsData.skuData.length;angular.forEach(vm.goodsData.skuStock[o],function(s,n){n.indexOf(a[t])!=-1&&("price"==e?vm.goodsData.skuStock[o][n][e]=parseFloat(vm.goodsData.skuStock[o][vm.openSkuBatchString][e]).toFixed(2):vm.goodsData.skuStock[o][n][e]=vm.goodsData.skuStock[o][vm.openSkuBatchString][e])})},$scope.getShipment=function(e){("undefined"==typeof vm.shipments||e)&&shipmentResource.get({},function(e){vm.goodsData.shipments=e.data})},$scope.addCollectFields=function(){var e={name:"",type:"text",multiple:!1,required:!0};vm.goodsData.collect_fields.push(e)},$scope.deleteCollectFields=function(e){vm.goodsData.collect_fields.splice(e,1)},$scope.save=function(){var e=$scope.saveValidity(0);if(!e)return!1;var t=[],a={};vm.goodsData.products=vm.goodsData.skuStock[vm.goodsData.skuData.length],angular.forEach(vm.goodsData.props,function(e,o){a={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.value},t.push(a)}),angular.forEach(vm.goodsData.skuData,function(e,o){angular.forEach(e,function(e,o){a={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.name},t.push(a)})});var o={barcode:vm.goodsData.barcode||"",goods_cat_id:vm.goodsData.cate[vm.goodsData.cate.length-1].data.id,goods_sn:vm.goodsData.goods_sn||"",img:vm.goodsData.imgs[0].url,imgs:vm.goodsData.imgs,tags:[],postage:vm.goodsData.postage||0,original_price:vm.goodsData.original_price||0,price:vm.goodsData.price||0,serve_label:vm.goodsData.serve_label,label_ids:vm.goodsData.label_ids,is_sku:vm.goodsData.is_sku,is_discount:vm.goodsData.is_discount,products:{},props:t,shipment_id:null!=vm.goodsData.shipment?vm.goodsData.shipment.id:0,stock:vm.goodsData.stock||0,stock_type:vm.goodsData.stockType,title:vm.goodsData.title,volume:vm.goodsData.volume||0,weight:vm.goodsData.weight||0,intro:vm.goodsData.intro,design_goods_id:vm.goodsData.designGoodsTpl,onsale_type:vm.goodsData.onsale_type,cquota:vm.goodsData.cquota,base_csale:vm.goodsData.base_csale,goods_line_id:vm.goodsData.goods_line_id||0,supplier_price:vm.goodsData.supplier_price||"",min_retail_price:vm.goodsData.min_retail_price||"",max_retail_price:vm.goodsData.max_retail_price||"",original_id:vm.goodsData.original_id,supplier_goods_id:vm.goodsData.supplier_goods_id};o.component_data=[];var s=angular.copy($scope.slices);for(var n in s){var r=designValidate[s[n].type](s[n].content);if(r)return $scope.editSlice(s[n],r),!1}angular.forEach(s,function(e,t){"goods_head"!=e.type&&o.component_data.push({type:e.type,content:e.content||""})}),o.is_sku&&angular.forEach(vm.goodsData.products,function(e,t){e.checked&&(o.products[t]={id:e.id,img:e.img,price:e.price,supplier_price:e.supplier_price,min_retail_price:e.min_retail_price,max_retail_price:e.max_retail_price,stock:e.stock,props_str:e.str,product_sn:e.product_sn,barcode:e.barcode,supplier_product_id:e.supplier_product_id})}),vm.goodsData.collect_fields&&(o.collect_fields=[],angular.forEach(vm.goodsData.collect_fields,function(e,t){o.collect_fields.push({name:e.name,type:e.type,required:e.required?1:0})})),vm.goodsData.selectedGoodsTags.length>0&&angular.forEach(vm.goodsData.selectedGoodsTags,function(e,t){o.tags.push(e.id)}),vm.goodsData.shipmentType||(o.shipment_id=0),vm.goodsData.onsale_type&&(o.onsale_at=vm.goodsData.onsale_at),$scope.save.disabled=!0,angular.isDefined($stateParams.id)?(o.id=$stateParams.id,goodsResource.update(o,function(e){e.error?(Flash.create("danger",e.error),$scope.save.disabled=!1):"0"==o.onsale_type?$state.go("distributor.auction.list"):$state.go("distributor.forsale.list")},function(e){$scope.save.disabled=!1})):($scope.catesHistory(),goodsResource.save(o,function(e){"0"==o.onsale_type?$state.go("distributor.auction.list"):$state.go("distributor.forsale.list")},function(e){$scope.save.disabled=!1}))},$scope.catesHistory=function(){var catesHistory=localStorage.getItem("catesHistory"),currentCates=[],currentIds=[];catesHistory=catesHistory?eval("("+catesHistory+")"):[],angular.forEach(vm.goodsData.cate,function(e,t){currentCates.push({id:e.data.id,name:e.data.name,parent_id:e.data.parent_id,cchild:e.data.cchild}),currentIds.push(e.data.id)});var distinct=!1,tempIds=[];for(var i in catesHistory)if(tempIds=[],angular.forEach(catesHistory[i],function(e,t){tempIds.push(e.id)}),currentIds.join(",")==tempIds.join(",")){distinct=!0;break}distinct||(catesHistory.length>=5&&catesHistory.splice(4,catesHistory.length-4),catesHistory.unshift(currentCates),localStorage.setItem("catesHistory",JSON.stringify(catesHistory)))},$rootScope.$$listeners.updateTag3||$rootScope.$on("updateTag3",function(e,t){tagResource.get({title:t},function(e){vm.goodsData.tags=e.data})}),$scope.saveValidity=function(e){var t=$scope.form;if(!vm.goodsData.isCateSelect)return Flash.create("danger","请选择商品类目"),!1;if(0==e||2==e||3==e){if(t.goods_title.$invalid)return t.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(0==vm.goodsData.imgs.length)return Flash.create("danger","请至少上传一张商品图片"),!1;if(0==vm.goodsData.goods_line_id)return Flash.create("danger","请选择商品线"),!1;if(!vm.goodsData.is_sku){if(t.goods_price.$invalid)return t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1;if(t.supplier_price.$invalid)return t.supplier_price.$dirty=!0,$("input[name='supplier_price']").focus(),!1;if(t.min_retail_price.$invalid)return t.min_retail_price.$dirty=!0,$("input[name='min_retail_price']").focus(),!1;if(t.max_retail_price.$invalid)return t.max_retail_price.$dirty=!0,$("input[name='max_retail_price']").focus(),!1;if($("input[name='max_retail_price']").val()-$("input[name='min_retail_price']").val()<0)return t.max_retail_price.$dirty=!0,$("input[name='max_retail_price']").focus(),Flash.create("danger","输入最小零售价不能大于最大零售价！"),!1;if($("input[name='supplier_price']").val()<0)return t.supplier_price.$invalid=!0,t.supplier_price.$dirty=!0,$("input[name='supplier_price']").focus(),Flash.create("danger","一级供货价需不小于0.00！"),!1;if(t.goods_stock.$invalid)return t.goods_stock.$dirty=!0,$("input[name='goods_stock']").focus(),!1}if(vm.goodsData.is_sku){var a=!1,o=vm.goodsData.skuData.length;if(0==o)return Flash.create("danger","请至少选择一个商品规格"),!1;for(var s in vm.goodsData.skuStock[o]){var n=vm.goodsData.skuStock[o][s];if(n.checked){var r="sku_price_"+n.sn,i="supplier_price_"+n.sn,c="min_retail_price_"+n.sn,l="max_retail_price_"+n.sn,e="sku_stock_"+n.sn;if(t[r].$invalid)return t[r].$dirty=!0,$("input[name='"+r+"']").focus(),a=!0,!1;if(t[i].$invalid)return t[i].$dirty=!0,$("input[name='"+i+"']").focus(),a=!0,!1;if(t[c].$invalid)return t[c].$dirty=!0,$("input[name='"+c+"']").focus(),a=!0,!1;if(t[l].$invalid)return t[l].$dirty=!0,$("input[name='"+l+"']").focus(),a=!0,!1;if($("input[name='"+i+"']").val()<0)return t[i].$invalid=!0,t[i].$dirty=!0,$("input[name='"+i+"']").focus(),Flash.create("danger","一级供货价需不小于0.00！"),a=!0,!1;if($("input[name='"+l+"']").val()-$("input[name='"+c+"']").val()<0)return t[l].$dirty=!0,$("input[name='"+l+"']").focus(),Flash.create("danger","输入最小零售价不能大于最大零售价！"),a=!0,!1;if(t[e].$invalid)return t[e].$dirty=!0,$("input[name='"+e+"']").focus(),a=!0,!1}}if(a)return!1}if(!vm.goodsData.shipmentType&&t.shipping_price.$invalid)return t.shipping_price.$dirty=!0,$("input[name='shipping_price']").focus(),!1;if(vm.goodsData.shipmentType){if(null==vm.goodsData.shipment)return Flash.create("danger","请选择运费模版"),!1;if(t.weight.$invalid)return t.weight.$dirty=!0,$("input[name='weight']").focus(),!1;if(t.volume.$invalid)return t.volume.$dirty=!0,$("input[name='volume']").focus(),!1}if(t.base_csale.$invalid)return t.base_csale.$dirty=!0,$("input[name='base_csale']").focus(),!1;if(1==vm.goodsData.onsale_type&&("000-00-00 00:00:00"==vm.goodsData.onsale_at||""==vm.goodsData.onsale_at))return Flash.create("danger","请选择上架时间"),!1;if(vm.goodsData.collect_fields){var d=!1;if(angular.forEach(vm.goodsData.collect_fields,function(e,a){var o="collectFieldsName"+a;if(t[o].$invalid)return t[o].$dirty=!0,$('input[name="'+o+'"]').focus(),d=!0,!1}),d)return!1}}return!0},$scope.catesHistoryChange=function(e){for(var t in e){t=parseInt(t);var a=e[t];angular.isUndefined(vm.goodsData.cate[t])&&(vm.goodsData.cate[t]={}),$scope.SelectCate(a.id,a.cchild,t,1,a,1)}},step){case"1":var catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),vm.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),vm.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),vm.catesHistoryList.unshift({ids:-1,strs:"请选择"}),vm.catesHistorySelect=-1,$scope.$watch("vm.catesHistorySelect",function(e,t){if(e!=-1)for(var a in vm.catesHistoryList){var o=vm.catesHistoryList[a];e==o.ids&&$scope.catesHistoryChange(catesHistory[a-1])}}),$scope.SelectCate=function(e,t,a,o,s,n){var r=vm.cates.length,i=a+1;t>0?catResource.get({parent_id:e},function(e){o?(vm.goodsData.cate[a].data=s,e._count>0?(angular.isUndefined(vm.goodsData.cate[i])&&(vm.goodsData.cate[i]={}),vm.goodsData.cate[i].collections=vm.cates[i]=e.data,vm.cates.splice(i+1,r-i-1),n||(vm.goodsData.isCateSelect=!1)):(vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)):(vm.goodsData.cate[a]={},vm.goodsData.cate[a].collections=vm.cates[a]=e.data)},function(e){}):(vm.goodsData.cate[a].data=s,vm.goodsData.cate.splice(i,vm.goodsData.cate.length-i),vm.cates.splice(i,r-i),vm.goodsData.isCateSelect=!0)},$scope.$watch("vm.goodsData.cate",function(e,t){e.length>0&&(vm.goodsData.props={})},!0),0==vm.goodsData.cate.length?$scope.SelectCate(0,1,0,0):(angular.forEach(vm.goodsData.cate,function(e,t){vm.cates[t]=e.collections}),vm.goodsData.isCateSelect=!0);break;case"2":vm.goodsData.tags=[],vm.skuValueTemp=[],vm.skuEditTemp=[],vm.showValue={addProp:!1,addSku:!1,editSku:!1},vm.skuSelectObject={},vm.isSkuSelect=!1,vm.skuType=0;var cateLn=vm.goodsData.cate.length;cateLn>0&&(0==vm.goodsData.skus.length||vm.goodsData.skus.length>0&&vm.goodsData.cate[cateLn-1].data.id!=vm.goodsData.skus[0].goods_cat_id)&&(vm.goodsData.prop=[],vm.goodsData.skus=[],vm.goodsData.skuStock={},$scope.getProp()),$scope.getTags(),$scope.$watch("vm.goodsData.shipmentType",function(e,t){1==e&&0==vm.goodsData.shipments.length&&$scope.getShipment()}),$scope.getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},$scope.nowFormatDate=$scope.getNowFormatDate();break;case"3":$scope.save.disabled=!1,designGoodsRes.get({},function(e){vm.designGoodsList=angular.copy(e.data),vm.designGoodsList.unshift({id:0,title:"普通版"})}),$scope.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],$scope.$watch("vm.goodsData.components_data",function(e,t){if(e.length>0){$scope.slices=e,"goods_head"!=$scope.slices[0].type&&$scope.slices.unshift({type:"goods_head"});for(var a in $scope.slices)"goods_info"==$scope.slices[a].type&&($scope.slices[a].class=!0,$scope.editSlice($scope.slices[a]))}}),$scope.config={},$scope.icon_list=designData.concat(),$scope.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,t){t.item.sortable.droptarget&&e.target!=t.item.sortable.droptarget[0]&&($scope.icon_list=designData.concat(),"mouseup"==e.handleObj.type&&$scope.editSlice(t.item.sortable.moved))}},$scope.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},$scope.goods_info=function(e){"goods_info"==e.type&&($scope.design={type:"text"})},$scope.removeSlice=function(e){$scope.slices.splice(e,1),$scope.design=!1},$scope.editSlice=function(e,t){"goods_head"!=e.type&&($scope.design=e,angular.forEach($scope.slices,function(e,t){e.class=!1}),e.class=!0,$timeout(function(){$scope.$broadcast("design_data",e),angular.isUndefined(t)||$scope.$broadcast("design_dirty",t)},200))},$scope.editSlice($scope.slices[1])}}])}),define("apps/distributor/controllers/material",["apps/common/controllers/controllers"],function(e){e.controller("distributor.material",["$document","$scope","$stateParams","dgoodsExternalResource","Flash",function(e,t,a,o,s){switch(a.type){case"taobao":t.type=0;break;case"shop":t.type=1;break;default:t.type=0}t.toggleTab=function(e){t.type!=e&&(t.type=e,t.searchTitle="",delete t.params.title,i())};var n=function(e){var t=/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w\- .\/?%&=]*)?/,a=new RegExp(t);return a.test(e)||(e=_global.url.ms+e),e},r=function(){t.params.offset=(t.paginationConf.currentPage-1)*t.paginationConf.itemsPerPage,t.params.limit=t.paginationConf.itemsPerPage,t.params.status=t.status,t.params.sorts=t.sorts,t.params.type=t.type,0==Object.keys(t.selectGoodses).length&&(t.selectGoodses[-1]=""),o.gets(t.params,function(e,a){t.paginationConf.totalItems=e._count,t.goodsList=e.data,angular.forEach(t.selectGoodses,function(e,a){var o=!1;angular.forEach(t.goodsList,function(e,s){a==e.id&&(t.goodsList[s].checked=!0,o=!0),t.type&&(t.goodsList[s].img=n(e.img))}),o||delete t.selectGoodses[a]})})};t.paginationConf={currentPage:1,itemsPerPage:10},t.params={offset:(t.paginationConf.currentPage-1)*t.paginationConf.itemsPerPage,limit:t.paginationConf.itemsPerPage,column:"created_at",direction:"desc"},t.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",function(){t.selectGoodses={},r()});var i=function(e){t.checkedAll=!1,1==t.paginationConf.currentPage?r():e?r():t.paginationConf.currentPage=1};t.paginationInit=function(){i()},t.$watch("uploadStatus",function(e,a){e&&(i(),t.uploadStatus=!1)}),t.sorting={price:"",stock:"",created_at:""},t.sortChange=function(e){t.params.column==e?t.params.direction="desc"==t.params.direction?"asc":"desc":(t.params.column=e,t.params.direction="desc"),i()},t.$watch("params.direction + params.column",function(e,a){"undefined"!=typeof e&&angular.forEach(t.sorting,function(e,a){a==t.params.column?t.sorting[a]="sorting-"+t.params.direction:t.sorting[a]=""})}),t.selectGoodses={},t.selectLength=0,t.selectGoods=function(e,a){a?t.selectGoodses[e]=a:delete t.selectGoodses[e]},t.checkedAll=!1,t.$watch("checkedAll",function(e,a){e&&angular.forEach(t.goodsList,function(e,a){t.goodsList[a].checked=!0,t.selectGoodses[e.id]=!0})}),t.$watch("selectGoodses",function(e,a){t.selectLength=Object.keys(e).length,t.selectLength<t.paginationConf.itemsPerPage&&t.paginationConf.totalItems!=t.selectLength&&(t.checkedAll=!1)},!0),t.batchDelete=function(){o.BatchDelete({ids:Object.keys(t.selectGoodses).join(",")},function(e,a){e.success?(t.selectGoodses={},s.create("success","删除成功"),i(t.paginationConf.currentPage)):s.create("danger","删除失败")})},t.goodsDelete=function(e){o.Delete({id:e},function(a,o){a.success?(delete t.selectGoodses[e],s.create("success","删除成功"),i(t.paginationConf.currentPage)):s.create("danger","删除失败")})},t.searchTitle="",t.search=function(){""!=t.searchTitle?t.params.title=t.searchTitle:delete t.params.title,i()}}])}),define("apps/distributor/controllers/material.edit",["apps/common/controllers/controllers"],function(controllers){controllers.controller("distributor.material.edit",["$scope","$state","$stateParams","GoodsData","lineResource","dgoodsExternalResource","dfromPropResource","dtagResource","Flash","designValidate",function($scope,$state,$stateParams,GoodsData,lineResource,goodsExternalResource,fromPropResource,tagResource,Flash,designValidate){function getGoodslines(){lineResource.getlist({enable:1},function(e){$scope.goods_lines=e.data,$scope.goods_lines.unshift($scope.defaultTag)})}$scope.step=$stateParams.step,$scope.goodsData=GoodsData,"undefined"==typeof $scope.goodsData.isStep||$scope.goodsData.isStep||angular.forEach(GoodsData.init(),function(e,t){$scope.goodsData[t]=e}),$scope.nextStep=function(e){switch($scope.goodsData.isStep=!0,e){case 1:$scope.goodsData.external_type?Flash.create("danger","店铺互导不支持修改商品品类"):$state.go("distributor.material.edit",{id:$stateParams.id,step:e});break;case 2:saveValidity(1)?$state.go("distributor.material.edit",{id:$stateParams.id,step:e}):$scope.goodsData.isStep=!1;break;case 3:saveValidity(2)?$state.go("distributor.material.edit",{id:$stateParams.id,step:e}):$scope.goodsData.isStep=!1}},$scope.defaultTag={id:0,name:"所有商品线"},getGoodslines();var getGoodsExternal=function(){goodsExternalResource.get({id:$stateParams.id},function(e,t){$scope.goodsData.has_get=!0,goodsAssign(e)})},goodsAssign=function(e){$scope.goodsData.external_id=$stateParams.id,$scope.goodsData.external_type=e.type,$scope.goodsData.goods_cat_id=e.goods_cat_id||0,e.goods_cat_id>0&&($scope.goodsData.cate[0]={},$scope.goodsData.cate[0].data={id:e.goods_cat_id,name:e.cat_name}),$scope.goodsData.prop=e.props;$scope.$watch("catsProps",function(t){if(t&&t.length>0)for(var a in t){$scope.goodsData.props[a]={};var o=!1;for(var s in e.props){var n=e.props[s];if(t[a].id==n.id){$scope.goodsData.props[a].id=n.prop_vid,$scope.goodsData.props[a].merchant_id=n.merchant_id,$scope.goodsData.props[a].prop_id=n.id,$scope.goodsData.props[a].value=n.prop_value,o=!0;break}}o||delete $scope.goodsData.props[a]}},!0);if($scope.goodsData.title=e.title,$scope.goodsData.tags=[],$scope.goodsData.is_sku=e.is_sku,$scope.goodsData.is_discount=e.is_discount||0,$scope.goodsData.original_id=e.original_id,$scope.goodsData.goods_line_id=e.goods_line_id||0,$scope.original_goods_line_id=e.original_goods_line_id,$scope.goodsData.supplier_goods_id=e.supplier_goods_id,e.is_sku){var t=e.products[0].props.split(";").length,a=[];$scope.goodsData.skuStock[t]={},angular.forEach(e.products,function(e,o){var s=e.props;$scope.goodsData.skuStock[t][s]={id:e.id,price:e.price,supplier_price:e.supplier_price,min_retail_price:e.min_retail_price,max_retail_price:e.max_retail_price,stock:e.stock,product_sn:e.product_sn,barcode:e.barcode,supplier_product_id:0},$scope.goodsData.skuStock[t][s].str=e.porps_str;var n="";angular.forEach(s.split(";"),function(e,t){n+=e.split(":").join("")}),$scope.goodsData.skuStock[t][s].sn=n,a.push(e.props)});var o=a.join(";")+";",s=[];$scope.$watch("goodsData.skus",function(e,t){angular.forEach($scope.goodsData.skus,function(e,t){s=[],angular.forEach(e.prop_values,function(t,a){o.indexOf(e.id+":"+t.id+";")!=-1&&(t.checked=!0,s.push(t))}),s.length>0&&$scope.goodsData.skuData.push(s)})},!0)}if($scope.goodsData.price=e.price,$scope.goodsData.supplier_price=e.supplier_price,$scope.goodsData.min_retail_price=e.min_retail_price,$scope.goodsData.max_retail_price=e.max_retail_price,$scope.goodsData.stock=e.stock,$scope.goodsData.products=e.products,$scope.goodsData.barcode=e.barcode,$scope.goodsData.goods_sn=e.goods_sn,$scope.goodsData.postage=e.postage,$scope.goodsData.shipments=[],$scope.goodsData.shipment_type=0!=e.shipment_id?1:0,$scope.goodsData.shipment_id=e.shipment_id,$scope.goodsData.shipment_type){$scope.$watch("goodsData.shipments",function(t){angular.forEach(t,function(t,a){t.id==e.shipment_id&&($scope.goodsData.shipment=t)})})}$scope.goodsData.weight=e.weight,$scope.goodsData.volume=e.volume,$scope.goodsData.collect_fields=e.collect_fields||[],$scope.goodsData.stock_type=e.stock_type,$scope.goodsData.onsale_type=e.onsale_type,$scope.goodsData.onsale_at=e.onsale_at,$scope.goodsData.cquota=e.cquota,$scope.goodsData.skuThead=[],$scope.goodsData.intro=e.intro||"",$scope.goodsData.description=e.description||"",$scope.goodsData.external_type&&angular.forEach(e.components_data,function(e,t){"goods_info"==e.type&&$scope.goodsData.components_data.push(e)}),$scope.goodsData.merchant_id=e.merchant_id,$scope.goodsData.shop_id=e.shop_id,$scope.goodsData.imgs=[],angular.forEach(e.imgs,function(e,t){""!=e&&$scope.goodsData.imgs.push({url:e})})},getProp=function(e){$scope.catsProps=[],fromPropResource.get({goods_cat_id:e,merchant_id:$scope.goodsData.merchant_id,shop_id:$scope.goodsData.shop_id},function(e,t){angular.forEach(e,function(e,t){if(0==e.type&&$scope.catsProps.push(e),1==e.type){var a=!1;for(var o in $scope.goodsData.skus)if($scope.goodsData.skus[o].id==e.id){a=!0;break}a||$scope.goodsData.skus.push(e)}})})},getTags=function(){$scope.shopTags=[],tagResource.get("",function(e,t){e._count>0&&angular.forEach(e.data,function(e,t){$scope.shopTags.push(e)})})},getNowFormatDate=function(){var e=new Date,t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},createCatesHistory=function(){var catesHistory=localStorage.getItem("catesHistory"),currentCates=[],currentIds=[];catesHistory=catesHistory?eval("("+catesHistory+")"):[],angular.forEach($scope.goodsData.cate,function(e,t){currentCates.push({id:e.data.id,name:e.data.name,parent_id:e.data.parent_id,cchild:e.data.cchild}),currentIds.push(e.data.id)});var distinct=!1,tempIds=[];for(var i in catesHistory)if(tempIds=[],angular.forEach(catesHistory[i],function(e,t){tempIds.push(e.id)}),currentIds.join(",")==tempIds.join(",")){distinct=!0;break}distinct||(catesHistory.length>=5&&catesHistory.splice(4,catesHistory.length-4),catesHistory.unshift(currentCates),localStorage.setItem("catesHistory",JSON.stringify(catesHistory)))};$scope.addTagInit={name:{name:"分组名称",value:""}},$scope.addTagFun=function(){var e=$scope.addTagInit.name.value;""!=e?tagResource.save({name:e},function(e,t){Flash.create("success","操作成功"),$scope.shopTags.push(e),$scope.goodsData.tags.push(e)},function(e){Flash.create("danger",e.data.error.message)}):Flash.create("warning","请填写分组名称")};var saveValidity=function(e){var t=$scope.form;
if(0==$scope.goodsData.goods_cat_id)return Flash.create("danger","请选择商品类目"),!1;if(0==e||2==e||3==e){if(t.goods_title.$invalid)return t.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(0==$scope.goodsData.imgs.length)return Flash.create("danger","请至少上传一张商品图片"),!1;if(0==$scope.goodsData.goods_line_id)return Flash.create("danger","请选择商品线"),!1;if(!$scope.goodsData.is_sku){if(t.goods_price.$invalid)return t.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1;if(t.supplier_price.$invalid)return t.supplier_price.$dirty=!0,$("input[name='supplier_price']").focus(),!1;if(t.min_retail_price.$invalid)return t.min_retail_price.$dirty=!0,$("input[name='min_retail_price']").focus(),!1;if(t.max_retail_price.$invalid)return t.max_retail_price.$dirty=!0,$("input[name='max_retail_price']").focus(),!1;if($("input[name='max_retail_price']").val()-$("input[name='min_retail_price']").val()<0)return t.max_retail_price.$dirty=!0,$("input[name='max_retail_price']").focus(),Flash.create("danger","输入最小零售价不能大于最大零售价！"),!1;if($("input[name='supplier_price']").val()<0)return t.supplier_price.$invalid=!0,t.supplier_price.$dirty=!0,$("input[name='supplier_price']").focus(),Flash.create("danger","一级供货价需不小于0.00！"),!1;if(t.goods_stock.$invalid)return t.goods_stock.$dirty=!0,$("input[name='goods_stock']").focus(),!1}if($scope.goodsData.is_sku){var a=!1,o=$scope.goodsData.skuData.length;if(0==o)return Flash.create("danger","请至少选择一个商品规格"),!1;for(var s in $scope.goodsData.skuStock[o]){var n=$scope.goodsData.skuStock[o][s];if(n.checked){var r="sku_price_"+n.sn,i="supplier_price_"+n.sn,c="min_retail_price_"+n.sn,l="max_retail_price_"+n.sn,e="sku_stock_"+n.sn;if(t[r].$invalid)return t[r].$dirty=!0,$("input[name='"+r+"']").focus(),a=!0,!1;if(t[i].$invalid)return t[i].$dirty=!0,$("input[name='"+i+"']").focus(),a=!0,!1;if(t[c].$invalid)return t[c].$dirty=!0,$("input[name='"+c+"']").focus(),a=!0,!1;if(t[l].$invalid)return t[l].$dirty=!0,$("input[name='"+l+"']").focus(),a=!0,!1;if($("input[name='"+i+"']").val()<0)return t[i].$invalid=!0,t[i].$dirty=!0,$("input[name='"+i+"']").focus(),Flash.create("danger","一级供货价需不小于0.00！"),a=!0,!1;if($("input[name='"+l+"']").val()-$("input[name='"+c+"']").val()<0)return t[l].$dirty=!0,$("input[name='"+l+"']").focus(),Flash.create("danger","输入最小零售价不能大于最大零售价！"),a=!0,!1;if(t[e].$invalid)return t[e].$dirty=!0,$("input[name='"+e+"']").focus(),a=!0,!1}}if(a)return!1}if(!$scope.goodsData.shipment_type&&t.shipping_price.$invalid)return t.shipping_price.$dirty=!0,$("input[name='shipping_price']").focus(),!1;if($scope.goodsData.shipment_type){if(null==$scope.goodsData.shipment)return Flash.create("danger","请选择运费模版"),!1;if(t.weight.$invalid)return t.weight.$dirty=!0,$("input[name='weight']").focus(),!1;if(t.volume.$invalid)return t.volume.$dirty=!0,$("input[name='volume']").focus(),!1}if(1==$scope.goodsData.onsale_type&&("000-00-00 00:00:00"==$scope.goodsData.onsale_at||""==$scope.goodsData.onsale_at))return Flash.create("danger","请选择上架时间"),!1;if($scope.goodsData.collect_fields){var d=!1;if(angular.forEach($scope.goodsData.collect_fields,function(e,a){var o="collectFieldsName"+a;if(t[o].$invalid)return t[o].$dirty=!0,$('input[name="'+o+'"]').focus(),d=!0,!1}),d)return!1}}return!0};switch($scope.save=function(e){var t=saveValidity(0);if(!t)return!1;var a=[],o={};$scope.goodsData.products=$scope.goodsData.skuStock[$scope.goodsData.skuData.length],angular.forEach($scope.goodsData.props,function(e,t){o={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.value},a.push(o)}),angular.forEach($scope.goodsData.skuData,function(e,t){angular.forEach(e,function(e,t){o={prop_id:e.prop_id,prop_vid:e.id,prop_value:e.name},a.push(o)})});var s={external_id:$scope.goodsData.external_id,barcode:$scope.goodsData.barcode||"",goods_cat_id:$scope.goodsData.goods_cat_id,goods_sn:$scope.goodsData.goods_sn||"",tags:[],img:$scope.goodsData.imgs[0].url,imgs:$scope.goodsData.imgs,postage:$scope.goodsData.postage||0,price:$scope.goodsData.price||0,is_sku:$scope.goodsData.is_sku,products:{},props:a,shipment_id:null!=$scope.goodsData.shipment?$scope.goodsData.shipment.id:0,stock:$scope.goodsData.stock||0,is_discount:$scope.goodsData.is_discount||0,stock_type:$scope.goodsData.stock_type,title:$scope.goodsData.title,volume:$scope.goodsData.volume||0,weight:$scope.goodsData.weight||0,intro:$scope.goodsData.intro,design_goods_id:$scope.goodsData.designGoodsTpl,onsale_type:$scope.goodsData.onsale_type,cquota:$scope.goodsData.cquota,goods_line_id:$scope.goodsData.goods_line_id||0,supplier_price:$scope.goodsData.supplier_price||"",min_retail_price:$scope.goodsData.min_retail_price||"",max_retail_price:$scope.goodsData.max_retail_price||"",original_id:$scope.goodsData.original_id||0,supplier_goods_id:$scope.goodsData.supplier_goods_id||0,original_price:$scope.goodsData.original_price||0};s.component_data=[];var n=angular.copy($scope.goodsData.slices);for(var r in n){var i=designValidate[n[r].type](n[r].content);if(i)return $scope.editSlice(n[r],i),!1}angular.forEach(n,function(e,t){"goods_head"!=e.type&&s.component_data.push({type:e.type,content:e.content||""})}),s.is_sku&&angular.forEach($scope.goodsData.products,function(e,t){e.checked&&(s.products[t]={id:e.id,price:e.price,supplier_price:e.supplier_price,min_retail_price:e.min_retail_price,max_retail_price:e.max_retail_price,stock:e.stock,props_str:e.str,product_sn:e.product_sn,barcode:e.barcode,supplier_product_id:0})}),$scope.goodsData.collect_fields&&(s.collect_fields=$scope.goodsData.collect_fields),$scope.goodsData.tags.length>0&&angular.forEach($scope.goodsData.tags,function(e,t){s.tags.push(e.id)}),$scope.goodsData.shipment_type||(s.shipment_id=0),$scope.goodsData.onsale_type&&(s.onsale_at=$scope.goodsData.onsale_at),createCatesHistory(),$(e.currentTarget).addClass("btn-submiting-sm"),$scope.save.disabled=!0,goodsExternalResource.save(s,function(e,t){"0"==s.onsale_type?$state.go("distributor.auction.list"):$state.go("distributor.forsale.list")},function(t,a){Flash.create("danger","编辑失败"),$(e.currentTarget).removeClass("btn-submiting-sm"),$scope.save.disabled=!1})},$scope.goodsData.isStep&&$scope.goodsData.has_get||getGoodsExternal(),$scope.step){case"1":$scope.is_next=!1,$scope.$watch("goodsData.goods_cat_id",function(e){0==e?$scope.is_next=!1:$scope.is_next=!0});break;case"2":$scope.$watch("goodsData.goods_cat_id",function(e){0!=e&&getProp($scope.goodsData.goods_cat_id)}),getTags(),$scope.nowFormatDate=getNowFormatDate();break;case"3":$scope.save.disabled=!1}$scope.goodsData.isStep=!1}])}),define("apps/distributor/controllers/goods_tpl",["apps/common/controllers/controllers"],function(e){e.controller("distributor.tpl",["$scope","Flash","ddesignGoodsRes","dgoodsResource","selectedIds","$modalInstance",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",column:"created_at",direction:"desc"},e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),r()},e.cancel=function(){n.dismiss("cancel")},e.useTpl=function(e){o.batchDesignGoods({design_goods_id:e,goods_ids:s},function(e){e.success?(t.create("success","设置模板成功"),n.close()):t.create("danger","设置模板失败")})};var r=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goodsTpls=t.data})};e.search=function(){r()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r)}])}),define("apps/distributor/controllers/price_tpl",["apps/common/controllers/controllers"],function(e){e.controller("distributor.price.tpl",["$scope","Flash","dproductResource","goodsId","$modalInstance",function(e,t,a,o,s){function n(){a.get({id:o,field:"price"},function(t){e.products=t})}e.products=[],e.cancel=function(){s.dismiss("cancel")},e.saveProductPrice=function(){a.update({id:o,products:e.products},function(e){e.success?(t.create("success","保存成功"),s.close()):t.create("danger","保存失败")})},n()}])}),define("apps/distributor/controllers/stock_tpl",["apps/common/controllers/controllers"],function(e){e.controller("distributor.stock.tpl",["$scope","Flash","dproductResource","goodsId","$modalInstance",function(e,t,a,o,s){function n(){a.get({id:o,field:"stock"},function(t){e.products=t})}e.products=[],e.cancel=function(){s.dismiss("cancel")},e.saveProductStock=function(){a.update({id:o,products:e.products},function(e){e.success?(t.create("success","保存成功"),s.close()):t.create("danger",e.error)})},n()}])}),define("apps/distributor/controllers/line",["apps/common/controllers/controllers"],function(e){e.controller("distributor.line",["$scope","$filter","ngPopover","Flash","lineResource","synchronizationResource","$modal","cityData",function(e,t,a,o,s,n,r,i){e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){a.close()},e.cancel=function(){a.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.saveField=function(e,t,a){var n={id:a};n[e]=t,s.editField(n,function(e){e.status?o.create("success",e.msg):o.create("danger",e.msg)})},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:0,column:"created_at",direction:"desc"},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),c()},e.enable=function(e){s.update({id:e,enable:1},function(e){e.status?(c(),o.create("success",e.msg)):o.create("danger","启用失败")})},e.disable=function(e){s.update({id:e,enable:0},function(e){e.status?(c(),o.create("success",e.msg)):o.create("danger","禁用失败")})},e.synchronization=function(e,t){n.listput({id:e},function(e){e.status?(c(),o.create("success",e.msg)):o.create("danger","同步失败")})};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.getlist(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c)}])}),define("apps/distributor/controllers/line.info",["apps/common/controllers/controllers"],function(e){e.controller("distributor.line.info",["$scope","lineResource","$stateParams","Flash","$state","$modal","$timeout",function(e,t,a,o,s,n,r){a.id?(e.title="修改商品线",t.get({id:a.id},function(t){e.data=t,r(function(){$('input[name="created_range"]').val(t.dt_validity_begin+"/"+t.dt_validity_end)},20),e.is_edit=1})):(e.title="新增商品线",e.data={enable:1}),e.customGoods=function(){var t=n.open({animation:!1,templateUrl:"assets/js/apps/design/templates/model_goods_list.html",controller:"modelGoodsCtrl"});t.result.then(function(t){"undefined"==typeof e.data.goods?e.data.goods=t:e.data.goods=e.data.goods.concat(t)})},e.btn_text="保存",e.submitForm=function(n){n&&(e.btn_text="保存中...",e.form.$invalid=!0,a.id?t.update({id:a.id},e.data,function(t){t.status?(s.go("distributor.line.list"),e.btn_text="保存",o.create("success"," 保存成功！")):(e.btn_text="保存",o.create("danger",res.msg))},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}):t.save(e.data,function(t){t.status?(s.go("distributor.line.list"),e.btn_text="保存",o.create("success"," 保存成功！")):(e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.msg))},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error.message)}))}}])}),define("apps/distributor/controllers/linegoods",["apps/common/controllers/controllers"],function(e){e.controller("distributor.line.linegoods",["$scope","$stateParams","$filter","ngPopover","Flash","linegoddsResource","synchronizationResource","$modal","cityData",function(e,t,a,o,s,n,r,i,c){e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){o.close()},e.cancel=function(){o.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.add_goods=function(){var e=i.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/distributor/templates/linegoods.goods.list.html",controller:"lineGoodsModalCtrl"});e.result.then(function(e){l()})},e.setProductPrice=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/lineprice_tpl.html",controller:"distributor.lineprice.tpl",resolve:{sku:function(){return e}}});t.result.then(function(){l()})},e.saveField=function(e,t,a){var o={id:a};o[e]=t,n.editField(o,function(e){e.status?s.create("success",e.msg):s.create("danger",e.msg)})},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:0,column:"created_at",direction:"desc"},e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),l()},e.enable=function(e){n.onSale({id:e,onsale:1},function(e){e.status?(l(),s.create("success",e.msg)):s.create("danger","上架失败")})},e.disable=function(e){n.onSale({id:e,onsale:0},function(e){e.status?(l(),s.create("success",e.msg)):s.create("danger","下架失败")})},e.confirmDelete=function(e,t){n.delete({id:e,goods_line_id:t},function(e){e.status?(l(),s.create("success",e.msg)):s.create("danger","删除失败")})},e.synchronization=function(e,t){r.put({id:e},function(e){e.status?(l(),s.create("success",e.msg)):s.create("danger","同步失败")})};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.goods_line_id=t.id,n.getlist(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l)}])}),define("apps/distributor/controllers/linegoods.goods.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("lineGoodsModalCtrl",["$scope","$stateParams","$modalInstance","linegoddsctrlResource","dtagResource","Flash","$state",function(e,t,a,o,s,n,r){function c(){s.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.selected=[],e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,type:1,column:"id",direction:"desc"},c();var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.tag_id=e.tag.selected.id),o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data;for(i in e.goods)for(j in a.contentgoods)e.goods[i].id==a.contentgoods[j].goods_id&&(e.goods[i].has_show=1)})};e.search=function(){l()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",l()},e.toggleSelection=function(t){var a=e.selected.indexOf(t);a>-1?e.selected.splice(a,1):e.selected.push(t)},e.ok=function(){var s=e.selected.join(",");o.add({goods_line_id:t.id,supplier_goods_str:s},function(e){e.status?(n.create("success",e.msg),a.close()):n.create("danger",e.msg)})},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/distributor/controllers/lineprice_tpl",["apps/common/controllers/controllers"],function(e){e.controller("distributor.lineprice.tpl",["$scope","Flash","dproductResource","sku","$modalInstance",function(e,t,a,o,s){e.products=o,e.cancel=function(){s.dismiss("cancel")}}])}),define("apps/distributor/controllers/supplier/withdraw.account.details",["apps/common/controllers/controllers"],function(e){e.controller("withdraw.account.details",["$scope","Flash","$modal","$filter","accountDetailsResource",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,company_name:"",startDate:"",endDate:"",level:e.level};var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.settleds=t.data})};e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n)}])}),define("apps/distributor/controllers/supplier/withdraw.account",["apps/common/controllers/controllers"],function(e){e.controller("withdraw.account",["$scope","Flash","$modal","$filter","accountResource","rankResource","ngPopover",function(e,t,a,o,s,n,r){e.level="all",e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},n.get(function(t){e.levelData=t.data}),e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,company_name:"",name:"",startDate:"",endDate:"",level:e.level};var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){1==e.paginationConf.currentPage?i():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a,e.remarkInfo.merchant_id=t.merchant_id},e.cancel=function(){r.close(),e.remarkInfo={id:"",text:""}},e.rechargeInfo={money:""},e.setRecharge=function(){var o=parseFloat(e.rechargeInfo.money),s=!1;if(""==e.rechargeInfo.money)t.create("danger","请填写充值金额");else{var n=/^\d+(\.\d+)?$/;if(n.test(e.rechargeInfo.money))if(o>0){var r=e.rechargeInfo.money.indexOf("."),i=0;r>0?(i=e.rechargeInfo.money.split(".")[1].length,i>2&&t.create("danger","充值金额只能包含两位小数,并且大于0"),e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),o=parseFloat(e.rechargeInfo.money),s=o>0):r==-1?(e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),s=!0):(t.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00")}else t.create("danger","输入的金额不能为0"),e.rechargeInfo.money="0.00";else t.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00",s=!1}if(s){var c=a.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/recharge.code.html",controller:"ssetRechargeCon",backdrop:!1,resolve:{data:function(){return e.rechargeInfo}}});c.result.then(function(e){})}}}]),e.controller("ssetRechargeCon",["$scope","$modalInstance","supplierRechargeResource","data","Flash","$location",function(e,t,a,o,s,n){e.IsSuccess={type:1},a.update({amount:o.money,merchant_id:o.merchant_id},function(t){t.success&&(e.rechargeInfo=t.data)}),e.paySuccess=function(){a.success({recharge_sn:e.rechargeInfo.recharge_sn},function(t){t.status?e.IsSuccess.type=2:s.create("danger",t.msg)})},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){n.path("/trade"),e.cancel()}}])}),define("apps/distributor/controllers/supplier/withdraw.manage",["apps/common/controllers/controllers"],function(e){e.controller("withdraw.manage",["$scope","Flash","$modal","$filter","ngPopover","swithdrawResource","$state","actionWithdrawSource","sRemarkSource",function(e,t,a,o,s,n,r,i,c){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.cancel=function(){s.close(),e.remarkInfo={id:"",text:""}},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,startDate:"all",endDate:"all",status:"all",is_supplier:!0,level:e.level};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0]?t[0]:"all",e.params.endDate=t[1]?t[1]:"all"):(delete e.params.startDate,delete e.params.endDate),1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l);var d=1;e.confirmCross=function(e,a){d&&(d=0,i.putWithdraw({id:e,status:1},function(e){e.status?(t.create("success","操作成功"),l()):t.create("danger",e.msg),d=1}))},e.confirmRefuse=function(e,a){i.putWithdraw({id:e,status:2},function(e){e.status?(t.create("success","操作成功"),l()):t.create("danger",e.msg)})},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a},e.set_remark=function(){var a={id:e.remarkInfo.id,content:e.remarkInfo.text};a.content?c.update(a,function(a){a.status?(t.create("success","提交成功"),s.close(),e.data[e.remarkInfo.index].remark=e.remarkInfo.text):t.create("danger",a.error)}):t.create("danger","请填写备注")},e.export=function(){var e="/suppliers/supplier_withdraw.json?export=true";window.location.href=e,t.create("success","正在导出,请等待...")}}])}),define("apps/distributor/controllers/supplier/rank.list",["apps/common/controllers/controllers"],function(e){e.controller("supplier.rank.list",["$scope","ngPopover","$resource","rankResource",function(e,t,a,o){var s=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1}}])}),define("apps/distributor/controllers/supplier/rank.info",["apps/common/controllers/controllers"],function(e){e.controller("supplier.rank.info",["$scope","rankResource","$stateParams","Flash","$state",function(e,t,a,o,s){a.id&&t.get({id:a.id},function(t){e.data=t}),e.submitForm=function(n){n&&(e.form.$invalid=!0,a.id&&t.update({id:a.id},e.data,function(t){t.status?(o.create("success"," 保存成功！"),e.btn_text="保存",s.go("distributor.supplier.rank.list",{status:"all"})):o.create("danger",t.error.message)},function(t){e.btn_text="保存",e.form.$invalid=!1,o.create("danger",t.data.error)}))}}])}),define("apps/distributor/controllers/supplier/dashboard.supply",["apps/common/controllers/controllers","echarts"],function(e,t){e.controller("dashboard.supply",["$scope","Flash","$modal","$filter","supplierDashboardResource",function(e,a,o,s,n){var r=t.init(document.getElementById("supplier-chart"));n.get(function(t){e.data=t;var a=[],o=[];angular.forEach(t.agent,function(e,t){a.push(e.company_name),o.push(e.supplier_amount)});var s={title:{subtext:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",splitLine:{show:!1},data:a}],yAxis:[{type:"value"}],series:[{name:"供货额",type:"bar",stack:"总量",itemStyle:{normal:{label:{show:!0,position:"inside"}}},data:o}]};r.setOption(s)})}])}),define("apps/distributor/controllers/supplier/dashboard.income",["apps/common/controllers/controllers","echarts","echarts/chart/line"],function(e,t){e.controller("distributor.dashboard.income",["$scope","incomeGraphResource","supplierDashboardResource","Flash","$modal","ngPopover",function(e,a,o,s,n,r){var i=t.init(document.getElementById("chart")),c=[],l=[],d={tooltip:{trigger:"axis"},legend:{data:["收入总额"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:c}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"收入总额",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:l}]};a.query().$promise.then(function(e){angular.forEach(e,function(e,t){c.push(e.date),l.push(e.supplier_amount)}),i.setOption(d)}),o.get(function(t){e.income=t}),e.cancel=function(){r.close(),e.remarkInfo={id:"",text:""}},e.rechargeInfo={money:""},e.setRecharge=function(){var t=parseFloat(e.rechargeInfo.money),a=!1;if(""==e.rechargeInfo.money)s.create("danger","请填写充值金额");else{var o=/^\d+(\.\d+)?$/;if(o.test(e.rechargeInfo.money))if(t>0){var i=e.rechargeInfo.money.indexOf("."),c=0;i>0?(c=e.rechargeInfo.money.split(".")[1].length,c>2&&s.create("danger","充值金额只能包含两位小数,并且大于0"),e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),t=parseFloat(e.rechargeInfo.money),a=t>0):i==-1?(e.rechargeInfo.money=parseFloat(e.rechargeInfo.money).toFixed(2),a=!0):(s.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00")}else s.create("danger","输入的金额不能为0"),e.rechargeInfo.money="0.00";else s.create("danger","请输入正确的金额"),e.rechargeInfo.money="0.00",a=!1}if(a){r.close();var l=n.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/recharge.code.html",controller:"supplierSetRechargeCon",backdrop:!1,resolve:{data:function(){return e.rechargeInfo.money}}});l.result.then(function(e){})}}}]).controller("supplierSetRechargeCon",["$scope","$modalInstance","sRechargeResource","data","Flash","$location",function(e,t,a,o,s,n){e.IsSuccess={type:1},a.update({amount:o},function(t){t.success&&(e.rechargeInfo=t.data)}),e.paySuccess=function(){window.location.reload(),e.cancel()},e.cancel=function(){t.dismiss("cancel")},e.ok=function(){window.location.reload(),e.cancel()}}])}),define("apps/distributor/controllers/supplier/suppliers.list",["apps/common/controllers/controllers"],function(e){e.controller("distributor.supplier.suppliers.list",["$scope","ngPopover","$resource","suppliersResource","rankResource","Flash","$stateParams","$state","suppliersPasswordResource","$location",function(e,t,a,o,s,n,r,i,c,l){e.enable="all",e.level="all"==r.level?"all":r.level;var d=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};o.query({offset:(t.offset-1)*t.limit,limit:t.limit,enable:e.enable,shop_name:e.shop_name,level:e.level},function(t){e.paginationConf.totalItems=t._count,e.data=t.data}),s.query({offset:(t.offset-1)*t.limit,limit:t.limit},function(t){e.levelData=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1},e.passwordInfo={password:"",id:"",user_id:"",merchant_id:""},e.set_passwordClick=function(t){e.passwordInfo.id=t.merchant_id,e.passwordInfo.user_id=t.user_id,e.passwordInfo.merchant_id=t.merchant_id},e.set_password=function(){e.passwordInfo.password?c.setPassword(e.passwordInfo,function(e){e.status?(n.create("success","修改成功"),t.close()):n.create("danger","修改失败")}):n.create("danger","请填写新密码")},e.cancel=function(){t.close()},e.over=function(t,a){1==a.enabled?a.enabled=0:a.enabled=1,o.update({id:a.id},{enabled:a.enabled},function(t){t.success&&(n.create("success"," 保存成功！"),e.btn_text="保存"),t.error&&n.create("danger",t.error.message)},function(t){e.btn_text="保存",n.create("danger",t.data.error)})},e.showQrcode=function(t){e.qrcodeInfo=t},e.goDispatct=function(e,t){l.path("/distributor/supplier/suppliers/dispatcts/"+e+"/"+encodeURI(t))}}])}),define("apps/distributor/controllers/supplier/suppliers.info",["apps/common/controllers/controllers"],function(e){e.controller("distributor.supplier.suppliers.info",["$scope","suppliersResource","suppliersMaxCagentResource","$stateParams","Flash","$state","rankResource","suppliersResourceLoder","suppliersGoodsLineResource",function(e,t,a,o,s,n,r,i,c){if(e.items={},o.id){e.isEdit=!0;var l=e.city=this;e.title="编辑经销商",e.data=i,a.get(function(t){t.status?1==t.is_cj?e.mcagent=t.mcagent:e.mcagent=t.mcagent+e.data.max_cagent:s.create("danger","接口请求超时!")}),c.get({enable:1,limit:1e3},function(t){t.data.unshift({id:"all",name:"请选择商品线"}),e.GoodsLineData=t.data}),l.regions={country:e.data.country,province:e.data.province,city:e.data.city,district:e.data.district},l.start="country",l.end="district",e.items={selected_city:[{id:e.data.country},{id:e.data.province},{id:e.data.city},{id:e.data.district}],address:e.data.address}}else{a.get(function(t){t.status?0==t.mcagent?e.mcagent=t.mcagent:e.mcagent=t.mcagent-1:s.create("danger","接口请求超时!")}),e.title="新增经销商",e.isEdit=!1;var l=e.city=this;l.regions={country:1},l.start="country",l.end="district",r.get({is_limit_level:!0},function(t){e.data={has_shop:0,receive_money:0,goods_deliver:0,level_discount:100,add_agent:1,design_feature_copy:0},t.data[0]&&(e.data.level=t.data[0].level),e.levelData=t.data}),c.get({enable:1,limit:1e3},function(t){t.data.unshift({id:"all",name:"请选择商品线"}),e.data.goods_line_id="all",e.GoodsLineData=t.data})}e.$watch("city",function(t){angular.isUndefined(t.selected)||(t.selected.length>2&&(e.cityname=t.selected[1].name),e.items.selected_city=t.selected)},!0),e.submitForm=function(a){if(a){if(!(e.items.selected_city[0]&&e.items.selected_city[1]&&e.items.selected_city[2]&&e.items.selected_city[3]&&e.items.selected_city[0].id&&e.items.selected_city[1].id&&e.items.selected_city[2].id&&e.items.selected_city[3].id))return void s.create("danger","请填写完整的所属区域!");if(!e.data.goods_line_id||"all"==e.data.goods_line_id)return void s.create("danger","请选择商品线!");if(e.form.$invalid=!0,e.data.country=e.items.selected_city[0].id,e.data.province=e.items.selected_city[1].id,e.data.city=e.items.selected_city[2].id,e.data.district=e.items.selected_city[3].id,e.data.address=e.items.address,o.id){if(1==e.data.add_agent){if(e.data.max_cagent>e.mcagent)return void s.create("danger","输入可开店铺数不可大于最大可开店铺数!");if(e.data.max_cagent<e.data.cagent)return void s.create("danger","输入可开店铺数不可小于已开店铺数!");if(""===e.data.max_cagent)return void s.create("danger","请输入可开店铺数!")}}else if(1==e.data.add_agent){if(e.data.max_cagent>e.mcagent)return void s.create("danger","输入可开店铺数不可大于最大可开店铺数!");if(""===e.data.max_cagent)return void s.create("danger","请输入可开店铺数!")}o.id||(e.data.username=document.getElementById("username").value),o.id?t.update({id:o.id},e.data,function(t){t.status?(s.create("success"," 保存成功！"),e.btn_text="保存",n.go("distributor.supplier.suppliers.list",{level:"all"})):s.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)}):t.save(e.data,function(t){t.status?(s.create("success"," 保存成功！"),e.btn_text="保存",n.go("distributor.supplier.suppliers.list",{level:"all"})):s.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)})}}}])}),define("apps/distributor/controllers/supplier/record",["apps/common/controllers/controllers"],function(e){e.controller("distributor.supplier.record",["$scope","ngPopover","srecordResource",function(e,t,a){e.status="all",e.sorts="desc",e.paginationConf={currentPage:1,itemsPerPage:20},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,
limit:e.paginationConf.itemsPerPage,order_no:""};var o=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.status=e.status,e.params.sorts=e.sorts,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.params.type="all",e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",o),e.set_type=function(t){e.params.type=t,o()},e.search=function(){1==e.paginationConf.currentPage?o():e.paginationConf.currentPage=1},e.sort=function(t){"asc"==t?e.sorts="desc":e.sorts="asc",o()},e.toggleRow=function(t){e.data[t].sub=!e.data[t].sub,e.data[t].icon=e.data[t].sub?"minus":"plus"}}])}),define("apps/distributor/controllers/supplier/feedback.list",["apps/common/controllers/controllers"],function(e){e.controller("distributor.supplier.feedback.list",["$scope","order","supplierFeedbackSource","ngPopover","saveDeliver","reviseprice","$stateParams","$modal","Flash",function(e,t,a,o,s,n,r,i,c){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,buy_way:"all",type:"all",express_type:"all",feedback:"all",sort:"desc"},e.searchParams={goods_name:"",payment_sn:"",buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc"};var l={goods_name:"",order_no:"",buy_way:"all",type:"all",consignee:"",mobile:"",express_type:"all",user_name:"",feedback:0};switch(r.type){case"tosend":e.tabs=1,e.params.type="tosend",e.searchParams.type="tosend";break;case"topay":e.tabs=1,e.params.type="topay",e.searchParams.type="topay";break;case"codpay":e.tabs=2,e.params.buy_way="codpay",e.searchParams.buy_way="codpay";break;case"selffetch":e.tabs=3,e.params.express_type="selffetch",e.searchParams.express_type="selffetch";break;case"peerpay":e.tabs=2,e.params.buy_way="peerpay",e.searchParams.buy_way="peerpay";break;case"feedback":e.tabs=4,e.params.feedback="all",e.searchParams.feedback="all";break;case"star":e.tabs=5,e.params.star="star",e.searchParams.star="star";break;default:e.tabs=1,e.params.type="all",e.searchParams.type="all"}e.type="all";var d=function(){var t=$('input[name="created_range"]').val();""!=t&&(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]),e.type=e.params.type,e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.query(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),e.search=function(){angular.forEach(e.searchParams,function(t,a){e.params[a]=e.searchParams[a]}),1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:d()};var p=function(t){angular.forEach(l,function(a,o){u(o,t)||(e.params[o]=a,e.searchParams[o]=a)})},u=function(e,t){var a=!1;for(var o in t)if(t[o]==e){a=!0;break}return a},m=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:d()};e.set_type=function(t){e.params.type=t,p(["type"]),m()},e.set_buy_way=function(t){e.params.buy_way="codpay",e.params.type=t,p(["type","buy_way"]),m()},e.set_express_type=function(t){e.params.express_type="selffetch",e.params.type=t,p(["type","express_type"]),m()},e.set_feedback=function(t){e.params.feedback=t,p(["feedback"]),m()},e.sort=function(t){"asc"==t?e.params.sort="desc":e.params.sort="asc",d()},e.export=function(){var t="/order/export?";angular.forEach(e.searchParams,function(e,a){angular.isUndefined(e)||(t+=a+"="+e+"&")});var a=$('input[name="created_range"]').val();""!=a&&(a=a.split("/"),t=t+"startDate="+a[0]+"&endDate="+a[1]+"&"),t+="export=yes",window.location.href=t},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.set_star=function(e,a){e.star=a,t.setStar({id:e.id,star:a})},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a},e.set_remark=function(){e.remarkInfo.text?t.setRemarks({id:e.remarkInfo.id,memo:e.remarkInfo.text},function(t){t.status?(c.create("success","提交成功"),o.close(),e.data[e.remarkInfo.index].remarks=e.remarkInfo.text):c.create("danger","提交失败")}):c.create("danger","请填写备注")},e.cancel=function(){o.close(),e.remarkInfo={id:"",text:""}},e.saveListDelivery=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return e}}});a.result.then(function(e){e&&d()})},e.reviseListPrice=function(e,t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.reviseprice.html",controller:"revisePrice",resolve:{data:function(){return e}}});a.result.then(function(t){t&&(e.goodslist=t.data.goodslist,e.amount=t.data.amount,e.shipment_fee=t.data.shipment_fee)})},e.checkedAll=!1,e.selectedIds=[],e.$watch("checkedAll",function(t){t?e.selectedIds=e.data.map(function(e){return e.id}):e.selectedIds=[]}),e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.print_waybill=function(){i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/choose_waybill_tpl.html",controller:"printWaybillCtrl",resolve:{order_ids:function(){return e.selectedIds}}})},e.printDevivery=function(){var t=$("#print_order_form"),a=e.selectedIds.join(",");$("#print_order_form input[name='ids']").val(a),t.submit()},e.refund=function(e){a.refund({id:e},function(e){if(1==e.status)if(angular.isUndefined(e.feedback_url))c.create("success",e.msg),d();else{window.open(e.feedback_url);i.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return e.feedback_url}}})}else c.create("danger",e.msg)})}}])}),define("apps/distributor/controllers/supplier/feedback.detail",["apps/common/controllers/controllers"],function(e){e.controller("distributor.supplier.feedback.detail",["$scope","order","saveDeliver","reviseprice","orderpick","$resource","$stateParams","$modal","$http","Flash","supplierFeedbackSource","orderQureyPay",function(e,t,a,o,s,n,r,i,c,l,d,p){function u(t){switch(0==t.is_selffetch_type&&(e.orderType="cod"==t.payment_code?2:1,1==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="买家付款",e.step[1].at=t.pay_at,e.step[2].title="发货",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at),2==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="货到付款",e.step[1].at=t.created_at,e.step[2].title="发货",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at),40==t.status&&(e.step[3].title="预计完成时间")),1==t.is_selffetch_type&&(e.orderType="cod"==t.payment_code?4:3,3==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="买家付款",e.step[1].at=t.pay_at,e.step[2].title="买家自提",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at,40==t.status&&(e.step[3].title="预计完成时间")),4==e.orderType&&(e.step[0].at=t.created_at,e.step[2].title="买家自提",e.step[2].at=t.finished_at,e.step[3].at=t.finished_at,40==t.status&&(e.step[3].title="预计完成时间"),e.step.splice(1,1))),e.isButShow={price:!1,address:!1,store:!1,delivery:!1,extend:!1,pick:!1,close:!1},t.status){case 10:e.orderStatus={title:"订单关闭",text:"自动过期;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"自动过期"};break;case 11:e.orderStatus={title:"订单关闭",text:"买家取消订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"买家取消订单"};break;case 12:e.orderStatus={title:"订单关闭",text:"订单关闭原因："+e.orderdetail.explain,style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"商家关闭订单"};break;case 13:e.orderStatus={title:"订单关闭",text:"维权完成关闭订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"维权完成关闭订单"};break;case 19:e.orderStatus={title:"买家已下单",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,e.isButShow.close=!0,e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 20:e.orderStatus={title:"待付款",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,e.isButShow.close=!0,e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 30:e.orderStatus={title:"待发货",text:"买家已付款，请尽快发货，否则买家有权申请退款;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.price=!1,e.isButShow.pick=!1,e.isButShow.close=!1;break;case 31:e.orderStatus={title:"货到付款 待发货",text:"买家选择了货到付款，请尽快发货;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.close=!0,e.isButShow.price=!1,e.isButShow.pick=!1;break;case 32:e.orderStatus={title:"针对上门自提，待取货",text:"买家已选择上门自提，等待买家上门自提;",style:"success",icon:"fa-clock-o",statusInfo:"待买家上门自提"},e.step[0].type=!0,e.step[1].type=!0,1==t.is_selffetch_type?e.isButShow.pick=!0:e.isButShow.pick=!1,"cod"==t.payment_code?e.isButShow.close=!0:e.isButShow.close=!1,e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1;break;case 40:e.orderStatus={title:"商家发货 买家待收货",text:"买家如在 发货后7天内 没有申请退款，交易将自动完成；",style:"success",icon:"fa-clock-o",statusInfo:"待收货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type&&(e.step[2].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.extend=!0,e.isButShow.close=!1;break;case 50:e.orderStatus={title:"已完成",text:"交易成功",style:"success",icon:"fa-check-circle-o",statusInfo:"已完成"},e.step[0].type=!0,e.step[1].type=!0,e.step[2].type=!0,4!=e.orderType&&(e.step[3].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.close=!1}}var m=n("/suppliers/orderDetail/:id.json",{id:"@id"},{});e.step=[{type:!1,title:"买家下单",at:""},{type:!1,title:"",at:""},{type:!1,title:"",at:""},{type:!1,title:"订单完成",at:""}],m.get({id:r.id},function(t){e.orderdetail=t,u(t)}),c.get("/regions.json").success(function(t){e.cityInfo=t}),e.setDelivery=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.setdelivery.html",controller:"setDelivery",resolve:{data:function(){return t},address:function(){var t=e.orderdetail.province_name+e.orderdetail.city_name+e.orderdetail.district_name+e.orderdetail.address+" , "+e.orderdetail.consignee+" , "+e.orderdetail.mobile;return t}}});a.result.then(function(e){e&&(t.logis_name=e.name,t.logis_no=e.number)})},e.expressSet=function(t,a,o){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},p.save(e.orderQureyData,function(e){if(e.status){i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return o}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})},e.orderPick=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.pick.html",controller:"orderPickCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,u(e.orderdetail))})},e.refund=function(e){d.refund({id:e},function(e){if(1==e.status)if(angular.isUndefined(e.feedback_url))l.create("success",e.msg);else{window.open(e.feedback_url);i.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return e.feedback_url}}})}else l.create("danger",e.msg)})}}])}),define("apps/distributor/controllers/supplier/feedback.refund",["apps/common/controllers/controllers"],function(e){e.controller("distributor.supplier.feedback.refund",["$scope","supplierFeedbackSource","$stateParams","$modal","Flash",function(e,t,a,o,s){function n(t){if(0==t.refund_info.type&&(e.refundItem=[{title:"申请退款中",at:t.refund_info.created_at,type:!1},{title:"商家处理退款申请",at:t.refund_info.operated_at,type:!1},{title:"退款已完成",at:t.refund_info.finished_at,type:!1}],1==t.refund_info.feedback)){var a={title:"第三方退款中",at:t.refund_info.applyed_at,type:!1};e.refundItem.splice(2,0,a)}if(1==t.refund_info.type&&(e.refundItem=[{title:"买家申请退款中",at:t.refund_info.created_at,type:!1},{title:"商家同意退款,等待买家退货",at:t.refund_info.operated_at,type:!1},{title:"买家货物已寄出,等待商家确认",at:t.refund_info.shipmented_at,type:!1},{title:"退款已完成",at:t.refund_info.finished_at,type:!1}],1==t.refund_info.feedback)){var a={title:"第三方退款中",at:t.refund_info.applyed_at,type:!1};e.refundItem.splice(3,0,a)}switch(e.feedbackState={title:"",titleIcon:"",titleInfo:"",bottonAgreeText:"",bottonAgreeStatus:!1,bottonRejectText:"",bottonRejectStatus:!1},t.refund_info.status){case 10:e.feedbackState.title="等待商家处理退款申请",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 11:e.feedbackState.title="买家再次申请退款，等待商家处理退款申请",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 12:e.feedbackState.title="系统申请退款中",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 20:0==t.refund_info.type?(e.feedbackState.title="商家同意退款",e.feedbackState.titleInfo="商家同意退款",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.title="商家已同意退款,请退货给商家",e.feedbackState.titleInfo="您已同意退款协议，请等待买家处理。",e.feedbackState.bottonAgreeText="已收到货，同意退款",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0,e.refundItem[1].type=!0;break;case 21:e.feedbackState={title:"商家不同意退款申请",titleIcon:"",titleInfo:"您已拒绝本次退款申请，买家修改退款申请后，需要您重新处理。",bottonAgreeText:"",bottonRejectText:""},0==t.refund_info.type?e.feedbackState.bottonAgreeText="同意退款给买家":e.feedbackState.bottonAgreeText="同意退货,发送退货地址";break;case 22:e.feedbackState={title:"已退货，等待商家确认收货",titleIcon:"",titleInfo:"买家已退货，请关注退货信息!",bottonAgreeText:"已收到货，同意退款",bottonRejectText:"拒绝退货申请"},e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!1,e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0;break;case 30:e.feedbackState={title:"第三方退款中",titleIcon:"",titleInfo:"退款金额:￥"+e.feedbackData.refund_info.refund_amount,bottonAgreeText:"",bottonRejectText:""},e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0,1==t.refund_info.feedback&&1==t.refund_info.type&&(e.refundItem[3].type=!0);break;case 31:e.feedbackState={title:"退款成功",titleIcon:"",titleInfo:"退款金额:￥"+t.refund_info.refund_amount,bottonAgreeText:"",bottonRejectText:""},e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0,1==t.refund_info.feedback&&(0==t.refund_info.type&&(e.refundItem[3].type=!0),1==t.refund_info.type&&(e.refundItem[3].type=!0,e.refundItem[4].type=!0)),0==t.refund_info.feedback&&1==t.refund_info.type&&(e.refundItem[3].type=!0);break;case 40:e.feedbackState={title:"已关闭",titleIcon:"",titleInfo:"申请已经关闭",bottonAgreeText:"",bottonRejectText:""};break;case 41:e.feedbackState={title:"用户已关闭",titleIcon:"",titleInfo:"申请已经关闭",bottonAgreeText:"",bottonRejectText:""}}}e.refundItem=[],t.get({id:a.id},function(t){e.feedbackData=t,n(t)}),e.agreeFeedback=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.feedback.agree.html",controller:"agreeFeedback",resolve:{data:function(){var t=e.feedbackData;return t}}});t.result.then(function(t){t&&(e.feedbackData=t.data,n(t.data))})},e.rejectFeedback=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.feedback.reject.html",controller:"rejectFeedback",resolve:{data:function(){var t=e.feedbackData;return t}}});t.result.then(function(t){t&&(e.feedbackData=t.data,n(t.data))})}}]),e.controller("agreeFeedback",["$scope","$modalInstance","data","feedback","Flash",function(e,t,a,o,s){e.agreeData=a,e.returnInfo={id:a.refund_info.refund_id,refundtype:a.refund_info.type,status:a.refund_info.status,order_goods_id:a.goods_info.order_goods_id,address:""},0==e.agreeData.refund_info.type&&(e.bottonText="同意"),1==e.agreeData.refund_info.type&&(10!=e.agreeData.refund_info.status&&11!=e.agreeData.refund_info.status&&12!=e.agreeData.refund_info.status&&21!=e.agreeData.refund_info.status||(e.bottonText="同意"),20!=e.agreeData.refund_info.status&&22!=e.agreeData.refund_info.status||(e.bottonText="确认收到货,并退款给买家")),e.butStatus=!1,e.confirm=function(){if(""!=e.returnInfo.address||1!=a.refund_info.type||10!=a.refund_info.status&&11!=a.refund_info.status&&12!=a.refund_info.status&&21!=a.refund_info.status)if(1==e.returnInfo.refundtype){if(10==e.returnInfo.status||11==e.returnInfo.status||12==e.returnInfo.status||21==e.returnInfo.status){var n={id:e.returnInfo.id,type:1,address:e.returnInfo.address,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.update(n,function(a){1==a.success?(t.close(a),s.create("success","您已同意买家的退款"),e.cancel()):s.create("danger",a.error),e.butStatus=!1})}if(20==e.returnInfo.status||22==e.returnInfo.status){var n={id:e.returnInfo.id,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.refund(n,function(a){if(1==a.success)if(angular.isUndefined(a.data.feedback_url))t.close(a),s.create("success","您已同意买家的退款"),e.cancel();else{window.open(a.data.feedback_url),e.cancel();$modal.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return a.data.feedback_url}}})}else s.create("danger",a.error);e.butStatus=!1})}}else{var n={id:e.returnInfo.id,type:1,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.update(n,function(a){if(1==a.success)if(angular.isUndefined(a.data.feedback_url))t.close(a),s.create("success","您已同意买家的退款"),e.cancel();else{window.open(a.data.feedback_url),e.cancel();$modal.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return a.data.feedback_url}}})}else s.create("danger",a.error);e.butStatus=!1})}else s.create("danger","请填写退货地址")},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("rejectFeedback",["$scope","$modalInstance","data","feedback","Flash",function(e,t,a,o,s){e.rejectData=a,e.rejectInfo={id:a.refund_info.refund_id,refundtype:a.refund_info.type,status:a.refund_info.status,order_goods_id:a.goods_info.order_goods_id,reason:""},e.butStatus=!1,e.confirm=function(){""==e.rejectInfo.reason?s.create("danger","请填写拒绝理由"):(e.butStatus=!0,o.update({id:e.rejectInfo.id,reason:e.rejectInfo.reason,type:"2",order_goods_id:e.rejectInfo.order_goods_id},function(a){1==a.success?(t.close(a),s.create("success","提交成功"),e.cancel()):s.create("danger","提交失败"),e.butStatus=!1}))},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("modalFeedback",["$scope","$state","$modalInstance","url",function(e,t,a,o){e.goUrl=o,e.refresh=function(){a.close(),t.reload()}}])}),define("apps/distributor/controllers/supplier/dispatct.list",["apps/common/controllers/controllers"],function(e){e.controller("dispatct.list",["$scope","Flash","$modal","$filter","dispatctListResource","rankResource","ngPopover","$stateParams","$location",function(e,t,a,o,s,n,r,i,c){e.shopId=i.id,e.shopName=decodeURI(i.shopName),e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,consignee:"",status:"all",order_sn:""};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.from_supplier_id=e.shopId,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.order_status=t.order_status})};e.search=function(){1==e.paginationConf.currentPage?l():e.paginationConf.currentPage=1},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.goDispatct=function(e,t){c.path("/distributor/supplier/suppliers/dispatct/"+e+"/"+encodeURI(t))},e.upOrder=function(e){var t=a.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/supplier_offline_order.html",controller:"supplierofflineOrderModalCtrl"});t.order_id=e,t.result.then(function(e){})}}])}),define("apps/distributor/controllers/supplier/dispatct.info",["apps/common/controllers/controllers"],function(e){e.controller("dispatct.info",["$scope","suppliersResource","$stateParams","Flash","$state","dispatctAddResource","$modal","$location",function(e,t,a,o,s,n,r,i){e.shopId=a.shopId,e.shopName=decodeURI(a.shopName),e.title="出货",e.items={},e.data={goods_amount:0};var c=e.city=this;c.regions={country:1},c.start="country",c.end="district",e.$watch("city",function(t){angular.isUndefined(t.selected)||(t.selected.length>2&&(e.cityname=t.selected[1].name),e.items.selected_city=t.selected)},!0),e.sortableOptions={cursor:"move",zIndex:8e3,axis:"x"},e.removeGoodsItem=function(t,a){if(e.goods.splice(a,1),d[t.goods_id]=d[t.goods_id]-1,t.prop){var o=l.indexOf(t.prop);l.splice(o,1)}},e.goods=[];var l=[],d=[];e.add_goods=function(){var t=r.open({animation:!1,templateUrl:"assets/js/apps/distributor/templates/supplier/goods_list.html",controller:"dispatctChooseGoodsModalCtrl"});t.selectedGoodAll=e.goods,t.selectedGoodProp=l,t.chooseGoodArr=d,t.shopId=e.shopId,t.result.then(function(t){e.goods=t.selectedGood,l=t.selectedGood_prop,d=t.chooseGoodArr})},e.$watch("goods",function(){var t=0;angular.forEach(e.goods,function(e){t+=e.price*e.quantity}),e.data.goods_amount=t.toFixed(2)},!0),e.submitForm=function(t){if(t){if(e.goods.length<=0)return void o.create("danger"," 请选择采购商品！");angular.forEach(e.goods,function(e,t){if(!e.stock)return void o.create("danger","选择的商品存在库存为0的商品，请先删除库存为0的商品")}),e.form.$invalid=!0,e.btn_text="出货中...",e.data.goods=e.goods,e.data.from_supplier_id=e.shopId,n.add(e.data,function(t){t.status?(e.btn_text="出货",o.create("success","出货成功！对应自有商品库存会减，目标经销商库存会加。"),i.path("/distributor/supplier/suppliers/dispatcts/"+a.shopId+"/"+a.shopName)):o.create("danger",t.msg)},function(t){e.btn_text="出货",e.form.$invalid=!1,o.create("danger",t.data.msg)})}}}])}),define("apps/distributor/controllers/supplier/goods.list",["apps/common/controllers/controllers"],function(e){e.controller("dispatctChooseGoodsModalCtrl",["$scope","$modalInstance","dispatctResource","tagResource","Flash","$modal","goodSkuDetailscgResource",function(e,t,a,o,s,n,r){e._global=_global,e.goods=[],e.selectedGood=t.selectedGoodAll,e.selectedGood_prop=t.selectedGoodProp;var i=t.chooseGoodArr,c=0;e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,goods_title:""};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.params.from_supplier_id=t.shopId,a.getlist(e.params,function(t){$(".js-search-btn").removeClass("disabled"),e.paginationConf.totalItems=t._count,e.goods=t.data,angular.forEach(e.goods,function(e){e.selectedCount=i[e.goods_id]?i[e.goods_id]:0,e.chooseclick=!1})})};e.search=function(e){$(".js-search-btn").hasClass("disabled")||($(".js-search-btn").addClass("disabled"),l())},e.choose=function(a,o){if(!a.stock)return void s.create("danger"," 该商品没有库存没有了，请采购其他商品！");var n=function(t){e.selectedGood.push({goods_id:a.goods_id,goods_title:a.title,img:a.img,price:"undefined"!=typeof t.price?t.price:a.price,stock:"undefined"!=typeof t.stock?t.stock:a.stock,quantity:1,prop:"undefined"!=typeof t.prop?t.prop:"",product_id:"undefined"!=typeof t.product_id?t.product_id:"",product_sn:"undefined"!=typeof t.product_sn?t.product_sn:"",props_str:"undefined"!=typeof t.props_str?t.props_str:"无",allstock:"undefined"!=typeof t.allstock?t.allstock:a.stock})};if(e.goods[c].chooseclick=!1,c=o,a.is_sku){r.get({goods_id:a.goods_id,from_supplier_id:t.shopId},function(t){e.goodsku=t.data,a.chooseclick=!0,e.goodsku.skuSelectCount=0,e.bSkuSelectCount=!1,angular.forEach(e.goodsku.props,function(e){e.choose=!1,angular.forEach(e.gps,function(e){e.choose=!1})})});var l=[];e.chooseSku=function(t,a){1==t.choose?(t.choose=!1,e.goodsku.props[a].choose=!1,e.goodsku.skuSelectCount--,l[a]=""):(angular.forEach(e.goodsku.props[a].gps,function(e){e.choose=!1}),l[a]=e.goodsku.props[a].id+":"+t.id,t.choose=!0,0==e.goodsku.props[a].choose&&e.goodsku.skuSelectCount++,e.goodsku.props[a].choose=!0),e.bSkuSelectCount=e.goodsku.skuSelectCount==e.goodsku.props.length},e.chooseOk=function(t){var a="",o=l.length;angular.forEach(l,function(e,t){a+=t==o-1?e:e+";"});var r=function(t){for(var a=0;a<e.goodsku.products.length;a++)if(e.goodsku.products[a].props==t){var o={product_id:e.goodsku.products[a].id,product_sn:e.goodsku.products[a].product_sn,props_str:e.goodsku.products[a].props_str,stock:e.goodsku.products[a].stock,price:e.goodsku.products[a].price,prop:e.goodsku.products[a].props,allstock:e.goodsku.products[a].stock};return o}};if(0==e.selectedGood_prop.length)e.selectedGood_prop.push(a),t.selectedCount++,i[t.goods_id]=t.selectedCount,n(r(a));else{var c=!1;angular.forEach(e.selectedGood,function(e){r(a).product_id==e.product_id&&(c=!0)}),c?s.create("danger"," 您已选择过该规格组合！"):(e.selectedGood_prop.push(a),t.selectedCount++,i[t.goods_id]=t.selectedCount,n(r(a)))}l=[],e.bSkuSelectCount=!1,e.goodsku.skuSelectCount=0,angular.forEach(e.goodsku.props,function(e){e.choose=!1,angular.forEach(e.gps,function(e){e.choose=!1})})}}else{var d=!1;angular.forEach(e.selectedGood,function(e){e.goods_id==a.goods_id&&(d=!0)}),d?s.create("danger"," 您已选择过商品！"):(a.selectedCount++,i[a.goods_id]=a.selectedCount,n({allstock:a.stock}))}},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",l()},e.ok=function(){angular.isUndefined(e.selectedGood)?t.dismiss("cancel"):t.close({selectedGood:e.selectedGood,selectedGood_prop:e.selectedGood_prop,chooseGoodArr:i})},e.cancel=function(){t.close({selectedGood:e.selectedGood,selectedGood_prop:e.selectedGood_prop,chooseGoodArr:i})}}])}),define("apps/distributor/controllers/goodslog",["apps/common/controllers/controllers"],function(e){e.controller("distributor.goodslog",["$scope","$filter","ngPopover","Flash","lineResource","lineslogResource","synchronizationResource","$modal","cityData",function(e,t,a,o,s,n,r,i,c){function l(){s.getlist({enable:1,limit:1e3},function(t){e.goods_lines=t.data,e.goods_lines.unshift(e.defaultTag)})}e.paginationConf={currentPage:1,itemsPerPage:10},e.params={type:1,offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,goods_title:"",sale:0,lines_id:0,column:"created_at",direction:"desc"},e.lines={},e.lines.selected=e.defaultTag={id:0,name:"所有商品线"},l(),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.add_time=t[0]+" 00:00:00",e.params.end_time=t[1]+" 23:59:59"):(delete e.params.add_time,delete e.params.end_time),1==e.paginationConf.currentPage?d():e.paginationConf.currentPage=1};var d=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.lines).length>0&&(e.params.goods_line_id=e.lines.selected.id),n.getlist(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d)}])}),define("apps/distributor/controllers/supplier/supplier.offline.order.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("supplierofflineOrderModalCtrl",["$scope","$stateParams","$modalInstance","supplierofflineOrder","Flash","$state",function(e,t,a,o,s,n){e._global=_global;var r=function(){o.get({order_id:a.order_id},function(t){e.goods=t.data.order_goods,e.data=t})};r(),e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/distributor/controllers/_base",["apps/distributor/controllers/auction","apps/distributor/controllers/forsale","apps/distributor/controllers/soldout","apps/distributor/controllers/form","apps/distributor/controllers/material","apps/distributor/controllers/material.edit","apps/distributor/controllers/goods_tpl","apps/distributor/controllers/price_tpl","apps/distributor/controllers/stock_tpl","apps/distributor/controllers/line","apps/distributor/controllers/line.info","apps/distributor/controllers/linegoods","apps/distributor/controllers/linegoods.goods.ctrl","apps/distributor/controllers/lineprice_tpl","apps/distributor/controllers/supplier/withdraw.account.details","apps/distributor/controllers/supplier/withdraw.account","apps/distributor/controllers/supplier/withdraw.manage","apps/distributor/controllers/supplier/rank.list","apps/distributor/controllers/supplier/rank.info","apps/distributor/controllers/supplier/dashboard.supply","apps/distributor/controllers/supplier/dashboard.income","apps/distributor/controllers/supplier/suppliers.list","apps/distributor/controllers/supplier/suppliers.info","apps/distributor/controllers/supplier/record","apps/distributor/controllers/supplier/feedback.list","apps/distributor/controllers/supplier/feedback.detail","apps/distributor/controllers/supplier/feedback.refund","apps/distributor/controllers/supplier/dispatct.list","apps/distributor/controllers/supplier/dispatct.info","apps/distributor/controllers/supplier/goods.list","apps/distributor/controllers/goodslog","apps/distributor/controllers/supplier/supplier.offline.order.ctrl"],function(){}),define("apps/distributor/directives/edit_title",["apps/common/directives/directives"],function(e){e.directive("deditTitle",[function(){return{restrict:"AE",replace:!0,scope:{title:"@",class:"@"},template:'<div ng-init="edittype=true"><p ng-show="edittype" class="inline-edit {{class}}" ng-click="edit()">{{title}}</p><p class="edit-title-box" ng-show="!edittype"><textarea class="form-control input-sm" type="text" ng-model="title"></textarea><button ng-click="save()" class="btn btn-sm btn-primary pull-right">保存</button></p></div>',link:function(e,t,a){e.edit=function(){e.edittype=!e.edittype},e.save=function(){e.edittype=!e.edittype}}}}])}),define("apps/distributor/directives/goods.material.upload",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("dgoodsMaterialUpload",["$modal",function(e){return{restrict:"AE",replace:!0,scope:{size:"@",type:"="},require:"^?ngModel",template:'<div class="goods-material-upload"><a class="btn btn-primary btn-sm" ng-click="openModal(size)" style="margin-right: 10px;" ><i class="fa fa-upload"></i> 导入商品素材</a></div>',
link:function(t,a,o,s){t.animationsEnabled=!1,t.openModal=function(a){var o=e.open({animation:t.animationsEnabled,controller:"directives.material.upload.modal",templateUrl:"assets/js/apps/distributor/templates/goods.material.upload.html",size:a,resolve:{type:function(){return t.type},paginationInit:function(){return t.$parent.paginationInit}}});o.result.then(function(e){s.$setViewValue(e)})}}}}]),t.controller("directives.material.upload.modal",["$scope","$modalInstance","Flash","type","paginationInit","shopUpladFactory","dshopImportResource",function(e,t,a,o,s,n,r){e.type=o;var i=function(){e.shop.offset<e.shop.total?e.dynamic=parseFloat(e.shop.offset/e.shop.total*100).toFixed(2):e.dynamic=100};1==e.type&&(e.shop=n,e.shop.status&&i()),e.csvfileInfo={status:!1,name:"",size:0},e.ok=function(){if(!e.csvfileInfo.status)return void a.create("danger","请选择一个CSV文件");if(e.csvfile.size>1048576)return void a.create("danger","文件大小不能超过1MB");var o=e.csvfile.name.substr(e.csvfile.name.toLowerCase().lastIndexOf(".")+1);if("csv"!=o)return void a.create("danger","请选择一个CSV文件。");var s=new FormData($("#csvFileUpload")[0]);$.ajax({url:"goods/import_taobao.json",method:"POST",data:s,processData:!1,contentType:!1}).done(function(e){e.success?(a.create("success",e.msg),t.close(e.success)):a.create("danger","导入失败，请重新检查文件")}).fail(function(e){a.create("danger","导入失败，请重新检查文件")})};var c=function(){r.save(e.shop,function(t,o){t.success?(e.shop.status=!0,e.shop.total=t.count,e.shop.exist+=t.exist,e.shop.imported+=t.imported,e.shop.offset=t.offset,e.dynamic=0,i(),e.dynamic<100?c():(e.shop.is_finish=!0,s())):a.create("danger",t.msg)})};e.shopImport=function(){return""==e.shop.username?(a.create("danger","请输入用户名"),!1):""==e.shop.password?(a.create("danger","请输入用户密码"),!1):void c()},e.shopImportReset=function(){angular.forEach(n.init(),function(t,a){e.shop[a]=t}),e.dynamic=0},e.cancel=function(){t.dismiss("cancel")},e.selectCsvFile=function(t){e.$apply(function(a){e.csvfile=t.files[0],e.csvfileInfo.status=!0,e.csvfileInfo.name=e.csvfile.name,e.csvfileInfo.size=parseFloat(e.csvfile.size/1024).toFixed(2)})}}])}),define("apps/distributor/directives/prop.setting",["apps/common/directives/directives"],function(e){e.directive("dgoodsPropSetting",["dpropResource","dpropValueResource","Flash",function(e,t,a){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/prop.setting.html",link:function(o,s,n){o.prop={name:"",input_value:"",disabled:!0},o.goods={addPropForm:!1},o.addProp=function(t){o.goodsData.goods_cat_id>0?($(t.currentTarget).addClass("btn-submiting-sm"),e.save({name:o.prop.name,input_value:o.prop.input_value,goods_cat_id:o.goodsData.goods_cat_id,type:0},function(e,s){a.create("success","操作成功"),$(t.currentTarget).removeClass("btn-submiting-sm"),e.inputValues=e.input_values,e.input_values=[],e.input_values.push(e.inputValues),o.catsProps.push(e),o.goodsData.props[o.catsProps.length-1]=e.inputValues,o.goods.addPropForm=!1,o.prop.name="",o.prop.input_value=""},function(e){a.create("danger",e.data.error.message)})):a.create("warning","请先选择品类")},o.deleteProp=function(t,s){"undefined"!=typeof t&&0!=t?e.delete({id:t},function(e,t){e.success?(a.create("success","删除成功"),o.catsProps.splice(s,1)):a.create("danger","删除失败")},function(e){a.create("danger",e.data.error.message)}):a.create("warning","无法获取到属性ID")},o.$watch("prop.name + prop.input_value",function(e,t){""!=o.prop.name&&""!=o.prop.input_value?o.prop.disabled=!1:o.prop.disabled=!0}),o.addPropValue={value:{name:"属性值",value:""}},o.addPropValueFun=function(e,s){""!=o.addPropValue.value.value?"undefined"!=typeof e&&0!=e?t.save({value:o.addPropValue.value.value,prop_id:e},function(e,t){o.catsProps[s].input_values.push(e),o.goodsData.props[s]=e},function(e){a.create("danger",e.data.error.message)}):a.create("warning","无法获取到属性ID"):a.create("warning","请填写属性值内容")},o.deletePropValue=function(e,s,n){e.stopPropagation(),t.delete({id:s},function(e){e.success?angular.forEach(o.catsProps,function(e,t){if(e.id==n)return angular.forEach(e.input_values,function(e,a){if(e.id==s)return o.catsProps[t].input_values.splice(a,1),"undefined"!=typeof o.goodsData.props[t]&&o.goodsData.props[t].id==s&&delete o.goodsData.props[t],!1}),!1}):a.create("danger","删除失败")},function(e){a.create("danger",e.data.error.message)})}}}}])}),define("apps/distributor/directives/sku.setting",["apps/common/directives/directives"],function(e){e.directive("dgoodsSkuSetting",["dpropResource","Flash","$compile",function(e,t,a){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/sku.setting.html",link:function(o,s,n){o.skuEditTemp=[],o.skuEditTemp.prop_values=[],o.showValue={},o.showValue.editSku={},o.deleteSku=function(a,s){"undefined"!=typeof a&&0!=a?e.delete({id:a},function(e){e.success?o.goodsData.skus.splice(s,1):t.create("danger","删除失败")},function(e){t.create("danger",e.data.error.message)}):t.create("warning","无法获取到属性ID")},o.openEditSku=function(e){o.skuEditTemp.tempVal="",o.skuEditTemp.disabled=!0,o.showValue.editSku[e]=!0,o.skuEditTemp=jQuery.extend(!0,{},o.goodsData.skus[e])},o.deleteEditTempSkuValue=function(e){o.skuEditTemp.prop_values.splice(e,1)},o.editAddTempSkuValue=function(e,a){if(a&&13!=e.keyCode)return!1;var s=o.skuEditTemp.tempVal,n=!1;""!=s?(angular.forEach(o.skuEditTemp.prop_values,function(e,t){if(e.name==s)return n=!0,!1}),n?t.create("danger","输入的规格值已存在"):(o.skuEditTemp.prop_values.push({name:s}),o.skuEditTemp.tempVal="")):t.create("warning","规格值名称不能为空")},o.editSku=function(a,s){var n=o.skuEditTemp.name;$(a.currentTarget).addClass("btn-submiting-sm"),e.update({id:o.skuEditTemp.id,name:n,prop_values:o.skuEditTemp.prop_values},function(e){e.success?(t.create("success","操作成功"),$(a.currentTarget).removeClass("btn-submiting-sm"),o.showValue.editSku[s]=!1,o.goodsData.skus[s].name=n,o.goodsData.skus[s].prop_values=e.data):t.create("danger",e.error)},function(e){t.create("danger",e.data.error.message)})},o.$watch("skuEditTemp.name + skuEditTemp.prop_values",function(e){""!=o.skuEditTemp.name&&o.skuEditTemp.prop_values.length>0?o.skuEditTemp.disabled=!1:o.skuEditTemp.disabled=!0}),o.vm={};var r=o.vm;r.calcCombine=function(e){for(var t=[],a=e.length,o=0;a>o;o++){t[o]=1;for(var s=o+1;a>s;s++)t[o]=t[o]*e[s].length}return t},r.printRow=function(e,t){var a=o.goodsData.skuData,s=a.length;return e!==s&&void(a[e]&&angular.forEach(a[e],function(a,n){if(r.skuStringArr[e]=a.prop_id+":"+a.id,r.skuStringArrNum[e]=a.prop_id.toString()+a.id.toString(),r.skuStringArrStr[e]=a.name,t||(r.tableHtml+="<tr class='js-sku-content'>",t=1),r.tableHtml+='<td data-atom-id="'+a.id+'" rowspan="'+r.combine[e]+'">'+a.name+"</td>",e==s-1){var i=r.skuStringArr.join(";"),c=r.skuStringArrNum.join(""),l=r.skuStringArrStr.join(":"),d=r.getAtomStockData(s,i);r.tableHtml+=r.tdTemplate(d,i,c)+"</tr>",r.trIndex+=1,t=0,"undefined"==typeof o.goodsData.skuStock[s]&&(o.goodsData.skuStock[s]={}),"undefined"==typeof o.goodsData.skuStock[s][i]?o.goodsData.skuStock[s][i]={id:0,price:"",supplier_price:"",min_retail_price:"",max_retail_price:"",stock:"",product_sn:"",sn:c,barcode:"",str:l}:o.goodsData.skuStock[s][i].str=l,o.goodsData.skuStock[s][i].checked=!0}var p=e+1;r.printRow(p,t)}))},r.generateRows=function(){return r.tableHtml="<tbody>",r.outputTrTag=0,r.trIndex=0,r.skuStringArr=[],r.skuStringArrNum=[],r.skuStringArrStr=[],r.printRow(0,r.outputTrTag),r.tableHtml+"</tbody>"},r.renderFooter=function(){return""},r.renderBody=function(){return r.combine=r.calcCombine(o.goodsData.skuData),r.generateRows()},r.renderHeader=function(){var e="";return angular.forEach(o.goodsData.skuThead,function(t,a){e+="<td>"+t.name+"</td>"}),"<thead><tr>"+e+'<td>价格</td><td>一级供货价</td><td>零售价</td><td>库存</td><td>商家编码</td><td>条形码</td><td width="80">批量操作</td></tr></thead>'},r.renderTable=function(){var e="";return e+=r.renderHeader(),e+=r.renderBody(),e+=r.renderFooter(),e},r.getAtomStockData=function(e,t){return angular.isUndefined(o.goodsData.skuStock[e])||angular.isUndefined(o.goodsData.skuStock[e][t])?{id:0,price:"",supplier_price:"",min_retail_price:"",max_retail_price:"",stock:"",product_sn:"",barcode:"",str:""}:o.goodsData.skuStock[e][t]},r.tdTemplate=function(e,t,a){var s=o.goodsData.skuData.length,n="has-error";return'<td><div class="validator-form" ng-class="{\''+n+"': form.sku_price_"+a+".$invalid && form.sku_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm sku-price-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].price" type="text" name="sku_price_'+a+'" value="'+e.price+'" /></div></td><td><div class="validator-form" ng-class="{\''+n+"': form.supplier_price_"+a+".$invalid && form.supplier_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm supplier-price-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].supplier_price" type="text" name="supplier_price_'+a+'" value="'+e.supplier_price+'" /></div></td><td class="lingshou"><div style="width: 100px;float: left;" class="validator-form" ng-class="{\''+n+"': form.min_retail_price_"+a+".$invalid && form.min_retail_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm min-retail-price-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].min_retail_price" type="text" name="min_retail_price_'+a+'" value="'+e.min_retail_price+'" /></div><div class="" style="width: 20px;float: left;text-align: center;line-height: 30px;">--</div><div style="width: 100px;float: left;" class="validator-form" ng-class="{\''+n+"': form.max_retail_price_"+a+".$invalid && form.max_retail_price_"+a+'.$dirty}"><input custom-number decimal="2" class="form-control input-sm max-retail-price-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].max_retail_price" type="text" name="max_retail_price_'+a+'" value="'+e.max_retail_price+'" /></div></td><td><div class="validator-form" ng-class="{\''+n+"': form.sku_stock_"+a+".$invalid && form.sku_stock_"+a+'.$dirty}"><input custom-number class="form-control input-sm sku-stock-input" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].stock" type="text" name="sku_stock_'+a+'" value="'+e.stock+'" /></div></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].product_sn" type="text" name="sku_product_sn" value="'+e.product_sn+'" /></td><td><input class="form-control input-sm" data-ids="'+t+'" ng-model="goodsData.skuStock[\''+s+"']['"+t+'\'].barcode" type="text" name="sku_barcode" value="'+e.barcode+'" /></td><td class="setting"><a data-ids="'+t+'" ng-click="openSkuBatch(\''+t+'\')" ng-popover="skuBatch.html" placement="bottom" maximize="true"><i class="fa fa-cog"></i></a></td>'},o.$watch("goodsData.skus",function(e,t){if(o.goodsData.skuData=[],o.goodsData.skuThead=[],e.length>0){$(".sku-list").each(function(){var e=[],t=$(this).index();$(this).children(".sku-tree").children("li").each(function(){$(this).children(".checkbox").children("label").children("input[type='checkbox']").is(":checked")&&"undefined"!=typeof o.goodsData.skus[t]&&e.push(o.goodsData.skus[t].prop_values[$(this).index()])}),e.length>0&&(o.goodsData.skuData.push(e),o.goodsData.skuThead.push(o.goodsData.skus[t]))}),angular.forEach(o.goodsData.skuStock[o.goodsData.skuData.length],function(e,t){e.checked=!1});var s=r.renderTable(),n=$(".js-sku-table");n.html(s),a(n)(o)}},!0),o.openSkuBatch=function(e){var t=o.goodsData.skuData.length;r.openSkuBatchString=e,r.isOpenBatchPrice=!("undefined"!=typeof o.goodsData.skuStock[t][e].price&&""!=o.goodsData.skuStock[t][e].price),r.isOpenBatchStock=!("undefined"!=typeof o.goodsData.skuStock[t][e].stock&&""!=o.goodsData.skuStock[t][e].stock)},o.skuBatch=function(e,t){var a=r.openSkuBatchString.split(";"),s=o.goodsData.skuData.length;angular.forEach(o.goodsData.skuStock[s],function(n,i){i.indexOf(a[t])!=-1&&("price"==e?o.goodsData.skuStock[s][i][e]=parseFloat(o.goodsData.skuStock[s][r.openSkuBatchString][e]).toFixed(2):o.goodsData.skuStock[s][i][e]=o.goodsData.skuStock[s][r.openSkuBatchString][e])})}}}}]).directive("dskuCreate",["Flash","dpropResource",function(e,t){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/sku.create.html",link:function(a,o,s){a.createSkuForm=!1,a.createDisabled=!0,a.skuValueTemp=[],a.addTempSkuValue=function(t,o){if(o&&13!=t.keyCode)return!1;var s=a.skuTempName,n=!1;""!=s?(angular.forEach(a.skuValueTemp,function(e,t){if(e==s)return n=!0,!1}),n?e.create("danger","输入的规格值已存在"):(a.skuValueTemp.push(s),a.skuTempName="")):e.create("warning","规格值名称不能为空")},a.deleteTempSkuValue=function(e){a.skuValueTemp.splice(e,1)},a.$watch("createSkuForm",function(e,t){e&&(a.skuValueTemp=[],a.skuName="")}),a.addSku=function(){if(a.$parent.goodsData.goods_cat_id>0){var o={name:a.skuName,goods_cat_id:a.$parent.goodsData.goods_cat_id,prop_value:a.skuValueTemp,type:1};""!=o.name?o.prop_value.length>0?t.save(o,function(e){a.$parent.goodsData.skus.push(e),a.createSkuForm=!1},function(t){e.create("danger",t.data.error.message)}):e.create("warning","至少添加一个规格值"):e.create("warning","规格名称不能为空")}else e.create("warning","请先选择品类")},a.$watch("skuName + skuValueTemp",function(e){""!=a.skuName&&a.skuValueTemp.length>0?a.createDisabled=!1:a.createDisabled=!0})}}}])}),define("apps/distributor/directives/shipment.setting",["apps/common/directives/directives"],function(e){e.directive("dgoodsShipment",["dfromShipmentResource",function(e){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/shipment.setting.html",link:function(t,a,o){var s=function(){e.get({shop_id:t.goodsData.shop_id},function(e,a){t.goodsData.shipments=e.data})};t.$watch("goodsData.shipment_type",function(e,a){1==e&&0==t.goodsData.shipments.length&&s()})}}}])}),define("apps/distributor/directives/collectFields.setting",["apps/common/directives/directives"],function(e){e.directive("dgoodsCollectFields",[function(){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/collectFields.setting.html",link:function(e,t,a){e.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],e.addCollectFields=function(){var t={name:"",type:"text",required:1};e.goodsData.collect_fields.push(t)},e.deleteCollectFields=function(t){e.goodsData.collect_fields.splice(t,1)}}}}])}),define("apps/distributor/directives/cates.select",["apps/common/directives/directives"],function(directives){directives.directive("dgoodsCatesSelect",["dcatResource",function(catResource){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/cates.select.html",link:function(scope,elem,attrs){scope.cates=[],scope.goodsData=scope.$parent.goodsData;var catesHistoryChange=function(e){for(var t in e){t=parseInt(t);var a=e[t];angular.isUndefined(scope.goodsData.cate[t])&&(scope.goodsData.cate[t]={}),scope.SelectCate(a.id,a.cchild,t,1,a,1)}},getCates=function(e,t,a,o,s){var n=scope.cates.length,r=e+1;catResource.get({parent_id:t},function(t,i){a?(scope.goodsData.cate[e].data=o,t._count>0?(angular.isUndefined(scope.goodsData.cate[r])&&(scope.goodsData.cate[r]={}),scope.goodsData.cate[r].collections=scope.cates[r]=t.data,scope.cates.splice(r+1,n-r-1),s||(scope.goodsData.goods_cat_id=0)):(scope.cates.splice(r,n-r),scope.goodsData.goods_cat_id=o.id)):(scope.goodsData.cate[e]={},scope.goodsData.cate[e].collections=scope.cates[e]=t.data)},function(e){})},catesHistory=localStorage.getItem("catesHistory");catesHistory=eval("("+catesHistory+")"),scope.catesHistoryList=[],angular.forEach(catesHistory,function(e,t){var a=[],o=[];angular.forEach(e,function(e,t){a.push(e.id),o.push(e.name)}),scope.catesHistoryList.push({ids:a.join(","),strs:o.join(">>")})}),scope.catesHistoryList.unshift({ids:-1,strs:"请选择"}),scope.catesHistorySelect=-1,scope.$watch("catesHistorySelect",function(e,t){if(e!=-1)for(var a in scope.catesHistoryList){var o=scope.catesHistoryList[a];e==o.ids&&catesHistoryChange(catesHistory[a-1])}}),scope.SelectCate=function(e,t,a,o,s,n){var r=scope.cates.length,i=a+1;t>0?getCates(a,e,o,s,n):(scope.goodsData.cate[a].data=s,scope.goodsData.cate.splice(i,scope.goodsData.cate.length-i),scope.cates.splice(i,r-i),scope.goodsData.goods_cat_id=s.id)},0==scope.goodsData.goods_cat_id?scope.SelectCate(0,1,0,0):angular.forEach(scope.goodsData.cate,function(e,t){scope.cates[t]=e.collections})}}}])}),define("apps/distributor/directives/detail.design",["apps/common/directives/directives"],function(e){e.directive("dgoodsDetailDesign",["$timeout","designData","ddesignGoodsRes",function(e,t,a){return{restrict:"AE",replace:!0,templateUrl:"assets/js/apps/distributor/templates/detail.design.html",link:function(o,s,n){a.get({},function(e){o.designGoodsList=angular.copy(e.data),o.designGoodsList.unshift({id:0,title:"普通版"})}),0==o.goodsData.slices.length&&(o.goodsData.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],o.$watch("goodsData.description",function(e){o.goodsData.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0,text:e},class:!0}],o.editSlice(o.goodsData.slices[1])})),o.$watch("goodsData.components_data",function(e,t){if(e.length>0){o.goodsData.slices=e,"goods_head"!=o.goodsData.slices[0].type&&o.goodsData.slices.unshift({type:"goods_head"});for(var a in o.goodsData.slices)"goods_info"==o.goodsData.slices[a].type&&(o.goodsData.slices[a].class=!0,o.editSlice(o.goodsData.slices[a]))}}),o.config={},o.icon_list=t.concat(),o.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,a){a.item.sortable.droptarget&&e.target!=a.item.sortable.droptarget[0]&&(o.icon_list=t.concat(),"mouseup"==e.handleObj.type&&o.editSlice(a.item.sortable.moved))}},o.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},o.goods_info=function(e){"goods_info"==e.type&&($scope.design={type:"text"})},o.removeSlice=function(e){o.goodsData.slices.splice(e,1),o.design=!1},o.$parent.editSlice=o.editSlice=function(t,a){"goods_head"!=t.type&&(o.design=t,angular.forEach(o.goodsData.slices,function(e,t){e.class=!1}),t.class=!0,e(function(){o.$broadcast("design_data",t),angular.isUndefined(a)||o.$broadcast("design_dirty",a)},200))},o.editSlice(o.goodsData.slices[1])}}}])}),define("apps/distributor/directives/_base",["apps/distributor/directives/edit_title","apps/distributor/directives/goods.material.upload","apps/distributor/directives/prop.setting","apps/distributor/directives/sku.setting","apps/distributor/directives/shipment.setting","apps/distributor/directives/collectFields.setting","apps/distributor/directives/cates.select","apps/distributor/directives/detail.design"],function(){}),define("apps/distributor/services/goods",["apps/common/services/services"],function(e){e.factory("dgoodsResource",["$resource",function(e){return e("suppliers/goods.json",{id:"@id"},{get:{method:"GET",url:"suppliers/goods/:id.json"},update:{method:"PUT",url:"suppliers/goods/:id.json"},delete:{method:"DELETE",url:"suppliers/supplier_goods/:id.json"},onSale:{method:"PUT",url:"suppliers/goods/sale/:id.json"},batchDelete:{method:"DELETE",url:"suppliers/goods/batch.json"},batchToggleSale:{method:"PUT",url:"suppliers/goods/batch_sale.json"},batchTag:{method:"PUT",url:"suppliers/goods/batch_tag.json"},batchRegion:{method:"PUT",url:"suppliers/goods/batch_region.json"},batchDesignGoods:{method:"PUT",url:"suppliers/goods/batch_design_goods.json"},batchDiscount:{method:"PUT",url:"suppliers/goods/batch_discount.json"},editField:{method:"PUT",url:"suppliers/goods/field/:id.json"},editProductField:{method:"PUT",url:"suppliers/goods/product_field/:id.json"},getProducts:{method:"GET",url:"suppliers/goods/products/:id.json"},getGuiderGoods:{method:"GET",url:"suppliers/goods_guider.json"},getQrcodeInfo:{method:"GET",url:"suppliers/goods/qrcode_info/:id.json"}})}]),e.factory("dmerchantSettingResource",["$resource",function(e){return e("/suppliers/merchant_setting.json",{},{update:{method:"POST"},get:{method:"GET"}})}]),e.factory("dshipmentResource",["$resource",function(e){return e("/suppliers/shipment.json",{id:"@id"},{get:{method:"GET",url:"/suppliers/shipment/:id.json"}})}]),e.factory("dfromShipmentResource",["$resource",function(e){return e("/suppliers/shop_shipments/:shop_id.json",{shop_id:"@shop_id"},{})}]),e.factory("ddesignGoodsRes",["$resource",function(e){return e("/suppliers/design/goods.json",{id:"@id"},{get:{method:"GET",url:"/suppliers/design/goods/:id.json"},update:{method:"PUT",url:"/suppliers/design/goods/:id.json"},delete:{method:"DELETE",url:"/suppliers/design/goods/:id.json"}})}])}),define("apps/distributor/services/prop",["apps/common/services/services"],function(e){e.factory("dpropResource",["$resource",function(e){return e("suppliers/prop.json",{id:"@id"},{get:{method:"GET",isArray:!0},update:{method:"PUT",url:"suppliers/prop/:id.json"},delete:{method:"DELETE",url:"suppliers/prop/:id.json"}})}]),e.factory("dfromPropResource",["$resource",function(e){return e("suppliers/from_prop.json",{id:"@id"},{get:{method:"GET",isArray:!0}})}])}),define("apps/distributor/services/propValue",["apps/common/services/services"],function(e){e.factory("dpropValueResource",["$resource",function(e){return e("suppliers/prop/input_value.json",{id:"@id"},{delete:{method:"DELETE",url:"suppliers/prop/input_value/:id.json"}})}])}),define("apps/distributor/services/tag",["apps/common/services/services"],function(e){e.factory("dtagResource",["$resource",function(e){return e("suppliers/tag.json",{id:"@id"},{get:{method:"GET",url:"suppliers/tag/:id.json"},update:{method:"PUT",url:"suppliers/tag/:id.json"},delete:{method:"DELETE",url:"suppliers/tag/:id.json"}})}])}),define("apps/distributor/services/cat",["apps/common/services/services"],function(e){e.factory("dcatResource",["$resource",function(e){return e("suppliers/cat.json",{id:"@id"},{})}])}),define("apps/distributor/services/product",["apps/common/services/services"],function(e){e.factory("dproductResource",["$resource",function(e){return e("suppliers/products.json",{id:"@id"},{get:{method:"GET",url:"suppliers/products/:id.json",isArray:!0},update:{method:"PUT",url:"suppliers/products/:id.json"}})}])}),define("apps/distributor/services/external",["apps/common/services/services"],function(e){e.factory("dgoodsExternalResource",["$resource",function(e){return e("suppliers/goods/external/:id.json",{id:"@id"},{save:{method:"POST",url:"suppliers/goods/external.json"},gets:{method:"GET",url:"suppliers/goods/external.json"},Delete:{method:"DELETE",url:"suppliers/goods/external/:id.json"},BatchDelete:{method:"DELETE",url:"suppliers/goods/external_batch.json"}})}])}),define("apps/distributor/services/shop.upload",["apps/common/services/services"],function(e){e.factory("shopUpladFactory",[function(){var e={username:"",password:"",offset:0,limit:10,imported:0,exist:0,status:!1,is_finish:!1},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t}])}),define("apps/distributor/services/shop.import",["apps/common/services/services"],function(e){e.factory("dshopImportResource",["$resource",function(e){return e("suppliers/goods/import_shop.json",{id:"@id"},{})}])}),define("apps/distributor/services/line",["apps/common/services/services"],function(e){e.factory("lineResource",["$resource",function(e){return e("suppliers/supplier_goods_line.json",{id:"@id"},{getlist:{method:"GET",url:"suppliers/supplier_goods_line.json"},update:{method:"PUT",url:"suppliers/enable_goods_line/:id.json"},editField:{method:"PUT",url:"suppliers/supplier_goods_line/:id.json"},save:{method:"POST",url:"suppliers/supplier_goods_line.json"}})}]),e.factory("linegoddsResource",["$resource",function(e){return e("suppliers/line_goods.json",{id:"@id"},{getlist:{method:"GET",url:"suppliers/line_goods.json"},onSale:{method:"PUT",url:"suppliers/onsale_line_goods/:id.json"},delete:{method:"DELETE",url:"suppliers/del_line_goods/:id.json"}})}]),e.factory("linegoddsctrlResource",["$resource",function(e){return e("suppliers/no_join_goods_list.json",{id:"@id"},{get:{method:"GET",url:"suppliers/no_join_goods_list.json"},add:{method:"POST",url:"suppliers/goods_to_line.json"},editField:{method:"PUT",url:"suppliers/onsale_line_goods/:id.json"}})}]),e.factory("synchronizationResource",["$resource",function(e){return e("suppliers/sync_line_goods_one.json",{id:"@id"},{put:{method:"PUT",url:"suppliers/sync_line_goods_one/:id.json"},listput:{method:"PUT",url:"suppliers/sync_line_goods_all/:id.json"}})}])}),define("apps/distributor/services/withdraw",["apps/common/services/services"],function(e){e.factory("accountResource",["$resource",function(e){return e("/suppliers/suppliers_cash.json",{id:"@id"},{get:{method:"GET",url:"/suppliers/suppliers_cash.json",isArray:!1}})}]),e.factory("sRemarkSource",["$resource",function(e){return e("/suppliers/supplier_withdrawupdate/:id.json",{id:"@id"},{update:{method:"PUT",url:"/suppliers/supplier_withdrawupdate/:id.json"},query:{method:"GET",isArray:!1}})}]),e.factory("actionWithdrawSource",["$resource",function(e){return e("suppliers/supplier_withdraw/:id.json",{id:"@id"},{putWithdraw:{method:"PUT",url:"suppliers/supplier_withdraw/:id.json"},query:{method:"GET",isArray:!1}})}]),e.factory("supplierRechargeResource",["$resource",function(e){return e("/suppliers/recharge.json",{},{update:{method:"POST"}})}])}),define("apps/distributor/services/rank",["apps/common/services/services"],function(e){e.factory("rankResource",["$resource",function(e){return e("/suppliers/suppliers_level/:id.json",{id:"@id"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}})}])}),define("apps/distributor/services/goodslog",["apps/common/services/services"],function(e){e.factory("lineslogResource",["$resource",function(e){return e("suppliers/goods/supplier_goods_log.json",{id:"@id"},{getlist:{method:"GET",url:"suppliers/goods/supplier_goods_log.json"}})}])}),define("apps/distributor/services/feedback",["apps/common/services/services"],function(e){e.factory("supplierFeedbackSource",["$resource",function(e){return e("/suppliers/order_refund_safeguard.json",{id:"@id"},{query:{method:"GET",isArray:!1},get:{method:"GET",url:"/suppliers/order/refund_details.json"},refund:{method:"PUT",url:"/suppliers/order/supplierFeedback/:id.json"}})}])}),define("apps/distributor/services/dispatct",["apps/common/services/services"],function(e){e.factory("dispatctAddResource",["$resource",function(e){return e("/suppliers/supplier_offline_order.json",{},{add:{method:"post"}})}]),e.factory("dispatctListResource",["$resource",function(e){return e("/suppliers/supplier_offline_orders.json",{get:{method:"GET",isArray:!0}})}]),e.factory("supplierofflineOrder",["$resource",function(e){return e("/suppliers/supplier_offline_order.json",{order_id:"@order_id"},{get:{method:"GET",url:"/suppliers/supplier_offline_order/:order_id.json"}})}])}),define("apps/distributor/services/_base",["apps/distributor/services/goods","apps/distributor/services/prop","apps/distributor/services/propValue","apps/distributor/services/tag","apps/distributor/services/cat","apps/distributor/services/product","apps/distributor/services/external","apps/distributor/services/shop.upload","apps/distributor/services/shop.import","apps/distributor/services/line","apps/distributor/services/withdraw","apps/distributor/services/rank","apps/distributor/services/goodslog","apps/distributor/services/feedback","apps/distributor/services/dispatct"],function(){}),define("apps/distributor/main",["apps/distributor/states/_base","apps/distributor/controllers/_base","apps/distributor/directives/_base","apps/distributor/services/_base"],function(){}),define("apps/team/states/dashboard",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("team",{abstract:!0,url:"/team",templateUrl:"assets/js/apps/team/templates/layout.html"}).state("team.dashboard",{url:"",templateUrl:"assets/js/apps/team/templates/dashboard.html",controller:"team.dashboard"})}])}),define("apps/team/states/SetCaptain",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){}])}),define("apps/team/states/list",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("team.list",{abstract:!0,url:"/list",templateUrl:"assets/js/apps/team/templates/list_tab.html"}).state("team.list.member",{url:"",templateUrl:"assets/js/apps/team/templates/team.member.html",controller:"team.team.member"}).state("team.list.group",{url:"/group",templateUrl:"assets/js/apps/team/templates/team.group.html",controller:"team.team.group"})}])}),define("apps/team/states/record",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("team.record",{url:"/record",templateUrl:"assets/js/apps/team/templates/record.html",controller:"team.record"})}])}),define("apps/team/states/setting",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("team.setting",{abstract:!0,url:"/setting",templateUrl:"assets/js/apps/team/templates/setting_tab.html"}).state("team.setting.settled",{url:"",templateUrl:"assets/js/apps/team/templates/setting_settled.html",controller:"team.setting.settled"}).state("team.setting.goods",{url:"/goods",templateUrl:"assets/js/apps/team/templates/setting.goods.html",controller:"team.setting.goods"}).state("team.setting.template",{url:"/template",templateUrl:"assets/js/apps/team/templates/setting.template.html",controller:"team.setting.template"})}])}),define("apps/team/states/design",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("team.design",{abstract:!0,url:"/design",templateUrl:"assets/js/apps/team/templates/design_tab.html"}).state("team.design.apply",{url:"",templateUrl:"assets/js/apps/team/templates/design.apply.html",controller:"team.design.apply"}).state("team.design.center",{url:"/center",templateUrl:"assets/js/apps/team/templates/design.center.html",controller:"team.design.center"}).state("team.design.qrcode",{url:"/qrcode",templateUrl:"assets/js/apps/team/templates/design.qrcode.html",controller:"team.design.qrcode"})}])}),define("apps/team/states/team.order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("team.order",{url:"/order",templateUrl:"assets/js/apps/team/templates/team.order.html",controller:"team.orders"})}])}),define("apps/team/states/_base",["apps/team/states/dashboard","apps/team/states/SetCaptain","apps/team/states/list","apps/team/states/record","apps/team/states/setting","apps/team/states/design","apps/team/states/team.order"],function(){}),define("apps/team/services/dashboard",["apps/common/services/services"],function(e){e.factory("teamDashboardResource",["$resource",function(e){return e("/team/stat_days.json",{query:{method:"GET",isArray:!0}})}]),e.factory("teamOverviewResource",["$resource",function(e){return e("/team/stat_baseinfo.json",{},{get:{method:"GET"}})}]),e.factory("teamRanksResource",["$resource",function(e){return e("/team/stat_ranks.json?top=3",{},{get:{method:"GET"}})}]),e.factory("teamMallIncomeResource",["$resource",function(e){return e("/mall/mallincome.json",{},{get:{method:"GET"}})}]),e.factory("teamIncomeSetting",["$resource",function(e){return e("/team/team_group.json",{},{get:{method:"GET"}})}]),e.factory("teamPostGroups",["$resource",function(e){return e("/team/team_group.json",{},{post:{method:"POST"}})}]),e.factory("teamPutGroups",["$resource",function(e){return e("/team/team_group.json",{},{put:{method:"PUT"}})}]),e.factory("teamPutGroupsid",["$resource",function(e){return e("/team/team_group/:id.json",{id:"@id"},{get:{method:"GET",url:"/team/team_group/:id.json"},delete:{method:"DELETE",url:"/team/team_group/:id.json"}})}])}),define("apps/team/services/setcaptain",["apps/common/services/services"],function(e){
e.factory("setcaptainPost",["$resource",function(e){return e("/team/team.json",{},{update:{method:"POST"}})}]),e.factory("captaingroup",["$resource",function(e){return e("/team/team_group.json",{},{get:{method:"GET"}})}]),e.factory("changecaptaininfo",["$resource",function(e){return e("/team/team.json",{id:"@id"},{getTeam:{method:"GET",url:"/team/team/:id.json"},changeTeam:{method:"PUT",url:"/team/team/:id.json"}})}])}),define("apps/team/services/design",["apps/common/services/services"],function(e){e.factory("TeamDesignResource",["$resource",function(e){return e("",{},{centerGet:{method:"GET",url:"/team/design/feature.json"},centerSave:{method:"PUT",url:"/team/design/feature.json"}})}])}),define("apps/team/services/team.design.qrcode",["apps/common/services/services"],function(e){e.factory("designqrcode",["$resource",function(e){return e("/team/design/qrcode.json",{},{getqrcode:{method:"GET",url:"/team/design/qrcode.json"},changeqrcode:{method:"put",url:"/team/design/qrcode.json"}})}])}),define("apps/team/services/list",["apps/common/services/services"],function(e){e.factory("teamResource",["$resource",function(e){return e("/team/list.json",{id:"@id"},{get:{method:"GET",url:"/team/list.json"},putTeam:{method:"PUT",url:"/team/list/team/:id.json"},putStatus:{method:"PUT",url:"/team/list/team/:id.json"},getGroups:{method:"GET",url:"/team/team_group.json"}})}]),e.factory("teamQrcode",["$resource",function(e){return e("/team/list.json",{id:"@id"},{get:{method:"GET",url:"team/qrcode/:id.json"}})}])}),define("apps/team/services/teamer",["apps/common/services/services"],function(e){e.factory("memberResource",["$resource",function(e){return e("/team/list/teamer.json",{id:"@id"},{getMembers:{method:"GET",url:"/team/list/teamer.json"},deleteTeamer:{method:"delete",url:"/team/list/teamer/:id.json"}})}]),e.factory("TeamcaptainResource",["$resource",function(e){return e("/team/list/teamer.json",{team_id:"@team_id"},{changecaptain:{method:"PUT",url:"team/team/captain/:team_id.json"}})}])}),define("apps/team/services/settled",["apps/common/services/services"],function(e){e.factory("teamBonusdResource",["$resource",function(e){return e("/team/team_bonus.json",{id:"@id"},{get:{method:"GET",url:"/team/team_bonus.json"}})}])}),define("apps/team/services/setting.goods",["apps/common/services/services"],function(e){e.factory("SettingPostGoods",["$resource",function(e){return e("/team/team_goods.json",{id:"@id"},{post:{method:"POST",url:"/team/team_goods.json"},get:{method:"GET",url:"/team/team_goods.json"},delete:{method:"DELETE",url:"/team/team_goods/:id.json"}})}])}),define("apps/team/services/setting.template",["apps/common/services/services"],function(e){e.factory("getTeamNotifySetting",["$resource",function(e){return e("/team/notify.json",{},{get:{method:"GET",url:"/team/notify.json"},update:{method:"PUT",url:"/team/notify.json"}})}])}),define("apps/team/services/team.order",["apps/common/services/services"],function(e){e.factory("getTeamOrders",["$resource",function(e){return e("/team/orders.json",{id:"@id"},{getOrderGoods:{method:"GET",url:"team/order_goods/:id.json",isArray:!0},get:{method:"GET",url:"/team/orders.json"}})}])}),define("apps/team/services/goods",["apps/common/services/services"],function(e){e.factory("teamGoodsResource",["$resource",function(e){return e("goods.json",{id:"@id"},{getGoods:{method:"GET",url:"goods.json"}})}])}),define("apps/team/services/tag",["apps/common/services/services"],function(e){e.factory("teamTagResource",["$resource",function(e){return e("goods/tag.json",{id:"@id"},{get:{method:"GET",url:"goods/tag/:id.json"},update:{method:"PUT",url:"goods/tag/:id.json"},delete:{method:"DELETE",url:"goods/tag/:id.json"}})}])}),define("apps/team/services/_base",["apps/team/services/dashboard","apps/team/services/setcaptain","apps/team/services/design","apps/team/services/team.design.qrcode","apps/team/services/list","apps/team/services/teamer","apps/team/services/settled","apps/team/services/setting.goods","apps/team/services/setting.template","apps/team/services/team.order","apps/team/services/goods","apps/team/services/tag"],function(){}),define("apps/team/controllers/dashboard",["apps/common/controllers/controllers","echarts","echarts/chart/pie"],function(e,t){e.controller("team.dashboard",["$scope","teamDashboardResource","teamOverviewResource","teamMallIncomeResource","teamRanksResource",function(e,a,o,s,n){var r=t.init(document.getElementById("chart")),i=t.init(document.getElementById("moneyChart")),c=t.init(document.getElementById("orderchart"));a.query().$promise.then(function(e){var t=[],a=[],o=[];angular.forEach(e,function(e,s){t.push(e.date),a.push(e.team_feat_sum),o.push(e.team_corder)});var s={tooltip:{trigger:"axis"},legend:{data:["交易总额"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:t}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"交易总额",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:a}]},n={tooltip:{trigger:"axis"},legend:{data:["订单数"]},grid:{x:50,x2:50,y:40,y2:30,borderWidth:0},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,axisLine:!1,splitLine:!1,axisTick:{length:4,lineStyle:{color:"#CCC"}},data:t}],yAxis:[{type:"value",axisLine:!1,splitLine:{lineStyle:{type:"dotted"}}}],series:[{name:"订单数",type:"line",smooth:!0,symbol:"circle",symbolSize:3,data:o}]};c.setOption(n),i.setOption(s)}),n.get(function(e){var t=[],a=[];angular.forEach(e,function(e,o){return void 0!=e.name&&(t.push(e.name),void a.push({value:e.feat_sum,name:e.name}))});var o={title:{text:"战队概况",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:t},toolbox:{show:!1,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["pie","funnel"],option:{funnel:{x:"25%",width:"50%",funnelAlign:"left",max:1548}}},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"销售额",type:"pie",radius:"55%",center:["50%","60%"],data:a}]};r.setOption(o)}),e.params={subDay:"",subMonth:1,subWeek:1},o.get(e.params,function(t){e.income=t}),s.get(function(t){e.mallIncome=t})}])}),define("apps/team/controllers/setcaptain",["apps/common/controllers/controllers"],function(e,t){e.controller("team.setcaptain",["$scope","Flash","$modalInstance","$state","$modal","ngPopover","setcaptainItem","setcaptainPost","captaingroup",function(e,t,a,o,s,n,r,i,c){e.captain={},e.data={},e.captain.temporaryName=r.nickname,e.data.group_id="-1",e.data.guider_id=r.id,e.groups=[{id:"-1",name:"--默认分组--"}];var l=function(t){c.get(function(t){e.groups=t.data,e.groups.unshift({id:"-1",name:"--默认分组--"})})};l(),e.btn_text="保存",e.cancel=function(){a.dismiss("cancel")},e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,r.id&&i.update(e.data,function(o){o.success?(e.btn_text="保存",t.create("success","设置成功！"),a.close(1)):o.error&&(e.btn_text="保存",t.create("danger",o.error),a.close(1))},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/team/controllers/group",["apps/common/controllers/controllers"],function(e){e.controller("team.groups.add",["$scope","Flash","$modalInstance","teamPostGroups",function(e,t,a,o){e.data={},e.data.title="新增分组",e.cancel=function(){a.dismiss("cancel")},e.groups=[{target:"",bonus:"",captain:"",type:0,enable:1}],e.add_groups=function(){e.groups.push({target:"",bonus:"",captain:"",type:0,enable:0})},e.removeSlide=function(t){e.groups.splice(t,1)},e.groupsMontch=[{target:"",bonus:"",captain:"",type:1,enable:0}],e.add_groups_month=function(){e.groupsMontch.push({target:"",bonus:"",captain:"",type:1,enable:0})},e.removeSlideMontch=function(t){e.groupsMontch.splice(t,1)},e.submit=function(s){if(e.enableids=[],e.enableidsMontch=[],s.group_name.$invalid)return s.group_name.$dirty=!0,$("input[name='group_name']").focus(),!1;if(e.groups){for(var n=e.groups,r=[],i=0;i<n.length;i++){if(r.push(n[i].target),""==n[i].target)return void t.create("danger","战队目标金额不能为空!");if(""==n[i].bonus)return void t.create("danger","战队总提成不能为空!");if(""==n[i].captain)return void t.create("danger","队长提成不能为空!");if(parseFloat(n[i].bonus)>parseFloat(n[i].target))return void t.create("danger","战队总提成不能高于目标奖金");if(parseFloat(n[i].captain)>parseFloat(n[i].bonus))return void t.create("danger","队长额外奖金不能高于战队总提成")}for(var c=r.sort(),i=0;i<c.length;i++)if(c[i]==c[i+1])return void t.create("danger","目标金额不能重复")}if(e.groupsMontch){for(var n=e.groupsMontch,r=[],i=0;i<n.length;i++){if(r.push(n[i].target),""==n[i].target)return void t.create("danger","战队目标金额不能为空!");if(""==n[i].bonus)return void t.create("danger","战队总提成不能为空!");if(""==n[i].captain)return void t.create("danger","队长提成不能为空!");if(parseFloat(n[i].bonus)>parseFloat(n[i].target))return void t.create("danger","战队总提成不能高于目标奖金");if(parseFloat(n[i].captain)>parseFloat(n[i].bonus))return void t.create("danger","队长额外奖金不能高于战队总提成")}for(var c=r.sort(),i=0;i<c.length;i++)if(c[i]==c[i+1])return void t.create("danger","目标金额不能重复")}if(s.group_max_num.$invalid)return s.group_max_num.$dirty=!0,$("input[name='group_max_num']").focus(),!1;angular.forEach(e.groups,function(t,a){e.enableids.push(e.groups[a].enable)}),angular.forEach(e.groupsMontch,function(t,a){e.enableidsMontch.push(e.groupsMontch[a].enable)});var l=[],l=e.enableids.concat(e.enableidsMontch),d=0;if(angular.forEach(l,function(e,t){d+=l[t]}),0==d)return t.create("danger","至少选择一个按月或按周增加！"),!1;var p=e.groups.concat(e.groupsMontch),u={type:"group",max_num:e.data.max_num,name:e.data.name,check:p};o.post(u,function(e){e.success?(t.create("success","设置成功！"),a.close(1)):e.error&&t.create("danger",e.error)},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/team/controllers/setting.template",["apps/common/controllers/controllers"],function(e){e.controller("team.setting.template",["$scope","Flash","getTeamNotifySetting","$modal",function(e,t,a,o){e.setting=a.get(),e.btn_text="保存",e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.update(e.setting,function(o){e.form.$invalid=!1,e.setting=a.get(),e.btn_text="保存",t.create("success"," 保存成功！")},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/team/controllers/setting.goods",["apps/common/controllers/controllers"],function(e){e.controller("team.setting.goods",["$scope","Flash","SettingPostGoods","$modal",function(e,t,a,o){e.search={},e.paginationConf={currentPage:1,itemsPerPage:6},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:""};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t.count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),e.addGuideGoods=function(){var e=o.open({animation:!1,templateUrl:"assets/js/apps/team/templates/add_goods_tpl.html",controller:"team.add_goods.tpl",windowClass:"modal-open"});e.result.then(function(e){e.success&&s()})},e.editGuideGoods=function(e,t){var a=o.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/guider/templates/choice_goods_tpl.html",controller:"choice_goods.tpl",resolve:{guider_goods_id:function(){return e},goods_id:function(){return t}}});a.result.then(function(e){s()})},e.remove=function(o,s){a.delete({id:s},function(a){e.data.splice(o,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})},e.search=function(){s()}}])}),define("apps/team/controllers/setting.settled",["apps/common/controllers/controllers"],function(e){e.controller("team.setting.settled",["$scope","teamPutGroupsid","teamPutGroups","teamPostGroups","Flash",function(e,t,a,o,s){var n;e.groups=[],e.groupsMontch=[],e.settingdata=function(){t.get({id:0},function(t){t.data.alias=t.data.alias?t.data.alias:"战队",void 0==t.data.max_num&&(t.data.max_num=0),e.data=t.data,n=t.data.id?1:0,angular.forEach(t.data.check,function(a,o){"Array"!=t.data.check&&(0==t.data.check[o].type?e.groups.push(t.data.check[o]):1==t.data.check[o].type&&e.groupsMontch.push(t.data.check[o]))})})},e.settingdata(),e.add_groups=function(){e.groups.push({target:"",bonus:"",captain:"",type:0,enable:0})},e.removeSlide=function(t){e.groups.splice(t,1)},e.add_groups_month=function(){e.groupsMontch.push({target:"",bonus:"",captain:"",type:1,enable:0})},e.removeSlideMontch=function(t){e.groupsMontch.splice(t,1)},e.submit=function(t){if(e.enableids=[],e.enableidsMontch=[],t.group_name.$invalid)return t.group_name.$dirty=!0,$("input[name='group_name']").focus(),!1;if(e.groups){for(var r=e.groups,i=[],c=0;c<r.length;c++){if(i.push(r[c].target),""==r[c].target)return void s.create("danger","战队目标金额不能为空!");if(""==r[c].bonus)return void s.create("danger","战队总提成不能为空!");if(""==r[c].captain)return void s.create("danger","队长提成不能为空!");if(parseFloat(r[c].bonus)>parseFloat(r[c].target))return void s.create("danger","战队总提成不能高于目标奖金");if(parseFloat(r[c].captain)>parseFloat(r[c].bonus))return void s.create("danger","队长额外奖金不能高于战队总提成")}for(var l=i.sort(),c=0;c<l.length;c++)if(l[c]==l[c+1])return void s.create("danger","目标金额不能重复")}if(e.groupsMontch){for(var r=e.groupsMontch,i=[],c=0;c<r.length;c++){if(i.push(r[c].target),""==r[c].target)return void s.create("danger","战队目标金额不能为空!");if(""==r[c].bonus)return void s.create("danger","战队总提成不能为空!");if(""==r[c].captain)return void s.create("danger","队长提成不能为空!");if(parseFloat(r[c].bonus)>parseFloat(r[c].target))return void s.create("danger","战队总提成不能高于目标奖金");if(parseFloat(r[c].captain)>parseFloat(r[c].bonus))return void s.create("danger","队长额外奖金不能高于战队总提成")}for(var l=i.sort(),c=0;c<l.length;c++)if(l[c]==l[c+1])return void s.create("danger","目标金额不能重复")}if(t.group_max_num.$invalid)return t.group_max_num.$dirty=!0,$("input[name='group_max_num']").focus(),!1;if(e.groups.length<1&&e.groupsMontch<1)return s.create("danger","至少添加一个按月或按周增加！"),!1;angular.forEach(e.groups,function(t,a){e.enableids.push(e.groups[a].enable)}),angular.forEach(e.groupsMontch,function(t,a){e.enableidsMontch.push(e.groupsMontch[a].enable)});var d=[],d=e.enableids.concat(e.enableidsMontch),p=0;if(angular.forEach(d,function(e,t){p+=d[t]}),0==p)return s.create("danger","至少选择一个按月或按周增加！"),!1;var u=e.groups.concat(e.groupsMontch),m={max_num:e.data.max_num,alias:e.data.alias,check:u};e.form.$invalid=!0,0==n?o.post(m,function(t){e.form.$invalid=!1,t.success?(n=1,s.create("success","设置成功！")):t.error&&s.create("danger",t.error)},function(t){e.form.$invalid=!1,s.create("danger",t.data.error.message)}):a.put(m,function(t){e.form.$invalid=!1,t.success?s.create("success","设置成功！"):t.error&&s.create("danger",t.error)},function(t){e.form.$invalid=!1,s.create("danger",t.data.error.message)})}}])}),define("apps/team/controllers/team.group",["apps/common/controllers/controllers"],function(e){e.controller("team.team.group",["$scope","Flash","$modal","teamIncomeSetting","teamPutGroupsid",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:6},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,o.get(e.params,function(t){e.paginationConf.totalItems=t.count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.addGuideLevel=function(){var e=a.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/team/templates/groups.html",controller:"team.groups.add",resolve:{level_id:function(){return 0}}});e.result.then(function(e){n()})},e.editGuideGroup=function(e){var t=a.open({size:"lg",animation:!1,templateUrl:"assets/js/apps/team/templates/groups.html",controller:"team.group.edit",resolve:{group_id:function(){return e}}});t.result.then(function(e){n()})},e.remove=function(a,o){s.delete({id:o},function(o){e.data.splice(a,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/team/controllers/team.member",["apps/common/controllers/controllers"],function(e){e.controller("team.team.member",["$scope","$filter","ngPopover","Flash","teamResource","teamQrcode","$modal",function(e,t,a,o,s,n,r){function i(t,a){s.putStatus(t,function(s){e.team[a].status=t.status,o.create("success"," 操作成功！")},function(e){o.create("danger",e.data.error.message)})}e.paginationConf={currentPage:1,itemsPerPage:10},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.placehold="战队",e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,group_id:-1,status:"2",startDate:"",endDate:"",column:"total_mount",created_at:"",direction:"desc",type:"0",title:""};var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.team=t.data})};e.group=[{id:-1,name:"全部"},{id:0,name:"默认分组"}];var l=function(){s.getGroups(function(t){e.group=t.data,e.group.unshift({id:-1,name:"全部"},{id:0,name:"默认分组"})})};l(),e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.sorting={created_at:"",teamerNum:"",total_bonus:"",total_mount:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),c()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.viewMemberInfo=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/team/templates/member_info.html",controller:"team.member.info",resolve:{orderId:function(){return e}}});t.result.then(function(e){c()},function(e){c()})},e.viewSaleInfo=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/team/templates/teamer.sales.html",controller:"team.member.info",resolve:{orderId:function(){return e}}});t.result.then(function(e){c()},function(e){c()})},e.confirmDisable=function(e,t,a){var o={id:e,status:a};i(o,t)},e.changeplaceholder=function(){0==e.params.type?e.placehold="战队":1==e.params.type?e.placehold="队长":2==e.params.type?e.placehold="手机号":e.placehold="队长账号"},e.search=function(){e.paginationConf.currentPage=1;var t=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.startDate=t[0],e.params.endDate=t[1]):(delete e.params.startDate,delete e.params.endDate),c()},e.setcaptain=function(e){var t=r.open({animation:!1,templateUrl:"assets/js/apps/team/templates/team_captain_setting.html",controller:"team_captain_setting",resolve:{id:function(){return e}}});t.result.then(function(e){c()})},e.showQrcode=function(t){n.get({id:t},function(t){e.qrcodeInfo=t})},e.open_copy=function(t){e.copy_text=t},e.showMessage=function(e){a.close(),Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/team/controllers/member.info",["apps/common/controllers/controllers"],function(e){e.controller("team.member.info",["$scope","orderId","memberResource","TeamcaptainResource","$modalInstance","Flash",function(e,t,a,o,s,n){e._global=_global,e.cancel=function(){s.close(1),s.dismiss("cancel")},e.paginationConf={currentPage:1,itemsPerPage:10},e.param={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,team_id:t,title:""};var r=function(){e.param.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.param.limit=e.paginationConf.itemsPerPage,a.getMembers(e.param,function(t){e.paginationConf.totalItems=t._count,e.member_list=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.confirmDelete=function(e){a.deleteTeamer({id:e},function(e){e.result?(n.create("success","删除成功"),r()):n.create("danger",e.result)})},e.changeTeamCaptain=function(e){var a={teamer_id:e,team_id:t};o.changecaptain(a,function(e){e.status?(n.create("success","操作成功"),r()):n.create("danger",e.msg)})},e.search=function(){r()}}])}),define("apps/team/controllers/record",["apps/common/controllers/controllers"],function(e){e.controller("team.record",["$scope","$filter","ngPopover","Flash","teamBonusdResource","$modal",function(e,t,a,o,s,n){e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},e.searchparams={},e.teambonus=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t.count,e.data=t.data})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",e.teambonus),e.search=function(){e.paginationConf.currentPage=1;var t=$('input[name="settled_range"]').val();""!=t?(t=t.split("/"),e.params.created_at_start=t[0],e.params.created_at_end=t[1]):(delete e.params.created_at_start,delete e.params.created_at_end),1==e.paginationConf.currentPage?e.teambonus():e.paginationConf.currentPage=1}}])}),define("apps/team/controllers/design.apply",["apps/common/controllers/controllers"],function(e){e.controller("team.design.apply",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","TeamerDesignResource",function(e,t,a,o,s,n,r,i){e.config={entrance_enable:0,fields:[]},e.slices=[{type:"partner_banner"},{type:"partner_apply",content:{fields:e.config.fields}},{type:"partner_intro"}],PartnerDesignResource.applyGet({},function(t){if(e.config={entrance_enable:t.entrance_enable,fields:t.fields},t.data.length){e.slices=t.data;for(var a in e.slices){var o=e.slices[a];if("partner_apply"==o.type){o.content.fields=e.config.fields;break}}}}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],e.addField=function(){e.config.fields.push({type:"text"})},e.deleteFields=function(t){e.config.fields.splice(t,1)},e.save=function(){var a=angular.copy(e.slices);for(var o in a){var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.config.data=a,PartnerDesignResource.applySave(e.config,function(e){t.create("success"," 修改成功！")},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/team/controllers/design.center",["apps/common/controllers/controllers"],function(e){e.controller("team.design.center",["$scope","Flash","$timeout","$state","$stateParams","designData","designValidate","TeamDesignResource",function(e,t,a,o,s,n,r,i){e.slices=[{type:"team_head"},{type:"team_navs"}],i.centerGet({},function(t){t.data.length>0&&(e.slices=t.data,angular.forEach(e.slices,function(e,t){}))}),e.icon_list=n.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=n.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},e.removeSlice=function(t){e.slices.splice(t,1),e.design=!1},e.editSlice=function(t,o){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,a(function(){e.$broadcast("design_data",t),angular.isUndefined(o)||e.$broadcast("design_dirty",o)},200)},e.save_btn_status=!1,e.save=function(){var a=angular.copy(e.slices);for(var o in a){var s=r[a[o].type](a[o].content);if(s)return e.editSlice(e.slices[o],s),!1}e.save_btn_status=!0,i.centerSave({data:a},function(a){e.save_btn_status=!1,t.create("success"," 修改成功！")},function(a){e.save_btn_status=!1,t.create("danger",a.data.error.message)})}}])}),define("apps/team/controllers/design.qrcode",["apps/common/controllers/controllers"],function(e){e.controller("team.design.qrcode",["$scope","$filter","ngPopover","Flash","designqrcode","$modal",function(e,t,a,o,s,n){function r(){s.get(function(t){e.enabled=t})}e.enabled={},r(),e.$watch("images",function(){angular.isUndefined(e.images)||(e.enabled.bg_pic=e.images[e.images.length-1].url)}),e.reset=function(e){r()},e.save_btn_status=!1,e.save=function(){e.save_btn_status=!0,s.changeqrcode(e.enabled,function(t){e.save_btn_status=!1,o.create("success","保存成功！"),r()},function(t){e.save_btn_status=!1,item.enabled=!item.enabled,o.create("danger",t.data.error.message)})}}])}),define("apps/team/controllers/team.order",["apps/common/controllers/controllers"],function(e){e.controller("team.orders",["$scope","$filter","Flash","getTeamOrders","$modal",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,status:"-1"};var n=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},r=function(){var t=n("Settled");"true"==t&&(e.params.status=1)};r();var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,o.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){e.paginationConf.currentPage=1;var t=$('input[name="settled_range"]').val(),a=$('input[name="created_range"]').val();""!=t?(t=t.split("/"),e.params.settled_at_start=t[0],e.params.settled_at_end=t[1]):(delete e.params.settled_at_start,delete e.params.settled_at_end),""!=a?(a=a.split("/"),e.params.created_at_start=a[0],e.params.created_at_end=a[1]):(delete e.params.created_at_start,delete e.params.created_at_end),i()},e.viewOrderInfo=function(e){s.open({animation:!1,templateUrl:"assets/js/apps/team/templates/order_info_tpl.html",controller:"team.order_info.tpl",resolve:{orderId:function(){return e}}})}}])}),define("apps/team/controllers/order_info_tpl",["apps/common/controllers/controllers"],function(e){e.controller("team.order_info.tpl",["$scope","orderId","getTeamOrders","$modalInstance",function(e,t,a,o){e._global=_global,e.cancel=function(){o.dismiss("cancel")};var s=function(){a.getOrderGoods({id:t},function(t){e.orderGoods=t})};s()}])}),define("apps/team/controllers/team.group.edit",["apps/common/controllers/controllers"],function(e){e.controller("team.group.edit",["$scope","Flash","$modalInstance","group_id","teamPostGroups","teamPutGroups","teamPutGroupsid",function(e,t,a,o,s,n,r){e.cancel=function(){a.dismiss("cancel")},e.groups=[],e.groupsMontch=[],o&&(e.GetteamPutGroupitem=function(){r.get({id:o},function(t){t.data.title="编辑分组",e.data=t.data,angular.forEach(t.data.check,function(a,o){if("Array"!=t.data.check){if(0==t.data.check[o].type)return e.groups.push(t.data.check[o]),!0;1==t.data.check[o].type&&e.groupsMontch.push(t.data.check[o])}})})},e.GetteamPutGroupitem()),e.add_groups=function(){e.groups.push({target:"",bonus:"",captain:"",type:0,enable:0})},e.removeSlide=function(t){e.groups.splice(t,1)},e.add_groups_month=function(){e.groupsMontch.push({target:"",bonus:"",captain:"",type:1,enable:0})},e.removeSlideMontch=function(t){e.groupsMontch.splice(t,1)},e.submit=function(s){if(e.enableids=[],e.enableidsMontch=[],s.group_name.$invalid)return s.group_name.$dirty=!0,$("input[name='group_name']").focus(),!1;if(e.groups){for(var r=e.groups,i=[],c=0;c<r.length;c++){if(i.push(r[c].target),parseFloat(r[c].bonus)>parseFloat(r[c].target))return void t.create("danger","战队总提成不能高于目标奖金");if(parseFloat(r[c].captain)>parseFloat(r[c].bonus))return void t.create("danger","队长额外奖金不能高于战队总提成")}for(var l=i.sort(),c=0;c<l.length;c++)if(l[c]==l[c+1])return void t.create("danger","目标金额不能重复")}if(e.groupsMontch){for(var r=e.groupsMontch,i=[],c=0;c<r.length;c++){if(i.push(r[c].target),parseFloat(r[c].bonus)>parseFloat(r[c].target))return void t.create("danger","战队总提成不能高于目标奖金");if(parseFloat(r[c].captain)>parseFloat(r[c].bonus))return void t.create("danger","队长额外奖金不能高于战队总提成")}for(var l=i.sort(),c=0;c<l.length;c++)if(l[c]==l[c+1])return void t.create("danger","目标金额不能重复")}if(s.group_max_num.$invalid)return s.group_max_num.$dirty=!0,$("input[name='group_max_num']").focus(),!1;if(e.groups.length<1&&e.groupsMontch<1)return t.create("danger","至少添加一个按月或按周增加！"),!1;angular.forEach(e.groups,function(t,a){e.enableids.push(e.groups[a].enable)}),angular.forEach(e.groupsMontch,function(t,a){e.enableidsMontch.push(e.groupsMontch[a].enable)});var d=[],d=e.enableids.concat(e.enableidsMontch),p=0;if(angular.forEach(d,function(e,t){p+=d[t]}),0==p)return t.create("danger","至少选择一个按月或按周增加！"),!1;var u=e.groups.concat(e.groupsMontch),m={group_id:o,max_num:e.data.max_num,name:e.data.name,check:u};n.put(m,function(e){e.success?(t.create("success","修改成功！"),a.close(1)):e.error&&t.create("danger",e.error)},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/team/controllers/team_setting_captain",["apps/common/controllers/controllers"],function(e,t){e.controller("team_setting_setcaptain",["$scope","Flash","$modalInstance","$state","$modal","ngPopover","setcaptainItem","setcaptainPost","captaingroup",function(e,t,a,o,s,n,r,i,c){e.captain={},e.data={},e.captain.temporaryName=r.captain,e.captain.teamname=r.name,e.data.guider_id=r.id,e.groups=[];var l=function(t){c.get(function(t){var a=t.data,o=[];o.push({name:"默认分组",id:"null"});for(var s=0;s<a.length;s++)o.push(a[s]);e.groups=o})};l(),e.btn_text="保存",e.cancel=function(){a.dismiss("cancel")},e.submitForm=function(e){}}])}),define("apps/team/controllers/team_captain_setting",["apps/common/controllers/controllers"],function(e,t){e.controller("team_captain_setting",["$scope","Flash","$modalInstance","$state","$modal","ngPopover","id","changecaptaininfo","captaingroup",function(e,t,a,o,s,n,r,i,c){e.data={},e.data.group_id=0,e.groups=[{id:0,name:"默认分组"}];var l=function(t){c.get(function(t){e.groups=t.data,e.groups.unshift({id:0,name:"默认分组"})})};l(),e._global=_global,e.cancel=function(){a.dismiss("cancel")};var d=function(){i.getTeam({id:r},function(t){e.captain=t,e.data=e.captain})};e.btn_text="保存",d(),e.submitForm=function(o){
o&&(e.btn_text="保存中...",e.form.$invalid=!0,r&&i.changeTeam(e.data,function(o){o.success?(e.btn_text="保存",t.create("success","设置成功！"),a.close(1)):o.error&&(e.btn_text="保存",t.create("danger",o.error),a.close(1))},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/team/controllers/team.add_goods.tpl",["apps/common/controllers/controllers"],function(e){e.controller("team.add_goods.tpl",["$scope","Flash","teamGoodsResource","teamTagResource","$modalInstance","SettingPostGoods","$modal",function(e,t,a,o,s,n,r){function i(){o.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.cancel=function(){s.dismiss("cancel")},e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},i();var c=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),a.getGoods(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){c()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column=t,e.params.direction="desc"==e.params.direction?"asc":"desc",c()},e.choice=function(e){n.post({goods_id:e},function(e){e.success?(t.create("success","设置成功！"),s.close(e)):e.error&&(t.create("danger",e.error),s.close(e))},function(e){t.create("danger",e.data.error.message)})}}])}),define("apps/team/controllers/_base",["apps/team/controllers/dashboard","apps/team/controllers/setcaptain","apps/team/controllers/group","apps/team/controllers/setting.template","apps/team/controllers/setting.goods","apps/team/controllers/setting.settled","apps/team/controllers/team.group","apps/team/controllers/team.member","apps/team/controllers/member.info","apps/team/controllers/record","apps/team/controllers/design.apply","apps/team/controllers/design.center","apps/team/controllers/design.qrcode","apps/team/controllers/team.order","apps/team/controllers/order_info_tpl","apps/team/controllers/team.group.edit","apps/team/controllers/team_setting_captain","apps/team/controllers/team_captain_setting","apps/team/controllers/team.add_goods.tpl"],function(){}),define("apps/team/main",["apps/team/states/_base","apps/team/services/_base","apps/team/controllers/_base"],function(){}),define("apps/virtualgoods/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("virtualgoods",{abstract:!0,url:"/virtualgoods",templateUrl:"assets/js/apps/virtualgoods/templates/layout.html"}).state("virtualgoods.home",{url:"/home",templateUrl:"assets/js/apps/virtualgoods/templates/layout2.html"}).state("virtualgoods.home.id",{url:"/:id",templateUrl:"assets/js/apps/virtualgoods/templates/list.html",controller:"virtualgoods.home"})}])}),define("apps/virtualgoods/states/_base",["apps/virtualgoods/states/main"],function(){}),define("apps/virtualgoods/controllers/virtualgoods",["apps/common/controllers/controllers"],function(e){e.controller("virtualgoods.home",["$document","$scope","$stateParams","$state","virtualgoodsResource","Flash",function(e,t,a,o,s,n){switch(a.type){case"taobao":t.type=0;break;case"shop":t.type=1;break;default:t.type=0}t.tempId=a.id,t.isrealoper=!1;var r=function(){t.params.offset=(t.paginationConf.currentPage-1)*t.paginationConf.itemsPerPage,t.params.limit=t.paginationConf.itemsPerPage,t.params.goods_id=a.id,0==Object.keys(t.selectGoodses).length,s.gets(t.params,function(e,a){e.error?(n.create("danger",e.error),"4500066"!=e.code?t.isrealoper=!0:o.go("shop.goods.auction.list")):t.isrealoper=!0,t.paginationConf.totalItems=e._count,t.goodsList=e.data,angular.forEach(t.selectGoodses,function(e,a){var o=!1;angular.forEach(t.goodsList,function(e,s){a==e.id&&(t.goodsList[s].checked=!0,o=!0)}),o||delete t.selectGoodses[a]})})};t.paginationConf={currentPage:1,itemsPerPage:10},t.params={offset:(t.paginationConf.currentPage-1)*t.paginationConf.itemsPerPage,limit:t.paginationConf.itemsPerPage},t.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",function(){t.selectGoodses={},r()});var i=function(e){t.checkedAll=!1,1==t.paginationConf.currentPage?r():e?r():t.paginationConf.currentPage=1};t.paginationInit=function(){i()},t.$watch("uploadStatus",function(e,a){e&&(i(),t.uploadStatus=!1)}),t.selectGoodses=[],t.selectLength=0,t.selectGoods=function(e,a){a?t.selectGoodses[e]=a:delete t.selectGoodses[e]},t.checkedAll=!1,t.$watch("checkedAll",function(e,a){angular.forEach(t.goodsList,function(a,o){if(!a.order_sn){var s=e;t.goodsList[o].checked=s,s?t.selectGoodses[a.id]=!0:t.selectGoodses=[]}})}),t.batchDelete=function(){s.BatchDelete({"ids[]":Object.keys(t.selectGoodses)},function(e,a){e.success?(t.selectGoodses={},n.create("success","删除成功"),i(t.paginationConf.currentPage)):n.create("danger","删除失败")})},t.goodsDelete=function(e){t.params.goods_id=a.id,s.Delete({id:e},function(a,o){a.success?(delete t.selectGoodses[e],n.create("success","删除成功"),i(t.paginationConf.currentPage)):n.create("danger","删除失败")})},t.searchTitle="",t.search=function(){s.gets(t.params,function(e,t,a){}),i()}}])}),define("apps/virtualgoods/controllers/_base",["apps/virtualgoods/controllers/virtualgoods"],function(){}),define("apps/virtualgoods/services/virtualgoods.import",["apps/common/services/services"],function(e){e.factory("virtualgoodsImportResource",["$resource",function(e){return e("goods/import_shop.json",{id:"@id"},{})}])}),define("apps/virtualgoods/services/virtualgoods",["apps/common/services/services"],function(e){e.factory("virtualgoodsResource",["$resource",function(e){return e("/virtualgoods/:id.json",{id:"@id"},{save:{method:"POST",url:"/virtualgoods/:id.json"},gets:{method:"GET",url:"/virtualgoods/cards.json"},Delete:{method:"DELETE",url:"/virtualgoods/:id.json"},BatchDelete:{method:"DELETE",url:"/virtualgoods/card.json"}})}])}),define("apps/virtualgoods/services/_base",["apps/virtualgoods/services/virtualgoods.import","apps/virtualgoods/services/virtualgoods"],function(){}),define("apps/virtualgoods/directives/virtualgoods.upload",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("virtualgoodsUpload",["$modal","$stateParams",function(e,t){t.id;return{restrict:"AE",replace:!0,scope:{size:"@",type:"="},require:"^?ngModel",template:'<div class="virtualgoods-upload"><a class="btn btn-primary btn-sm" ng-click="openModal(size)" style="margin-right: 10px;" ><i class="fa fa-upload"></i> 导入卡密</a></div>',link:function(t,a,o,s){t.animationsEnabled=!1,t.openModal=function(a){var o=e.open({animation:t.animationsEnabled,controller:"virtualgoodsUpload.modal",templateUrl:"assets/js/apps/virtualgoods/templates/virtualgoods.upload.html",size:a,resolve:{type:function(){return t.type},paginationInit:function(){return t.$parent.paginationInit}}});o.result.then(function(e){s.$setViewValue(e)})}}}}]),t.controller("virtualgoodsUpload.modal",["$scope","$stateParams","$modalInstance","Flash","type","paginationInit","shopUpladFactory","virtualgoodsImportResource",function(e,t,a,o,s,n,r,i){e.type=s;var c=function(){e.shop.offset<e.shop.total?e.dynamic=parseFloat(e.shop.offset/e.shop.total*100).toFixed(2):e.dynamic=100};1==e.type&&(e.shop=r,e.shop.status&&c()),e.csvfileInfo={status:!1,name:"",size:0},e.ok=function(){var s=t.id;if(!e.csvfileInfo.status)return void o.create("danger","请选择一个CSV文件");if(e.csvfile.size>1048576)return void o.create("danger","文件大小不能超过1MB");var n=e.csvfile.name.substr(e.csvfile.name.toLowerCase().lastIndexOf(".")+1);if("csv"!=n)return void o.create("danger","请选择一个CSV文件。");var r=new FormData($("#csvFileUpload")[0]);$.ajax({url:"virtualgoods/"+s+".json",method:"POST",data:r,processData:!1,contentType:!1}).done(function(e){e.success?(o.create("success",e.msg),a.close(e.success)):o.create("danger","导入失败，请重新检查文件")}).fail(function(e){o.create("danger","导入失败，请重新检查文件")})};var l=function(){i.save(e.shop,function(t,a){t.success?(e.shop.status=!0,e.shop.total=t.count,e.shop.exist+=t.exist,e.shop.imported+=t.imported,e.shop.offset=t.offset,e.dynamic=0,c(),e.dynamic<100?l():(e.shop.is_finish=!0,n())):o.create("danger",t.msg)})};e.shopImport=function(){return""==e.shop.username?(o.create("danger","请输入用户名"),!1):""==e.shop.password?(o.create("danger","请输入用户密码"),!1):void l()},e.shopImportReset=function(){angular.forEach(r.init(),function(t,a){e.shop[a]=t}),e.dynamic=0},e.cancel=function(){a.dismiss("cancel")},e.selectCsvFile=function(t){e.$apply(function(a){e.csvfile=t.files[0],e.csvfileInfo.status=!0,e.csvfileInfo.name=e.csvfile.name,e.csvfileInfo.size=parseFloat(e.csvfile.size/1024).toFixed(2)})}}])}),define("apps/virtualgoods/directives/_base",["apps/virtualgoods/directives/virtualgoods.upload"],function(){}),define("apps/virtualgoods/main",["apps/virtualgoods/states/_base","apps/virtualgoods/controllers/_base","apps/virtualgoods/services/_base","apps/virtualgoods/directives/_base"],function(){}),define("apps/app/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("app",{url:"/app",templateUrl:"assets/js/apps/app/templates/layout.html",abstract:!0}).state("app.banner",{url:"",templateUrl:"assets/js/apps/app/templates/main.html",controller:"AppCtrl"}).state("app.apply",{url:"/apply",template:"<div ui-view></div>",abstract:!0}).state("app.apply.ios",{url:"/ios",templateUrl:"assets/js/apps/app/templates/apply_ios.html",controller:"iosApply"}).state("app.apply.android",{url:"/android",templateUrl:"assets/js/apps/app/templates/apply_android.html",controller:"androidApply"}).state("app.apply.wxpay",{url:"/wxpay",templateUrl:"assets/js/apps/app/templates/apply_wxpay.html",controller:"applyWxpay"})}])}),define("apps/app/states/_base",["apps/app/states/main"],function(){}),define("apps/app/controllers/main",["apps/common/controllers/controllers"],function(e){e.controller("AppCtrl",["$scope",function(e){e.list=["查看并处理订单信息;","消息助手,订单消息,商品库存预警及时通知;","查看每日店铺收益统计."]}])}),define("apps/app/controllers/apply.ios",["apps/common/controllers/controllers"],function(e){e.controller("iosApply",["$scope","Flash","appApply","getFailMsg","$modal","getQrcode","putShare",function(e,t,a,o,s,n,r){var i=function(){a.get({app_type:2},function(t){e.start_img={img:"",logo:"",appSmallIcon:"",appIcon:""},t.status?(e.appInfo=t.result,e.appInfo.share?e.shareInfo=e.appInfo.share:e.shareInfo={weixin:{show:1,username:"",password:""},qq:{show:0,username:"",password:""},sina:{show:0,username:"",password:""}},e.appInfo.umeng||(e.appInfo.umeng={username:""}),e.start_img.img=t.result.start_img[0]||"",e.start_img.logo=t.result.logo[0]||"",e.start_img.appSmallIcon=t.result.appSmallIcon[0]||"",e.start_img.appIcon=t.result.appIcon[0]||"",7==t.result.type&&c(),6==t.result.type&&l()):e.appInfo={app_type:2,type:1,name:"",logo:[],start_img:[],main_type:"0",secondary_type:"0",app_keyword:"",describe:"",upgrade_memo:""}})};i(),e.result={failMsg:""};var c=function(){o.get({id:e.appInfo.id},function(t){e.result.failMsg=t.result.memo})};e.code={img:""};var l=function(){n.get({id:e.appInfo.id},function(t){e.code.img=t.result})},d=function(a){if(e.appInfo.logo=[],!e.start_img.logo)return t.create("danger","请选择icon图标"),!1;if(!/\.(png)$/.test(e.start_img.logo))return t.create("danger","请选择png格式的icon图标"),!1;if(e.appInfo.logo.push(e.start_img.logo),e.appInfo.start_img=[],!e.start_img.img)return t.create("danger","请选择启动图"),!1;if(!/\.(png)$/.test(e.start_img.img))return t.create("danger","请选择png格式的启动图"),!1;if(e.appInfo.start_img.push(e.start_img.img),"0"==e.appInfo.main_type)return t.create("danger","请选择主要类别"),!1;if(e.appInfo.main_type==e.appInfo.secondary_type)return t.create("danger","主要类别不能和次要类别相同"),!1;if(e.appInfo.app_keyword.indexOf(",")>-1){var o=e.appInfo.app_keyword.split(",");for(var s in o){var n=o[s];if(n.length>5)return t.create("danger","单个关键字不能大于5个字"),!1}}else if(e.appInfo.app_keyword.length>5)return t.create("danger","关键字不能大于5个字"),!1;return!0};e.save=function(o,s){return!!d(o)&&(e.appInfo.next_step=s,void(e.appInfo.id?a.put(e.appInfo,function(a){a.status?(t.create("success","修改成功"),1==s&&(e.appInfo.type=2)):t.create("danger",a.msg)}):a.post(e.appInfo,function(a){a.status?(t.create("success","保存成功"),1==s&&(e.appInfo.type=2),i()):t.create("danger",a.msg)})))},e.saveShare=function(a){e.shareInfo.sina.show||(e.shareInfo.sina.username="",e.shareInfo.sina.password=""),e.appInfo.umeng_show||(e.appInfo.umeng.username="");var o={share:e.shareInfo,umeng:e.appInfo.umeng};r.put({id:e.appInfo.id},o,function(a){a.status?(t.create("success","修改成功"),e.appInfo.type=4,i()):t.create("danger",a.msg)})},e.restart=function(){e.appInfo.type=1},e.open=function(){var t=s.open({animation:!1,templateUrl:"assets/js/apps/app/templates/apply_detail.html",controller:"ModalInstanceCtrlIos",size:"lg",resolve:{apply_id:function(){return e.appInfo.id}}});t.result.then(function(){},function(){})}}]).controller("ModalInstanceCtrlIos",["$scope","$modalInstance","apply_id","getApplyInfo",function(e,t,a,o){var s=function(){o.get({id:a},function(t){e.data=t,n()})};s(),e.info={app_type:"",check_status:"",icon:"",appSmallIcon:"",appIcon:"",start_img:[]};var n=function(){switch(angular.forEach(e.data.start_img,function(t,a){e.info.start_img.push(_global.url.ms+t)}),e.data.logo[0]&&(e.info.icon=_global.url.ms+e.data.logo[0]),e.data.appSmallIcon[0]&&(e.info.appSmallIcon=_global.url.ms+e.data.appSmallIcon[0]),e.data.appIcon[0]&&(e.info.appIcon=_global.url.ms+e.data.appIcon[0]),e.info.app_type=1==e.data.app_type?"安卓":"IOS",e.data.type){case 1:e.info.check_status="填写申请";break;case 2:e.info.check_status="资料审核";break;case 3:e.info.check_status="分享资料填写";break;case 4:e.info.check_status="app制作";break;case 5:e.info.check_status="上架审核";break;case 6:e.info.check_status="开放下载";break;case 7:e.info.check_status="资料审核失败"}};e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/app/controllers/apply.android",["apps/common/controllers/controllers"],function(e){e.controller("androidApply",["$scope","Flash","appApply","getFailMsg","$modal","getQrcode","putShare",function(e,t,a,o,s,n,r){var i=function(){e.start_img={imgA:"",imgB:"",imgC:""},e.appImg={logo:"",appSmallIcon:"",appIcon:""},a.get({app_type:1},function(t){t.status?(e.appInfo=t.result,e.appInfo.share?e.shareInfo=e.appInfo.share:e.shareInfo={weixin:{show:1,username:"",password:""},qq:{show:0,username:"",password:""},sina:{show:0,username:"",password:""}},e.appInfo.umeng||(e.appInfo.umeng={username:""}),t.result.start_img.length>0&&(e.start_img.imgA=t.result.start_img[0]||"",e.start_img.imgB=t.result.start_img[1]||"",e.start_img.imgC=t.result.start_img[2]||""),e.appImg.logo=t.result.logo[0]||"",e.appImg.appSmallIcon=t.result.appSmallIcon[0]||"",e.appImg.appIcon=t.result.appIcon[0]||"",7==t.result.type&&l(),6==t.result.type&&d()):e.appInfo={app_type:1,type:1,name:"",logo:[],start_img:[],main_type_index:-1,label_type_index:-1,main_type:"",label_type:"",app_keyword:"",describe:"",brief_describe:"",appSmallIcon:[],appIcon:[],umeng:{username:"",password:""},wx_share:{username:"",password:""},label_android:t.result.label_android},c()})};i();var c=function(){e.classification={mainArr:[{id:-1,name:"请选择主要分类"}],labelSumArr:[],labelItemArr:[{id:-1,name:"请选择应用标签"}],flag:1},angular.forEach(e.appInfo.label_android,function(t,a){e.classification.mainArr.push({id:a,name:t.name});var o=[{id:-1,name:"请选择应用标签"}];angular.forEach(t.child,function(e,t){o.push({id:t,name:e})}),e.classification.labelSumArr.push(o)}),e.$watch("appInfo.main_type_index",function(t){e.classification.flag?e.classification.flag=0:e.appInfo.label_type_index=-1,t>=0?e.classification.labelItemArr=e.classification.labelSumArr[t]:e.classification.labelItemArr=[{id:-1,name:"请选择应用标签"}]})};e.result={failMsg:""};var l=function(){o.get({id:e.appInfo.id},function(t){e.result.failMsg=t.result.memo})};e.code={img:""};var d=function(){n.get({id:e.appInfo.id},function(t){e.code.img=t.result})},p=function(a){if(!a.appName.$valid)return a.appName.$dirty=!0,$("input[name='appName']").focus(),!1;if(e.appInfo.logo=[],!e.appImg.logo)return t.create("danger","请选择icon图标"),!1;if(!/\.(png)$/.test(e.appImg.logo))return t.create("danger","请选择png格式的icon图标"),!1;if(e.appInfo.logo.push(e.appImg.logo),e.appInfo.appSmallIcon=[],!e.appImg.appSmallIcon)return t.create("danger","请选择应用小图标"),!1;if(!/\.(png)$/.test(e.appImg.appSmallIcon))return t.create("danger","请选择png格式的应用小图标"),!1;if(e.appInfo.appSmallIcon.push(e.appImg.appSmallIcon),e.appInfo.appIcon=[],!e.appImg.appIcon)return t.create("danger","请选择应用小图标"),!1;if(!/\.(png)$/.test(e.appImg.appIcon))return t.create("danger","请选择png格式的应用小图标"),!1;e.appInfo.appIcon.push(e.appImg.appIcon),e.appInfo.start_img=[];for(var o in e.start_img){if(!e.start_img[o])return t.create("danger","请选择启动图"),!1;if(!/\.(png)$/.test(e.start_img[o]))return t.create("danger","请选择png格式的启动图"),!1;e.appInfo.start_img.push(e.start_img[o])}if(e.appInfo.main_type_index==-1)return t.create("danger","请选择应用分类"),!1;if(e.appInfo.label_android[e.appInfo.main_type_index].child.length&&e.appInfo.label_type_index==-1)return t.create("danger","请选择应用标签"),!1;if(e.appInfo.app_keyword.indexOf(",")>-1){var s=e.appInfo.app_keyword.split(",");for(var o in s){var n=s[o];if(n.length>5)return t.create("danger","单个关键字不能大于5个字"),!1}}else if(e.appInfo.app_keyword.length>5)return t.create("danger","关键字不能大于5个字"),!1;return!!a.describe.$valid||(a.describe.$dirty=!0,$("input[name='describe']").focus(),!1)};e.save=function(o,s){return!!p(o)&&(e.appInfo.main_type=e.appInfo.label_android[e.appInfo.main_type_index].name,e.appInfo.label_type_index!=-1?e.appInfo.label_type=e.appInfo.label_android[e.appInfo.main_type_index].child[e.appInfo.label_type_index]:e.appInfo.label_type="",e.appInfo.next_step=s,void(e.appInfo.id?a.put(e.appInfo,function(a){a.status?(t.create("success","修改成功"),1==s&&(e.appInfo.type=2)):t.create("danger",a.msg)}):a.post(e.appInfo,function(a){a.status?(t.create("success","保存成功"),1==s&&(e.appInfo.type=2),i()):t.create("danger",a.msg)})))},e.saveShare=function(a){e.shareInfo.sina.show||(e.shareInfo.sina.username="",e.shareInfo.sina.password=""),e.appInfo.umeng_show||(e.appInfo.umeng.username="");var o={share:e.shareInfo,umeng:{username:e.appInfo.umeng.username||""}};r.put({id:e.appInfo.id},o,function(a){a.status?(t.create("success","修改成功"),e.appInfo.type=4,i()):t.create("danger",a.msg)})},e.open=function(){var t=s.open({animation:!1,templateUrl:"assets/js/apps/app/templates/apply_detail.html",controller:"ModalInstanceCtrlAndroid",size:"lg",resolve:{apply_id:function(){return e.appInfo.id}}});t.result.then(function(){},function(){})},e.restart=function(){e.appInfo.type=1}}]).controller("ModalInstanceCtrlAndroid",["$scope","$modalInstance","apply_id","getApplyInfo",function(e,t,a,o){var s=function(){o.get({id:a},function(t){e.data=t,n()})};s(),e.info={app_type:"",check_status:"",icon:"",appSmallIcon:"",appIcon:"",start_img:[]};var n=function(){switch(angular.forEach(e.data.start_img,function(t,a){e.info.start_img.push(_global.url.ms+t)}),e.data.logo[0]&&(e.info.icon=_global.url.ms+e.data.logo[0]),e.data.appSmallIcon[0]&&(e.info.appSmallIcon=_global.url.ms+e.data.appSmallIcon[0]),e.data.appIcon[0]&&(e.info.appIcon=_global.url.ms+e.data.appIcon[0]),e.info.app_type=1==e.data.app_type?"安卓":"IOS",e.data.type){case 1:e.info.check_status="填写申请";break;case 2:e.info.check_status="资料审核";break;case 3:e.info.check_status="分享资料填写";break;case 4:e.info.check_status="app制作";break;case 5:e.info.check_status="上架审核";break;case 6:e.info.check_status="开放下载";break;case 7:e.info.check_status="资料审核失败"}};e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/app/controllers/apply.wxpay",["apps/common/controllers/controllers"],function(e){e.controller("applyWxpay",["$scope","$modal","paymentResource","checkWXPayment","paymentOpenResource","settinginfoResource","Flash",function(e,t,a,o,s,n,r){function i(e,a){var o=t.open({animation:!1,templateUrl:"assets/js/apps/app/templates/apply_wxpay_modal.html",controller:"appPaymentModelCtrl",resolve:{item:function(){return e},type:function(){return a}}});o.result.then(function(t){t&&1==a&&(e.enabled=!e.enabled,e.set=a)})}function c(e){s.update({id:e.id,online:2},function(t){r.create("success"," 操作成功！"),e.enabled=!e.enabled},function(e){r.create("danger",res.data.error.message)})}e.payment=a.query({code:"wxpay3",online:2}),e.payConfig=function(e,t){i(e,t)},e.toggle_install=function(t){1!=t.set?e.payConfig(t,1):c(t)},e.is_apply=1,e.form_info={},e.is_disabled=!1,e.btn_save="申 请",e.is_rrds=0;var l=function(){n.get({online:2},function(t){e.is_rrds=t.data.is_rrds,null!=t.data.apply_log&&(e.form_info={apply_div_name:t.data.apply_log.name,apply_div_tel:t.data.apply_log.mobile},e.is_apply=t.data.is_apply),0==e.is_apply&&(e.btn_save="正在申请……",e.is_disabled=!0)})};l(),e.save=function(t){var a={name:e.form_info.apply_div_name,mobile:e.form_info.apply_div_tel,is_apply:e.is_apply};t&&n.update(a,function(t){t.success?(e.btn_save="正在申请……",e.is_disabled=!0,r.create("success","申请成功，请等待客服回复！")):r.create("danger",t.message)},function(e){r.create("danger",e.data.error.message)})}}]).controller("appPaymentModelCtrl",["$scope","paymentResource","$modalInstance","item","type","Flash",function(e,t,a,o,s,n){t.get({id:o.id,code:o.code,online:2},function(t){e.data=t,s&&(e.data.is_facilitator=0),"wxpay3"==e.data.code?e.data.is_sys=0:e.data.is_sys=t.is_sys||0,e._global=_global,e.data.code=o.code,e.form_info={apply_div_name:"",apply_div_tel:""},void 0!=_global.shop.supplier_id&&(e.data.is_sys=0),"llpay"!=e.data.code?t.config&&t.config!={}&&t.params!=[]&&angular.forEach(t.config,function(e,a){""!=a&&(t.params[a].model=e)}):t.config&&t.config!={}&&t.params!=[]&&angular.forEach(t.config,function(e,a){angular.forEach(e,function(e,o){""!=o&&"risk_item"!=o&&(t.params[a][o].model=e)})})}),e.ok=function(r){if(r){var i={id:o.id,code:o.code,is_sys:e.data.is_sys,support_sys:e.data.support_sys,listorder:e.data.listorder,pem:e.data.pem,online:2};if("llpay"!=e.data.code)e.data.params&&1!=e.data.is_sys&&(i.config={},i.is_facilitator=e.data.is_facilitator,angular.forEach(e.data.params,function(e,t){i.config[t]=e.model}),"wxpay3"==e.data.code&&1==e.data.is_facilitator&&delete i.config.key);else if(e.data.params&&1!=e.data.is_sys){var c=0,l=0;if(i.config={},angular.forEach(e.data.params,function(t,a){i.config[a]={},angular.forEach(t,function(e,t){i.config[a][t]=e.model,"virtual"==a&&(""!=e.model&&null!=e.model||(c=1)),"physical"==a&&(""!=e.model&&null!=e.model||(l=1))}),void 0!=e.data.config&&(i.config[a].risk_item=e.data.config[a].risk_item),"physical"==a?i.config[a].busi_partner=109001:i.config[a].busi_partner=101001}),1==c&&1==l)return n.create("danger","请填写分类中的商户编号和安全检验码！"),!1}s?t.save(i,function(e){a.close(1)},function(e){a.close(0)}):t.update(i,function(e){e.success?(n.create("success","保存成功"),a.close(1)):n.create("danger",e.message)},function(e){n.create("danger",e.data.error.message),a.close(0)})}},e.cancel=function(){a.dismiss("cancel")}}])});define("apps/app/controllers/_base",["apps/app/controllers/main","apps/app/controllers/apply.ios","apps/app/controllers/apply.android","apps/app/controllers/apply.wxpay"],function(){});define("apps/app/services/main",["apps/common/services/services"],function(e){e.factory("appApply",["$resource",function(e){return e("app/getAppCustom.json",{id:"@id"},{get:{method:"GET",url:"app/getAppCustom.json"},post:{method:"POST",url:"app/postAppCustom.json"},put:{method:"PUT",url:"app/putAppCustom/:id.json"}})}]),e.factory("getFailMsg",["$resource",function(e){return e("app/getAppAudit/:id.json",{id:"@id"},{get:{method:"GET"}})}]),e.factory("getApplyInfo",["$resource",function(e){return e("app/getAppInfo.json",{id:"@id"},{get:{method:"GET",url:"app/getAppInfo/:id.json"}})}]),e.factory("getQrcode",["$resource",function(e){return e("app/getAppQRcode.json",{id:"@id"},{get:{method:"GET",url:"app/getAppQRcode/:id.json"}})}]),e.factory("putShare",["$resource",function(e){return e("/app/putAppCustomShare/:id.json",{id:"@id"},{put:{method:"PUT",url:"/app/putAppCustomShare/:id.json"}})}])}),define("apps/app/services/wxpay",["apps/common/services/services"],function(e){e.factory("paymentResource",["$resource",function(e){return e("/trade/payment/:id.json",{id:"@id"},{update:{method:"PUT"},query:{isArray:!1}})}]),e.factory("paymentOpenResource",["$resource",function(e){return e("/trade/open/:id.json",{id:"@id"},{update:{method:"PUT"}})}]),e.factory("checkWXPayment",["$resource",function(e){return e("/trade/check_payment.json",{},{query:{isArray:!1}})}]),e.factory("settinginfoResource",["$resource",function(e){return e("/trade/paymentapply.json",{},{get:{method:"GET",url:"/trade/paymentapply.json"},update:{method:"POST",url:"/trade/paymentapply.json"}})}])}),define("apps/app/services/_base",["apps/app/services/main","apps/app/services/wxpay"],function(){}),define("apps/app/directives/upload.pem",["apps/common/directives/directives","fileupload"],function(e,t){e.directive("appCacert",["Flash",function(e){return{restrict:"A",transclude:!0,scope:{cacert:"="},template:'<span><span ng-transclude></span><input type="file" name="file" multiple=""></span>',link:function(t,a,o){var s={url:"/trade/uploadpem.json",dataType:"json"};"alipay"==o.type?s.formData=function(e){return e.push({name:"file_type",value:2}),e}:s.formData=function(e){return e.push({name:"file_type",value:1}),e.push({name:"online",value:2}),e},s.add=function(a,o){o.submit().success(function(a,o,s){t.$apply(function(){t.cacert=a}),e.create("success"," 上传成功！")}).error(function(t,a,o){e.create("danger",t.responseJSON.error.message)})},a.fileupload(s)}}}])}),define("apps/app/directives/_base",["apps/app/directives/upload.pem"],function(){}),define("apps/app/main",["apps/app/states/_base","apps/app/controllers/_base","apps/app/services/_base","apps/app/directives/_base"],function(){}),define("apps/magic/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("magic",{abstract:!0,url:"/magic",templateUrl:"assets/js/apps/magic/templates/layout.html"}).state("magic.browse",{url:"/browse",templateUrl:"assets/js/apps/magic/templates/browse.html",controller:"browse"}).state("magic.map",{url:"/map",templateUrl:"assets/js/apps/magic/templates/map.html",controller:"map"}).state("magic.tradeInfo",{url:"/tradeInfo",templateUrl:"assets/js/apps/magic/templates/tradeInfo.html",controller:"tradeInfo"}).state("magic.goodsInfo",{url:"/goodsInfo",templateUrl:"assets/js/apps/magic/templates/goodsInfo.html",controller:"goodsInfo"}).state("magic.goodsEffect",{url:"/goodsEffect",templateUrl:"assets/js/apps/magic/templates/goodsEffect.html",controller:"goodsEffect"})}])}),define("apps/magic/states/_base",["apps/magic/states/main"],function(){}),define("apps/magic/controllers/browse",["apps/common/controllers/controllers"],function(e){e.controller("browse",["$scope","Flash","$http","$modal","browseTotal","browseTrend","videoAddress",function(e,t,a,o,s,n,r){e.videoAddress=r,s.get(function(t){e.basic=t.data}),e.chartData={legend:["访客数","浏览量","跳失率(％)","人均浏览量"],xdata:[],ydata:{guestData:[],browseData:[],loseData:[],avgData:[]}},n.get(function(t){var a=[],o=[],s=[],n=[],r=[];angular.forEach(t.data,function(e,t){a.push(e.date),o.push(e.uv),s.push(e.pv),n.push(e.lose),r.push(e.average_pv)}),e.chartData.xdata=a,e.chartData.ydata={guestData:o,browseData:s,loseData:n,avgData:r}})}])}),define("apps/magic/controllers/map",["apps/common/controllers/controllers","echarts","echarts/chart/map"],function(e,t){e.controller("map",["$scope","Flash","$http","$modal","magicVisitAna","magicDate","visitPeriod",function(e,a,o,s,n,r,i){function c(){e.chartData={legend:["时段平均访客数","时段平均浏览量"],xdata:[],ydata:{guestData:[],browseData:[]}};var t=$('input[name="period_range"]').val();""!=t&&(t=t.split("/"),e.periodParams.timeStart=t[0],e.periodParams.timeEnd=t[1]),i.get(e.periodParams,function(t){var a=[],o=[],s=[];angular.forEach(t.data,function(e,t){a.push(e.hour),o.push(e.uv),s.push(e.pv)}),e.chartData.xdata=a,e.chartData.ydata={guestData:o,browseData:s}})}function l(){var t=[],a={title:{show:!1,text:"浏览量占比排行",x:"center"},tooltip:{showContent:!0,trigger:"item"},legend:{show:!1,orient:"vertical",x:"left",data:["浏览量占比排行"]},dataRange:{show:!1,min:0,max:2500,x:"left",y:"bottom",text:["高","低"],calculable:!0},toolbox:{show:!1,orient:"vertical",x:"right",y:"center",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},roamController:{show:!1,x:"right",mapTypeControl:{china:!0}},series:[{name:"浏览量占比排行",type:"map",mapType:"china",itemStyle:{normal:{label:{show:!0},areaStyle:{color:"#eee"},borderColor:"#ccc",borderWidth:1},emphasis:{label:{show:!0}}},data:t}]},o=$('input[name="area_range"]').val();""!=o&&(o=o.split("/"),e.visitParams.timeStart=o[0],e.visitParams.timeEnd=o[1]),n.get(e.visitParams,function(o){e.areaList=o.data,angular.forEach(o.data,function(e,a){t.push(e)}),d.setOption(a)})}e.date={ranges:r.dateRange,maxDate:r.maxDate},e.periodParams={},e.visitParams={},c(),e.searchPeriod=function(){c()};var d=t.init(document.getElementById("visitAreaMap"));l(),e.searchArea=function(){d.clear(),l()}}])}),define("apps/magic/controllers/tradeInfo",["apps/common/controllers/controllers"],function(e){e.controller("tradeInfo",["$scope","Flash","$http","$modal","magicTradeInfo","magicTradeTrend","magicDate",function(e,t,a,o,s,n,r){s.get(function(t){e.tradeInfo=t.data}),e.chartData={legend:["下单买家数","下单金额","支付买家数","支付金额"],xdata:[],ydata:{tuserData:[],tpriceData:[],puserData:[],ppriceData:[]}},n.get(function(t){var a=[],o=[],s=[],n=[],r=[];angular.forEach(t.data,function(e,t){a.push(e.date),o.push(e.total_user),s.push(e.total_price),n.push(e.pay_user),r.push(e.pay_price)}),e.chartData.xdata=a,e.chartData.ydata={tuserData:o,tpriceData:s,puserData:n,ppriceData:r}})}])}),define("apps/magic/controllers/goodsInfo",["apps/common/controllers/controllers"],function(e){e.controller("goodsInfo",["$scope","Flash","$http","$modal","magicGoodsInfo","magicGoodsTrend",function(e,t,a,o,s,n){s.get(function(t){e.basic=t.data}),e.chartData={legend:["访问数","支付数","下单数"],xdata:[],ydata:{pv:[],cpay:[],corder:[]}},n.get(function(t){var a=[],o=[],s=[],n=[];angular.forEach(t.data,function(e,t){a.push(e.date),o.push(e.pv),s.push(e.cpay),n.push(e.corder)}),e.chartData.xdata=a,e.chartData.ydata={pv:o,cpay:s,corder:n}})}])}),define("apps/magic/controllers/goodsEffect",["apps/common/controllers/controllers"],function(e){e.controller("goodsEffect",["$scope","Flash","$http","$modal","magicGoodsList",function(e,t,a,o,s){function n(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,s.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data})}e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n)}])}),define("apps/magic/controllers/_base",["apps/magic/controllers/browse","apps/magic/controllers/map","apps/magic/controllers/tradeInfo","apps/magic/controllers/goodsInfo","apps/magic/controllers/goodsEffect"],function(){}),define("apps/magic/services/main",["apps/common/services/services"],function(e){e.factory("browseTotal",["$resource",function(e){return e("/magic/browse/getBasic.json",{},{})}]),e.factory("browseTrend",["$resource",function(e){return e("/magic/browse/getTrend.json",{},{})}]),e.factory("visitPeriod",["$resource",function(e){return e("/magic/browse/getUdh.json",{},{})}]),e.factory("magicVisitAna",["$resource",function(e){
return e("/magic/browse/getIp.json",{},{})}]),e.factory("magicTradeInfo",["$resource",function(e){return e("/magic/browse/getTradeBasic.json",{},{})}]),e.factory("magicTradeTrend",["$resource",function(e){return e("/magic/browse/getTradeTrend.json",{},{})}]),e.factory("magicGoodsInfo",["$resource",function(e){return e("/magic/browse/getGoodsBasic.json",{},{})}]),e.factory("magicGoodsTrend",["$resource",function(e){return e("/magic/browse/getGoodsTrend.json",{},{})}]),e.factory("magicGoodsList",["$resource",function(e){return e("/magic/browse/getGoodsList.json",{},{})}]),e.factory("magicDate",[function(){var e={"前天":[moment().subtract("days",2),moment().subtract("days",2)],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"最近30天":[moment().subtract("days",30),moment()]},t=moment().subtract("days",1).format("YYYY-MM-DD");return{dateRange:e,maxDate:t}}])}),define("apps/magic/services/_base",["apps/magic/services/main"],function(){}),define("apps/magic/directives/chart.line",["apps/common/directives/directives","echarts"],function(e,t){e.directive("chartLine",[function(){return{restrict:"E",scope:{legend:"=",xdata:"=",ydata:"="},template:'<div class="chart-line"></div>',link:function(e,a,o){function s(e,t,a){r.legend.data=e,r.xAxis[0].data=t;var o=Object.keys(a).map(function(e){return a[e]});r.series=[];for(var s=0;s<o.length;s++)r.series.push({name:e[s],type:"line",label:{normal:{show:!1,position:"top"}},smooth:!0,symbol:"circle",symbolSize:3,data:o[s]})}a.find("div").attr("id",o.chartid);var n=t.init(document.getElementById(o.chartid)),r={tooltip:{trigger:"axis"},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,borderWidth:0},xAxis:[{type:"category",axisLine:{show:!1},axisTick:{show:!1,length:4,lineStyle:{color:"#CCC"}},boundaryGap:!1,splitLine:{show:!1}}],yAxis:[{type:"value",axisLine:{show:!1},axisTick:{show:!1,length:4,lineStyle:{color:"#CCC"}},splitLine:{lineStyle:{type:"dotted"}}}],series:[],animation:!0,animationDuration:500,animationEasing:"exponentialOut"};e.$watchGroup(["xdata","ydata"],function(t,a){t[0].length<=1||t!=a&&(n.clear(),s(e.legend,t[0],t[1]),n.setOption(r))})}}}])}),define("apps/magic/directives/_base",["apps/magic/directives/chart.line"],function(){}),define("apps/magic/main",["apps/magic/states/_base","apps/magic/controllers/_base","apps/magic/services/_base","apps/magic/directives/_base"],function(){}),define("apps/trip/states/line",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.trip",{url:"/trip",templateUrl:"assets/js/apps/trip/templates/layout.html"}).state("shop.trip.line",{abstract:!0,url:"/line",template:"<div ui-view></div>"}).state("shop.trip.line.list",{url:"?callback",templateUrl:"assets/js/apps/trip/templates/line.html",controller:"shop.trip.line"}).state("shop.trip.line.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/trip/templates/line_edit.html",controller:"shop.trip.line.edit"}).state("shop.trip.type",{url:"/type",templateUrl:"assets/js/apps/trip/templates/type.html",controller:"shop.trip.type"}).state("shop.trip.addtype",{url:"/type/linetype_add",templateUrl:"assets/js/apps/trip/templates/type_add.html",controller:"shop.trip.addtype"}).state("shop.trip.edittype",{url:"/type/type_edit/:id",templateUrl:"assets/js/apps/trip/templates/type_edit.html",controller:"shop.trip.type_edit"}).state("shop.trip.deal",{abstract:!0,url:"/deal",template:"<div ui-view></div>"}).state("shop.trip.deal.list",{url:"",templateUrl:"assets/js/apps/trip/templates/deal.html",controller:"shop.trip.deal"}).state("shop.trip.deal.add",{url:"/add",templateUrl:"assets/js/apps/trip/templates/deal.add.html",controller:"shop.trip.deal.add"}).state("shop.trip.deal.info",{url:"/info/:id",templateUrl:"assets/js/apps/trip/templates/deal.info.html",controller:"shop.trip.deal.info"})}])}),define("apps/trip/states/order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.trip.order",{url:"/order",templateUrl:"assets/js/apps/trip/templates/order.html",controller:"shop.trip.order"}).state("shop.trip.unfinished_order",{url:"/unfinished_order",templateUrl:"assets/js/apps/trip/templates/unfinished_order.html",controller:"shop.trip.unfinished_order"}).state("shop.trip.finished_order",{url:"/finished_order",templateUrl:"assets/js/apps/trip/templates/finished_order.html",controller:"shop.trip.finished_order"}).state("shop.trip.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/trip/templates/order_detail.html",controller:"shop.trip.detail"}).state("shop.trip.group",{url:"/group/:id",templateUrl:"assets/js/apps/trip/templates/group_detail.html",controller:"shop.trip.group"}).state("shop.trip.refund",{url:"/refund",templateUrl:"assets/js/apps/trip/templates/refund.html",controller:"shop.trip.refund"}).state("shop.trip.refund_detail",{url:"/refund/detail/:id",templateUrl:"assets/js/apps/trip/templates/refund_detail.html",controller:"shop.trip.refund_detail"})}])}),define("apps/trip/states/add",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.trip.add",{url:"/add",controller:"shop.trip.line.form",templateUrl:"assets/js/apps/trip/templates/form.html"})}])}),define("apps/trip/states/_base",["apps/trip/states/line","apps/trip/states/order","apps/trip/states/add"],function(){}),define("apps/trip/controllers/line",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.line",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","tripListResource","goodsResource","tripDeleteResource",function(e,t,a,o,s,n,r,i,c){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",link_url:""};var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,r.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.lines=t.data,e.title=t.data.title})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.showQrcode=function(t){i.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.search=function(){e.paginationConf.currentPage=1,l()},e.remove=function(e){c.delete({id:e},function(e){1==e.status?(l(),s.create("success","删除成功")):s.create("success","删除失败")})}}])}),define("apps/trip/controllers/line.edit",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.line.edit",["$scope","$state","GoodsData","$stateParams","tagResource","EditTripResource","typelineResource","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n,r,i,c,l,d){function p(t){var a=new BMap.Geocoder;a.getPoint(t,function(t){t?(e.params.trip_goods_theme.lon=t.lng,e.params.trip_goods_theme.lat=t.lat,u.centerAndZoom(t,16),g=new BMap.Marker(t),g.enableDragging(),u.clearOverlays(),u.addOverlay(g),f(g)):l.create("danger","您选择地址没有解析到结果!")},e.cityname)}e.id=o.id,e.params={title:"",img:"",imgs:[],tags:[],trip_goods_theme:{type_id:"",from_province:"",from_city:"",to_country:"",to_province:"",to_city:"",venue:"",lat:"",lon:"",tags:""},trip_goods_plan:{day:"",night:"",plan:[{des:"",lines:[{from:"",to:""}],breakfast:"",transport:"",spots:[{spot:""}],imgs:[],lunch:"",supper:"",hotel:"",property:[]}]},trip_goods_price:{price:"",kid_price:"",enable_kid:"",kid_height:"",start_day:"",end_day:"",presell_day:"",presell_hour:""},trip_goods_price_date:[{set_out:"",price:"",kid_price:"",min_tuan:"",max_tuan:""}],trip_goods_insurance:[{title:"",description:"",price:"",require:""}],trip_goods_des:{feature:"",notice:"",refund:0,refund_day:"",refund_hour:"",refund_rate:"",refund_info:"",hotline:""}},n.get({id:e.id},function(t){if(e.params=t,e.params.trip_goods_plan.goods_id){for(var a=0;a<e.params.trip_goods_plan.plan.length;a++){e.params.trip_goods_plan.plan[a].index=a;var o=a+1;e.params.trip_goods_plan.plan[a].listorder=o}e.itinerary_trip=e.params.trip_goods_plan.plan}else e.itinerary_trip=[];var s=new BMap.Point(e.params.trip_goods_theme.lon,e.params.trip_goods_theme.lat);u.centerAndZoom(s,16);var n=new BMap.Marker(s);n.enableDragging(),u.addOverlay(n),e.params.trip_goods_price_date.length>0&&(e.init_datesModel={},$.each(e.params.trip_goods_price_date,function(t,a){var o="",s=a.set_out,n=[];0==a.kid_price?(o=a.price,n=[{price:parseFloat(a.price),price_category:1e4}]):(o=a.price,n=[{price:parseFloat(a.price),price_category:1e4},{price:parseFloat(a.kid_price),price_category:10001}]);var r={id:a.id,maxPrice:a.price,minPrice:o,dt:s,min_stock:a.min_tuan,max_stock:a.max_tuan,item_price:n};return e.init_datesModel[s]={state:"chosed",mark:"￥"+o,item_stock:r},r}),e.showMydate(e.init_datesModel)),e.insurance=e.params.trip_goods_insurance,1==e.params.trip_goods_des.refund&&$(".refund-info").show()}),$(".nav-tabs li").click(function(){$(this).addClass("active"),$(this).siblings().removeClass("active");var e=$(this).find("a").attr("aria-controls");$(".tab-pane").removeClass("active"),$("#"+e).addClass("active")}),r.get(function(t){e.categories=t.data,e.categories.unshift({id:-1,title:"请选择分组"})}),e.hours=[{id:0,title:"0:00"},{id:1,title:"1:00"},{id:2,title:"2:00"},{id:3,title:"3:00"},{id:4,title:"4:00"},{id:5,title:"5:00"},{id:6,title:"6:00"},{id:7,title:"7:00"},{id:8,title:"8:00"},{id:9,title:"9:00"},{id:10,title:"10:00"},{id:11,title:"11:00"},{id:12,title:"12:00"},{id:13,title:"13:00"},{id:14,title:"14:00"},{id:15,title:"15:00"},{id:16,title:"16:00"},{id:17,title:"17:00"},{id:18,title:"18:00"},{id:19,title:"19:00"},{id:20,title:"20:00"},{id:21,title:"21:00"},{id:22,title:"22:00"},{id:23,title:"23:00"}],e.hours.unshift({id:-1,title:"请选择"}),e.price_categroys=[{id:1e4,name:"adult",title:"成人"},{id:10001,name:"kid",title:"儿童"}];var u=new BMap.Map("baiduMap"),m=new BMap.Point(e.params.trip_goods_theme.lon,e.params.trip_goods_theme.lat);u.centerAndZoom(m,16);var g=new BMap.Marker(m);g.enableDragging(),u.addOverlay(g),u.centerAndZoom(new BMap.Point(116.404,39.915),16),u.addControl(new BMap.NavigationControl),u.enableScrollWheelZoom(!0);var f=function(t){t.addEventListener("dragend",function(a){var o=t.getPosition();e.params.trip_goods_theme.lon=o.lon,e.params.trip_goods_theme.lat=o.lat})};f(g),e.searchAddress=function(){if(angular.isUndefined(e.params.trip_goods_theme.venue)||""==e.params.trip_goods_theme.venue)return l.create("danger","请输入地址"),!1;var t=e.params.trip_goods_theme.venue;p(t)},e.showrefund=function(){1==e.params.trip_goods_des.refund?$(".refund-info").show():$(".refund-info").hide()},e.goodsData="",e.getTags=function(){s.get({type:1},function(t){t._count>0?angular.forEach(t.data,function(e,t){a.tags.push(e)}):a.tags=[],e.goodsData=a.tags},function(e){l.create("danger",e.data.error.message)})},e.getTags(),e.addTag=function(){var t=$.trim($("#input-addTag-name-pop").val());""!=t?s.save({name:t,type:1},function(t){l.create("success","操作成功"),e.params.tags.push(t),e.ngPopoverClose()},function(e){l.create("danger",e.data.error.message)}):l.create("warning","请填写分组名称")},e.ngPopoverClose=function(){c.close()},e.params.trip_goods_price.start_day=mydate.getFormatDate(new Date(1e3*e.params.trip_goods_price.start_day)),e.params.trip_goods_price.end_day=mydate.getFormatDate(new Date(1e3*e.params.trip_goods_price.end_day)),e.params.trip_goods_price.start_day<new Date&&(e.tomorrow=e.params.trip_goods_price.start_day);mydate.getFormatDate(e.params.trip_goods_price.start_day),mydate.getFormatDate(e.params.trip_goods_price.end_day);e.is_price_chosed=!1,e.showMydate=function(t){var a=$(".adult").is(":checked"),o=$(".kid").is(":checked");if(1==a||1==o?e.is_price_chosed=!0:0==a&&0==o&&(e.is_price_chosed=!1),e.is_price_chosed&&e.params.trip_goods_price.start_day&&e.params.trip_goods_price.end_day){var s=mydate.getFormatDate(e.params.trip_goods_price.start_day),n=mydate.getFormatDate(e.params.trip_goods_price.end_day);e.dates=new mydate({keyid:3434,date:new Date,dom:".date",start_time:s,end_time:n}),e.dates.run(),t&&(e.dates.datesModel=t,e.dates.according(),t=null)}},e.$on("$viewContentLoaded",function(){$(document).off("click.itineraryEdit"),$(".container").on("click.itineraryEdit",".mydate .con .on a, .mydate .con .max a",function(t){var a=$(this).attr("title");e.showpricewindow("today",new Date(a))}),$(".container").on("click.itineraryEdit",".mydate .con .on i.remove-date",function(t){var a=$(this).next("a").attr("title");e.dates.datesModel[a]&&(e.dates.datesModel[a].state="cancel");var o=[];$.each(e.dates.datesModel,function(t,a){if("chosed"==a.state){for(var s="",n="",r=0;r<a.item_stock.item_price.length;r++)1e4==a.item_stock.item_price[r].price_category&&(n=a.item_stock.item_price[r].price_category),10001==a.item_stock.item_price[r].price_category&&(s=a.item_stock.item_price[r].price_category);o.push({id:a.item_stock.id,goods_id:e.id,max_tuan:a.item_stock.max_stock,min_tuan:a.item_stock.min_stock,set_out:a.item_stock.dt,kid_price:s,price:n})}}),e.params.trip_goods_price_date=o,e.dates.according()})}),e.showpricewindow=function(t,a){var o=[],s=$(".adult").is(":checked"),n=$(".kid").is(":checked");1==s&&o.push({price_category:1e4,name:"成人",price:""}),1==n&&o.push({price_category:10001,name:"儿童",price:""});var r=d.open({templateUrl:"setPrice.html",size:"lg",controller:"priceWindowCtrl",resolve:{type:function(){return t},price_categroys:function(){return o},dates:function(){return e.dates},specifyDate:function(){return a},start_time:function(){return e.params.trip_goods_price.start_day},end_time:function(){return e.params.trip_goods_price.end_day}}});r.result.then(function(t){var a=[],o=e.dates.datesModel;$.each(o,function(e){for(var t="",s="",n=0;n<o[e].item_stock.item_price.length;n++)1e4==o[e].item_stock.item_price[n].price_category&&(t=o[e].item_stock.item_price[0].price),10001==o[e].item_stock.item_price[n].price_category&&(s=o[e].item_stock.item_price[1].price);a.push({set_out:""+o[e].item_stock.dt,min_tuan:o[e].item_stock.min_stock,max_tuan:o[e].item_stock.max_stock,price:t,kid_price:s})}),e.params.trip_goods_price_date=a},function(e){})},e.fnFormatInt=function(e){var t=$(e.currentTarget),a=t.val(),o=/^[0-9]*$/;o.test(a)||t.val(a.replace(/[^0-9]/g,""))},e.createtrips=function(){var t=e.itinerary_trip.length,a=t;if(a<e.params.trip_goods_plan.day)for(;t<e.params.trip_goods_plan.day;){t++;var o=t-1,s={trip:"",listorder:t,index:o,line:[{from:"",to:""}],spots:[{spot:""}]};e.itinerary_trip.push(s)}else for(var n=e.itinerary_trip.length;n>e.params.trip_goods_plan.day;n--)e.itinerary_trip.splice(n-1,1)},e.addline=function(t){e.itinerary_trip[t].lines.push({from:"",to:""})},e.addspots=function(t){e.itinerary_trip[t].spots.push({spot:""})},e.property=[],e.addproperty=function(e){$(".schedul-day").eq(e).find(".addproperty").show(),$(".schedul-day").eq(e).find(".add-property").hide()},e.addProp=function(t){var a=$(".schedul-day").eq(t).find(".input-addProp-name").val(),o=$(".schedul-day").eq(t).find(".input-addkey-name").val();e.itinerary_trip[t].property.push({key:a,val:o}),$(".schedul-day").eq(t).find(".addproperty").hide(),$(".schedul-day").eq(t).find(".add-property").show()},e.showAdd=function(e){$(".schedul-day").eq(e).find(".addproperty").hide(),$(".schedul-day").eq(e).find(".add-property").show()},e.confirmDisable=function(t,a){e.itinerary_trip[t].property.splice(a,1)},e.insurance=[],e.addinsurance=function(){var t=d.open({animation:!1,templateUrl:"assets/js/apps/trip/templates/add_insurance.html",controller:"trip.addinsurance",resolve:{}});t.result.then(function(t){e.insurance.push({title:t.title,price:t.price,description:t.description,require:""})})},e.editinsurance=function(t,a,o,s){var n=d.open({animation:!1,templateUrl:"assets/js/apps/trip/templates/edit_insurance.html",controller:"trip.editinsurance",resolve:{title:function(){return t},price:function(){return a},description:function(){return o},ID:function(){return s}}});n.result.then(function(t){$.each(e.insurance,function(e,a){t.id==a.id&&(a.title=t.title,a.price=t.price,a.description=t.description)})})},e.save=function(){return""==e.params.trip_goods_theme.from_province?($(".from_province").addClass("has-error"),l.create("danger","请输入出发省份"),!1):""==e.params.trip_goods_theme.from_city?($(".from_city").addClass("has-error"),l.create("danger","请输入出发城市"),!1):""==e.params.trip_goods_theme.to_country?($(".to_country").addClass("has-error"),l.create("danger","请输入目的地国家"),!1):""==e.params.trip_goods_theme.to_province?($(".to_province").addClass("has-error"),l.create("danger","请输入目的地省份"),!1):""==e.params.trip_goods_theme.to_city?($(".to_city").addClass("has-error"),l.create("danger","请输入目的地城市"),!1):""==e.params.trip_goods_theme.venue?($(".position").addClass("has-danger"),l.create("danger","请输入集合地点"),!1):""==e.params.trip_goods_plan.day?($(".total-day").addClass("has-danger"),l.create("danger","请输入出行天数"),!1):""==e.params.trip_goods_des.hotline?($(".hot-line").addClass("has-danger"),l.create("danger","请输入咨询电话"),!1):($(".has-error").removeClass("has-error"),$(".has-danger").removeClass("has-danger"),e.params.imgs.length>0&&(e.params.img=e.params.imgs[0].url),e.tags=[],$.each(e.params.tags,function(t,a){e.tags.push(a.id)}),e.params.tags=e.tags,e.params.trip_goods_insurance=e.insurance,e.jsondata={},e.jsondata.title=e.params.title,e.jsondata.img=e.params.img,e.jsondata.imgs=e.params.imgs,e.jsondata.tags=e.params.tags,e.jsondata.tripGoodsTheme=e.params.trip_goods_theme,e.jsondata.tripGoodsPlan=e.params.trip_goods_plan,e.jsondata.tripGoodsPrice=e.params.trip_goods_price,e.jsondata.tripGoodsPriceDate=e.params.trip_goods_price_date,e.jsondata.tripGoodsInsurance=e.params.trip_goods_insurance,e.jsondata.tripGoodsDes=e.params.trip_goods_des,void n.put({id:o.id},e.jsondata,function(e){1==e.status?(l.create("success"," 保存成功！"),t.go("shop.trip.line.list")):l.create("danger",""+e.msg)}))}}])}),define("apps/trip/controllers/type",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.type",["$scope","$stateParams","typelineResource","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:""};var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.linetype=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){i()}}])}),define("apps/trip/controllers/order",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.order",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])}),define("apps/trip/controllers/unfinished_order",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.unfinished_order",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])}),define("apps/trip/controllers/finished_order",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.finished_order",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])}),define("apps/trip/controllers/detail",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.detail",["$scope","$state","$stateParams","$filter","ngPopover","Flash","$modal","TripOrderDetailResource",function(e,t,a,o,s,n,r,i){e.id=a.id,i.get({id:e.id},function(t){e.params=t,e.params.contacts={};for(var a=0;a<e.params.trip_order.trip_order_traveller.length;a++){var o=e.params.trip_order.trip_order_traveller[a];1==o.contacts&&(e.params.contacts.consignee=o.consignee,e.params.contacts.mobile=o.mobile)}})}])}),define("apps/trip/controllers/group",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.group",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])}),define("apps/trip/controllers/refund",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.refund",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])}),define("apps/trip/controllers/refund_detail",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.refund_detail",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])});var lang={day:"日",month:"月",year:"年",week:"星期",weekday:["日","一","二","三","四","五","六"]};define("CHN",function(){});var mydate=function(e){e.keyid&&(this.keyid=e.keyid),e.code_type&&(this.code_type=e.code_type),e.hotel_price&&(this.hotel_price=e.hotel_price),e.stock&&(this.hotel_stock=e.stock),this.dom=e.dom,this.date=e.date,this.price=e.price,this.dateone=this.todate(e.date),this.ddate=this.todate(e.date),this.lang=e.lang||"CHN",this.skin=e.skin||"default",this.data=e.data,this.start_time=this.todate(e.start_time||"1900-01-01"),this.end_time=this.todate(e.end_time||"2200-01-01");var t=this;this.datesModel={},$(this.dom).addClass("mydatein"),$("body").on("click",".mydate .title .left_but",function(e){var a=t.ddmonth,o=t.ddyear;1==a?(a=12,o-=1):a-=1,(a>=t.month&&o>=t.year||a<=t.month&&o>t.year)&&(t.ddmonth=a,t.ddyear=o,$(".mydate .title p").html(t.ddyear+lang.year+t.ddmonth+lang.month),t.tinsup([t.ddyear,t.ddmonth-1]))}),$("body").on("click",".mydate .title .right_but",function(e){12==t.ddmonth?(t.ddmonth=1,t.ddyear=t.ddyear+1):t.ddmonth=t.ddmonth+1,$(".mydate .title p").html(t.ddyear+lang.year+t.ddmonth+lang.month),t.tinsup([t.ddyear,t.ddmonth-1])})};mydate.prototype={config:{mydatemonth:[31,28,31,30,31,30,31,31,30,31,30,31]},run:function(){var e='<div class="mydate">            <div class="title">                <a href="javascript:void(0)" class="icon left_but"></a><a href="javascript:void(0)" class="icon right_but"></a>                <p></p>            </div>            <div class="conter">                <ul class="week"></ul>                <ul class="con">                </ul>            </div>        </div>';$(".mydatezrone").html(e),this.year=this.getyear(this.date),this.month=this.getmonth(this.date),this.day=this.getday(this.date),this.ddyear=this.year,this.ddmonth=this.month,$(".mydate .title p").html(this.year+lang.year+this.month+lang.month);var t="";for(x in lang.weekday)t+="<li>"+lang.weekday[x]+"</li>";$(".mydate .week").append(t),this.one=this.getoutday(this.date);var a=this.getdatejson({day:this.one,date:this.getday(this.date),typeid:this.keyid,hotel_stock:this.hotel_stock}),o=this.monthdom(this.price,a,this.keyid);$(".mydate .conter .con").append(o),$(".mydate").css({display:"block","margin-top":"10px"})},monthdom:function(e,t,a){var o="";for(x in t){var s=t[x].date,n=lang.week+lang.weekday[s.getDay()],r=s.getDate(),i=mydate.getFormatDate(t[x].date);if(0==t[x].on)o+='<li class="out"><p>'+r+"</p></li>";else if(this.datesModel[i])if("chosed"===this.datesModel[i].state&&3!=this.datesModel[i].keyid){var c=this.datesModel[i];o+='<li class="on tip" data-pid="'+c.item_stock.id+'"><i class="if remove-date"></i><a href="javascript:void(0)" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>"+c.mark+"</span></a></li>"}else if("chosed"===this.datesModel[i].state&&3==this.datesModel[i].keyid&&2==this.datesModel[i].init_type){var c=this.datesModel[i];o+=c.item_stock.dt>=c.item_stock.nowdays?'<li class="on tip"><a href="javascript:void(0)" data-goodsid="'+c.item_stock.id+'" data-remark="'+c.item_stock.remark+'" data-stock="'+c.item_stock.occupy_stock+'" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>已预订："+c.mark+"</span><span>线下占用："+c.item_stock.occupy_stock+"</span><span>剩余库存："+c.item_stock.remain_stock+"</span></a></li>":'<li class="out"><a href="javascript:void(0)" data-goodsid="'+c.item_stock.id+'" data-remark="'+c.item_stock.remark+'" data-stock="'+c.item_stock.occupy_stock+'" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>已预订："+c.mark+"</span><span>线下占用："+c.item_stock.occupy_stock+"</span><span>剩余库存："+c.item_stock.remain_stock+"</span></a></li>"}else if("chosed"===this.datesModel[i].state&&3==this.datesModel[i].keyid&&1==this.datesModel[i].init_type){var c=this.datesModel[i];o+=c.item_stock.dt>=c.item_stock.nowdays?'<li class="on tip"><a href="javascript:void(0)" data-goodsid="'+c.item_stock.id+'" data-remark="'+c.item_stock.remark+'"  data-price="'+c.item_stock.price+'" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>价格："+c.mark+"</span></a></li>":'<li class="out"><a href="javascript:void(0)" data-goodsid="'+c.item_stock.id+'" data-remark="'+c.item_stock.remark+'" data-price="'+c.item_stock.price+'" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>价格："+c.mark+"</span></a></li>"}else"cancel"===this.datesModel[i].state&&(o+='<li class="out"><p>'+r+"</p></li>");else if(3==this.keyid&&2==this.code_type){var l=t[x].date.setDate(t[x].date.getDate()),d=mydate.getFormatDate(new Date(l));o+=d>=this.date?'<li class="on"><i class="if if-remove"></i><a href="javascript:void(0)"  data-remark="" data-stock="0" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>基础库存:"+t[x].stock+"</span></a></li>":'<li class="out"><i class="if if-remove"></i><a href="javascript:void(0)"  data-remark="" data-stock="0" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>基础库存:"+t[x].stock+"</span></a></li>"}else if(3==this.keyid&&1==this.code_type){var l=t[x].date.setDate(t[x].date.getDate()),d=mydate.getFormatDate(new Date(l));o+=d>=this.date?'<li class="on"><i class="if if-remove"></i><a href="javascript:void(0)"  data-remark="" data-price="'+this.hotel_price+'" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>价格："+this.hotel_price+"</span></a></li>":'<li class="out"><i class="if if-remove"></i><a href="javascript:void(0)"  data-remark="" data-price="'+this.hotel_price+'" title="'+i+'"data-week="'+n+'"><p>'+r+"</p><span>价格："+this.hotel_price+"</span></a></li>"}else o+='<li class="on"><i class="if if-remove"></i><a href="javascript:void(0)" title="'+i+'"data-week="'+n+'"><p>'+r+"</p></a></li>"}return o},todate:function(e){var t,a,o;if(o=e,"string"==typeof o){var a=o.split("-"),t=new Date(1900,1,1);t.setFullYear(parseInt(a[0]),parseInt(a[1]-1),parseInt(a[2]))}else t=e;return t},getoutday:function(e){var t,a;return t=e?this.todate(e):this.ddate,t.setDate(1),a=t.getDay()},getday:function(e){var t,a;return t=e?this.todate(e):this.ddate,a=t.getDate()},getmonth:function(e){var t,a;return t=e?this.todate(e):this.ddate,a=t.getMonth()+1},getyear:function(e){var t,a;return t=e?this.todate(e):this.ddate,a=t.getFullYear()},getdatejson:function(e){var t,a;e?(a=e.day?e.day:this.one,t=e.date?e.date:this.ddate):(a=this.one,t=this.ddate);var o=new Array,s=new Date(this.ddyear,this.ddmonth-1,1),n=this.getMonthDayCount(s),r=s;if(e.typeid&&3==e.typeid)for(var i=this.one;i>0;i--){var c=new Date(s);c=new Date(c.setDate(s.getDate()-i)),o.push({date:c,on:!1,stock:e.hotel_stock})}else for(var i=this.one;i>0;i--){var c=new Date(s);c=new Date(c.setDate(s.getDate()-i)),o.push({date:c,on:!1})}if(e.typeid&&3==e.typeid)for(var i=0;i<n;i++){var l=r>=this.start_time;o.push({date:new Date(r),on:l,stock:e.hotel_stock}),r.setDate(r.getDate()+1)}else for(var i=0;i<n;i++){var l=r>=this.start_time&&r<=this.end_time;o.push({date:new Date(r),on:l}),r.setDate(r.getDate()+1)}if(e.typeid&&3==e.typeid)for(var i=42-o.length;i>0;i--)o.push({date:new Date(r),on:!1,stock:e.hotel_stock}),r.setDate(r.getDate()+1);else for(var i=42-o.length;i>0;i--)o.push({date:new Date(r),on:!1}),r.setDate(r.getDate()+1);return o},tinsup:function(e){$(".mydate .con li").remove(),this.ddate.setFullYear(e[0],e[1],1),this.one=this.ddate.getDay();var t=this.getdatejson({day:this.one,date:this.ddate,typeid:this.keyid,hotel_stock:this.hotel_stock}),a=this.monthdom(this.price,t);return $(".mydate .conter .con").append(a),t},getMonthDayCount:function(e){var t=e.getYear(),a=e.getMonth()+1,o=this.config.mydatemonth[a-1];return 2==a&&(t%4==0&&t%100!=0||t%100==0&&t%400==0)&&(o=29),o},according:function(){var e=this.tinsup([this.ddyear,this.ddmonth-1]);return e}},mydate.getFormatDate=function(e){var t="";return e&&(e=new Date(e),t=e.getFullYear()+"-"+mydate.fillWithZero(e.getMonth()+1)+"-"+mydate.fillWithZero(e.getDate())),t},mydate.fillWithZero=function(e,t){if(!e)return"";t=t||2,e=e.toString();var a=e.length;if(a<t)for(var o=a;o<t;o++)e="0"+e;return e},define("mydate",["CHN"],function(){}),define("apps/trip/controllers/form",["apps/common/controllers/controllers","baiduMap","mydate"],function(e){e.controller("shop.trip.line.form",["$scope","$state","GoodsData","AddTripResource","typelineResource","tagResource","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n,r,i,c,l,d){function p(t){var a=new BMap.Geocoder;a.getPoint(t,function(t){t?(e.params.tripGoodsTheme.lon=t.lng,e.params.tripGoodsTheme.lat=t.lat,u.centerAndZoom(t,16),g=new BMap.Marker(t),g.enableDragging(),u.clearOverlays(),u.addOverlay(g),f(g)):l.create("danger","您选择地址没有解析到结果!")},e.cityname)}$(".nav-tabs li").click(function(){$(this).addClass("active"),$(this).siblings().removeClass("active");var e=$(this).find("a").attr("aria-controls");$(".tab-pane").removeClass("active"),$("#"+e).addClass("active")}),e.params={title:"",img:"",imgs:[],tags:[],tripGoodsTheme:{type_id:"",from_province:"",from_city:"",to_country:"",to_province:"",to_city:"",venue:"",lat:"",lon:"",tags:""},tripGoodsPlan:{day:"",night:"",plan:[{des:"",lines:[{from:"",to:""}],breakfast:"",transport:"",spots:[{spot:""}],imgs:[],lunch:"",supper:"",hotel:"",property:[]}]},tripGoodsPrice:{price:"",kid_price:"",enable_kid:"",kid_height:"",start_day:"",end_day:"",presell_day:"",presell_hour:""},tripGoodsPriceDate:[{set_out:"",price:"",kid_price:"",min_tuan:"",max_tuan:""}],tripGoodsInsurance:[{title:"",description:"",price:"",require:""}],tripGoodsDes:{feature:"",notice:"",refund:0,refund_day:"",refund_hour:"",refund_rate:"",refund_info:"",hotline:""}},e.params.tripGoodsTheme.lon=116.404,e.params.tripGoodsTheme.lat=39.915,e.price_categroys=[{id:1e4,name:"adult",title:"成人"},{id:10001,name:"kid",title:"儿童"}],s.get(function(t){e.categories=t.data});var u=new BMap.Map("baiduMap");u.centerAndZoom(new BMap.Point(116.404,39.915),16),u.addControl(new BMap.NavigationControl),u.enableScrollWheelZoom(!0);var m=new BMap.Point(e.params.tripGoodsTheme.lon,e.params.tripGoodsTheme.lat);u.centerAndZoom(m,16);var g=new BMap.Marker(m);g.enableDragging(),u.addOverlay(g);var f=function(t){t.addEventListener("dragend",function(a){var o=t.getPosition();e.params.tripGoodsTheme.lon=o.lon,e.params.tripGoodsTheme.lat=o.lat})};f(g),e.searchAddress=function(){if(angular.isUndefined(e.params.tripGoodsTheme.venue)||""==e.params.tripGoodsTheme.venue)return l.create("danger","请输入地址"),!1;var t=e.params.tripGoodsTheme.venue;p(t)},e.showrefund=function(){1==e.params.tripGoodsDes.refund?$(".refund-info").show():$(".refund-info").hide()},e.goodsData="",e.getTags=function(){n.get({type:1},function(t){t._count>0?angular.forEach(t.data,function(e,t){a.tags.push(e)}):a.tags=[],e.goodsData=a.tags},function(e){l.create("danger",e.data.error.message)})},e.getTags(),e.addTag=function(){var t=$.trim($("#input-addTag-name-pop").val());""!=t?n.save({name:t,type:1},function(t){l.create("success","操作成功"),e.params.tags.push(t),e.ngPopoverClose()},function(e){l.create("danger",e.data.error.message)}):l.create("warning","请填写分组名称")},e.ngPopoverClose=function(){c.close()},e.params.tripGoodsPrice.start_day=mydate.getFormatDate(new Date(1e3*e.params.tripGoodsPrice.start_day)),e.params.tripGoodsPrice.end_day=mydate.getFormatDate(new Date(1e3*e.params.tripGoodsPrice.end_day)),e.params.tripGoodsPrice.start_day<new Date&&(e.tomorrow=e.params.tripGoodsPrice.start_day);mydate.getFormatDate(e.params.tripGoodsPrice.start_day),mydate.getFormatDate(e.params.tripGoodsPrice.end_day);e.is_price_chosed=!1,e.showMydate=function(t){var a=$(".adult").is(":checked"),o=$(".kid").is(":checked");if(1==a||1==o?e.is_price_chosed=!0:0==a&&0==o&&(e.is_price_chosed=!1),e.is_price_chosed&&e.params.tripGoodsPrice.start_day&&e.params.tripGoodsPrice.end_day){
var s=mydate.getFormatDate(e.params.tripGoodsPrice.start_day),n=mydate.getFormatDate(e.params.tripGoodsPrice.end_day);e.dates=new mydate({keyid:3434,date:new Date,dom:".date",start_time:s,end_time:n}),e.dates.run(1),t&&(e.dates.datesModel=t,e.dates.according(),t=null)}},e.$on("$viewContentLoaded",function(){$(document).off("click.itineraryEdit"),$(".container").on("click.itineraryEdit",".mydate .con .on a, .mydate .con .max a",function(t){var a=$(this).attr("title");e.showpricewindow("today",new Date(a))}),$(".container").on("click.itineraryEdit",".mydate .con .on .remove-date",function(t){var a=$(this).next("a").attr("title");e.dates.datesModel[a]&&(e.dates.datesModel[a].state="cancel");var o=[];$.each(e.dates.datesModel,function(t,a){if("chosed"==a.state){for(var s="",n="",r=0;r<a.item_stock.item_price.length;r++)1e4==a.item_stock.item_price[r].price_category&&(n=a.item_stock.item_price[r].price_category),10001==a.item_stock.item_price[r].price_category&&(s=a.item_stock.item_price[r].price_category);o.push({id:a.item_stock.id,goods_id:e.id,max_tuan:a.item_stock.max_stock,min_tuan:a.item_stock.min_stock,set_out:a.item_stock.dt,kid_price:s,price:n})}}),e.params.trip_goods_price_date=o,e.dates.according()})}),e.showpricewindow=function(t,a){var o=[],s=$(".adult").is(":checked"),n=$(".kid").is(":checked");1==s&&o.push({price_category:1e4,name:"成人",price:""}),1==n&&o.push({price_category:10001,name:"儿童",price:""});var r=d.open({templateUrl:"setPrice.html",size:"lg",controller:"priceWindowCtrl",resolve:{type:function(){return t},price_categroys:function(){return o},dates:function(){return e.dates},specifyDate:function(){return a},start_time:function(){return e.params.tripGoodsPrice.start_day},end_time:function(){return e.params.tripGoodsPrice.end_day}}});r.result.then(function(t){var a=[],o=e.dates.datesModel;$.each(o,function(e){for(var t="",s="",n=0;n<o[e].item_stock.item_price.length;n++)1e4==o[e].item_stock.item_price[n].price_category&&(t=o[e].item_stock.item_price[0].price),10001==o[e].item_stock.item_price[n].price_category&&(s=o[e].item_stock.item_price[1].price);a.push({set_out:""+o[e].item_stock.dt,min_tuan:o[e].item_stock.min_stock,max_tuan:o[e].item_stock.max_stock,price:t,kid_price:s})}),e.params.tripGoodsPriceDate=a},function(e){})},e.fnFormatInt=function(e){var t=$(e.currentTarget),a=t.val(),o=/^[0-9]*$/;o.test(a)||t.val(a.replace(/[^0-9]/g,""))},e.getNowFormatDate=function(){var e=new Date(new Date-864e5),t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},e.nowFormatDate=e.getNowFormatDate(),e.itinerary_trip=[],e.createtrips=function(){var t=e.itinerary_trip.length,a=t;if(a<e.params.tripGoodsPlan.day)for(;t<e.params.tripGoodsPlan.day;){t++;var o=t-1,s={breakfast:"",des:"",hotel:"",imgs:[],property:[],lunch:"",supper:"",transport:"",listorder:t,index:o,line:[{from:"",to:""}],spots:[{spot:""}]};e.itinerary_trip.push(s)}else for(var n=e.itinerary_trip.length;n>e.params.tripGoodsPlan.day;n--)e.itinerary_trip.splice(n-1,1)},e.addline=function(t){e.itinerary_trip[t].line.push({from:"",to:""})},e.addspots=function(t){e.itinerary_trip[t].spots.push({spot:""})},e.property=[],e.addproperty=function(e){$(".schedul-day").eq(e).find(".addproperty").show(),$(".schedul-day").eq(e).find(".add-property").hide()},e.addProp=function(t){var a=$(".schedul-day").eq(t).find(".input-addProp-name").val(),o=$(".schedul-day").eq(t).find(".input-addkey-name").val();e.itinerary_trip[t].property.push({key:a,val:o}),$(".schedul-day").eq(t).find(".addproperty").hide(),$(".schedul-day").eq(t).find(".add-property").show()},e.showAdd=function(e){$(".schedul-day").eq(e).find(".addproperty").hide(),$(".schedul-day").eq(e).find(".add-property").show()},e.confirmDisable=function(t,a){e.itinerary_trip[t].property.splice(a,1)},e.insurance=[],e.addinsurance=function(){var t=d.open({animation:!1,templateUrl:"assets/js/apps/trip/templates/add_insurance.html",controller:"trip.addinsurance",resolve:{}});t.result.then(function(t){e.insurance.push({title:t.title,price:t.price,description:t.description,require:""})})},e.editinsurance=function(t,a,o,s){var n=d.open({animation:!1,templateUrl:"assets/js/apps/trip/templates/edit_insurance.html",controller:"trip.editinsurance",resolve:{title:function(){return t},price:function(){return a},description:function(){return o},ID:function(){return s}}});n.result.then(function(t){$.each(e.insurance,function(e,a){t.id==a.id&&(a.title=t.title,a.price=t.price,a.description=t.description)})})},e.save=function(){return e.tags=[],$.each(e.params.tags,function(t,a){e.tags.push(a.id)}),e.params.tags=e.tags,""==e.params.tripGoodsTheme.from_province?($(".from_province").addClass("has-error"),l.create("danger","请输入出发省份"),!1):""==e.params.tripGoodsTheme.from_city?($(".from_city").addClass("has-error"),l.create("danger","请输入出发城市"),!1):""==e.params.tripGoodsTheme.to_country?($(".to_country").addClass("has-error"),l.create("danger","请输入目的地国家"),!1):""==e.params.tripGoodsTheme.to_province?($(".to_province").addClass("has-error"),l.create("danger","请输入目的地省份"),!1):""==e.params.tripGoodsTheme.to_city?($(".to_city").addClass("has-error"),l.create("danger","请输入目的地城市"),!1):""==e.params.tripGoodsTheme.venue?($(".position").addClass("has-danger"),l.create("danger","请输入集合地点"),!1):""==e.params.tripGoodsPlan.day?($(".total-day").addClass("has-danger"),l.create("danger","请输入出行天数"),!1):""==e.params.tripGoodsDes.hotline?($(".hot-line").addClass("has-danger"),l.create("danger","请输入咨询电话"),!1):($(".has-error").removeClass("has-error"),$(".has-danger").removeClass("has-danger"),e.params.imgs.length>0&&(e.params.img=e.params.imgs[0].url),e.params.tripGoodsInsurance=e.insurance,e.params.tripGoodsPlan.plan=e.itinerary_trip,void o.post(e.params,function(e){1==e.status?(l.create("success"," 保存成功！"),t.go("shop.trip.line.list")):l.create("danger",""+e.msg)}))}}])}),define("apps/trip/controllers/typeadd",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.addtype",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","addtypelineResource","$state",function(e,t,a,o,s,n,r,i){e.params={title:"",icon:""},e.addtype=function(){r.post(e.params,function(e){1==e.status&&(s.create("success"," 保存成功！"),i.go("shop.trip.type")),0==e.status&&s.create("danger"," 保存失败！")})}}])}),define("apps/trip/controllers/typeedit",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.type_edit",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","edittypelineResource","$state",function(e,t,a,o,s,n,r,i){e.id=t.id,e.params={title:"",icon:""},r.get({id:e.id},function(t){e.params=t}),e.save=function(){r.put(e.params,function(e){1==e.status&&(s.create("success"," 保存成功！"),i.go("shop.trip.type")),0==e.status&&s.create("danger"," 保存失败！")})}}])}),define("apps/trip/controllers/deal",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.deal",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","dealListResource",function(e,t,a,o,s,n,r){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,version:""};var i=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,r.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.deals=t.data,e.version=t.version})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",i),e.search=function(){e.paginationConf.currentPage=1,i()}}])}),define("apps/trip/controllers/deal.add",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.deal.add",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","dealAddResource","dealNewResource",function(e,t,a,o,s,n,r,i){e.setting={id:0,aggrement:"",merchant_id:"",version:"",created_at:"",updated_at:""},i.get(function(t){e.setting=t.data}),e.btn_text="更改协议",e.submitForm=function(t){if(t){e.btn_text="更改中...";var a={aggrement:e.setting.aggrement,version:e.setting.version};r.save(a,function(t){e.btn_text="更改协议",s.create("success"," 保存成功！")},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.error.msg)})}}}])}),define("apps/trip/controllers/deal.info",["apps/common/controllers/controllers"],function(e){e.controller("shop.trip.deal.info",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","dealInfoResource",function(e,t,a,o,s,n,r){e.id=t.id,e.params={title:"",merchant_id:"",shop_id:"",aggrement:"",version:"",created_at:"",updated_at:""},r.get({id:e.id},function(t){e.params=t.data,id=e.id})}])}),define("apps/trip/controllers/addinsurance",["apps/common/controllers/controllers"],function(e){e.controller("trip.addinsurance",["$scope","$stateParams","$filter","ngPopover","Flash","$modal","$modalInstance",function(e,t,a,o,s,n,r){e.info={title:"",price:"",description:""},e.cancel=function(){r.dismiss("cancel")};e.ok=function(){r.close(e.info)}}])}),define("apps/trip/controllers/editinsurance",["apps/common/controllers/controllers"],function(e){e.controller("trip.editinsurance",["$scope","$stateParams","$filter","ngPopover","$modalInstance","Flash","$modal","title","price","description","ID",function(e,t,a,o,s,n,r,i,c,l,d){e.info={title:i,price:c,description:l,id:d},e.cancel=function(){s.dismiss("cancel")};e.ok=function(){s.close(e.info)}}])}),define("apps/trip/controllers/commission",["apps/common/controllers/controllers"],function(e){e.controller("trip.commission",["$scope","$stateParams","$filter","ngPopover","Flash","$modal",function(e,t,a,o,s,n){}])}),define("apps/trip/controllers/priceWindow",["apps/common/controllers/controllers"],function(e){e.controller("priceWindowCtrl",["$scope","Flash","$modalInstance","$stateParams","$filter","ngPopover","$modal","type","price_categroys","specifyDate","start_time","end_time","dates",function(e,t,a,o,s,n,r,i,c,l,d,p,u){if(e[i]=!0,e.start_time="string"==typeof d?new Date(d):d,e.end_time="string"==typeof p?new Date(p):p,e.max_stock="",e.min_stock="",e.original_price="",e.price_categroys=c,e.dates=u,"today"===i){l=mydate.getFormatDate(l);var m=e.dates.datesModel[l];m&&m.item_stock&&(m=m.item_stock,e.max_stock=m.max_stock,e.min_stock=m.min_stock,e.original_price=m.original_price,$.each(e.price_categroys,function(t){e.price_categroys[t];$.each(m.item_price,function(a){m.item_price[a].price_category==e.price_categroys[t].price_category&&(e.price_categroys[t].price=m.item_price[a].price)})}))}var g={};switch(i){case"day":var f=[];for(_ in e.dates.datesModel)f.push(_);if(f.length>0){var h=f[0];e.max_stock=e.dates.datesModel[h].item_stock.max_stock,e.min_stock=e.dates.datesModel[h].item_stock.min_stock,e.price_categroys=[];for(var _=0;_<e.dates.datesModel[h].item_stock.item_price.length;_++){var v=e.dates.datesModel[h].item_stock.item_price[_];1e4==v.price_category&&e.price_categroys.push({name:"成人",price_category:1e4,price:v.price}),10001==v.price_category&&e.price_categroys.push({name:"儿童",price_category:10001,price:v.price})}}break;case"week":e.weeknum=[{name:"周日"},{name:"周一"},{name:"周二"},{name:"周三"},{name:"周四"},{name:"周五"},{name:"周六"}];var f=[];for(_ in e.dates.datesModel)f.push(_);if(f.length>0){var h=f[0];e.max_stock=e.dates.datesModel[h].item_stock.max_stock,e.min_stock=e.dates.datesModel[h].item_stock.min_stock,e.price_categroys=[];for(var _=0;_<e.dates.datesModel[h].item_stock.item_price.length;_++){var v=e.dates.datesModel[h].item_stock.item_price[_];1e4==v.price_category&&e.price_categroys.push({name:"成人",price_category:1e4,price:v.price}),10001==v.price_category&&e.price_categroys.push({name:"儿童",price_category:10001,price:v.price})}}break;case"month":e.monthnum=new Array;for(var _=0;_<31;_++)e.monthnum.push({name:_+1});var f=[];for(_ in e.dates.datesModel)f.push(_);if(f.length>0){var h=f[0];e.max_stock=e.dates.datesModel[h].item_stock.max_stock,e.min_stock=e.dates.datesModel[h].item_stock.min_stock,e.price_categroys=[];for(var _=0;_<e.dates.datesModel[h].item_stock.item_price.length;_++){var v=e.dates.datesModel[h].item_stock.item_price[_];1e4==v.price_category&&e.price_categroys.push({name:"成人",price_category:1e4,price:v.price}),10001==v.price_category&&e.price_categroys.push({name:"儿童",price_category:10001,price:v.price})}}}e.ok=function(){if(e.priceWinForm.$invalid)return g_dialog.float("请填写完整信息","error"),!1;for(var t,o=0,s=0;s<e.price_categroys.length;s++){var n=parseFloat(e.price_categroys[s].price);n>o&&(o=n),(void 0==t||n<t)&&(t=n)}var r=new Date(e.start_time);if("day"==i)for(;r<=e.end_time;){var c={dt:mydate.getFormatDate(r),min_stock:e.min_stock,max_stock:e.max_stock,original_price:e.original_price,item_price:$.map(e.price_categroys,function(e){return{price_category:e.price_category,price:e.price}})};g[c.dt]={state:"chosed",mark:"￥"+o,item_stock:c};var d=r.setDate(r.getDate()+1);r=new Date(d)}else if("week"==i)for(;r<=e.end_time;){if(e.weeknum[r.getDay()].is_ckd){var c={dt:mydate.getFormatDate(r),min_stock:e.min_stock,max_stock:e.max_stock,original_price:e.original_price,item_price:$.map(e.price_categroys,function(e){return{price_category:e.price_category,price:e.price}})};g[c.dt]={state:"chosed",mark:"￥"+t,item_stock:c}}var d=r.setDate(r.getDate()+1);r=new Date(d)}else if("month"==i)for(;r<=e.end_time;){var p=r.getDate()-1;if(e.monthnum[p].is_ckd){var c={dt:mydate.getFormatDate(r),min_stock:e.min_stock,max_stock:e.max_stock,original_price:e.original_price,item_price:$.map(e.price_categroys,function(e){return{price_category:e.price_category,price:e.price}})};g[c.dt]={state:"chosed",mark:"￥"+t,item_stock:c}}var d=r.setDate(r.getDate()+1);r=new Date(d)}else{var c={dt:l,min_stock:e.min_stock,max_stock:e.max_stock,original_price:e.original_price,item_price:$.map(e.price_categroys,function(e){return{price_category:e.price_category,price:e.price}})};g[c.dt]={state:"chosed",mark:"￥"+t,item_stock:c}}e.dates.datesModel=$.extend(!0,e.dates.datesModel,g),e.dates.according(),a.close()},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/trip/controllers/_base",["apps/trip/controllers/line","apps/trip/controllers/line.edit","apps/trip/controllers/type","apps/trip/controllers/order","apps/trip/controllers/unfinished_order","apps/trip/controllers/finished_order","apps/trip/controllers/detail","apps/trip/controllers/group","apps/trip/controllers/refund","apps/trip/controllers/refund_detail","apps/trip/controllers/form","apps/trip/controllers/typeadd","apps/trip/controllers/typeedit","apps/trip/controllers/deal","apps/trip/controllers/deal.add","apps/trip/controllers/deal.info","apps/trip/controllers/addinsurance","apps/trip/controllers/editinsurance","apps/trip/controllers/commission","apps/trip/controllers/priceWindow"],function(){}),define("apps/trip/directives/_base",[],function(){}),define("apps/trip/services/typeline",["apps/common/services/services"],function(e){e.factory("typelineResource",["$resource",function(e){return e("/trip/type/list.json",{id:"@id"},{get:{method:"GET",url:"/trip/type/list.json"}})}]),e.factory("addtypelineResource",["$resource",function(e){return e("/trip/type.json",{id:"@id"},{post:{method:"POST",url:"/trip/type.json"}})}]),e.factory("edittypelineResource",["$resource",function(e){return e("/trip/type/:id.json",{id:"@id"},{put:{method:"PUT",url:"/trip/type/:id.json"},get:{method:"GET",url:"/trip/type/:id.json"}})}]),e.factory("tripListResource",["$resource",function(e){return e("/trip/goods/list.json",{id:"@id"},{get:{method:"GET",url:"/trip/goods/list.json"}})}]),e.factory("tripDeleteResource",["$resource",function(e){return e("/trip/goods/:id.json",{id:"@id"},{delete:{method:"DELETE",url:"/trip/goods/:id.json"}})}])}),define("apps/trip/services/deal",["apps/common/services/services"],function(e){e.factory("dealAddResource",["$resource",function(e){return e("/trip/aggrement.json",{id:"@id"},{post:{method:"POST",url:"/trip/aggrement.json"}})}]),e.factory("dealNewResource",["$resource",function(e){return e("/trip/new_aggrement.json",{id:"@id"},{get:{method:"GET",url:"/trip/new_aggrement.json"}})}]),e.factory("dealListResource",["$resource",function(e){return e("/trip/aggrement_list.json",{id:"@id"},{get:{method:"GET",url:"/trip/aggrement_list.json"}})}]),e.factory("dealInfoResource",["$resource",function(e){return e("/trip/aggrement/:id.json",{id:"@id"},{get:{method:"GET",url:"/trip/aggrement/:id.json"}})}])}),define("apps/trip/services/trip",["apps/common/services/services"],function(e){e.factory("AddTripResource",["$resource",function(e){return e("/trip/goods.json",{id:"@id"},{post:{method:"POST",url:"/trip/goods.json"}})}]),e.factory("EditTripResource",["$resource",function(e){return e("/trip/goods/:id.json",{id:"@id"},{get:{method:"GET",url:"/trip/goods/:id.json"},put:{method:"PUT",url:"/trip/goods/:id.json"}})}]),e.factory("TripOrderDetailResource",["$resource",function(e){return e("/trip/order/:id.json",{id:"@id"},{get:{method:"GET",url:"/trip/order/:id.json"}})}])}),define("apps/trip/services/_base",["apps/trip/services/typeline","apps/trip/services/deal","apps/trip/services/trip"],function(){}),define("apps/trip/main",["apps/trip/states/_base","apps/trip/controllers/_base","apps/trip/directives/_base","apps/trip/services/_base"],function(){}),define("apps/ticket/states/auction",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ticket",{url:"/ticket",templateUrl:"assets/js/apps/ticket/templates/layout.html",controller:"shop.ticket.layout"}).state("shop.ticket.auction",{abstract:!0,url:"/auction",template:"<div ui-view></div>"}).state("shop.ticket.auction.list",{url:"?callback",templateUrl:"assets/js/apps/ticket/templates/auction.html",controller:"shop.ticket.auction"}).state("shop.ticket.auction.comments",{url:"/add",templateUrl:"assets/js/apps/goods/templates/comments.add.html",controller:"shop.ticket.auction.comments.add"}).state("shop.ticket.auction.edit",{url:"/edit",templateUrl:"assets/js/apps/goods/templates/comments.edit.html",controller:"shop.ticket.auction.comments.edit"})}])}),define("apps/ticket/states/add",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ticket.add",{abstract:!0,url:"/add",template:"<div ui-view></div>"}).state("shop.ticket.add.step",{controller:"shop.ticket.form",url:"/step/:step",templateUrl:"assets/js/apps/ticket/templates/form.html"})}])}),define("apps/ticket/states/edit",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ticket.edit",{abstract:!0,url:"/edit",template:"<div ui-view></div>"}).state("shop.ticket.edit.step",{controller:"shop.ticket.form",url:"/:id/step/:step?type",templateUrl:"assets/js/apps/ticket/templates/form.html"})}])}),define("apps/ticket/states/order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ticket.order",{abstract:!0,url:"/order",template:"<div ui-view></div>"}).state("shop.ticket.order.list",{url:"/list",templateUrl:"assets/js/apps/ticket/templates/order.list.html",controller:"shop.ticket.list"}).state("shop.ticket.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/ticket/templates/order.detail.html",controller:"shop.ticket.detail"}).state("shop.ticket.feedback",{url:"/feedback/:id",templateUrl:"assets/js/apps/ticket/templates/order.feedback.html",controller:"shop.order.feedback"})}])}),define("apps/ticket/states/verification",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ticket.verification",{abstract:!0,template:"<div ui-view></div>"}).state("shop.ticket.verification.list",{url:"/verification",templateUrl:"assets/js/apps/ticket/templates/verification.html",controller:"shop.ticket.verification"})}])}),define("apps/ticket/states/thirdParty",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.ticket.thirdParty",{abstract:!0,template:"<div ui-view></div>"}).state("shop.ticket.thirdParty.setting",{url:"/thirdParty",templateUrl:"assets/js/apps/ticket/templates/third_party_setting.html",controller:"shop.ticket.thirdParty"})}])}),define("apps/ticket/states/_base",["apps/ticket/states/auction","apps/ticket/states/add","apps/ticket/states/edit","apps/ticket/states/order","apps/ticket/states/verification","apps/ticket/states/thirdParty"],function(){}),define("apps/ticket/controllers/auction",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.auction",["$scope","$stateParams","$filter","ngPopover","Flash","goodsResource","tagResource","$modal","listBackParams",function(e,t,a,o,s,n,r,i,c){var l=10,d=!1;e.params={offset:0,limit:l,title:"",column:"created_at",direction:"desc",start_time:"",end_time:"",piao_stock:"",piao_onsale:"all",trip_type:2},e.item=!1,e.toggle=function(t){e.item=!t},e.save=function(){o.close()},e.cancel=function(){o.close()},e.checkTitle=function(e){if(""==e)return"商品名称不能为空!"},e.checkPrice=function(e){if(!/^\d+(\.\d+)?$/.test(e))return"格式不正确!"},e.checkStock=function(e){if(!/^[0-9]+[0-9]*]*$/.test(e))return"格式不正确!"},e.saveField=function(e,t,a){var o={id:a};o[e]=t,n.editField(o,function(e){e.success||s.create("danger",e.error)})},e.goods={checkedAll:!1},e.selectedIds=[],e.selectedTagIds=[],e.selectedRegionIds=[],e.setting={},e.setting.is_discount=1,e.$watch("search.params",function(t){t&&!d&&(1==e.paginationConf.currentPage?p():e.paginationConf.currentPage=1)},!0),e.sortClass=function(t,a){return e.params.column==t&&e.params.direction==a},e.sort=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),p()},e.confirmDelete=function(e){n.delete({id:e},function(e){e.success?(s.create("success","删除成功"),p()):s.create("danger","删除失败")})},e.confirmOnSale=function(e){n.onSale({id:e,sale:1},function(e){e.success?(s.create("success","上架成功"),p()):s.create("danger","上架失败")})},e.confirmOffSale=function(e){n.onSale({id:e,sale:0},function(e){e.success?(s.create("success","下架成功"),p()):s.create("danger","下架失败")})},e.confirmBatchOnSale=function(){n.batchToggleSale({ids:e.selectedIds,sale:1},function(t){t.success?(s.create("success","上架成功"),p(),e.goods.checkedAll=!1):s.create("danger","上架失败")})},e.confirmBatchDelete=function(){n.batchDelete({ids:e.selectedIds.join(",")},function(t){t.success?(s.create("success","删除成功"),p(),e.goods.checkedAll=!1):s.create("danger","删除失败")})},e.confirmBatchOffSale=function(){n.batchToggleSale({ids:e.selectedIds,sale:0},function(t){t.success?(s.create("success","下架成功"),p(),e.goods.checkedAll=!1):s.create("danger","下架失败")})},e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.isGroup=!1,e.batchGoodsTags=function(){e.isGroup=!0,n.batchTag({tag_ids:e.selectedTagIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,e.goodsTags.map(function(e){e.checked=!1}),o.close(),s.create("success","分组成功")):s.create("danger","分组失败"),e.selectedTagIds=[],e.isGroup=!1},function(){e.isGroup=!1})},e.checkGoodsTag=function(t){var a=e.selectedTagIds.indexOf(t);a>-1?e.selectedTagIds.splice(a,1):e.selectedTagIds.push(t)},e.batchSetRegions=function(){n.batchRegion({region_ids:e.selectedRegionIds,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,s.create("success","区域设置成功")):s.create("danger","区域设置失败")})},e.isDiscount=!1,e.batchGoodsDiscount=function(){e.isDiscount=!0,n.batchDiscount({is_discount:e.setting.is_discount,goods_ids:e.selectedIds},function(t){t.success?(e.goods.checkedAll=!1,p(),s.create("success","设置成功")):s.create("danger","设置失败"),e.isDiscount=!1},function(){e.isDiscount=!1}),o.close()},e.$watch("goods.checkedAll",function(t){t?e.selectedIds=e.goods.map(function(e){return e.id}):e.selectedIds=[]});var p=function(){if(e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,e.search.params){e.params.goods_tag_id=e.search.params.tag.id;for(var t in e.search.params.types)delete e.params[e.search.params.types[t]];e.search.params.input&&(e.params[e.search.params.type.type]=e.search.params.input),e.search.params.start_time?e.params.start_time=e.search.params.start_time:e.params.start_time="",e.search.params.end_time?e.params.end_time=e.search.params.end_time:e.params.end_time="",e.search.params.piao_stock?e.params.piao_stock=e.search.params.piao_stock:e.params.piao_stock="",e.search.params.piao_onsale&&(e.params.piao_onsale=e.search.params.piao_onsale.id)}c.set({page:e.paginationConf.currentPage,search:e.search},"GoodsAuction"),n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.goods=t.data}),d=!1};if(e.$watch("paginationConf.currentPage",p),"1"==t.callback){d=!0;var u=c.get("GoodsAuction");e.search=u&&u.search?u.search:{},e.paginationConf={itemsPerPage:l,currentPage:u?u.page:1}}else e.paginationConf={itemsPerPage:l,currentPage:1},e.search={};e.setGoodsTpl=function(){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/goods_tpl.html",controller:"shop.goods.tpl",resolve:{selectedIds:function(){return e.selectedIds}}});t.result.then(function(){e.goods.checkedAll=!1})},e.setProductStock=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/goods/templates/stock_tpl.html",controller:"shop.stock.tpl",resolve:{goodsId:function(){return e}}});t.result.then(function(){p()})},e.showQrcode=function(t){n.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){o.close(),s.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/ticket/controllers/auction.comments.add",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.auction.comments.add",["$scope","Flash","$location","setComments","$timeout","$stateParams","goodsPropsList",function(e,t,a,o,s,n,r){e.access=!1,e.param={content:"好评，非常棒！！！"},e.images={},o.get({id:a.search().id},function(t){e.virtual_info=t}),r.get({id:a.search().id},function(t){e.goods_info=t}),e.selectPorps=function(e,t){$(".props-list[data-id="+e+"] button").each(function(e){$(this).css({"border-color":"#ccc"}),$(this).removeClass("select")}),$(".btn-props[data-id="+t+"]").css({"border-color":"#FB5300",background:"#fff"}),$(".btn-props[data-id="+t+"]").addClass("select")},e.setTextarea=function(){"好评，非常棒！！！"==e.param.content&&(e.param.content="")},e.backTextarea=function(){e.param.content||(e.param.content="好评，非常棒！！！"),e.param.content.length>200&&(t.create("danger","评论内容不能超过200字！"),e.param.content=e.param.content.substr(0,200))},e.star=function(t){e.param.score=t;var a=angular.element(document.getElementById("showb"));a.css({width:24*t})},e.star(5),e.submitForm=function(){e.param.images=[];for(var n in e.images)e.param.images.push(e.images[n]);if(e.param.id=a.search().id,e.param.add="add",!e.selected)return void t.create("danger"," 请选择虚拟人物");e.param.nick_id=e.selected.id;var r=[],i=[];for(prop in e.goods_info.props)i.push(prop);if(1==e.goods_info.is_sku&&$("button.select").length<i.length)return void t.create("danger"," 请选择商品属性");if($("button.select").each(function(e){r.push($(this).text())}),e.param.props=r.join(":"),e.param.is_sku=e.goods_info.is_sku,!e.param.created_at)return void t.create("danger","请选择评论时间");var c=new Date(e.param.created_at).getTime(),l=(new Date).getTime();return c>l?(t.create("danger","评论时间应早于当前时间"),void $("input[name=created_at]").focus()):(e.access=!0,void o.post(e.param,function(o){o.status?(t.create("success"," 保存成功！"),s(function(){a.path("/shop/ticket/auction")},1500)):(t.create("danger"," 保存失败！"),e.access=!1)},function(a){t.create("danger"," 保存失败！"),e.access=!1}))}}])}),define("apps/ticket/controllers/auction.comments.edit",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.auction.comments.edit",["$scope","Flash","$location","setComments","$timeout","$stateParams","goodsPropsList","goodsCommentsList","updateCommentsList","$state",function(e,t,a,o,s,n,r,i,c,l){var d,p=a.search();e.access=!1,e.param={},e.selectPorps=function(e,t){$(".props-list[data-id="+e+"] button").each(function(e){$(this).css({"border-color":"#ccc"}),$(this).removeClass("select")}),$(".btn-props[data-id="+t+"]").css({"border-color":"#FB5300",background:"#fff"}),$(".btn-props[data-id="+t+"]").addClass("select")},e.backTextarea=function(){e.param.content||(e.param.content="好评，非常棒！！！"),e.param.content.length>200&&(t.create("danger","评论内容不能超过200字！"),e.param.content=e.param.content.substr(0,200))},e.star=function(t){e.param.score=t;var a=angular.element(document.getElementById("showb"));a.css({width:24*t})},r.get({id:p.goodsid},function(t){e.goods_info=t,i.get({id:p.id,goodsid:p.goodsid},function(t){d=t.data.member,e.param.content=t.data[0].content,e.param.created_at=t.data[0].created_at,e.param.image=[],e.star(t.data[0].score);for(var a=t.data[0].props,s=a.split(":"),n=0;n<s.length;n++)$(".props-list[data-num="+n+"] button").each(function(e){$(this).text()==s[n]&&$(this).addClass("select").css({"border-color":"#FB5300",background:"#fff"})});for(var n=0;n<t.img.length;n++)e.param.image.push(t.img[n]);o.get({id:p.goodsid},function(t){e.virtual_info=t;for(var a=0;a<t.virtual.length;a++)t.virtual[a].id==d.id&&(e.selected=t.virtual[a])})})}),e.submitForm=function(){e.param.id=p.id,e.param.goodsid=p.goodsid,e.param.edit="edit",e.param.nick_id=e.selected.id;var a=[];$("button.select").each(function(e){a.push($(this).text())}),e.param.props=a.join(":");var o=new Date(e.param.created_at).getTime(),n=(new Date).getTime();return o>n?(t.create("danger","评论时间应早于当前时间"),void $("input[name=created_at]").focus()):(e.access=!0,void c.put(e.param,function(a){a.status?(t.create("success"," 保存成功！"),s(function(){history.go(-1)},1500)):(t.create("danger"," 保存失败！"),e.access=!1)},function(a){t.create("danger"," 保存失败！"),e.access=!1}))}}])}),define("apps/ticket/controllers/form",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.form",["$location","$scope","$stateParams","$compile","$state","Flash","$modal","ngPopover","TicketData","shopServerData","propResource","propValueResource","tagResource","goodsResource","designData","designGoodsRes","$timeout","designValidate","ticketCat","thirdParty","ticketStore",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m,g,f,h,_,v,y,b){function k(e){var a=new BMap.Geocoder;a.getPoint(e,function(e){e?(w.goodsData.piao_goods.position_lon=e.lng,w.goodsData.piao_goods.position_lat=e.lat,I.centerAndZoom(e,16),j=new BMap.Marker(e),j.enableDragging(),I.clearOverlays(),I.addOverlay(j),T(j)):n.create("danger","您选择地址没有解析到结果!")},t.cityname)}var P=l.get();P.then(function(e){t.shopServerData=e});var w=t.vm={},D=a.step;w.cates=[],w.activeTab=D,t.isGetProp=!1,t.isShow=!1,t.isVirtual=!1,w.goodsData=c;var C=t.city={start:"province",end:"district"};if(C.regions={country:1},angular.isDefined(a.id))if(w.is_edit=!!a.id,w.goodsData.isStep){if("2"==D){C.regions.province=w.goodsData.piao_goods.province,C.regions.city=w.goodsData.piao_goods.city,C.regions.district=w.goodsData.piao_goods.district;var x=$("#cityChoose");x.html("<div city-select ng-model='city'></td>"),o(x)(t)}}else angular.forEach(c.init(),function(e,t){w.goodsData[t]=e}),m.get({id:a.id},function(e){t.cateData={},t.cateData.mall_category_id=e.mall_category_id,t.cateData.mall_cat_name=e.mall_cat_name,w.goodsData.cate[0]={},w.goodsData.cate[0].data={},w.goodsData.isCateSelect=!0,w.goodsData.cate[0].data.id=e.goods_cat_id,w.goodsData.goods_cat_id=e.goods_cat_id,w.goodsData.cat_name=e.cat_name,w.goodsData.cate[0].data.is_virtual=e.is_virtual,w.goodsData.cate[0].data.name=e.cat_name,w.goodsData.piao_product=e.piao_product;var a=[],s=[],n=[];angular.forEach(e.products,function(e,t){n.push(e.stock),a.push(e.props_str.replace(/:/,"+")),s=e.props.split(";")[1].split(":"),w.goodsData.ticketSkus.checkedTicketSpeciesID.push(Number(s[1]))});var r=[];angular.forEach(w.goodsData.piao_product,function(e,t){
r.push(e),e.stock=n[t]}),angular.forEach(a,function(e,t){w.goodsData.ticketSkus.totalDatas[e]=r[t]}),t.isGetProp||t.getProp();var i=t.$watch("vm.goodsData.prop",function(t,a){t.length>0&&(i(),angular.forEach(e.props,function(e,t){for(var a in w.goodsData.prop){var o=w.goodsData.prop[a];if(e.id==o.id)return w.goodsData.props[a]={id:e.prop_vid,merchant_id:e.merchant_id,prop_id:e.id,value:e.prop_value},!1}}))},!0);w.goodsData.title=e.title,angular.forEach(e.imgs,function(e,t){w.goodsData.imgs[t]={id:e.id,url:e.img}}),w.goodsData.selectedGoodsTags=angular.copy(e.tags),3==e.piao_goods.is_charge_off&&(w.goodsData.selectStores=angular.copy(e.piao_goods.charge_off)),w.goodsData.serve_label=e.serve_label,w.goodsData.label_ids=e.label_ids;for(var c=0;c<e.label_ids.length;c++)for(var l=0;l<t.shopServerData.length;l++)e.label_ids[c]==t.shopServerData[l].id&&(t.shopServerData[l].checked=!0);if(w.goodsData.is_sku=e.is_sku,w.goodsData.is_discount=e.is_discount||0,w.goodsData.goods_sn=e.goods_sn,w.goodsData.barcode=e.barcode,w.goodsData.is_virtual=e.is_virtual,w.goodsData.virtual_card_type=e.virtual_card_type,w.goodsData.is_autosend=e.is_autosend,w.goodsData.is_verify_card=e.is_verify_card,e.is_sku){var d=e.products[0].props.split(";").length,p=[];w.goodsData.skuStock[d]={},angular.forEach(e.products,function(e,t){var a=e.props;w.goodsData.skuStock[d][a]={id:e.id,img:e.img,price:e.price,stock:e.stock,product_sn:e.product_sn,barcode:e.barcode},w.goodsData.piaoID[a]={id:e.id},w.goodsData.skuStock[d][a].str=e.porps_str;var o="";angular.forEach(a.split(";"),function(e,t){o+=e.split(":").join("")}),w.goodsData.skuStock[d][a].sn=o,p.push(e.props)});var u=p.join(";")+";",m=[],g=t.$watch("vm.goodsData.skus",function(e,t){e.length>0&&g(),angular.forEach(w.goodsData.skus[1],function(e,t){m=[],angular.forEach(e.prop_values,function(t,a){u.indexOf(e.id+":"+t.id+";")!=-1&&(t.checked=!0,m.push(t))}),m.length>0&&w.goodsData.skuData.push(m)})},!0)}else w.goodsData.price=e.price,w.goodsData.stock=e.stock,w.goodsData.old_stock=e.stock;w.goodsData.old_products=e.products,w.goodsData.old_props=e.props,w.goodsData.original_price=e.original_price,w.goodsData.stockType=e.stock_type,angular.forEach(e.collect_fields,function(e,t){w.goodsData.collect_fields.push({name:e.name,type:e.type,multiple:!!e.multiple,required:!!e.required})}),w.goodsData.intro=e.intro,w.goodsData.components_data=e.components_data,w.goodsData.designGoodsTpl=e.design_goods_id,w.goodsData.onsale_type=e.onsale_type,w.goodsData.onsale_type&&(w.goodsData.onsale_at=e.onsale_at),w.goodsData.cquota=e.cquota,w.goodsData.base_csale=e.base_csale,w.goodsData.isConfirmLocation=!0,w.goodsData.piao_goods=e.piao_goods,t.city.regions.province=e.piao_goods.province,t.city.regions.city=e.piao_goods.city,t.city.regions.district=e.piao_goods.district;var f=$("#cityChoose");f.html("<div city-select ng-model='city'></td>"),o(f)(t);var h=new BMap.Map("baiduMap");h.centerAndZoom(new BMap.Point(116.404,39.915),16),h.addControl(new BMap.NavigationControl),h.enableScrollWheelZoom(!0);var _=new BMap.Point(w.goodsData.piao_goods.position_lon,w.goodsData.piao_goods.position_lat);h.centerAndZoom(_,16);var v=new BMap.Marker(_);v.enableDragging(),h.addOverlay(v)},function(e){});else w.goodsData.isStep?"2"==D&&(C.regions.province=w.goodsData.piao_goods.province,C.regions.city=w.goodsData.piao_goods.city,C.regions.district=w.goodsData.piao_goods.district):(angular.forEach(c.init(),function(e,t){w.goodsData[t]=e}),w.goodsData.piao_goods.position_lon=116.404,w.goodsData.piao_goods.position_lat=39.915);t.$watch("city",function(e){angular.isUndefined(e.selected)||(e.selected.length>2&&(t.cityname=e.selected[1].name,w.goodsData.piao_goods.province=e.selected[0].id,w.goodsData.piao_goods.city=e.selected[1].id,w.goodsData.piao_goods.district=e.selected[2].id),t.selected_city=e.selected)},!0);var I=new BMap.Map("baiduMap");I.centerAndZoom(new BMap.Point(116.404,39.915),16),I.addControl(new BMap.NavigationControl),I.enableScrollWheelZoom(!0);var S=new BMap.Point(w.goodsData.piao_goods.position_lon,w.goodsData.piao_goods.position_lat);I.centerAndZoom(S,16);var j=new BMap.Marker(S);j.enableDragging(),I.addOverlay(j);var T=function(e){e.addEventListener("dragend",function(t){var a=e.getPosition();w.goodsData.piao_goods.position_lon=a.lng,w.goodsData.piao_goods.position_lat=a.lat})};switch(T(j),t.searchAddress=function(){if(w.goodsData.isConfirmLocation=!0,angular.isUndefined(t.cityname))return n.create("danger","请先选择城市"),!1;if(angular.isUndefined(w.goodsData.piao_goods.address)||""==w.goodsData.piao_goods.address)return n.create("danger","请输入地址"),!1;var e=t.selected_city[1].name+t.selected_city[2].name+w.goodsData.piao_goods.address;k(e)},w.goodsData.isStep=!1,w.click={addProp:!1,addPropValue:!1,addSku:!1,editSku:!1},w.collectFieldsFormat=[{name:"text",title:"单行文本"},{name:"multipleText",title:"多行文本"},{name:"tel",title:"数字格式"},{name:"email",title:"邮件格式"},{name:"date",title:"日期"},{name:"time",title:"时间"},{name:"id_no",title:"身份证号码"}],t.shopServerClick=function(e){var t=w.goodsData.label_ids.indexOf(e.id);t>-1?(w.goodsData.label_ids.splice(t,1),e.checked=!1):(w.goodsData.label_ids.push(e.id),e.checked=!0)},t.ngPopoverClose=function(){i.close()},t.nextStep=function(e){switch(w.goodsData.isStep=!0,e){case 2:angular.isDefined(a.id)?s.go("shop.ticket.edit.step",{id:a.id,step:e}):(s.go("shop.ticket.add.step",{step:e}),t.isVirtual=!0);break;case 3:t.saveValidity(2)&&(angular.isDefined(a.id)?s.go("shop.ticket.edit.step",{id:a.id,step:e}):s.go("shop.ticket.add.step",{step:e}))}},t.isThirdParty=function(){y.get({},function(e){e.status?w.goodsData.ticketSkus.totalDatas!={}&&angular.forEach(w.goodsData.ticketSkus.totalDatas,function(e,t){e.is_travel=1}):w.goodsData.piao_goods.is_third_api=0})},t.getProp=function(){t.isGetProp=!0,d.get({goods_cat_id:w.goodsData.goods_cat_id},function(e,t){if(Object.keys(e).length>2)for(var a=0;a<Object.keys(e).length-2;a++)0==e[a].type?w.goodsData.prop.push(e[a]):w.goodsData.skus.push(e[a]);w.goodsData.ticketSkus.checkedTicketSpeciesID.length>0&&angular.forEach(w.goodsData.skus[1].prop_values,function(e,t){w.goodsData.ticketSkus.checkedTicketSpeciesID.indexOf(e.id)!=-1&&(e.checked=!0)})})},t.showAdd=function(e){$(".input-"+e+"-name").val(""),w.showValue[e]=!w.showValue[e]},t.addProp=function(e){var t=$.trim($("#input-addProp-name").val()),a=$.trim($("#input-addProp-value").val());""!=t?""!=a?(w.click.addProp=!0,$(e.currentTarget).addClass("btn-submiting-sm"),d.save({name:t,input_value:a,goods_cat_id:w.goodsData.goods_cat_id,type:0},function(t){n.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),t.inputValues=t.input_values,t.input_values=[],t.input_values.push(t.inputValues),c.prop.push(t),w.goodsData.prop=c.prop,w.goodsData.props[w.goodsData.prop.length-1]=t.inputValues,w.showValue.addProp=!1,w.click.addProp=!1},function(e){n.create("danger",e.data.error.message),w.click.addProp=!1})):n.create("warning","请填写属性值"):n.create("warning","请填写属性名称")},t.deleteProp=function(){w.deletePropID?d.delete({id:w.deletePropID},function(e){if(e.success){n.create("success","删除成功"),w.goodsData.prop.splice(w.deletePropIndex,1);for(var a=w.deletePropIndex+1;a<w.goodsData.prop.length+1;a++)w.goodsData.props[a]&&(w.goodsData.props[a-1]=w.goodsData.props[a]);t.ngPopoverClose()}else n.create("danger","删除失败")},function(e){n.create("danger",e.data.error.message)}):n.create("warning","无法获取到属性ID")},t.addPropValue=function(e){var a=$.trim($("#input-addProp-name-pop").val());""!=a?w.addPropValueID?($(e.currentTarget).addClass("btn-submiting-sm"),w.click.addPropValue=!0,p.save({value:a,prop_id:w.addPropValueID},function(e){w.goodsData.prop[w.addPropValueIndex].input_values.push(e),w.goodsData.props[w.addPropValueIndex]=e,t.ngPopoverClose(),w.click.addPropValue=!1},function(e){n.create("danger",e.data.error.message),w.click.addPropValue=!1})):n.create("warning","无法获取到属性ID"):n.create("warning","请填写属性值内容")},t.deletePropValue=function(e,t,a){t.stopPropagation(),p.delete({id:e},function(t){t.success?angular.forEach(w.goodsData.prop,function(t,o){if(t.id==a)return angular.forEach(t.input_values,function(t,a){if(t.id==e)return w.goodsData.prop[o].input_values.splice(a,1),"undefined"!=typeof w.goodsData.props[o]&&w.goodsData.props[o].id==e&&delete w.goodsData.props[o],!1}),!1}):n.create("danger","删除失败")},function(e){n.create("danger",e.data.error.message)})},t.getTags=function(){u.get({},function(e){e._count>0?angular.forEach(e.data,function(e,t){c.tags.push(e)}):c.tags=[],w.goodsData.tags=c.tags},function(e){n.create("danger",e.data.error.message)})},t.addTag=function(){var e=$.trim($("#input-addTag-name-pop").val());""!=e?u.save({name:e},function(e){n.create("success","操作成功"),w.goodsData.tags.push(e),w.goodsData.selectedGoodsTags.push(e),t.ngPopoverClose()},function(e){n.create("danger",e.data.error.message)}):n.create("warning","请填写分组名称")},t.getStores=function(){b.get({},function(e){e._count>0?angular.forEach(e.data,function(e,t){c.stores.push(e)}):c.stores=[],w.goodsData.stores=c.stores},function(e){})},t.openEditSku=function(e){w.skuEditTemp[e]=jQuery.extend(!0,{},w.goodsData.skus[e])},t.editAddTempSkuValue=function(e,t,a){if(a&&13!=t.keyCode)return!1;var o=$.trim($("#input-editAddSku-value-"+e).val()),s=!1;""!=o?(angular.forEach(w.skuEditTemp[e].prop_values,function(e,t){if(e.name==o)return s=!0,!1}),s?n.create("danger","输入的规格值已存在"):(w.skuEditTemp[e].prop_values.push({name:o}),$("#input-editAddSku-value-"+e).val(""))):n.create("warning","规格值名称不能为空")},t.deleteEditTempSkuValue=function(e,t){var a=$(t.currentTarget).parent("label").data("pid");w.skuEditTemp[a].prop_values[e].id&&(w.skuEditTemp[a].is_del=w.skuEditTemp[a].is_del?++w.skuEditTemp[a].is_del:1),w.skuEditTemp[a].prop_values.splice(e,1)},t.editSku=function(e,t){var a="";if(a=0!=w.skuEditTemp[t].merchant_id?w.skuEditTemp[t].name=$.trim($("#input-editSku-name-"+w.skuEditTemp[t].id).val()):w.skuEditTemp[t].name,w.skuEditTemp[t].is_del){var o=Utils.confirm("您删除的已有属性值将可能影响到店铺中的其他商品规格");if(!o)return}$(e.currentTarget).addClass("btn-submiting-sm"),w.click.editSku=!0,d.update({id:w.skuEditTemp[t].id,name:a,prop_values:w.skuEditTemp[t].prop_values},function(o){o.success?(n.create("success","操作成功"),$(e.currentTarget).removeClass("btn-submiting-sm"),w.showValue.editSku[t]=!1,w.goodsData.skus[t].name=a,angular.forEach(o.data,function(e,a){angular.forEach(w.goodsData.skus[t].prop_values,function(t,a){e.id==t.id&&t.checked&&(e.checked=!0)})}),w.goodsData.skus[t].prop_values=o.data):n.create("danger",o.error),w.click.editSku=!1},function(e){n.create("danger",e.data.error.message),w.click.editSku=!1})},t.ticketSkus={ticketTypes:[],ticketSpecies:[],totalNames:[],totalDatas:{},checkedNames:[],checkedNamesID:{},currentTicket:{name:"",data:{}}},t.setTicketActive=function(e){t.form;return t.ticketSkus.currentTicket.name!==e&&(!!t.ticketSkuInValid(t.ticketSkus.currentTicket.name)&&(t.ticketSkus.currentTicket.name=e,void(t.settingStatus="basic")))},t.ticketSkuInValid=function(e){var a=t.form,o=w.goodsData.ticketSkus.totalDatas[e];if(!o.travel_human_num)return a.travelPerson.$dirty=!0,$("input[name='travelPerson']").focus(),n.create("danger","请设置"+e+"门票对应人数数量"),!1;if(!o.stock)return a.ticketStock.$dirty=!0,$("input[name='ticketStock']").focus(),n.create("danger","请设置"+e+"库存"),!1;if(w.goodsData.piao_goods.is_third_api&&!o.goods_code)return a.ticketNumber.$dirty=!0,$("input[name='ticketNumber']").focus(),n.create("danger","请设置"+e+"商品编码"),!1;if(!o.is_travel&&!o.price[0].price)return a.ticket_noNeed.$dirty=!0,$("input[name='ticket_noNeed']").focus(),n.create("danger","请设置"+e+"门票价格"),!1;for(var s=!1,r=0;r<o.price.length;r++){if(o.is_travel){var i="start_at"+r,c="end_at"+r;if(!o.price[r].price){var l="ticket_price"+r;a[l].$dirty=!0,$("input[name='"+l+"']").focus(),s=!0,n.create("danger","请设置"+e+"门票价格");break}}else var i="start_at_"+r,c="end_at_"+r;if(!o.price[r].start_date){a[i].$dirty=!0,$("input[name='"+i+"']").focus(),s=!0,n.create("danger","请设置"+e+"开始日期");break}if(!o.price[r].end_date){a[c].$dirty=!0,$("input[name='"+c+"']").focus(),s=!0,n.create("danger","请设置"+e+"结束日期");break}if(o.price[r].end_date<o.price[r].start_date){$("input[name='"+c+"']").focus(),s=!0,n.create("danger",e+"的结束日期不能小于开始日期");break}}return!s&&(o.is_travel&&!o.show_date?(a.monthLimit.$dirty=!0,$("input[name='monthLimit']").focus(),n.create("danger","请填写"+e+"门票显示限制"),!1):2!=o.refund||o.refund_percentage?!!o.notice||(a.reserveDescription.$dirty=!0,$("textarea[name='reserveDescription']").focus(),n.create("danger","请填写"+e+"预订须知"),!1):(a.refundPercentage.$dirty=!0,$("input[name='refundPercentage']").focus(),n.create("danger","请填写"+e+"退款比例"),!1))},t.setSettingActive=function(e,a){return t.settingStatus!==e&&void(t.settingStatus=e)},t.addValidityDate=function(e){e.push({start_date:"",end_date:"",price:""})},t.deleteValidityDate=function(e,t){e.splice(t,1)},t.reducingCurrentPrice=function(e){e.price=[{start_date:"",end_date:"",price:""}],e.show_date=1},t.$watch("vm.goodsData.skus",function(e,a){if(e.length>0&&2==D){var o={is_travel_human:0,travel_human_num:"",stock:"",goods_code:"",is_travel:1,price:[{start_date:"",end_date:"",price:""}],show_date:1,refund:1,refund_percentage:"",notice:""};t.ticketSkus.ticketTypes=w.goodsData.skus[0].prop_values,t.ticketSkus.ticketSpecies=w.goodsData.skus[1].prop_values,t.ticketSkus.checkedNames=[],w.goodsData.checkedProps_str=[],t.ticketSkus.checkedNamesID={},w.goodsData.ticketSkus.checkedTicketSpeciesID=[],w.goodsData.skuData[0]=[w.goodsData.skus[0].prop_values[0]],w.goodsData.skuData[1]=[],angular.forEach(t.ticketSkus.ticketTypes,function(e,a){angular.forEach(t.ticketSkus.ticketSpecies,function(a,s){a.checked&&(t.ticketSkus.checkedNames.push(e.name+"+"+a.name),w.goodsData.checkedProps_str.push(e.name+":"+a.name),t.ticketSkus.checkedNamesID[e.name+"+"+a.name]=e.prop_id+":"+e.id+";"+a.prop_id+":"+a.id,w.goodsData.ticketSkus.checkedTicketSpeciesID.push(a.id),w.goodsData.skuData[1].push(t.ticketSkus.ticketSpecies[s])),t.ticketSkus.totalNames.indexOf(e.name+"+"+a.name)==-1&&(t.ticketSkus.totalNames.push(e.name+"+"+a.name),angular.isUndefined(w.goodsData.ticketSkus.totalDatas[e.name+"+"+a.name])&&(w.goodsData.ticketSkus.totalDatas[e.name+"+"+a.name]=angular.copy(o)))})}),t.ticketSkus.checkedNames.length&&(t.ticketSkus.currentTicket.name&&t.ticketSkus.checkedNames.indexOf(t.ticketSkus.currentTicket.name)!=-1||(t.settingStatus="basic",t.ticketSkus.currentTicket.name=t.ticketSkus.checkedNames[0]),w.goodsData.piao_product={},angular.forEach(t.ticketSkus.checkedNames,function(e,a){w.goodsData.piao_product[t.ticketSkus.checkedNamesID[e]]=w.goodsData.ticketSkus.totalDatas[e]})),angular.forEach(w.goodsData.skuStock[w.goodsData.skuData.length],function(e,t){e.checked=!1})}},!0),t.addCollectFields=function(){var e={name:"",type:"text",multiple:!1,required:!0};w.goodsData.collect_fields.push(e)},t.deleteCollectFields=function(e){w.goodsData.collect_fields.splice(e,1)},t.save=function(){var e=[],o={};w.goodsData.products=w.goodsData.skuStock[w.goodsData.skuData.length],angular.forEach(w.goodsData.props,function(t,a){o={prop_id:t.prop_id,prop_vid:t.id,prop_value:t.value},e.push(o)}),angular.forEach(w.goodsData.skuData,function(t,a){angular.forEach(t,function(t,a){o={prop_id:t.prop_id,prop_vid:t.id,prop_value:t.name},e.push(o)})});var r={barcode:w.goodsData.barcode||"",goods_cat_id:w.goodsData.goods_cat_id,mall_category_id:w.goodsData.mall_category_id,goods_sn:w.goodsData.goods_sn||"",img:w.goodsData.imgs[0].url,imgs:w.goodsData.imgs,tags:[],postage:w.goodsData.postage||0,original_price:w.goodsData.original_price||0,price:w.goodsData.price||0,serve_label:w.goodsData.serve_label,label_ids:w.goodsData.label_ids,is_sku:w.goodsData.is_sku,is_discount:w.goodsData.is_discount,region_ids:w.goodsData.noDeliveryArea.region_ids,products:{},props:e,shipment_id:null!=w.goodsData.shipment?w.goodsData.shipment.id:0,stock:w.goodsData.stock||0,stock_type:w.goodsData.stockType,title:w.goodsData.title,volume:w.goodsData.volume||0,weight:w.goodsData.weight||0,intro:w.goodsData.intro,design_goods_id:w.goodsData.designGoodsTpl,onsale_type:w.goodsData.onsale_type,cquota:w.goodsData.cquota,base_csale:w.goodsData.base_csale,is_virtual:0,virtual_card_type:w.goodsData.virtual_card_type,is_autosend:w.goodsData.is_autosend,is_verify_card:w.goodsData.is_verify_card,piao_goods:w.goodsData.piao_goods,old_products:w.goodsData.old_products,old_props:w.goodsData.old_props,old_stock:w.goodsData.old_stock};r.piao_product=angular.copy(w.goodsData.piao_product),r.component_data=[];var i=angular.copy(t.slices);for(var c in i){var l=_[i[c].type](i[c].content);if(l)return t.editSlice(i[c],l),!1}if(angular.forEach(i,function(e,t){"goods_head"!=e.type&&r.component_data.push({type:e.type,content:e.content||""})}),w.goodsData.checkedProps_str.length>0){var d=0;angular.forEach(w.goodsData.piao_product,function(e,t){r.products[t]={id:w.goodsData.piaoID[t]?w.goodsData.piaoID[t].id:0,img:"",price:e.price[0].price,stock:e.stock,props_str:w.goodsData.checkedProps_str[d],product_sn:"",barcode:""},d++})}$.isEmptyObject(r.piao_product)||angular.forEach(r.piao_product,function(e,t){delete e.stock,angular.forEach(e.price,function(t,a){t.start_date=t.start_date.substr(0,10),t.end_date=t.end_date.substr(0,10),e.is_travel||(t.price=e.price[0].price)})}),w.goodsData.collect_fields&&(r.collect_fields=[],angular.forEach(w.goodsData.collect_fields,function(e,t){r.collect_fields.push({name:e.name,type:e.type,required:e.required?1:0})})),w.goodsData.selectedGoodsTags.length>0&&angular.forEach(w.goodsData.selectedGoodsTags,function(e,t){r.tags.push(e.id)}),r.piao_goods.charge_off=[],!w.goodsData.piao_goods.is_third_api&&3==w.goodsData.piao_goods.is_charge_off&&w.goodsData.selectStores.length>0&&angular.forEach(w.goodsData.selectStores,function(e,t){r.piao_goods.charge_off.push(e.id)}),w.goodsData.shipmentType||(r.shipment_id=0),w.goodsData.onsale_type&&(r.onsale_at=w.goodsData.onsale_at),t.save.disabled=!0,angular.isDefined(a.id)?(r.id=a.id,m.update(r,function(e){e.error?(n.create("danger",e.error),t.save.disabled=!1):(n.create("success","保存成功"),s.go("shop.ticket."+a.type+".list",{callback:1}))},function(e){t.save.disabled=!1})):m.save(r,function(e){e.error?(n.create("danger",e.error),t.save.disabled=!1):(n.create("success","添加成功"),"0"==r.onsale_type?s.go("shop.ticket.auction.list"):s.go("shop.ticket.forsale.list"))},function(e){t.save.disabled=!1})},t.saveValidity=function(e){var a=t.form;if(2==e){if(a.goods_title.$invalid)return a.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(0==w.goodsData.imgs.length)return n.create("danger","请至少上传一张商品图片"),!1;if(w.goodsData.is_sku){var o=w.goodsData.skuData[1].length;if(0==o)return n.create("danger","请至少选择一个门票种类"),!1;for(var s=!0,r=0;r<t.ticketSkus.checkedNames.length;r++)if(!t.ticketSkuInValid(t.ticketSkus.checkedNames[r])){s=!1;break}if(!s)return!1}if(a.spot_name.$invalid)return a.spot_name.$dirty=!0,$("input[name='spot_name']").focus(),!1;if(angular.isUndefined(t.cityname))return n.create("danger","请选择城市"),!1;if(a.address.$invalid)return a.address.$dirty=!0,$("input[name='address']").focus(),!1;if(!w.goodsData.isConfirmLocation)return n.create("danger","请点击【地图定位】按钮进行精确定位"),!1;if(!w.goodsData.is_third_api){if(0==w.goodsData.stores.length)return n.create("danger","请前往门店管理添加门店"),!1;if(3==w.goodsData.piao_goods.is_charge_off&&0==w.goodsData.selectStores.length)return n.create("danger","请选择支持核销门店"),!1}if(w.goodsData.collect_fields){var i=!1;if(angular.forEach(w.goodsData.collect_fields,function(e,t){var o="collectFieldsName"+t;if(a[o].$invalid)return a[o].$dirty=!0,$('input[name="'+o+'"]').focus(),i=!0,!1}),i)return!1}if(1==w.goodsData.onsale_type&&("000-00-00 00:00:00"==w.goodsData.onsale_at||""==w.goodsData.onsale_at))return n.create("danger","请选择上架时间"),!1;if(a.base_csale.$invalid)return a.base_csale.$dirty=!0,$("input[name='base_csale']").focus(),!1}return!0},D){case"2":t.editorOptions={extraPlugins:"",height:"200px",toolbar:[],allowedContent:!0},w.goodsData.is_third_api=0,w.goodsData.tags=[],w.goodsData.stores=[],w.skuValueTemp=[],w.skuEditTemp=[],w.showValue={addProp:!1,addSku:!1,editSku:!1},w.skuSelectObject={},w.isSkuSelect=!1,w.skuType=0,angular.isUndefined(a.id)&&v.get({parent_id:0,type:2},function(e){w.goodsData.goods_cat_id=e.data[0].id,w.goodsData.cat_name=e.data[0].name,w.goodsData.is_virtual=e.data[0].is_virtual,w.goodsData.prop=[],w.goodsData.skus=[],w.goodsData.skuStock={},t.getProp()}),t.getTags(),t.getStores(),t.getNowFormatDate=function(){var e=new Date(new Date-864e5),t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},t.nowFormatDate=t.getNowFormatDate();break;case"3":t.save.disabled=!1,f.get({},function(e){w.designGoodsList=angular.copy(e.data),w.designGoodsList.unshift({id:0,title:"普通版"})}),t.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],t.$watch("vm.goodsData.components_data",function(e,a){if(e.length>0){t.slices=e,"goods_head"!=t.slices[0].type&&t.slices.unshift({type:"goods_head"});for(var o in t.slices)"goods_info"==t.slices[o].type&&(t.slices[o].class=!0,t.editSlice(t.slices[o]))}}),t.config={},t.icon_list=g.concat(),t.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,a){a.item.sortable.droptarget&&e.target!=a.item.sortable.droptarget[0]&&(t.icon_list=g.concat(),"mouseup"==e.handleObj.type&&t.editSlice(a.item.sortable.moved))}},t.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},t.goods_info=function(e){"goods_info"==e.type&&(t.design={type:"text"})},t.removeSlice=function(e){t.slices.splice(e,1),t.design=!1},t.editSlice=function(e,a){"goods_head"!=e.type&&(t.design=e,angular.forEach(t.slices,function(e,t){e.class=!1}),e.class=!0,h(function(){t.$broadcast("design_data",e),angular.isUndefined(a)||t.$broadcast("design_dirty",a)},200))},t.editSlice(t.slices[1])}}])}),define("apps/ticket/controllers/order_list",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.list",["$scope","order","ngPopover","saveDeliver","reviseprice","$stateParams","$modal","Flash","ticketOrderList","dateConstant","ticketVerificate",function(e,t,a,o,s,n,r,i,c,l,d){e.paginationConf={currentPage:1,itemsPerPage:10},e.limit={limit_from:0,limit_to:3e3},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",order_type:"0",is_third_api:"all"},e.searchParams={goods_name:"",payment_sn:"",buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",order_type:"0",is_third_api:"all"};var p={goods_name:"",order_no:"",buy_way:"all",type:"all",express_type:"all",user_name:"",feedback:"0",order_type:0,is_third_api:"all"};switch(n.type){case"tosend":e.tabs=1,e.params.type="tosend",e.searchParams.type="tosend";break;case"topay":e.tabs=1,e.params.type="topay",e.searchParams.type="topay";break;case"codpay":e.tabs=2,e.params.buy_way="codpay",e.searchParams.buy_way="codpay";break;case"selffetch":e.tabs=3,e.params.express_type="selffetch",e.searchParams.express_type="selffetch";break;case"peerpay":e.tabs=2,e.params.buy_way="peerpay",e.searchParams.buy_way="peerpay";break;case"feedback":e.tabs=4,e.params.feedback="all",e.searchParams.feedback="all";break;case"star":e.tabs=5,e.params.star="star",e.searchParams.star="star";break;default:e.tabs=1,e.params.type="all",e.searchParams.type="all"}e.type="all";var u=function(){if($('input[name="created_range"]').val()){var t=$('input[name="created_range"]').val(),a=t.split("/");e.params.startDate=a[0],e.params.endDate=a[1]}else e.params.startDate="",e.params.endDate="";if($('input[name="finish_range"]').val()){var o=$('input[name="finish_range"]').val(),s=o.split("/");e.params.startFinishDate=s[0],e.params.endFinishDate=s[1]}else e.params.startFinishDate="",e.params.endFinishDate="";e.type=e.params.type,e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,c.get(e.params,function(t){e.selectedIds=[],e.paginationConf.totalItems=t._count,e.isCustom=_global.shop.customs,e.data=t.data,$(".check-box").attr("checked",!1),m(),e.isSearch=!1},function(){e.isSearch=!1})},m=function(){e.isCustom?(e.opsRowSpan=3,e.headerRowSpan=9):(e.opsRowSpan=2,e.headerRowSpan=8)};e.saveCustom=function(a,o){t.postCustom({id:a.id},function(t){t.status?(e.data[o].custom_state=t.custom_state,e.data[o].custom_code=t.custom_code,i.create("success","报关成功")):i.create("danger","报关失败")})},e.getCustomStatus=function(a,o){t.resetCustom({id:a.id},function(t){t.status?(e.data[o].custom_state=t.custom_state,e.data[o].custom_code=t.custom_code,i.create("success","刷新成功,"+t.custom_state)):i.create("danger","刷新失败")})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",u),e.isSearch=!1,e.search=function(){e.isSearch=!0,angular.forEach(e.searchParams,function(t,a){e.params[a]=e.searchParams[a]}),1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:u()},e.formatnum=function(t){t=parseInt(t),t<0||!t&&0!=t?(e.limit.limit_from=0,i.create("danger","开始行数最小为0")):e.limit.limit_from=t},e.limitnum=function(t){t=parseInt(t),t<=0||t>3e3||!t?(i.create("danger","导出行数最小为1,最大为3000"),e.limit.limit_to=3e3):e.limit.limit_to=t},e.export=function(){if(e.selectedIds.length)var t=e.selectedIds.join(","),a="/piao/export?ids="+t+"&export=yes";else{var a="/piao/export?";if(angular.forEach(e.searchParams,function(e,t){e&&(a+=t+"="+e+"&")}),$('input[name="created_range"]').val()){var o=$('input[name="created_range"]').val(),s=o.split("/");a+="startDate="+s[0]+"&endDate="+s[1]}if($('input[name="finish_range"]').val()){var n=$('input[name="finish_range"]').val(),r=n.split("/");a+="&startFinishDate="+r[0]+"&endFinishDate="+r[1]}a+="&limit_from="+e.limit.limit_from+"&limit_to="+e.limit.limit_to+"&type="+e.params.type,a+="&export=yes"}window.location.href=a,i.create("success","正在导出,请等待...")};var g=function(t){angular.forEach(p,function(a,o){f(o,t)||(e.params[o]=a,e.searchParams[o]=a)})},f=function(e,t){var a=!1;for(var o in t)if(t[o]==e){a=!0;break}return a},h=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:u()};e.set_type=function(t){e.params.type=t,g(["type"]),h()},e.set_buy_way=function(t){e.params.buy_way="codpay",e.params.type=t,g(["type","buy_way"]),h()},e.set_express_type=function(t){e.params.express_type="selffetch",e.params.type=t,g(["type","express_type"]),h()},e.set_feedback=function(t){e.params.feedback=t,g(["feedback"]),h()},e.sort=function(t){"asc"==t?e.params.sort="desc":e.params.sort="asc",u()},e.ranges=l.ranges,e.set_star=function(e,a){e.star=a,t.setStar({id:e.id,star:a})},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a},e.isRemark=!1,e.set_remark=function(){e.isRemark=!0,e.remarkInfo.text?t.setRemarks({id:e.remarkInfo.id,memo:e.remarkInfo.text},function(t){t.status?(i.create("success","提交成功"),a.close(),e.data[e.remarkInfo.index].remarks=e.remarkInfo.text):i.create("danger","提交失败"),e.isRemark=!1},function(){e.isRemark=!1}):(i.create("danger","请填写备注"),e.isRemark=!1)},e.cancel=function(){a.close(),e.remarkInfo={id:"",text:""}},e.saveListDelivery=function(e,t){var a=r.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return e}}});a.result.then(function(e){e&&u()})},e.reviseListPrice=function(e,t){var a=r.open({animation:!1,templateUrl:"assets/js/apps/ticket/templates/order.reviseprice.html",controller:"ticketRevisePrice",resolve:{data:function(){return e}}});a.result.then(function(t){t&&(e.goodslist=t.data.goodslist,e.amount=t.data.amount,e.shipment_fee=0)})},e.checkedAll=!1,e.selectedIds=[],e.$watch("checkedAll",function(t){t?e.selectedIds=e.data.map(function(e){return e.id}):e.selectedIds=[]}),e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.print_waybill=function(){r.open({animation:!1,templateUrl:"assets/js/apps/order/templates/choose_waybill_tpl.html",controller:"printWaybillCtrl",resolve:{order_ids:function(){return e.selectedIds}}})},e.printDevivery=function(){var t=$("#print_order_form"),a=e.selectedIds.join(",");$("#print_order_form input[name='ids']").val(a),t.submit()},e.ticketVerification={btn_text:"保存",ticket_code:"",isSaving:!1},e.cancelPopover=function(){a.close()},e.getOrderId=function(t){e.ticketID=t},e.checkTicket=function(t){$(t.currentTarget).addClass("btn-submiting-sm"),e.ticketVerification.isSaving=!0,d.put({id:e.ticketID},{type:"all",charge_off_code:e.ticketVerification.ticket_code},function(a){a.status?(i.create("success","核销成功"),e.cancelPopover(),u()):i.create("danger",a.msg),e.ticketVerification.isSaving=!1,$(t.currentTarget).removeClass("btn-submiting-sm")},function(a){e.ticketVerification.isSaving=!1,$(t.currentTarget).removeClass("btn-submiting-sm")})}}]),e.controller("printWaybillCtrl",["$scope","$modalInstance","order_ids","waybillResource","Flash",function(e,t,a,o,s){e.order_ids=a.join(","),e.myWaybills=0,o.get(function(t){e.waybills=t.data,e.waybills.unshift({id:0,name:"请选择"})}),e.px2mm=function(e){$("body").append("<div id='mm2px' style='width:1mm;height:1mm;display:none;'></div>");var t={};return t[0]=e/$("#mm2px").width(),t[1]=e/$("#mm2px").height(),$("#inch2px").remove(),t},e.pixels=JSON.stringify(e.px2mm(1)),e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ticket/controllers/verification",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.verification",["$scope","$state","Flash","ticketOrderLog","ticketStore","dateConstant",function(e,t,a,o,s,n){s.get({},function(t){e.stores=t.data},function(e){a.create("danger",e.data.error.message)}),e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,order_sn:"",charge_off_code:"",store_id:"",operate_username:"",charge_off_type:"all",status:"all",start_date:"",end_date:""};var r=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,o.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.isSearch=!1},function(t){e.data=[],a.create("danger",t.data.error),e.isSearch=!1})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.isSearch=!1,e.search=function(){e.isSearch=!0;var t=$('input[name="created_range"]').val();""!=t?(e.searchInfo.dates=null,t=t.split("/"),e.searchInfo.start_date=t[0],e.searchInfo.end_date=t[1]):(e.searchInfo.start_date="",e.searchInfo.end_date=""),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.ranges=n.ranges}])}),define("apps/ticket/controllers/third_party_setting",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.thirdParty",["$scope","Flash","thirdParty",function(e,t,a){e.btn_text="保存",e.third_info={},a.get(function(t){t.status&&(e.third_info={username:t.data.username,corp_code:t.data.corp_code,key:t.data.key})},function(e){}),e.submitForm=function(o){o&&(e.btn_text="保存中...",e.form.$invalid=!0,a.save({},e.third_info,function(a){e.btn_text="保存",a.status?t.create("success"," 保存成功！"):(t.create("danger"," 保存失败！"),e.form.$invalid=!1)},function(a){e.btn_text="保存",e.form.$invalid=!1,t.create("danger",a.data.error.message)}))}}])}),define("apps/ticket/controllers/ticket_layout",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.layout",["$scope","Flash","ticketTypeData","$state",function(e,t,a,o){e.releaseTicket=!1,e.isTicket=function(){e.releaseTicket=!0,
a.get({},function(a){e.releaseTicket=!1,a.status?o.go("shop.ticket.add.step",{step:2}):t.create("danger","发布景区门票失败")},function(){e.releaseTicket=!1})}}])}),define("apps/ticket/controllers/order.setprice",["apps/common/controllers/controllers"],function(e){e.controller("ticketRevisePrice",["$scope","$modalInstance","data","reviseprice","Flash",function(e,t,a,o,s){function n(){var t=e.modalData.goodslist,a=0,o=0,s=0;totalPrice=0;for(var n=0;n<t.length;n++)a+=void 0!=_global.shop.supplier_id?parseFloat(t[n].price)*parseFloat(t[n].original_quantity):parseFloat(t[n].price)*parseFloat(t[n].quantity),o+=parseFloat(t[n].shipcost),s+=parseFloat(t[n].favorable);o>=0?e.setPrice="+ "+o.toFixed(2):e.setPrice=" "+o.toFixed(2),totalPrice=a+o+parseFloat(e.modalData.shipment_fee)-s,e.costPrice=a.toFixed(2),e.favoPrice=s.toFixed(2),e.totalPrice=totalPrice.toFixed(2)}e.modalData=angular.copy(a);e.costPrice=0,e.setPrice=0,e.favoPrice=0,e.totalPrice=0;var r=/^([+-]?[0-9][\d]{0,3}|0)([.]?[\d]{1,2})?$/;n(),e.priceSet=function(e,t,a){r.test($(t.target).val())?n():(s.create("danger","请输入正确的价格"),$(t.target).focus())},e.but={text:"确定",status:!1},e.saverevisePrice=function(){for(var a={order_id:e.modalData.id,goods:[],shipment_fee:0},n=!0,r=e.modalData.goodslist,i=0;i<r.length;i++){var c=0;if(c=void 0!=_global.shop.supplier_id?parseFloat(r[i].price)*parseFloat(r[i].original_quantity)+parseFloat(r[i].shipcost)-parseFloat(r[i].favorable):parseFloat(r[i].price)*parseFloat(r[i].quantity)+parseFloat(r[i].shipcost)-parseFloat(r[i].favorable),c<0){n=!1,s.create("danger","单个商品总价不能小于0");break}var l={id:r[i].id,price:r[i].shipcost};a.goods.push(l)}n&&(e.but.text="提交中",e.but.status=!0,o.update(a,function(a){1==a.success?(s.create("success","修改成功"),t.close(a)):s.create("danger",a.error),e.but.text="确定",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ticket/controllers/detail",["apps/common/controllers/controllers"],function(e){e.controller("shop.ticket.detail",["$scope","order","saveDeliver","reviseprice","orderpick","$resource","$stateParams","$modal","$http","Flash","orderQureyPay","ngPopover","ticketVerificate",function(e,t,a,o,s,n,r,i,c,l,d,p,u){function m(t){switch(0==t.is_selffetch_type&&(e.orderType="cod"==t.payment_code?2:1,1==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="买家付款",e.step[1].at=t.pay_at,e.step[2].title="待核销",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at),2==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="货到付款",e.step[1].at=t.created_at,e.step[2].title="发货",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at),40==t.status?e.step[3].title="预计完成时间":50==t.status&&(e.step[3].title="订单完成")),1==t.is_selffetch_type&&(e.orderType="cod"==t.payment_code?4:3,3==e.orderType&&(e.step[0].at=t.created_at,e.step[1].title="买家付款",e.step[1].at=t.pay_at,e.step[2].title=1==t.is_virtual?"系统发货 ":"买家自提",e.step[2].at=t.shipments_at,e.step[3].at=t.finished_at,40==t.status&&(e.step[3].title="预计完成时间")),4==e.orderType&&(e.step[0].at=t.created_at,e.step[2].title="买家自提",e.step[2].at=t.finished_at,e.step[3].at=t.finished_at,40==t.status&&(e.step[3].title="预计完成时间"),e.step.splice(1,1))),e.isButShow={price:!1,address:!1,store:!1,delivery:!1,extend:!1,pick:!1,close:!1},t.status){case 10:e.orderStatus={title:"订单关闭",text:"自动过期;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"自动过期"};break;case 11:e.orderStatus={title:"订单关闭",text:"买家取消订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"买家取消订单"};break;case 12:e.orderStatus={title:"订单关闭",text:"订单关闭原因："+e.orderdetail.explain,style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"商家关闭订单"};break;case 13:e.orderStatus={title:"订单关闭",text:"维权完成关闭订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"维权完成关闭订单"};break;case 19:e.orderStatus={title:"买家已下单",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,e.isButShow.close=!0,e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 20:e.orderStatus={title:"待付款",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,e.isButShow.close=!0,e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 30:e.orderStatus={title:"审核中",text:"买家已付款，请尽快通过审核，否则买家有权申请退款;",style:"success",icon:"fa-clock-o",statusInfo:"审核中"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.price=!1,e.isButShow.pick=!1,e.isButShow.close=!1;break;case 31:e.orderStatus={title:"货到付款 待发货",text:"买家选择了货到付款，请尽快发货;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.close=!0,e.isButShow.price=!1,e.isButShow.pick=!1;break;case 32:e.orderStatus={title:"针对上门自提，待取货",text:"买家已选择上门自提，等待买家上门自提;",style:"success",icon:"fa-clock-o",statusInfo:"待买家上门自提"},e.step[0].type=!0,e.step[1].type=!0,1==t.is_selffetch_type?e.isButShow.pick=!0:e.isButShow.pick=!1,"cod"==t.payment_code?e.isButShow.close=!0:e.isButShow.close=!1,e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1;break;case 40:e.orderStatus={title:"买家待核销",text:"买家在超出门票规定使用期限有效期后，门票核销失效，订单自动完成关闭；",style:"success",icon:"fa-clock-o",statusInfo:"待核销"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type&&(e.step[2].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.extend=!0,e.isButShow.close=!1;break;case 50:e.orderStatus={title:"已完成",text:"交易成功",style:"success",icon:"fa-check-circle-o",statusInfo:"已完成"},e.step[0].type=!0,e.step[1].type=!0,e.step[2].type=!0,4!=e.orderType&&(e.step[3].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.close=!1}}var g=n("/order/:id.json",{id:"@id"},{});e.step=[{type:!1,title:"买家下单",at:""},{type:!1,title:"",at:""},{type:!1,title:"",at:""},{type:!1,title:"订单完成",at:""}],g.get({id:r.id},function(t){e.orderdetail=t,m(t)}),e.updateStore=function(e){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.store.html",controller:"updateStore",resolve:{data:function(){return e}}});a.result.then(function(a){t.setStore({order_id:e.id,store_id:a.id},function(t){t.success?(l.create("success","修改成功"),e.selffetch_store=angular.copy(a)):l.create("danger","修改失败")})})},e.reviseListPrice=function(t,a){var o=i.open({animation:!1,templateUrl:"assets/js/apps/ticket/templates/order.reviseprice.html",controller:"ticketRevisePrice",resolve:{data:function(){return t}}});o.result.then(function(a){a&&(e.orderdetail=a.data,m(t))})},e.revisePrice=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.reviseprice.html",controller:"revisePrice",resolve:{data:function(){return t}}});a.result.then(function(a){a&&(e.orderdetail=a.data,m(t))})},e.saveDelivery=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,messageList(),m(e.orderdetail))})},e.closeOrder=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.close.html",controller:"closeOrder",resolve:{data:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,m(e.orderdetail))})},e.orderPick=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.pick.html",controller:"orderPickCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,m(e.orderdetail))})},e.orderExtend=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.extend.html",controller:"orderExtendCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail.finished_at=t,m(e.orderdetail))})},e.ticketVerification={btn_text:"保存",ticket_code:"",isSaving:!1},e.cancelPopover=function(){p.close()},e.setType=function(t){e.checkType=t},e.checkTicket=function(t){$(t.currentTarget).addClass("btn-submiting-sm"),e.ticketVerification.isSaving=!0,u.put({id:e.orderdetail.id},{type:e.checkType,charge_off_code:e.ticketVerification.ticket_code},function(a){a.status?(l.create("success","核销成功"),e.cancelPopover(),e.orderdetail=a.data,m(a.data)):l.create("danger",a.msg),e.ticketVerification.isSaving=!1,$(t.currentTarget).removeClass("btn-submiting-sm")},function(a){e.ticketVerification.isSaving=!1,$(t.currentTarget).removeClass("btn-submiting-sm")})}}]),e.controller("orderPickCont",["$scope","$modalInstance","orderpick","id","Flash",function(e,t,a,o,s){e.but={text:"确定",status:!1},e.confirm=function(){e.but.text="提交中",e.but.status=!0,a.update({id:o},function(a){1==a.success?(s.create("success","设置成功"),t.close(a)):s.create("danger",a.error.msg),e.but.text="确定",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("orderExtendCont",["$scope","$modalInstance","order","id","Flash",function(e,t,a,o,s){e.but={text:"提交",status:!1},e.saveInfo={day:"3"},e.confirm=function(){e.but.text="提交中",e.but.status=!0,a.extend({id:o,day:e.saveInfo.day},function(a){1==a.success?(s.create("success","修改成功"),t.close(a.data)):s.create("danger",a.error),e.but.text="提交",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/ticket/controllers/_base",["apps/ticket/controllers/auction","apps/ticket/controllers/auction.comments.add","apps/ticket/controllers/auction.comments.edit","apps/ticket/controllers/form","apps/ticket/controllers/order_list","apps/ticket/controllers/verification","apps/ticket/controllers/third_party_setting","apps/ticket/controllers/ticket_layout","apps/ticket/controllers/order.setprice","apps/ticket/controllers/detail"],function(){}),define("apps/ticket/directives/ticket.list.search",["apps/common/directives/directives"],function(e){e.directive("ticketListSearch",["tagResource",function(e){return{restrict:"AE",replace:!0,scope:{returnTags:"=",ngModel:"="},require:"?^ngModel",templateUrl:"assets/js/apps/ticket/templates/ticket.list.search.html",link:function(t,a,o,s){function n(){e.get({},function(e){t.tags=e.data,t.returnTags=e.data,t.tags.unshift(i)})}var r={id:"all",name:"所有状态"};t.piao_onsales=[{id:0,name:"下架"},{id:1,name:"上架"}],t.piao_onsales.unshift(r);var i={id:0,name:"所有分组"};t.types=[{type:"title",name:"商品标题"}],n(),t.param={piao_onsale:t.ngModel&&t.ngModel.piao_onsale?t.ngModel.piao_onsale:r,tag:t.ngModel&&t.ngModel.tag?t.ngModel.tag:i,type:t.ngModel&&t.ngModel.type?t.ngModel.type:t.types[0],input:t.ngModel&&t.ngModel.input?t.ngModel.input:"",start_time:t.ngModel&&t.ngModel.start_time?t.ngModel.start_time:"",end_time:t.ngModel&&t.ngModel.end_time?t.ngModel.end_time:"",piao_stock:t.ngModel&&t.ngModel.piao_stock?t.ngModel.piao_stock:""},t.searchParam={types:t.types.map(function(e){return e.type})},t.searchInfo={dates:""},t.search=function(){var e=$('input[name="created_range"]').val();""!=e?(e=e.split("/"),t.param.start_time=e[0],t.param.end_time=e[1]):(t.param.start_time="",t.param.end_time=""),angular.forEach(t.param,function(e,a){t.searchParam[a]=e}),s.$setViewValue(t.searchParam)}}}}])}),define("apps/ticket/directives/_base",["apps/ticket/directives/ticket.list.search"],function(){}),define("apps/ticket/services/goods",["apps/common/services/services"],function(e){e.factory("TicketData",function(){var e={selectedGoodsTags:[],cate:[],isCateSelect:!1,goods_cat_id:0,prop:[],props:{},title:"",imgs:[],serve_label:0,label_ids:[],is_sku:1,is_discount:0,noDeliveryArea:{region_ids:[],region_names:""},skus:[],skuData:[],skuStock:[],products:{},tags:[],original_price:null,price:null,stock:null,goods_sn:null,barcode:null,shipment_type:0,shipmentType:0,shipments:[],shipment:null,postage:null,weight:null,volume:null,stockType:0,stock_type:0,onsale_type:0,onsale_at:"",collect_fields:[],intro:"",components_data:[],designGoodsTpl:0,cquota:0,slices:[],description:"",external_type:0,base_csale:0,piao_product:{},piao_goods:{is_third_api:0,scenic_name:"",address:"",province:"",city:"",district:"",is_charge_off:2,charge_off:[]},ticketSkus:{totalDatas:{},checkedTicketSpeciesID:[]},stores:[],selectStores:[],selected_city:[],checkedProps_str:[],isConfirmLocation:!1,piaoID:{}},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t.isStep=!1,t})}),define("apps/ticket/services/ticketINFO",["apps/common/services/services"],function(e){e.factory("ticketCat",["$resource",function(e){return e("goods/cat.json",{})}]),e.factory("thirdParty",["$resource",function(e){return e("piao/piao_third_api.json",{})}]),e.factory("ticketTypeData",["$resource",function(e){return e("piao/is_piao.json",{})}]),e.factory("ticketStore",["$resource",function(e){return e("store.json",{})}]),e.factory("ticketOrderList",["$resource",function(e){return e("piao/piao_order.json",{})}]),e.factory("ticketVerificate",["$resource",function(e){return e("piao/piao_order/:id.json",{id:"@id"},{put:{method:"PUT"}})}]),e.factory("ticketOrderLog",["$resource",function(e){return e("piao/piao_order_log.json",{})}])}),define("apps/ticket/services/_base",["apps/ticket/services/goods","apps/ticket/services/ticketINFO"],function(){}),define("apps/ticket/main",["apps/ticket/states/_base","apps/ticket/controllers/_base","apps/ticket/directives/_base","apps/ticket/services/_base"],function(){}),define("apps/hotel/states/order",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.hotel",{url:"/hotel",templateUrl:"assets/js/apps/hotel/templates/layout.html"}).state("shop.hotel.order",{abstract:!0,url:"",template:"<div ui-view></div>"}).state("shop.hotel.order.list",{url:"/list/:type",templateUrl:"assets/js/apps/hotel/templates/order.html",controller:"hotel.order"}).state("shop.hotel.all",{abstract:!0,url:"/all",template:"<div ui-view></div>"}).state("shop.hotel.all.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/hotel/templates/hotel.order.detail.html",controller:"hotel.order.detail"}).state("shop.hotel.refundid",{url:"/refundid/:id",templateUrl:"assets/js/apps/hotel/templates/order.hotel.feedback.html",controller:"shop.hotel.feedback"})}])}),define("apps/hotel/states/rooms",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.hotel.rooms",{abstract:!0,url:"/rooms",template:"<div ui-view></div>",controller:"hotel.rooms.list"}).state("shop.hotel.rooms.list",{url:"?callback",templateUrl:"assets/js/apps/hotel/templates/room_list.html"}).state("shop.hotel.rooms.stock",{url:"/stock/:id",templateUrl:"assets/js/apps/hotel/templates/rooms.stock.html",controller:"rooms.stock"}).state("shop.hotel.rooms.date",{url:"/date/:id",templateUrl:"assets/js/apps/hotel/templates/rooms.date.html",controller:"rooms.date"})}])}),define("apps/hotel/states/manage",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.hotel.manage",{abstract:!0,url:"/manage",template:"<div ui-view></div>"}).state("shop.hotel.manage.list",{url:"",templateUrl:"assets/js/apps/hotel/templates/manage.html",controller:"hotel.manage"}).state("shop.hotel.manage.detail",{url:"/detail/:id",templateUrl:"assets/js/apps/hotel/templates/manage.detail.html",controller:"manage.detail"})}])}),define("apps/hotel/states/dashboard",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.hotel.dashboard",{abstract:!0,url:"/dashboard",template:"<div ui-view></div>"}).state("shop.hotel.dashboard.list",{url:"?callback",templateUrl:"assets/js/apps/hotel/templates/dashboard.html",controller:"hotel.dashboard"})}])}),define("apps/hotel/states/rooms_add",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.hotel.add",{abstract:!0,url:"/add",template:"<div ui-view></div>"}).state("shop.hotel.add.step",{url:"/step/:step",templateUrl:"assets/js/apps/hotel/templates/rooms_add.html",controller:"hotel.roomsadd"}).state("shop.hotel.edit",{abstract:!0,url:"/edit",template:"<div ui-view></div>"}).state("shop.hotel.edit.step",{controller:"hotel.roomsadd",url:"/:id/step/:step",templateUrl:"assets/js/apps/hotel/templates/rooms_add.html"})}])}),define("apps/hotel/states/_base",["apps/hotel/states/order","apps/hotel/states/rooms","apps/hotel/states/manage","apps/hotel/states/dashboard","apps/hotel/states/rooms_add"],function(){}),define("apps/hotel/controllers/order",["apps/common/controllers/controllers"],function(e){e.controller("hotel.order",["$scope","HotelOrderleave","hotelOrder","order","ngPopover","saveDeliver","reviseprice","$stateParams","$modal","Flash","HotelStores","HotelOrderall",function(e,t,a,o,s,n,r,i,c,l,d,p){e.paginationConf={currentPage:1,itemsPerPage:10},e.limit={limit_from:0,limit_to:3e3},e.isGetted=!0,e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",order_type:"0"},e.searchParams={goods_name:"",payment_sn:"",buy_way:"all",type:"all",express_type:"all",feedback:"0",sort:"desc",order_type:"0"};var u={goods_name:"",order_no:"",buy_way:"all",type:"all",consignee:"",mobile:"",express_type:"all",user_name:"",feedback:0,order_type:0};switch(i.type){case"tosend":e.tabs=1,e.params.type="tosend",e.searchParams.type="tosend";break;case"topay":e.tabs=1,e.params.type="topay",e.searchParams.type="topay";break;case"codpay":e.tabs=2,e.params.buy_way="codpay",e.searchParams.buy_way="codpay";break;case"selffetch":e.tabs=3,e.params.express_type="selffetch",e.searchParams.express_type="selffetch";break;case"peerpay":e.tabs=2,e.params.buy_way="peerpay",e.searchParams.buy_way="peerpay";break;case"feedback":e.tabs=4,e.params.feedback="all",e.searchParams.feedback="all";break;case"star":e.tabs=5,e.params.star="star",e.searchParams.star="star";break;default:e.tabs=1,e.params.type="all",e.searchParams.type="all"}e.type="all";var m=function(){if(e.dates&&$('input[name="created_range"]').val()){var t=$('input[name="created_range"]').val(),o=t.split("/");e.params.startDate=o[0],e.params.endDate=o[1]}if(e.datein_at&&$('input[name="in_at_range"]').val()){var t=$('input[name="in_at_range"]').val(),o=t.split("/");e.params.in_at=o[0],e.params.out_at=o[1]}if(e.dates_arrive_at&&$('input[name="s_arrive_at_range"]').val()){var t=$('input[name="s_arrive_at_range"]').val(),o=t.split("/");e.params.s_arrive_at=o[0],e.params.e_arrive_at=o[1]}if(e.finish_dates&&$('input[name="finish_range"]').val()){var s=$('input[name="finish_range"]').val(),n=s.split("/");e.params.startFinishDate=n[0],e.params.endFinishDate=n[1]}e.type=e.params.type,e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.get(e.params,function(t){e.isGetted=!0,e.selectedIds=[],e.paginationConf.totalItems=t._count,e.isCustom=_global.shop.customs,e.data=t.data,$(".check-box").attr("checked",!1),g()})},g=function(){e.isCustom?(e.opsRowSpan=3,e.headerRowSpan=7):(e.opsRowSpan=2,e.headerRowSpan=8)};e.saveCustom=function(t,o){a.postCustom({id:t.id},function(t){t.status?(e.data[o].custom_state=t.custom_state,e.data[o].custom_code=t.custom_code,l.create("success","报关成功")):l.create("danger","报关失败")})},e.getCustomStatus=function(t,o){a.resetCustom({id:t.id},function(t){t.status?(e.data[o].custom_state=t.custom_state,e.data[o].custom_code=t.custom_code,l.create("success","刷新成功,"+t.custom_state)):l.create("danger","刷新失败")})},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",m),d.get(function(t){e.hoteldata=t.data}),e.search=function(){angular.forEach(e.searchParams,function(t,a){e.params[a]=e.searchParams[a]}),1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:(e.isGetted=!1,m())},e.formatnum=function(t){t=parseInt(t),t<0||!t&&0!=t?(e.limit.limit_from=0,l.create("danger","开始行数最小为0")):e.limit.limit_from=t},e.limitnum=function(t){t=parseInt(t),t<=0||t>3e3||!t?(l.create("danger","导出行数最小为1,最大为3000"),e.limit.limit_to=3e3):e.limit.limit_to=t},e.export=function(){if(e.selectedIds.length)var t=e.selectedIds.join(","),a="/hotel/order_list.json?ids="+t+"&export=yes";else{var a="/hotel/order_list.json?";if(angular.forEach(e.searchParams,function(e,t){e&&(a+=t+"="+e+"&")}),$('input[name="created_range"]').val()){var o=$('input[name="created_range"]').val(),s=o.split("/");a+="startDate="+s[0]+"&endDate="+s[1]}if($('input[name="finish_range"]').val()){var n=$('input[name="finish_range"]').val(),r=n.split("/");a+="&startFinishDate="+r[0]+"&endFinishDate="+r[1]}a+="&limit_from="+e.limit.limit_from+"&limit_to="+e.limit.limit_to+"&type="+e.params.type,a+="&export=yes"}window.location.href=a,l.create("success","正在导出,请等待...")};var f=function(t){angular.forEach(u,function(a,o){h(o,t)||(e.params[o]=a,e.searchParams[o]=a)})},h=function(e,t){var a=!1;for(var o in t)if(t[o]==e){a=!0;break}return a},_=function(){1!=e.paginationConf.currentPage?e.paginationConf.currentPage=1:m()};e.set_type=function(t){e.params.type=t,f(["type"]),_()},e.set_buy_way=function(t){e.params.buy_way="codpay",e.params.type=t,f(["type","buy_way"]),_()},e.set_express_type=function(t){e.params.express_type="selffetch",e.params.type=t,f(["type","express_type"]),_()},e.set_feedback=function(t){e.params.feedback=t,f(["feedback"]),_()},e.sort=function(t){"asc"==t?e.params.sort="desc":e.params.sort="asc",m()},e.ranges={"今天":[moment().startOf("day"),moment().endOf("day")],"昨天":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7天":[moment().subtract("days",7),moment()],"最近15天":[moment().subtract("days",15),moment()],"本月":[moment().startOf("month"),moment()],"上月":[moment().subtract("days",30),moment()]},e.set_star=function(e,t){e.star=t,p.setStar({id:e.id,star:t})},e.remarkInfo={id:"",text:"",index:""},e.set_remarkClick=function(t,a){e.remarkInfo.id=t.id,e.remarkInfo.text=t.remarks,e.remarkInfo.index=a},e.set_remark=function(){e.remarkInfo.text?p.setRemarks({id:e.remarkInfo.id,memo:e.remarkInfo.text},function(t){t.status?(l.create("success","提交成功"),s.close(),e.data[e.remarkInfo.index].remarks=e.remarkInfo.text):l.create("danger","提交失败")}):l.create("danger","请填写备注")},e.cancel=function(){s.close(),e.remarkInfo={id:"",text:""}},e.saveListDelivery=function(e,t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return e.order_sn},isList:function(){return!0}}});a.result.then(function(e){e&&m()})},e.reviseListPrice=function(e,t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/hotel/templates/order.hotel.reviseprice.html",controller:"order.hotel.revisePrice",resolve:{data:function(){return e.order_sn},isList:function(){return!0}}});a.result.then(function(e){e&&m()})},e.reviseListHotelLeave=function(a,o){t.update({id:a.id},function(t){t.status?(e.data[o].status=50,e.data[o].status_msg="已离店",l.create("success","修改成功")):l.create("danger","修改失败")})},e.reviseListhotel=function(e,t){var a=c.open({animation:!1,templateUrl:"assets/js/apps/hotel/templates/order.revisehotel.html",controller:"reviseHotel",resolve:{data:function(){return e},isList:function(){return!0}}});a.result.then(function(e){e&&m()})},e.reviseListHotelstayIn=function(e,t,a){var o=c.open({animation:!1,templateUrl:"assets/js/apps/hotel/templates/order.revisehotelstayin.html",controller:"reviseHotelstayIn",resolve:{order_id:function(){return e.id},hotel_order_goods_id:function(){return t.hotel_order_goods_id},isList:function(){return!0}}});o.result.then(function(e){e&&m()})},e.checkedAll=!1,e.selectedIds=[],e.$watch("checkedAll",function(t){t?e.selectedIds=e.data.map(function(e){return e.id}):e.selectedIds=[]}),e.toggleSelection=function(t){var a=e.selectedIds.indexOf(t);a>-1?e.selectedIds.splice(a,1):e.selectedIds.push(t)},e.print_waybill=function(){c.open({animation:!1,templateUrl:"assets/js/apps/order/templates/choose_waybill_tpl.html",controller:"printWaybillCtrl",resolve:{order_ids:function(){return e.selectedIds}}})},e.printDevivery=function(){var t=$("#print_order_form"),a=e.selectedIds.join(",");$("#print_order_form input[name='ids']").val(a),t.submit()}}]),e.controller("printWaybillCtrl",["$scope","$modalInstance","order_ids","waybillResource","Flash",function(e,t,a,o,s){e.order_ids=a.join(","),e.myWaybills=0,o.get(function(t){e.waybills=t.data,e.waybills.unshift({id:0,name:"请选择"})}),e.px2mm=function(e){$("body").append("<div id='mm2px' style='width:1mm;height:1mm;display:none;'></div>");var t={};return t[0]=e/$("#mm2px").width(),t[1]=e/$("#mm2px").height(),$("#inch2px").remove(),t},e.pixels=JSON.stringify(e.px2mm(1)),e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/hotel/controllers/order_details",["apps/common/controllers/controllers"],function(e){e.controller("order.details",["$http","$state","$scope","$stateParams","hotelOrder",function(e,t,a,o,s){function n(e){19==e.status?(a.step[0].type=!0,a.step[0].at=e.created_at,a.orderStatus.icon="fa-clock-o"):30==e.status?(a.step[0].type=!0,a.step[0].at=e.created_at,a.step[1].type=!0,a.step[1].at=e.pay_at,a.orderStatus.icon="fa-clock-o"):40==e.status?(a.step[0].type=!0,a.step[0].at=e.created_at,a.step[1].type=!0,a.step[1].at=e.pay_at,a.step[2].type=!0,a.step[2].at=e.shipments_at,a.orderStatus.icon="fa-clock-o"):50==e.status&&(a.step[0].type=!0,a.step[0].at=e.created_at,a.step[1].type=!0,a.step[1].at=e.pay_at,a.step[2].type=!0,a.step[2].at=e.shipments_at,a.step[3].type=!0,a.step[3].at=e.finished_at,a.orderStatus.icon="fa-check-circle-o",a.orderStatus.title="订单已完成")}s.queryOrderDetails({id:o.id},function(e){a.step=[{type:!1,title:"买家下单",at:""},{type:!1,title:"买家付款",at:""},{type:!1,title:"客户入住",at:""},{type:!1,title:"订单完成",at:""}],a.orderStatus={icon:"",title:""},a.orderDetail=e,n(e.order)})}])}),define("apps/hotel/controllers/intake_record",["apps/common/controllers/controllers"],function(e){e.controller("intake.record",["$scope","$stateParams","Flash","$state","$modal","$modalInstance",function(e,t,a,o,s,n){e.cancel=function(){n.dismiss("cancel")}}])}),define("apps/hotel/controllers/dashboard",["apps/common/controllers/controllers"],function(e){e.controller("hotel.dashboard",["$http","$state","$scope","$timeout","$modal","hotelInfoStat","$stateParams","Flash",function(e,t,a,o,s,n,r,i){a.hoteldata={},a.hoteldata.stores=[],a.btn_text="保存",n.query(function(e){1==e.status?(a.hoteldata=e.data,a.hoteldata.dsys=e.data.buy_limit,a.hoteldata.stores=e.data.stores,a.isCheckedAll()):i.create("danger",e.msg)}),a.checkAllItems=function(){a.member.checkedAll?(angular.forEach(a.hoteldata.stores,function(e,t){e.enabled=1}),a.member.check_btn="取消全选"):(angular.forEach(a.hoteldata.stores,function(e,t){e.enabled=0}),a.member.check_btn="全选")},a.isCheckedAll=function(){var e=!0;angular.forEach(a.hoteldata.stores,function(t,o){e&&0===t.enabled&&(a.member={check_btn:"全选",checkedAll:!1},e=!1)}),e&&(a.member={check_btn:"取消全选",checkedAll:!0})},a.submitForm=function(){a.btn_text="保存中",a.form.$invalid=!0,a.hoteldataSubmit={buy_limit:a.hoteldata.buy_limit,stores:[]},angular.forEach(a.hoteldata.stores,function(e,t){1===e.enabled&&a.hoteldataSubmit.stores.push(e.id)}),a.hoteldataSubmit.stores=a.hoteldataSubmit.stores.toString(),n.save(a.hoteldataSubmit,function(e){1==e.status?(a.btn_text="保存",a.form.$invalid=!1,i.create("success",e.msg)):(a.btn_text="保存",i.create("danger",e.msg),a.form.$invalid=!1)})}}])}),define("apps/hotel/controllers/save_dashboard",["apps/common/controllers/controllers"],function(e){e.controller("update.dashboard",["$scope","$modal","data","$modalInstance","Flash",function(e,t,a,o,s){e.cancel=function(){o.dismiss("cancel")},e.hotelBaseData01Img=[],a&&(e.params=a,e.hotelBaseData01Img.push({url:a.icon})),e.addSave=function(){e.hotelBaseData01Img.length>0?(e.params.icon=e.hotelBaseData01Img[0].url,o.close(e.params)):s.create("danger","图片不能为空")}}]),e.controller("save.dashboard",["$scope","$modal","$modalInstance","Flash",function(e,t,a,o){e.cancel=function(){a.dismiss("cancel")},e.params={title:"",icon:"",is_active:"1",is_default:"1"},e.hotelBaseData01Img=[],e.addSave=function(){e.hotelBaseData01Img.length>0?(e.params.icon=e.hotelBaseData01Img[0].url,a.close(e.params)):o.create("danger","图片不能为空")}}])}),define("apps/hotel/controllers/rooms_add",["apps/common/controllers/controllers"],function(e){e.controller("hotel.roomsadd",["$location","$scope","$stateParams","$state","Flash","$modal","ngPopover","$timeout","HotelData","HotelStores","designGoodsRes","designData","designValidate","HotelRoomsList","HotelStoreGoodsCart",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m,g){var f=t.vm={},h=a.step;switch(f.cates=[],f.activeTab=h,t.btn_text="保存",f.goodsData=c,angular.isDefined(a.id)?(f.is_edit=!!a.id,f.goodsData.isStep||(angular.forEach(c.init(),function(e,t){f.goodsData[t]=e}),m.get({id:a.id},function(e){f.goodsData.goods_cat_id=e.goods_cat_id,f.goodsData.cate[0]={},f.goodsData.cate[0].data={},f.goodsData.isCateSelect=!0,f.goodsData.cate[0].data.id=e.goods_cat_id,f.goodsData.cate[0].data.is_virtual=e.is_virtual,f.goodsData.cate[0].data.name=e.cat_name,f.goodsData.title=e.title,angular.forEach(e.imgs,function(e,t){f.goodsData.imgs[t]={id:e.id,url:e.img}}),f.goodsData.selectStores=angular.copy(e.store),f.goodsData.serve_label=e.serve_label,f.goodsData.label_ids=e.label_ids;for(var a=0;a<e.label_ids.length;a++)for(var o=0;o<t.shopServerData.length;o++)e.label_ids[a]==t.shopServerData[o].id&&(t.shopServerData[o].checked=!0);if(f.goodsData.is_sku=e.is_sku,f.goodsData.is_discount=e.is_discount||0,f.goodsData.goods_sn=e.goods_sn,f.goodsData.barcode=e.barcode,f.goodsData.is_virtual=e.is_virtual,f.goodsData.virtual_card_type=e.virtual_card_type,f.goodsData.is_autosend=e.is_autosend,f.goodsData.is_verify_card=e.is_verify_card,e.is_sku||(f.goodsData.price=e.price,f.goodsData.stock=e.stock,f.goodsData.old_stock=e.stock),f.goodsData.old_products=e.products,f.goodsData.old_props=e.props,f.goodsData.original_price=e.original_price,f.goodsData.shipmentType=0!=e.shipment_id?1:0,f.goodsData.shipmentType){var s=t.$watch("vm.goodsData.shipments",function(t,a){angular.forEach(t,function(t,a){t.id==e.shipment_id&&(f.goodsData.shipment=t,s())})});f.goodsData.weight=e.weight,f.goodsData.volume=e.volume}else f.goodsData.postage=e.postage;f.goodsData.stockType=e.stock_type,angular.forEach(e.collect_fields,function(e,t){f.goodsData.collect_fields.push({name:e.name,type:e.type,multiple:!!e.multiple,required:!!e.required})}),f.goodsData.intro=e.intro,f.goodsData.components_data=e.components_data,f.goodsData.designGoodsTpl=e.design_goods_id,f.goodsData.onsale=e.onsale,f.goodsData.onsale&&(f.goodsData.onsale_at=e.onsale_at),f.goodsData.cquota=e.cquota,f.goodsData.base_csale=e.base_csale,f.goodsData.intro=e.intro},function(e){}))):(1==a.step&&(f.goodsData.virtual_card_type=1,f.goodsData.is_autosend=0,f.goodsData.is_verify_card=0),f.goodsData.isStep||angular.forEach(c.init(),function(e,t){f.goodsData[t]=e})),f.goodsData.isStep=!1,t.getStoreGoodsCart=function(){g.get({parent_id:0,type:3},function(e){f.goodsData.goods_cat_id=e.data[0].id})},t.getStores=function(){l.get({enabled:1},function(e){e.data.length>0?f.goodsData.stores=e.data:f.goodsData.stores=[]},function(e){})},t.saveValidity=function(e){var a=t.form;if(2==e){if(a.goods_title.$invalid)return a.goods_title.$dirty=!0,$("input[name='goods_title']").focus(),!1;if(a.goods_stock.$invalid)return a.goods_stock.$dirty=!0,$("input[name='goods_stock']").focus(),!1;if(0==f.goodsData.imgs.length)return s.create("danger","请至少上传一张商品图片"),!1;if(0==f.goodsData.selectStores.length)return s.create("danger","请至少选择一个门店"),
!1;if(a.goods_price.$invalid)return a.goods_price.$dirty=!0,$("input[name='goods_price']").focus(),!1}return!0},t.nextStep=function(e){switch(f.goodsData.isStep=!0,e){case 2:angular.isDefined(a.id)?o.go("shop.hotel.edit.step",{id:a.id,step:e}):(o.go("shop.hotel.add.step",{step:e}),t.isVirtual=!0);break;case 3:t.saveValidity(2)&&(angular.isDefined(a.id)?o.go("shop.hotel.edit.step",{id:a.id,step:e}):o.go("shop.hotel.add.step",{step:e}))}},h){case"2":f.goodsData.stores=[],f.skuValueTemp=[],f.skuEditTemp=[],f.showValue={addProp:!1,addSku:!1,editSku:!1},f.skuSelectObject={},f.isSkuSelect=!1,f.skuType=0,t.getStores(),angular.isUndefined(a.id)&&t.getStoreGoodsCart(),t.getNowFormatDate=function(){var e=new Date(new Date-864e5),t="-",a=":",o=e.getMonth()+1,s=e.getDate();o>=1&&o<=9&&(o="0"+o),s>=0&&s<=9&&(s="0"+s);var n=e.getFullYear()+t+o+t+s+" "+e.getHours()+a+e.getMinutes()+a+e.getSeconds();return n},t.nowFormatDate=t.getNowFormatDate();break;case"3":d.get({},function(e){f.designGoodsList=angular.copy(e.data),f.designGoodsList.unshift({id:0,title:"普通版"})}),t.slices=[{type:"goods_head"},{type:"goods_info",content:{edit:!0},class:!0}],t.$watch("vm.goodsData.components_data",function(e,a){if(e.length>0){t.slices=e,"goods_head"!=t.slices[0].type&&t.slices.unshift({type:"goods_head"});for(var o in t.slices)"goods_info"==t.slices[o].type&&(t.slices[o].class=!0,t.editSlice(t.slices[o]))}}),t.config={},t.icon_list=p.concat(),t.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(e,a){a.item.sortable.droptarget&&e.target!=a.item.sortable.droptarget[0]&&(t.icon_list=p.concat(),"mouseup"==e.handleObj.type&&t.editSlice(a.item.sortable.moved))}},t.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y",items:".sortable:not(.not-sortable)"},t.goods_info=function(e){"goods_info"==e.type&&(t.design={type:"text"})},t.removeSlice=function(e){t.slices.splice(e,1),t.design=!1},t.editSlice=function(e,a){"goods_head"!=e.type&&(t.design=e,angular.forEach(t.slices,function(e,t){e.class=!1}),e.class=!0,i(function(){t.$broadcast("design_data",e),angular.isUndefined(a)||t.$broadcast("design_dirty",a)},200))},t.editSlice(t.slices[1])}t.unique=function(e){for(var t=[],a={},o=0;null!=e[o];o++)a[e[o]]||(t.push(e[o]),a[e[o]]=!0);return t},t.save=function(e){if(e&&t.saveValidity(2)){t.btn_text="保存中...",t.form.$invalid=!0;var n=[],r={stores:[],barcode:f.goodsData.barcode||"",goods_cat_id:f.goodsData.goods_cat_id,mall_category_id:f.goodsData.mall_category_id,goods_sn:f.goodsData.goods_sn||"",img:f.goodsData.imgs[0].url,imgs:f.goodsData.imgs,tags:[],postage:f.goodsData.postage||0,original_price:f.goodsData.original_price||0,price:f.goodsData.price||0,serve_label:f.goodsData.serve_label,label_ids:f.goodsData.label_ids,is_sku:f.goodsData.is_sku,is_discount:f.goodsData.is_discount,region_ids:f.goodsData.noDeliveryArea.region_ids,products:{},props:n,shipment_id:null!=f.goodsData.shipment?f.goodsData.shipment.id:0,stock:f.goodsData.stock||0,stock_type:2,title:f.goodsData.title,volume:f.goodsData.volume||0,weight:f.goodsData.weight||0,intro:f.goodsData.intro,design_goods_id:f.goodsData.designGoodsTpl,onsale:f.goodsData.onsale,cquota:f.goodsData.cquota,base_csale:f.goodsData.base_csale,is_virtual:0,virtual_card_type:f.goodsData.virtual_card_type,is_autosend:f.goodsData.is_autosend,is_verify_card:f.goodsData.is_verify_card,old_products:f.goodsData.old_products,old_props:f.goodsData.old_props,old_stock:f.goodsData.old_stock};r.component_data=[];var i=angular.copy(t.slices);for(var c in i){var l=u[i[c].type](i[c].content);if(l)return t.editSlice(i[c],l),!1}if(angular.forEach(i,function(e,t){"goods_head"!=e.type&&r.component_data.push({type:e.type,content:e.content||""})}),f.goodsData.collect_fields&&(r.collect_fields=[],angular.forEach(f.goodsData.collect_fields,function(e,t){r.collect_fields.push({name:e.name,type:e.type,required:e.required?1:0})})),f.goodsData.selectStores.length>0){angular.forEach(f.goodsData.selectStores,function(e,t){r.stores.push(e.id)});var d=t.unique(r.stores);r.stores=d.join(",")}f.goodsData.shipmentType||(r.shipment_id=0),f.goodsData.onsale&&(r.onsale_at=f.goodsData.onsale_at),t.save.disabled=!0,angular.isDefined(a.id)?(r.id=a.id,m.update(r,function(e){e.error?(s.create("danger",e.error),t.save.disabled=!1):(s.create("success","保存成功"),o.go("shop.hotel.rooms.list",{callback:1}))},function(e){t.save.disabled=!1})):m.save(r,function(e){e.error?(s.create("danger",e.error),t.save.disabled=!1):(t.save.disabled=!0,s.create("success","添加成功"),o.go("shop.hotel.rooms.list"))},function(e){t.save.disabled=!1})}}}])}),define("apps/hotel/controllers/rooms_list",["apps/common/controllers/controllers"],function(e){e.controller("hotel.rooms.list",["$scope","HotelRoomsList","HotelStores","Flash",function(e,t,a,o){e.paginationConf={currentPage:1,itemsPerPage:10},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",trip_type:"3",hotel_onsale:"all",store_id:"",column:"id",direction:"desc"};var s=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,t.query(e.params,function(t){e.paginationConf.totalItems=t._count,e.roomList=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",s),a.get(function(t){e.hoteldata=t.data}),e.search=function(){1==e.paginationConf.currentPage?s():e.paginationConf.currentPage=1},e.remove=function(a,n){t.delete({id:n},function(t){e.roomList.splice(a,1),s(),o.create("success"," 删除成功！")},function(e){o.create("danger",e.data.error.message)})}}])}),define("apps/hotel/controllers/manage",["apps/common/controllers/controllers"],function(e){e.controller("hotel.manage",["$http","Flash","$state","$scope","$timeout","$modal","HotelStores","HotelStoreDtail","HotelQrcode","ngPopover",function(e,t,a,o,s,n,r,i,c,l){o.paginationConf={currentPage:1,itemsPerPage:10},o.params={offset:(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,limit:o.paginationConf.itemsPerPage,keywords:"",enabled:"1",direction:"desc"};var d=function(){o.params.offset=(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,o.params.limit=o.paginationConf.itemsPerPage,r.get(o.params,function(e){o.paginationConf.totalItems=e._count,o.stores=e.data})};o.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",d),o.remove=function(e,a){i.delete({id:a},function(a){o.stores.splice(e,1),t.create("success"," 删除成功！")},function(e){t.create("danger",e.data.error.message)})},o.search=function(){1==o.paginationConf.currentPage?d():o.paginationConf.currentPage=1},o.showQrcode=function(e){c.qrcode({id:e},function(e){o.qrcodeInfo=e})},o.showMessage=function(){l.close(),t.create("success"," 复制成功！")},o.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/hotel/controllers/manage.detail",["apps/common/controllers/controllers"],function(e){e.controller("manage.detail",["$http","Flash","$state","$scope","$timeout","$modal","$stateParams","HotelStoreDtail",function(e,t,a,o,s,n,r,i){i.get({id:r.id},function(e){o.storedtail=e})}])}),define("apps/hotel/controllers/rooms.stock",["apps/common/controllers/controllers","mydate"],function(e){e.controller("rooms.stock",["$http","Flash","$state","$scope","$timeout","$modal","$stateParams","HotelRoomsList",function(e,t,a,o,s,n,r,i){o.today=new Date,o.todays=new Date,o.tomorrow=o.today.setDate(o.today.getDate()+1),o.tomorrowst=o.todays.setDate(o.todays.getDate()),o.tomorrowst=mydate.getFormatDate(new Date(o.tomorrowst)),o.init_state={},o.price_categroys={},o.info={id:r.id||0,start_time:"",end_time:""},o.getEditInfo=function(e){i.get({id:r.id},function(t){o.info=t,o.info.start_time=mydate.getFormatDate(new Date(1e3*o.info.start_time)),o.info.end_time=mydate.getFormatDate(new Date(1e3*o.info.end_time)),o.info.start_time<new Date&&(o.tomorrow=o.info.start_time),o.info.room_bstock&&o.info.room_bstock.length>0?(o.init_datesModel={},o.info.item_stock=$.map(o.info.room_bstock,function(e,t){var a=mydate.getFormatDate(new Date(1e3*e.timestamp)),s={id:e.goods_id,booking_stock:e.booking_stock,occupy_stock:e.occupy_stock,remain_stock:e.remain_stock,remark:e.remark,dt:a,stock:e.stock,nowdays:o.tomorrowst};return o.init_datesModel[a]={state:"chosed",mark:e.booking_stock,item_stock:s,keyid:o.info.trip_type,init_type:2},s}),o.init_state.info=!0):o.info.room_bstock&&0==o.info.room_bstock.length&&o.showMydate(o.init_datesModel),1==e&&o.showMydate(o.init_datesModel)})},o.pull_data=function(){if(o.info.id){var e=o.$watch("init_state",function(){o.init_state.info&&(o.showMydate(o.init_datesModel),e())},!0);o.getEditInfo()}},o.showMydate=function(e){var t=$(".adult").is(":checked"),a=$(".kid").is(":checked");if(1==t||1==a?o.is_price_chosed=!0:0==t&&0==a&&(o.is_price_chosed=!1),o.info.start_time&&o.info.end_time){var s=mydate.getFormatDate(o.info.start_time),n=mydate.getFormatDate(o.info.end_time);o.dates=new mydate({keyid:o.info.trip_type,code_type:2,date:mydate.getFormatDate(new Date),dom:".date",start_time:s,end_time:n,stock:o.info.stock}),o.dates.run(),e&&(o.dates.datesModel=e,o.dates.according(),e=null)}},o.$on("$viewContentLoaded",function(){$(".mydatezrone").off("click"),$(".mydatezrone").on("click",".mydate .con .on a, .mydate .con .max a",function(e){var t=$(this).attr("title"),a=$(this).attr("data-stock"),s=$(this).attr("data-remark"),n={todaydate:t,data_stock:a,remark:s};o.showpricewindow("today",new Date(t),n)})}),o.showpricewindow=function(e,t,a){var s={};s={goods_id:o.info.id,stock:parseInt(a.data_stock),remark:a.remark,date:a.todaydate};var r=n.open({animation:!1,templateUrl:"assets/js/apps/hotel/templates/hotel_setStocks.html",controller:"rooms.stockWindowCtrl",windowClass:"modal-open",resolve:{type:function(){return e},price_categroys:function(){return s},dates:function(){return o.dates},specifyDate:function(){return t},start_time:function(){return o.info.start_time},end_time:function(){return o.info.end_time}}});r.result.then(function(e){},function(e){$(".container").off()})}}])}),define("apps/hotel/controllers/rooms.date",["apps/common/controllers/controllers","mydate"],function(e){e.controller("rooms.date",["$http","Flash","$state","$scope","$timeout","$modal","$stateParams","HotelRoomsList",function(e,t,a,o,s,n,r,i){o.today=new Date,o.todays=new Date,o.tomorrow=o.today.setDate(o.today.getDate()+1),o.tomorrowst=o.todays.setDate(o.todays.getDate()),o.tomorrowst=mydate.getFormatDate(new Date(o.tomorrowst)),o.init_state={},o.price_categroys={},o.info={id:r.id||0,start_time:"",end_time:""},o.getEditInfo=function(e){i.get({id:r.id},function(t){o.info=t,o.info.start_time=mydate.getFormatDate(new Date(1e3*o.info.start_time)),o.info.end_time=mydate.getFormatDate(new Date(1e3*o.info.end_time)),o.info.start_time<new Date&&(o.tomorrow=o.info.start_time),o.info.room_price&&o.info.room_price.length>0?(o.init_datesModel={},o.info.item_stock=$.map(o.info.room_price,function(e,t){var a=mydate.getFormatDate(new Date(1e3*e.timestamp)),s={id:e.goods_id,remark:e.remark,dt:a,price:e.price,nowdays:o.tomorrowst};return o.init_datesModel[a]={state:"chosed",mark:e.price,item_stock:s,keyid:o.info.trip_type,init_type:1},s}),o.init_state.info=!0):o.info.room_price&&0==o.info.room_price.length&&o.showMydate(o.init_datesModel),1==e&&o.showMydate(o.init_datesModel)})},o.pull_data=function(){if(o.info.id){var e=o.$watch("init_state",function(){o.init_state.info&&(o.showMydate(o.init_datesModel),e())},!0);o.getEditInfo()}},o.showMydate=function(e){var t=$(".adult").is(":checked"),a=$(".kid").is(":checked");if(1==t||1==a?o.is_price_chosed=!0:0==t&&0==a&&(o.is_price_chosed=!1),o.info.start_time&&o.info.end_time){var s=mydate.getFormatDate(o.info.start_time),n=mydate.getFormatDate(o.info.end_time);o.dates=new mydate({keyid:o.info.trip_type,code_type:1,date:mydate.getFormatDate(new Date),dom:".date",start_time:s,end_time:n,hotel_price:o.info.price}),o.dates.run(),e&&(o.dates.datesModel=e,o.dates.according(),e=null)}},o.$on("$viewContentLoaded",function(){$(".mydatezrone").off("click"),$(".mydatezrone").on("click",".mydate .con .on a, .mydate .con .max a",function(e){var t=$(this).attr("title"),a=$(this).attr("data-price"),s=$(this).attr("data-remark"),n={todaydate:t,data_price:a,remark:s};o.showpricewindow("today",new Date(t),n)})}),o.showpricewindow=function(e,t,a){var s={};s={goods_id:o.info.id,price:parseFloat(a.data_price),remark:a.remark,date:a.todaydate};var r=n.open({animation:!1,templateUrl:"assets/js/apps/hotel/templates/hotel_setprices.html",controller:"rooms.priceWindowCtrl",windowClass:"modal-open",resolve:{type:function(){return e},price_categroys:function(){return s},dates:function(){return o.dates},specifyDate:function(){return t},start_time:function(){return o.info.start_time},end_time:function(){return o.info.end_time}}});r.result.then(function(e){},function(e){$(".container").off()})}}])}),define("apps/hotel/controllers/rooms.priceWindow",["apps/common/controllers/controllers","mydate"],function(e){e.controller("rooms.priceWindowCtrl",["$scope","Flash","$modalInstance","$stateParams","$filter","ngPopover","$modal","type","HotelRoomsPutPrice","price_categroys","specifyDate","start_time","end_time","dates",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m){if(e.today=new Date,e.toddays=new Date,e.tomorrow=e.today.setDate(e.today.getDate()+1),e.tomorrowsted=e.toddays.setDate(e.toddays.getDate()),e.tomorrowst=mydate.getFormatDate(new Date(e.tomorrowsted)),e[i]=!0,e.btn_text="保存",e.start_time="string"==typeof p?new Date(p):p,e.end_time="string"==typeof u?new Date(u):u,e.rooms_stock={},e.rooms_stock=l,e.max_stock="",e.min_stock="",e.original_price="",e.price_categroys=l,e.dates=m,"today"===i){d=mydate.getFormatDate(d);var g=e.dates.datesModel[d];g&&g.item_stock&&(g=g.item_stock,e.max_stock=g.max_stock,e.min_stock=g.min_stock,e.original_price=g.original_price)}var f={};e.submitForm=function(){if(e.rooms_stock.price<=0)return form.price.$dirty=!0,t.create("danger"," 价格不能小于等于0！"),$("input[name='price']").focus(),!1;e.btn_text="保存中",e.form.$invalid=!0;new Date(e.start_time);c.update(e.rooms_stock,function(o){if(1==o.status){e.btn_text="保存",e.form.$invalid=!1,t.create("success",o.msg);var s={dt:d,original_price:e.original_price,remark:l.remark,price:o.data.price,nowdays:e.tomorrowst};f[s.dt]={state:"chosed",mark:o.data.price,item_stock:s,init_type:1,keyid:3},e.dates.datesModel=$.extend(!0,e.dates.datesModel,f),e.dates.according(),a.close(1)}else t.create("danger",o.msg),e.form.$invalid=!1,e.btn_text="保存"})},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/hotel/controllers/rooms.stockWindow",["apps/common/controllers/controllers","mydate"],function(e){e.controller("rooms.stockWindowCtrl",["$scope","Flash","$modalInstance","$stateParams","$filter","ngPopover","$modal","type","HotelRoomsPutStock","price_categroys","specifyDate","start_time","end_time","dates",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m){if(e.today=new Date,e.toddays=new Date,e.tomorrow=e.today.setDate(e.today.getDate()+1),e.tomorrowsted=e.toddays.setDate(e.toddays.getDate()),e.tomorrowst=mydate.getFormatDate(new Date(e.tomorrowsted)),e[i]=!0,e.btn_text="保存",e.start_time="string"==typeof p?new Date(p):p,e.end_time="string"==typeof u?new Date(u):u,e.rooms_stock={},e.rooms_stock=l,e.max_stock="",e.min_stock="",e.original_price="",e.price_categroys=l,e.dates=m,"today"===i){d=mydate.getFormatDate(d);var g=e.dates.datesModel[d];g&&g.item_stock&&(g=g.item_stock,e.max_stock=g.max_stock,e.min_stock=g.min_stock,e.original_price=g.original_price)}var f={};e.submitForm=function(){if(form.stock.$invalid||e.rooms_stock.stock<0)return form.stock.$dirty=!0,$("input[name='stock']").focus(),t.create("danger","线下占用量不能为空或小于0！"),!1;e.btn_text="保存中",e.form.$invalid=!0;new Date(e.start_time);c.update(e.rooms_stock,function(o){if(1==o.status){e.btn_text="保存",e.form.$invalid=!1,t.create("success",o.msg);var s={dt:d,original_price:e.original_price,booking_stock:o.data.booking_stock,occupy_stock:o.data.occupy_stock,remain_stock:o.data.remain_stock,remark:l.remark,stock:o.data.stock,nowdays:e.tomorrowst,init_type:2};f[s.dt]={state:"chosed",mark:o.data.booking_stock,item_stock:s,init_type:2,keyid:3},e.dates.datesModel=$.extend(!0,e.dates.datesModel,f),e.dates.according(),a.close(1)}else t.create("danger",o.msg),e.form.$invalid=!1,e.btn_text="保存"})},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/hotel/controllers/order.sethoteltype",["apps/common/controllers/controllers"],function(e){e.controller("reviseHotel",["$scope","$modalInstance","data","isList","order","HotelRoomsCheckGoods","Flash",function(e,t,a,o,s,n,r){e.info={check_type:1,id:a.hotel_order_goods_id},e.but={text:"确定",status:!1},e.saverevisePrice=function(){e.but.text="提交中",e.but.status=!0,n.update(e.info,function(a){1==a.status?(r.create("success","确认成功"),t.close(a)):r.create("danger",a.msg),e.but.text="确定",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/hotel/controllers/order.sethotelstayIn",["apps/common/controllers/controllers"],function(e){e.controller("reviseHotelstayIn",["$scope","$modalInstance","order_id","isList","HotelOrderCheckRaside","Flash","HotelOrderRefundInfo","hotel_order_goods_id",function(e,t,a,o,s,n,r,i){e.info={},e.returninfo=!1,e.returninfotext=!1,r.get({id:a},function(t){0==t.quantity?(e.returninfotext=!0,n.create("danger","无可退数量，订单已取消或已退款!")):(e.returninfo=!0,e.info={id:i,is_reside:t.is_reside,refund_amount:t.amount,refund_credit:t.credit,refund_memo:"",refund_quantity:t.quantity})}),e.but={text:"确定",status:!1},e.saverevisePrice=function(){return""==e.info.refund_credit&&0!=e.info.refund_credit||void 0==e.info.refund_credit?(n.create("danger","退还积分不能为空!"),!1):(e.but.text="提交中",e.but.status=!0,void s.update(e.info,function(a){1==a.status?(n.create("success","确认成功"),t.close(a)):n.create("danger",a.msg),e.but.text="确定",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/hotel/controllers/order.hotel.revisePrice",["apps/common/controllers/controllers"],function(e){e.controller("order.hotel.revisePrice",["$scope","$modalInstance","data","isList","HotelOrderDetail","HotelSetOrderPrice","Flash",function(e,t,a,o,s,n,r){function i(){for(var t=e.modalData.goodslist,a=0,o=0,s=0,n=0,r=0;r<t.length;r++)a+=void 0!=_global.shop.supplier_id?parseFloat(t[r].price)*parseFloat(t[r].original_quantity):parseFloat(t[r].price)*parseFloat(t[r].quantity),o+=parseFloat(t[r].shipcost),s+=parseFloat(t[r].favorable);o>=0?e.price.set="+ "+o.toFixed(2):e.price.set=" "+o.toFixed(2),n=a+o+parseFloat(e.modalData.shipment_fee)-s,e.price.cost=a.toFixed(2),e.price.favo=s.toFixed(2),e.price.total=n.toFixed(2)}e.price={cost:0,set:0,favo:0,total:0};var c=/^([+-]?[0-9][\d]{0,3}|0)([.]?[\d]{1,2})?$/;o?s.get({id:a},function(t){e.modalData=t,i()}):(e.modalData=angular.copy(a),i()),e.priceSet=function(e,t,a){c.test($(t.target).val())?i():(r.create("danger","请输入正确的价格"),$(t.target).focus())},e.freightSet=function(e){return c.test($(e.target).val())?void($(e.target).val()>=0?i():(r.create("danger","邮费不能小于0"),$(e.target).focus())):($(e.target).focus(),r.create("danger","请输入正确的价格"),!1)},e.spareFreight=function(){e.modalData.shipment_fee=parseFloat(0).toFixed(2),i()},e.but={text:"确定",status:!1},e.saverevisePrice=function(){var a={order_id:e.modalData.id,goods:[],shipment_fee:e.modalData.shipment_fee},o=!0,s=e.modalData.goodslist;a.shipment_fee<0&&(o=!1,r.create("danger","邮费不能小于0"));for(var i=0;i<s.length;i++){var c=0;if(c=void 0!=_global.shop.supplier_id?parseFloat(s[i].price)*parseFloat(s[i].original_quantity)+parseFloat(s[i].shipcost)-parseFloat(s[i].favorable):parseFloat(s[i].price)*parseFloat(s[i].quantity)+parseFloat(s[i].shipcost)-parseFloat(s[i].favorable),c<0){o=!1,r.create("danger","单个商品总价不能小于0");break}var l={id:s[i].id,price:s[i].shipcost};a.goods.push(l)}o&&(e.but.text="提交中",e.but.status=!0,n.update(a,function(a){1==a.success?(r.create("success","修改成功"),t.close(a)):r.create("danger",a.error),e.but.text="确定",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/hotel/controllers/order.hotel.feedback",["apps/common/controllers/controllers"],function(e){e.controller("shop.hotel.feedback",["$scope","feedback","$stateParams","$modal","Flash","orderQureyPay",function(e,t,a,o,s,n){function r(t){if(0==t.refund_info.type&&(e.refundItem=[{title:"商家主动退款",at:t.refund_info.created_at,type:!1},{title:"系统退款中",at:t.refund_info.operated_at,type:!1},{title:"退款已完成",at:t.refund_info.finished_at,type:!1}],1==t.refund_info.feedback)){var a={title:"第三方退款中",at:t.refund_info.applyed_at,type:!1};e.refundItem.splice(2,0,a)}if(1==t.refund_info.type&&(e.refundItem=[{title:"买家申请退款中",at:t.refund_info.created_at,type:!1},{title:"商家同意退款,等待买家退货",at:t.refund_info.operated_at,type:!1},{title:"买家货物已寄出,等待商家确认",at:t.refund_info.shipmented_at,type:!1},{title:"退款已完成",at:t.refund_info.finished_at,type:!1}],1==t.refund_info.feedback)){var a={title:"第三方退款中",at:t.refund_info.applyed_at,type:!1};e.refundItem.splice(3,0,a)}switch(e.feedbackState={title:"",titleIcon:"",titleInfo:"",bottonAgreeText:"",bottonAgreeStatus:!1,bottonRejectText:"",bottonRejectStatus:!1},t.refund_info.status){case 10:e.feedbackState.title="等待商家处理退款申请",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 11:e.feedbackState.title="买家再次申请退款，等待商家处理退款申请",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 12:e.feedbackState.title="系统申请退款中",0==t.refund_info.type?(e.feedbackState.titleInfo="收到买家仅退款申请，请尽快处理",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.titleInfo="收到买家退款并退货申请，请尽快处理",e.feedbackState.bottonAgreeText="同意退货,发送退货地址",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0;break;case 20:0==t.refund_info.type?(e.feedbackState.title="商家同意退款",e.feedbackState.titleInfo="商家同意退款",e.feedbackState.bottonAgreeText="同意买家退款",e.feedbackState.bottonRejectText="拒绝退款"):(e.feedbackState.title="商家已同意退款,请退货给商家",e.feedbackState.titleInfo="您已同意退款协议，请等待买家处理。",e.feedbackState.bottonAgreeText="已收到货，同意退款",e.feedbackState.bottonRejectText="拒绝退货申请"),e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!0,e.refundItem[0].type=!0,e.refundItem[1].type=!0;break;case 21:e.feedbackState={title:"商家不同意退款申请",titleIcon:"",titleInfo:"您已拒绝本次退款申请，买家修改退款申请后，需要您重新处理。",bottonAgreeText:"",bottonRejectText:""},0==t.refund_info.type?e.feedbackState.bottonAgreeText="同意退款给买家":e.feedbackState.bottonAgreeText="同意退货,发送退货地址";break;case 22:e.feedbackState={title:"已退货，等待商家确认收货",titleIcon:"",titleInfo:"买家已退货，请关注退货信息!",bottonAgreeText:"已收到货，同意退款",bottonRejectText:"拒绝退货申请"},e.feedbackState.bottonAgreeStatus=!0,e.feedbackState.bottonRejectStatus=!1,e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0;break;case 30:e.feedbackState={title:"第三方退款中",titleIcon:"",titleInfo:"退款金额:￥"+e.feedbackData.refund_info.refund_amount,bottonAgreeText:"",bottonRejectText:""},e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0,1==t.refund_info.feedback&&1==t.refund_info.type&&(e.refundItem[3].type=!0);break;case 31:e.feedbackState={title:"退款成功",titleIcon:"",titleInfo:"退款金额:￥"+t.refund_info.refund_amount,bottonAgreeText:"",bottonRejectText:""},e.refundItem[0].type=!0,e.refundItem[1].type=!0,e.refundItem[2].type=!0,1==t.refund_info.feedback&&(0==t.refund_info.type&&(e.refundItem[3].type=!0),1==t.refund_info.type&&(e.refundItem[3].type=!0,e.refundItem[4].type=!0)),0==t.refund_info.feedback&&1==t.refund_info.type&&(e.refundItem[3].type=!0);break;case 40:e.feedbackState={title:"已关闭",titleIcon:"",titleInfo:"申请已经关闭",bottonAgreeText:"",bottonRejectText:""};break;case 41:e.feedbackState={title:"用户已关闭",titleIcon:"",titleInfo:"申请已经关闭",bottonAgreeText:"",bottonRejectText:""}}}e.angular=angular,e.refundItem=[],t.get({id:a.id},function(t){e.feedbackData=t,r(t)}),e.agreeFeedback=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.feedback.agree.html",controller:"agreeFeedback",resolve:{data:function(){var t=e.feedbackData;return t}}});t.result.then(function(t){t&&(e.feedbackData=t.data,r(t.data))})},e.rejectFeedback=function(){var t=o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.feedback.reject.html",controller:"rejectFeedback",resolve:{data:function(){var t=e.feedbackData;return t}}});t.result.then(function(t){t&&(e.feedbackData=t.data,r(t.data))})},e.expressSet=function(t,a,s){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},n.save(e.orderQureyData,function(e){if(e.status){o.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return s}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})}}]),e.controller("agreeFeedback",["$scope","$modalInstance","data","feedback","Flash",function(e,t,a,o,s){e.agreeData=a,e.returnInfo={id:a.refund_info.refund_id,refundtype:a.refund_info.type,status:a.refund_info.status,order_goods_id:a.goods_info.order_goods_id,address:""},0==e.agreeData.refund_info.type&&(e.bottonText="同意"),1==e.agreeData.refund_info.type&&(10!=e.agreeData.refund_info.status&&11!=e.agreeData.refund_info.status&&12!=e.agreeData.refund_info.status&&21!=e.agreeData.refund_info.status||(e.bottonText="同意"),20!=e.agreeData.refund_info.status&&22!=e.agreeData.refund_info.status||(e.bottonText="确认收到货,并退款给买家")),e.butStatus=!1,e.confirm=function(){if(""!=e.returnInfo.address||1!=a.refund_info.type||10!=a.refund_info.status&&11!=a.refund_info.status&&12!=a.refund_info.status&&21!=a.refund_info.status)if(1==e.returnInfo.refundtype){if(10==e.returnInfo.status||11==e.returnInfo.status||12==e.returnInfo.status||21==e.returnInfo.status){var n={id:e.returnInfo.id,type:1,address:e.returnInfo.address,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.update(n,function(a){1==a.success?(t.close(a),s.create("success","您已同意买家的退款"),e.cancel()):s.create("danger",a.error),e.butStatus=!1})}if(20==e.returnInfo.status||22==e.returnInfo.status){var n={id:e.returnInfo.id,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.refund(n,function(a){if(1==a.success)if(angular.isUndefined(a.data.feedback_url))t.close(a),s.create("success","您已同意买家的退款"),e.cancel();else{window.open(a.data.feedback_url),e.cancel();$modal.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return a.data.feedback_url}}})}else s.create("danger",a.error);e.butStatus=!1})}}else{var n={id:e.returnInfo.id,type:1,order_goods_id:e.returnInfo.order_goods_id};e.butStatus=!0,o.update(n,function(a){if(1==a.success)if(angular.isUndefined(a.data.feedback_url))t.close(a),s.create("success","您已同意买家的退款"),e.cancel();else{window.open(a.data.feedback_url),e.cancel();$modal.open({animation:!1,templateUrl:"feedbackModal.html",controller:"modalFeedback",resolve:{url:function(){return a.data.feedback_url}}})}else s.create("danger",a.error);e.butStatus=!1})}else s.create("danger","请填写退货地址")},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("rejectFeedback",["$scope","$modalInstance","data","feedback","Flash",function(e,t,a,o,s){e.rejectData=a,e.rejectInfo={id:a.refund_info.refund_id,refundtype:a.refund_info.type,status:a.refund_info.status,order_goods_id:a.goods_info.order_goods_id,reason:""},e.butStatus=!1,e.confirm=function(){""==e.rejectInfo.reason?s.create("danger","请填写拒绝理由"):(e.butStatus=!0,o.update({id:e.rejectInfo.id,reason:e.rejectInfo.reason,type:"2",order_goods_id:e.rejectInfo.order_goods_id},function(a){1==a.success?(t.close(a),s.create("success","提交成功"),e.cancel()):s.create("danger","提交失败"),e.butStatus=!1}))},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("modalFeedback",["$scope","$state","$modalInstance","url",function(e,t,a,o){e.goUrl=o,e.refresh=function(){a.close(),t.reload()}}])}),define("apps/hotel/controllers/hotel.order.detail",["apps/common/controllers/controllers"],function(e){e.controller("hotel.order.detail",["$scope","HotelOrderDetail","saveDeliver","reviseprice","orderpick","$resource","$stateParams","$modal","$http","Flash","orderQureyPay","getexpress",function(e,t,a,o,s,n,r,i,c,l,d,p){function u(t){switch(19==t.status||20==t.status?e.step[0].at=t.created_at:30==t.status?(e.step[0].at=t.created_at,e.step[1].at=t.pay_at):40==t.status?(e.step[0].at=t.created_at,e.step[1].at=t.pay_at,e.step[2].at=t.hotel_res.in_at):50==t.status&&(e.step[0].at=t.created_at,e.step[1].at=t.pay_at,e.step[2].at=t.hotel_res.in_at,e.step[3].at=t.hotel_res.out_at),e.isButShow={price:!1,address:!1,store:!1,delivery:!1,extend:!1,pick:!1,close:!1},t.status){case 10:e.orderStatus={title:"订单取消",text:"自动取消;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"自动取消"};break;case 11:e.orderStatus={title:"订单关闭",text:"买家取消订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"买家取消订单"};break;case 12:e.orderStatus={title:"订单取消",text:"订单取消原因："+e.orderdetail.explain,style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"商家取消"};break;case 13:e.orderStatus={title:"订单关闭",text:"维权完成关闭订单;",style:"orderclose",icon:"fa-exclamation-circle",statusInfo:"维权完成关闭订单"};break;case 19:e.orderStatus={title:"买家已下单",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,e.isButShow.close=!0,e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 20:e.orderStatus={title:"待付款",text:"如买家未在规定时间内付款，订单将按照设置逾期自动关闭;",style:"success",icon:"fa-clock-o",statusInfo:"待付款"},e.step[0].type=!0,0==t.is_selffetch_type&&(e.isButShow.address=!0),1==t.is_selffetch_type&&(e.isButShow.store=!0),e.isButShow.price=!0,e.isButShow.close=!0,e.isButShow.delivery=!1,e.isButShow.pick=!1;break;case 30:e.orderStatus={title:"待入住",text:"买家已付款，等待入住;",style:"success",icon:"fa-clock-o",statusInfo:"待入住"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.price=!1,e.isButShow.pick=!1,e.isButShow.close=!1;break;case 31:e.orderStatus={title:"货到付款 待发货",text:"买家选择了货到付款，请尽快发货;",style:"success",icon:"fa-clock-o",statusInfo:"待发货"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type?e.isButShow.address=!0:e.isButShow.address=!1,1==t.is_selffetch_type?e.isButShow.store=!0:e.isButShow.store=!1,e.isButShow.delivery=!0,e.isButShow.close=!0,e.isButShow.price=!1,e.isButShow.pick=!1;break;case 32:e.orderStatus={title:"针对上门自提，待取货",text:"买家已选择上门自提，等待买家上门自提;",style:"success",icon:"fa-clock-o",statusInfo:"待买家上门自提"},e.step[0].type=!0,e.step[1].type=!0,1==t.is_selffetch_type?e.isButShow.pick=!0:e.isButShow.pick=!1,"cod"==t.payment_code?e.isButShow.close=!0:e.isButShow.close=!1,e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1;break;case 40:e.orderStatus={title:"已入住",text:"已入住 没有申请退款，交易将自动完成；",style:"success",icon:"fa-clock-o",statusInfo:"已入住"},e.step[0].type=!0,e.step[1].type=!0,0==t.is_selffetch_type&&(e.step[2].type=!0),
e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.extend=!0,e.isButShow.close=!1;break;case 50:e.orderStatus={title:"已离店",text:"交易成功",style:"success",icon:"fa-check-circle-o",statusInfo:"已离店"},e.step[0].type=!0,e.step[1].type=!0,e.step[2].type=!0,4!=e.orderType&&(e.step[3].type=!0),e.isButShow.price=!1,e.isButShow.address=!1,e.isButShow.store=!1,e.isButShow.delivery=!1,e.isButShow.pick=!1,e.isButShow.close=!1}}e.step=[{type:!1,title:"买家下单",at:""},{type:!1,title:"在线付款",at:""},{type:!1,title:"客户入住",at:""},{type:!1,title:"客户离店",at:""}],e.orderdetaildata=function(){t.get({id:r.id},function(t){e.orderdetail=t,u(t)})},e.orderdetaildata(),e.updateAddress=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.address.html",controller:"updateAddress",resolve:{data:function(){return t},cityData:function(){return e.cityInfo}}});a.result.then(function(t){t&&(e.orderdetail.province=t.province,e.orderdetail.province_name=t.province_name,e.orderdetail.city=t.city,e.orderdetail.city_name=t.city_name,e.orderdetail.district=t.district,e.orderdetail.district_name=t.district_name,e.orderdetail.address=t.address,e.orderdetail.zipcode=t.zipcode,e.orderdetail.consignee=t.consignee,e.orderdetail.mobile=t.mobile)})},e.updateStore=function(e){var t=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.store.html",controller:"updateStore",resolve:{data:function(){return e}}});t.result.then(function(t){order.setStore({order_id:e.id,store_id:t.id},function(a){a.success?(l.create("success","修改成功"),e.selffetch_store=angular.copy(t)):l.create("danger","修改失败")})})},e.updateHotelActiveRefund=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/hotel/templates/order.hotel.active.rafund.html",controller:"order.hotel.active.rafund",resolve:{rafundData:function(){return t}}});a.result.then(function(t){e.orderdetaildata()})},e.revisePrice=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.reviseprice.html",controller:"revisePrice",resolve:{data:function(){return t},isList:function(){return!1}}});a.result.then(function(a){a&&(e.orderdetail=a.data,u(t))})},e.saveDelivery=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.delivery.html",controller:"saveDelivery",resolve:{data:function(){return t},isList:function(){return!1}}});a.result.then(function(t){t&&(e.orderdetail=t.data,messageList(),u(e.orderdetail))})},e.setDelivery=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.setdelivery.html",controller:"setDelivery",resolve:{data:function(){return t},order_id:function(){return e.orderdetail.id}}});a.result.then(function(e){e&&(t.logis_name=e.name,t.logis_no=e.number)})},e.closeOrder=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.close.html",controller:"closeOrder",resolve:{data:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,u(e.orderdetail))})},e.expressSet=function(t,a,o){e.orderQureyData={merchant_id:_global.shop.merchant_id,shop_id:_global.shop.id,logis_no:t},d.save(e.orderQureyData,function(e){if(e.status){i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.express.html",controller:"expressOrder",resolve:{data:function(){return t},logis_code:function(){return o}}})}else window.open("http://www.kuaidi100.com/chaxun?com="+a+"&nu="+t,"_blank")})},e.orderPick=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.pick.html",controller:"orderPickCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail=t.data,u(e.orderdetail))})},e.orderExtend=function(t){var a=i.open({animation:!1,templateUrl:"assets/js/apps/order/templates/order.extend.html",controller:"orderExtendCont",resolve:{id:function(){return t}}});a.result.then(function(t){t&&(e.orderdetail.finished_at=t,u(e.orderdetail))})}}]),e.controller("orderPickCont",["$scope","$modalInstance","orderpick","id","Flash",function(e,t,a,o,s){e.but={text:"确定",status:!1},e.confirm=function(){e.but.text="提交中",e.but.status=!0,a.update({id:o},function(a){1==a.success?(s.create("success","设置成功"),t.close(a)):s.create("danger",a.error.msg),e.but.text="确定",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("setDelivery",["$scope","$modalInstance","getDelivery","order","data","order_id","Flash",function(e,t,a,o,s,n,r){e.oldModalData=s,e.modalData=angular.copy(s),a.get({id:n},function(t){e.deliveryList=t.deliveryInfo,e.address=t.addressInfo.province_name+t.addressInfo.city_name+t.addressInfo.district_name+t.addressInfo.address+" , "+t.addressInfo.consignee+" , "+t.addressInfo.mobile}),e.deliveryInfo={isOther:0,id:e.modalData.id,name:e.modalData.logis_name,otherName:e.modalData.logis_name,code:e.modalData.logis_code,number:e.modalData.logis_no},1==e.modalData.type&&(e.deliveryInfo.isOther=1,e.deliveryInfo.otherName="其他物流"),e.set_delivery=function(t,a,o){e.deliveryInfo.isOther=t,e.deliveryInfo.otherName=a,0==t?(e.deliveryInfo.name=a,e.deliveryInfo.code=o):(e.deliveryInfo.name="",e.deliveryInfo.code="")},e.but={text:"修改",status:!1},e.confirm=function(){var a=/^[0-9a-zA-Z]+$/,s=!1;0==e.deliveryInfo.isOther?""!=e.deliveryInfo.number?a.test(e.deliveryInfo.number)?s=!0:(r.create("danger","请输入正确的物流单号"),s=!1):(r.create("danger","请填写物流信息"),s=!1):""!=e.deliveryInfo.name&&""!=e.deliveryInfo.number?a.test(e.deliveryInfo.number)?s=!0:(r.create("danger","请输入正确的物流单号"),s=!1):""==e.deliveryInfo.name?(r.create("danger","请填写物流公司名称"),s=!1):""==e.deliveryInfo.number&&(r.create("danger","请填写物流单号"),s=!1),s&&(e.but.text="提交中",e.but.status=!0,o.setDelivery(e.deliveryInfo,function(a){1==a.success?(r.create("success","修改成功"),t.close(e.deliveryInfo)):r.create("danger",a.error),e.but.text="修改",e.but.status=!1}))},e.cancel=function(){t.dismiss("cancel")}}]),e.controller("orderExtendCont",["$scope","$modalInstance","order","id","Flash",function(e,t,a,o,s){e.but={text:"提交",status:!1},e.saveInfo={day:"3"},e.confirm=function(){e.but.text="提交中",e.but.status=!0,a.extend({id:o,day:e.saveInfo.day},function(a){1==a.success?(s.create("success","修改成功"),t.close(a.data)):s.create("danger",a.error),e.but.text="提交",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/hotel/controllers/order.hotel.active.rafund",["apps/common/controllers/controllers"],function(e){e.controller("order.hotel.active.rafund",["$scope","$modalInstance","rafundData","HotelActiveRefund","Flash","HotelOrderRefundInfo",function(e,t,a,o,s,n){e.info={},e._global=_global,e.rafundData=a,n.get({id:a.id},function(t){e.info={id:t.order_goods_id,order_id:a.id,is_reside:t.is_reside,amount:t.amount,credit:t.credit,memo:"",quantity:t.quantity}}),e.but={text:"发起退款",status:!1},e.saverevisePrice=function(){e.but.text="提交中",e.but.status=!0,o.refund(e.info,function(a){1==a.status?(s.create("success","确认成功"),t.close(a)):s.create("danger",a.msg),e.but.text="确定",e.but.status=!1})},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/hotel/controllers/_base",["apps/hotel/controllers/order","apps/hotel/controllers/order_details","apps/hotel/controllers/intake_record","apps/hotel/controllers/dashboard","apps/hotel/controllers/save_dashboard","apps/hotel/controllers/rooms_add","apps/hotel/controllers/rooms_list","apps/hotel/controllers/manage","apps/hotel/controllers/manage.detail","apps/hotel/controllers/rooms.stock","apps/hotel/controllers/rooms.date","apps/hotel/controllers/rooms.priceWindow","apps/hotel/controllers/rooms.stockWindow","apps/hotel/controllers/order.sethoteltype","apps/hotel/controllers/order.sethotelstayIn","apps/hotel/controllers/order.hotel.revisePrice","apps/hotel/controllers/order.hotel.feedback","apps/hotel/controllers/hotel.order.detail","apps/hotel/controllers/order.hotel.active.rafund"],function(){}),define("apps/hotel/services/hotel_info",["apps/common/services/services"],function(e){e.factory("hotelOrder",["$resource",function(e){return e("/hotel/order_list.json",{id:"@id"},{query:{url:"/hotel/order_list.json"}})}]),e.factory("hotelInfoStat",["$resource",function(e){return e("/hotel/base/config.json",{},{query:{method:"GET",url:"/hotel/base/config.json"},save:{method:"PUT",url:"/hotel/base/config.json"}})}]),e.factory("HotelBaseConfig",["$resource",function(e){return e("/hotel/base/config.json",{},{post:{method:"POST",url:"/hotel/base/config.json"}})}]),e.factory("HotelStores",["$resource",function(e){return e("/hotel/stores.json",{},{get:{method:"GET",url:"/hotel/stores.json"}})}]),e.factory("HotelStoreDtail",["$resource",function(e){return e("/hotel/store/:id.json",{id:"@id"},{get:{method:"GET",url:"/hotel/store/:id.json"},delete:{method:"DELETE",url:"/hotel/store/:id.json"}})}]),e.factory("HotelRoomsList",["$resource",function(e){return e("/hotel/goods.json",{id:"@id"},{query:{method:"GET",url:"/hotel/goods.json"},get:{method:"GET",url:"/hotel/goods/:id.json"},delete:{method:"DELETE",url:"/hotel/goods/:id.json"},update:{method:"PUT",url:"/hotel/goods/:id.json"},save:{method:"POST",url:"/hotel/goods.json"}})}]),e.factory("HotelStoreGoodsCart",["$resource",function(e){return e("/hotel/goods/cat.json",{},{get:{method:"GET",url:"/hotel/goods/cat.json"}})}]),e.factory("HotelRoomsPutStock",["$resource",function(e){return e("/hotel/room_bstock.json",{},{update:{method:"PUT",url:"/hotel/room_bstock.json"}})}]),e.factory("HotelRoomsPutPrice",["$resource",function(e){return e("/hotel/room_price.json",{},{update:{method:"PUT",url:"/hotel/room_price.json"}})}]),e.factory("HotelRoomsCheckGoods",["$resource",function(e){return e("/hotel/check_goods/:id.json",{id:"@id"},{update:{method:"PUT",url:"/hotel/check_goods/:id.json"}})}]),e.factory("HotelOrderRefundInfo",["$resource",function(e){return e("/hotel/order_refund_info/:id.json",{id:"@id"},{get:{method:"GET",url:"/hotel/order_refund_info/:id.json"}})}]),e.factory("HotelOrderCheckRaside",["$resource",function(e){return e("/hotel/check_reside/:id.json",{id:"@id"},{update:{method:"PUT",url:"/hotel/check_reside/:id.json"}})}]),e.factory("HotelQrcode",["$resource",function(e){return e("/hotel/hotel_code:id.json",{id:"@id"},{qrcode:{method:"GET",url:"/hotel/hotel_code/:id.json"}})}]),e.factory("HotelOrderall",["$resource",function(e){return e("/hotel/order/star/set.json",{id:"@id"},{setStar:{method:"PUT",url:"/hotel/order/star/set.json"},setRemarks:{method:"PUT",url:"/hotel/order/remarks.json"}})}]),e.factory("HotelOrderDetail",["$resource",function(e){return e("/hotel/order/:id.json",{id:"@id"},{setStar:{method:"PUT",url:"/hotel/order/:id.json"}})}]),e.factory("HotelOrderleave",["$resource",function(e){return e("/hotel/order/finish/:id.json",{id:"@id"},{update:{method:"PUT",url:"/hotel/order/finish/:id.json"}})}]),e.factory("HotelActiveRefund",["$resource",function(e){return e("/hotel/order_refund.json",{},{refund:{method:"POST",url:"/hotel/order_refund.json"}})}]),e.factory("HotelSetOrderPrice",["$resource",function(e){return e("/hotel/order/set/order_price.json",{},{update:{method:"PUT",url:"/hotel/order/set/order_price.json"}})}]),e.factory("HotelData",[function(){var e={selectedGoodsTags:[],cate:[],isCateSelect:!1,goods_cat_id:0,prop:[],props:{},title:"",imgs:[],serve_label:0,label_ids:[],is_sku:0,is_discount:0,noDeliveryArea:{region_ids:[],region_names:""},skus:[],skuData:[],skuStock:[],products:{},tags:[],original_price:null,price:null,stock:null,goods_sn:null,barcode:null,shipment_type:0,shipmentType:0,shipments:[],shipment:null,postage:null,weight:null,volume:null,stockType:0,stock_type:0,onsale_type:0,onsale_at:"",collect_fields:[],intro:"",components_data:[],designGoodsTpl:0,cquota:0,slices:[],description:"",external_type:0,base_csale:0,stores:[],selectStores:[],onsale:1,unshelve_at:""},t=angular.copy(e);return t.init=function(){return t=angular.copy(e)},t.isStep=!1,t}])}),define("apps/hotel/services/_base",["apps/hotel/services/hotel_info"],function(){}),define("apps/hotel/main",["apps/hotel/states/_base","apps/hotel/controllers/_base","apps/hotel/services/_base"],function(){}),define("apps/game/states/bigwheel",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.game",{url:"/game",templateUrl:"assets/js/apps/game/templates/layout.html"}).state("shop.game.bigwheel",{abstract:!0,url:"/bigwheel",template:"<div ui-view></div>"}).state("shop.game.bigwheel.list",{url:"/list",templateUrl:"assets/js/apps/game/templates/bigwheel.list.html",controller:"shop.game.bigwheel.list"}).state("shop.game.bigwheel.records",{url:"/records/:type_id",templateUrl:"assets/js/apps/game/templates/bigwheel.records.html",controller:"shop.game.bigwheel.records"}).state("shop.game.bigwheel.user_records",{url:"/user_records/:type_id",templateUrl:"assets/js/apps/game/templates/bigwheel.user_records.html",controller:"shop.game.bigwheel.user_records"}).state("shop.game.bigwheel.add",{url:"/add",templateUrl:"assets/js/apps/game/templates/bigwheel.add.html",controller:"shop.game.bigwheel.add"}).state("shop.game.bigwheel.editor",{url:"/add/:type_id/:type",templateUrl:"assets/js/apps/game/templates/bigwheel.add.html",controller:"shop.game.bigwheel.add"}).state("shop.game.bigwheel.look",{url:"/look/:type_id",templateUrl:"assets/js/apps/game/templates/bigwheel.look.html",controller:"shop.game.bigwheel.look"})}])}),define("apps/game/states/_base",["apps/game/states/bigwheel"],function(){}),define("apps/game/services/bigwheel",["apps/common/services/services"],function(e){e.factory("bigwheelResource",["$resource",function(e){return e("/activity/bigwheel_list.json",{id:"@id"},{get:{method:"GET",url:"/activity/bigwheel_list.json"},changeStatus:{method:"POST",url:"/activity/bigwheel_change_status/:id.json"},delOne:{method:"POST",url:"/activity/bigwheel_del/:id.json"},getQrcodeInfo:{method:"GET",url:"/activity/bigwheel_qrcode/:id.json"}})}]),e.factory("bigwheel_records_Resource",["$resource",function(e){return e("/activity/bigwheel_winlist.json",{id:"@id"},{get:{method:"GET",url:"/activity/bigwheel_winlist.json"},detail:{method:"GET",url:"/activity/bigwheel_windetail/:id.json"},delOne:{method:"POST",url:"/activity/bigwheel_windelone/:id.json"},delAll:{method:"POST",url:"/activity/bigwheel_windelall.json"},exchange:{method:"POST",url:"/activity/bigwheel_winexchange/:id.json"}})}]),e.factory("bigwheel_user_records_Resource",["$resource",function(e){return e("/activity/bigwheel_joinuserlist.json",{id:"@id"},{get:{method:"GET",url:"/activity/bigwheel_joinuserlist.json"},detail:{method:"GET",url:"/activity/bigwheel_joinuserdetail/:id.json"},delOne:{method:"POST",url:"/activity/bigwheel_joinuserdelone/:id.json"},delAll:{method:"POST",url:"/activity/bigwheel_joinuserdelall.json"}})}]),e.factory("bigwheel_add_Resource",["$resource",function(e){return e("bigwheel_save",{id:"@id"},{post:{method:"POST",url:"/activity/bigwheel_save/:id.json"},musicList:{method:"GET",url:"/activity/bigwheel_musiclibrary.json"},quanList:{method:"GET",url:"/activity/bigwheel_coupons_list.json"},list_info:{method:"GET",url:"/activity/bigwheel_info/:id.json"}})}])}),define("apps/game/services/_base",["apps/game/services/bigwheel"],function(){}),define("apps/game/controllers/bigwheel.list",["apps/common/controllers/controllers"],function(e){e.controller("shop.game.bigwheel.list",["$scope","$state","bigwheelResource","Flash","ngPopover",function(e,t,a,o,s){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={activity_name:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var n=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.search=function(){1==e.paginationConf.currentPage?n():e.paginationConf.currentPage=1},e.changeStatus=function(e){if("fa fa-pause"==$("#status_"+e).attr("class"))var t=0;else var t=1;a.changeStatus({id:e},{activity_on_off:t},function(a){1==a.status?1==t?($("#status_"+e).attr("class","fa fa-pause"),$("#status_span_"+e).html("进行中")):($("#status_"+e).attr("class","fa fa-play"),$("#status_span_"+e).html("已关闭")):o.create("danger",a.msg)})},e.remove=function(t){a.delOne({id:t},function(t){1==t.status?(o.create("success",t.msg),e.search()):o.create("danger",t.msg)})},e.showQrcode=function(t){a.getQrcodeInfo({id:t},function(t){e.qrcodeInfo=t})},e.showMessage=function(){s.close(),o.create("success"," 复制成功！")},e.fallback=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)}}])}),define("apps/game/controllers/bigwheel.records",["apps/common/controllers/controllers"],function(e){e.controller("shop.game.bigwheel.records",["$scope","$state","bigwheel_records_Resource","Flash","$stateParams","$modal",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={type_id:s.type_id,state:"0",search_user_type:"1",search_user:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var r=function(){e.bigwheel={checkedAll:!1},e.checkedIds=[],e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.activity_list=t.activity_list})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.bigwheel={checkedAll:!1},e.checkedIds=[],e.$watch("bigwheel.checkedAll",function(t){t?e.checkedIds=e.data.map(function(e){return e.id}):e.checkedIds=[]}),e.toggleSelection=function(t){var a=e.checkedIds.indexOf(t);a>-1?e.checkedIds.splice(a,1):e.checkedIds.push(t)},e.removeall=function(){return 0==e.checkedIds.length?(o.create("danger","请选择删除的内容"),!1):void a.delAll({ids:e.checkedIds},function(t){1==t.status?(o.create("success",t.msg),e.search()):o.create("danger",t.msg)})},e.remove=function(t){a.delOne({id:t},function(t){1==t.status?(o.create("success",t.msg),e.search()):o.create("danger",t.msg)})},e.exchange=function(t){a.exchange({id:t},function(t){1==t.status?(o.create("success",t.msg),e.search()):o.create("danger",t.msg)})},e.data_go=function(){var t="/activity/bigwheel_winlist.json?export=1";angular.forEach(e.searchInfo,function(e,a){e&&(t+="&"+a+"="+e)}),window.location.href=t,o.create("success","正在导出,请等待...")},e.windetail=function(e){var t=n.open({animation:!1,templateUrl:"assets/js/apps/game/templates/bigwheel.windetail.html",controller:"windetail",resolve:{data:function(){return e}}});t.result.then(function(e){})}}]),e.controller("windetail",["$scope","$modalInstance","data","bigwheel_records_Resource","Flash",function(e,t,a,o,s){o.detail({id:a},function(t){1==t.status?e.data=t.info:s.create("danger",t.msg)}),e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/game/controllers/bigwheel.user_records",["apps/common/controllers/controllers"],function(e){e.controller("shop.game.bigwheel.user_records",["$scope","$state","bigwheel_user_records_Resource","Flash","$stateParams","$modal",function(e,t,a,o,s,n){e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={type_id:s.type_id,search_user_type:"1",search_user:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var r=function(){e.bigwheel={checkedAll:!1},e.checkedIds=[],e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,a.get(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.data=t.data,e.activity_list=t.activity_list})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.bigwheel={checkedAll:!1},e.checkedIds=[],e.$watch("bigwheel.checkedAll",function(t){t?e.checkedIds=e.data.map(function(e){return e.id}):e.checkedIds=[]}),e.toggleSelection=function(t){var a=e.checkedIds.indexOf(t);a>-1?e.checkedIds.splice(a,1):e.checkedIds.push(t)},e.removeall=function(){return 0==e.checkedIds.length?(o.create("danger","请选择删除的内容"),!1):void a.delAll({ids:e.checkedIds},function(t){1==t.status?(o.create("success",t.msg),e.search()):o.create("danger",t.msg)})},e.remove=function(t){a.delOne({id:t},function(t){1==t.status?(o.create("success",t.msg),e.search()):o.create("danger",t.msg)})},e.data_go=function(){var t="/activity/bigwheel_joinuserlist.json?export=1";angular.forEach(e.searchInfo,function(e,a){e&&(t+="&"+a+"="+e)}),window.location.href=t,o.create("success","正在导出,请等待...")},e.userdetail=function(e){var t=n.open({animation:!1,templateUrl:"assets/js/apps/game/templates/bigwheel.userdetail.html",controller:"userdetail",resolve:{data:function(){return e}}});t.result.then(function(e){})}}]),e.controller("userdetail",["$scope","$modalInstance","data","bigwheel_user_records_Resource","Flash",function(e,t,a,o,s){o.detail({id:a},function(t){1==t.status?e.data=t.info:s.create("danger",t.msg)}),e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/game/controllers/bigwheel.add",["apps/common/controllers/controllers"],function(e){e.controller("shop.game.bigwheel.add",["$scope","$state","bigwheel_add_Resource","Flash","$modal","$stateParams",function(e,t,a,o,s,n){e.bigwheelgame={activity_name:"",logo:"",activity_template:"1",activity_describe:"",musicfrom_id:"0",backmusic_url:"",musiclibrary_id:"0",uploadmusic_url:"",notwin_describe:"",gameover_content:"",ad_on_off:"",ad_image:"",starttime:"",endtime:"",cjts:"0",cjcs:"",wintimes:"",gather_type:"",f_on_off:"",firststarttime:"",firstendtime:"",type1:"0",type2:"0",type3:"0",type4:"0",type5:"0",type6:"0",awards1:"",awards2:"",awards3:"",awards4:"",awards5:"",awards6:"",pb1:"",pb2:"",pb3:"",pb4:"",pb5:"",pb6:"",sum1:"",sum2:"",sum3:"",sum4:"",sum5:"",sum6:"",image1:"",image2:"",image3:"",image4:"",image5:"",image6:"",coupon1:"",coupon2:"",coupon3:"",coupon4:"",coupon5:"",coupon6:"",restrict1:"",restrict2:"",restrict3:"",restrict4:"",restrict5:"",restrict6:"",upmusic_arrinfo:""},e.ranges={"今天":[moment(),moment().endOf("day")],"明天":[moment().add("days",1).startOf("day"),moment().add("days",1).endOf("day")],"一个周":[moment(),moment().add("days",7)],"15天":[moment(),moment().add("days",15)]},e.listinfo={type_id:n.type_id,type:n.type},e.active_type="add",e.active_type=void 0==e.$stateParams.type?"add":e.$stateParams.type,"add"!=e.active_type&&a.list_info({id:e.listinfo.type_id},function(t){e.bigwheelgame=t.info,e.bigwheelgame.musicfrom_id=String(e.bigwheelgame.musicfrom_id),e.bigwheelgame.musiclibrary_id=String(e.bigwheelgame.musiclibrary_id);var a=e.bigwheelgame.activity_template,o=a-1;$(".tempBigwheel").attr("ng-value",o),$(".tempBigwheel>li").eq(o).addClass("temp_active").siblings().removeClass();var s="game_bg"+a,n=e._global.source_url+"/xiaodian/game/new_rotor/tle"+a+".png",r=e._global.source_url+"/xiaodian/game/new_rotor/zp_bg"+a+".png",i=e._global.source_url+"/xiaodian/game/new_rotor/zp_logo"+a+".jpg";$(".user_logo").attr("src",n),$(".games_zp_img").attr("src",r),$(".games_zp_logo").attr("src",i),$(".game_bg").removeClass().addClass("game_bg").addClass(s),0==e.bigwheelgame.ad_on_off?e.imgShow=!1:e.imgShow=!0;var c=e.bigwheelgame.starttime,l=e.bigwheelgame.endtime,d=""+c+"/"+l;$('input[name="created_range"]').attr("value",d);var p=e.bigwheelgame.cjts;$('select[name="date_chose"]').val(p);var u=e.bigwheelgame.gather_type;$('.msgInp input[name="msg_game"][value='+u+"]").attr("checked",!0),0==e.bigwheelgame.f_on_off?e.f_check_imgShow=!1:e.f_check_imgShow=!0;var m=e.bigwheelgame.firststarttime,g=e.bigwheelgame.firstendtime;if(m&&g){var f=""+m+"/"+g;$('input[name="f_range"]').attr("value",f)}var h=e.bigwheelgame.type1;$('select[name="type_1"]').val(h),$('select[name="type_1"]').attr("data-id",h);var _=e.bigwheelgame.awards1;$('input[name="type_name_1"]').val(_),$("#zhuanjp1").html(_);var v=e.bigwheelgame.coupon1;$(".gh_1").val(v);var y=e.bigwheelgame.pb1;0==y&&(y=""),$('input[name="type_pa_1"]').val(y);var b=e.bigwheelgame.sum1;0==b&&(b=""),$('input[name="type_size_1"]').val(b);var k=e.bigwheelgame.restrict1;1==k?$(".rt1").attr({value:k,checked:!0}):$(".rt1").attr({value:k,checked:!1}),1==h&&$(".type_img_1").show(),2==h&&$(".type_quan_1").show(),0!=h?$(".rest1").show():$(".rest1").hide(),2==h&&($('input[name="type_pa_1"]').attr("readonly",!1),$(".type_quan_1 .btn").html("修改券")),1==h&&($('input[name="type_pa_1"]').attr("readonly",!1),$('input[name="type_name_1"]').attr("readonly",!1),$('input[name="type_size_1"]').attr("readonly",!1));var P=e.bigwheelgame.type2;$('select[name="type_2"]').val(P),$('select[name="type_2"]').attr("data-id",P);var w=e.bigwheelgame.awards2;$('input[name="type_name_2"]').val(w),$("#zhuanjp2").html(w);var D=e.bigwheelgame.coupon2;$(".gh_2").val(D);var C=e.bigwheelgame.pb2;0==C&&(C=""),$('input[name="type_pa_2"]').val(C);var x=e.bigwheelgame.sum2;0==x&&(x=""),$('input[name="type_size_2"]').val(x);var I=e.bigwheelgame.restrict2;1==I?$(".rt2").attr({value:I,checked:!0}):$(".rt2").attr({value:I,checked:!1}),1==P&&$(".type_img_2").show(),2==P&&$(".type_quan_2").show(),0!=P?$(".rest2").show():$(".rest2").hide(),2==P&&($('input[name="type_pa_2"]').attr("readonly",!1),$(".type_quan_2 .btn").html("修改券")),1==P&&($('input[name="type_pa_2"]').attr("readonly",!1),$('input[name="type_name_2"]').attr("readonly",!1),$('input[name="type_size_2"]').attr("readonly",!1));var S=e.bigwheelgame.type3;$('select[name="type_3"]').val(S),$('select[name="type_3"]').attr("data-id",S);var j=e.bigwheelgame.awards3;$('input[name="type_name_3"]').val(j),$("#zhuanjp3").html(j);var T=e.bigwheelgame.coupon3;$(".gh_3").val(T);var E=e.bigwheelgame.pb3;0==E&&(E=""),$('input[name="type_pa_3"]').val(E);var R=e.bigwheelgame.sum3;0==R&&(R=""),$('input[name="type_size_3"]').val(R);var U=e.bigwheelgame.restrict3;1==U?$(".rt3").attr({value:U,checked:!0}):$(".rt3").attr({value:U,checked:!1}),1==S&&$(".type_img_3").show(),2==S&&$(".type_quan_3").show(),0!=S?$(".rest3").show():$(".rest3").hide(),2==S&&($('input[name="type_pa_3"]').attr("readonly",!1),$(".type_quan_3 .btn").html("修改券")),1==S&&($('input[name="type_pa_3"]').attr("readonly",!1),$('input[name="type_name_3"]').attr("readonly",!1),$('input[name="type_size_3"]').attr("readonly",!1));var F=e.bigwheelgame.type4;$('select[name="type_4"]').val(F),$('select[name="type_4"]').attr("data-id",F);var G=e.bigwheelgame.awards4;$('input[name="type_name_4"]').val(G),$("#zhuanjp4").html(G);var A=e.bigwheelgame.coupon4;$(".gh_4").val(A);var L=e.bigwheelgame.pb4;0==L&&(L=""),$('input[name="type_pa_4"]').val(L);var M=e.bigwheelgame.sum4;0==M&&(M=""),$('input[name="type_size_4"]').val(M);var O=e.bigwheelgame.restrict4;1==O?$(".rt4").attr({value:O,checked:!0}):$(".rt4").attr({value:O,checked:!1}),1==F&&$(".type_img_4").show(),2==F&&$(".type_quan_4").show(),0!=F?$(".rest4").show():$(".rest4").hide(),2==F&&($('input[name="type_pa_4"]').attr("readonly",!1),$(".type_quan_4 .btn").html("修改券")),1==F&&($('input[name="type_pa_4"]').attr("readonly",!1),$('input[name="type_name_4"]').attr("readonly",!1),$('input[name="type_size_4"]').attr("readonly",!1));var q=e.bigwheelgame.type5;$('select[name="type_5"]').val(q),$('select[name="type_5"]').attr("data-id",q);var B=e.bigwheelgame.awards5;$('input[name="type_name_5"]').val(B),$("#zhuanjp5").html(B);var z=e.bigwheelgame.coupon5;$(".gh_5").val(z);var V=e.bigwheelgame.pb5;0==V&&(V=""),$('input[name="type_pa_5"]').val(V);var N=e.bigwheelgame.sum5;0==N&&(N=""),$('input[name="type_size_5"]').val(N);var H=e.bigwheelgame.restrict5;1==H?$(".rt5").attr({value:H,checked:!0}):$(".rt5").attr({value:H,checked:!1}),1==q&&$(".type_img_5").show(),2==q&&$(".type_quan_5").show(),0!=q?$(".rest5").show():$(".rest5").hide(),2==q&&($('input[name="type_pa_5"]').attr("readonly",!1),$(".type_quan_5 .btn").html("修改券")),1==q&&($('input[name="type_pa_5"]').attr("readonly",!1),$('input[name="type_name_5"]').attr("readonly",!1),$('input[name="type_size_5"]').attr("readonly",!1));var W=e.bigwheelgame.type6;$('select[name="type_6"]').val(W),$('select[name="type_6"]').attr("data-id",W);var Y=e.bigwheelgame.awards6;$('input[name="type_name_6"]').val(Y),$("#zhuanjp6").html(Y);var Q=e.bigwheelgame.coupon6;$(".gh_6").val(Q);var X=e.bigwheelgame.pb6;0==X&&(X=""),$('input[name="type_pa_6"]').val(X);var J=e.bigwheelgame.sum6;0==J&&(J=""),$('input[name="type_size_6"]').val(J);var K=e.bigwheelgame.restrict6;1==K?$(".rt6").attr({value:K,checked:!0}):$(".rt6").attr({value:K,checked:!1}),1==W&&$(".type_img_6").show(),2==W&&$(".type_quan_6").show(),0!=W?$(".rest6").show():$(".rest6").hide(),2==W&&($('input[name="type_pa_6"]').attr("readonly",!1),$(".type_quan_6 .btn").html("修改券")),1==W&&($('input[name="type_pa_6"]').attr("readonly",!1),$('input[name="type_name_6"]').attr("readonly",!1),$('input[name="type_size_6"]').attr("readonly",!1))}),e.editorOptions={extraPlugins:"uploadimage,widgets",height:"200px",toolbar:[["Widgets","Uploadimage","Table","Link","Unlink","Blockquote","HorizontalRule"],["Find","Preview","Source"],["FontSize","Bold","Italic","Underline","TextColor","BGColor","-","NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]],allowedContent:!0},e.showpic=function(e){$("div.type_img_"+e).css({position:"relative"}),$("img.t_img"+e).attr("src")&&$("img.t_img"+e).css({position:"absolute",left:"89px",top:"1px",display:"block",width:"120px",border:"1px solid rgb(221, 221, 221)",padding:"2px"})},e.hidepic=function(e){$("img.t_img"+e).css({display:"none"})},e.flag=1,e.type="next",e.next=function(t){if("number"==typeof t&&(1==t&&(e.bigwheelgame.nexttype=1,e.bigwheelgame.upmusic_arrinfo&&(e.bigwheelgame.uploadmusic_url=e.bigwheelgame.upmusic_arrinfo.url),a.post({id:0},e.bigwheelgame,function(a){1==a.status?(e.flag=parseInt(t)+1,e.bkType=!1,2===t?e.type="save":e.type="next"):o.create("danger",a.msg)},function(e){o.create("danger",e.data.error.message)})),2==t)){e.bigwheelgame.nexttype=2;var s=$('input[name="created_range"]').val(),n=s.split("/");e.bigwheelgame.starttime=n[0],e.bigwheelgame.endtime=n[1],e.bigwheelgame.gather_type=$('input[name="msg_game"]:checked').val(),a.post({id:0},e.bigwheelgame,function(a){1==a.status?(e.bigwheelgame.nexttype=0,e.flag=parseInt(t)+1,e.bkType=!1,2===t?e.type="save":e.type="next"):o.create("danger",a.msg)},function(e){o.create("danger",e.data.error.message)})}},e.bkType=!0,e.backFlag=function(t){e.bkType||(e.flag=parseInt(t)-1,e.type="next",2==t&&(e.bkType=!0))},e.updateFlag=function(t){if(1==e.flag&&(2==t&&(e.bigwheelgame.nexttype=1,e.bigwheelgame.upmusic_arrinfo&&(e.bigwheelgame.uploadmusic_url=e.bigwheelgame.upmusic_arrinfo.url),a.post({id:0},e.bigwheelgame,function(a){1==a.status?(e.flag=t,1==t?e.bkType=!0:e.bkType=!1,3==t?e.type="save":e.type="next"):o.create("danger",a.msg)},function(e){o.create("danger",e.data.error.message)})),3==t)){e.bigwheelgame.nexttype=2;var s=$('input[name="created_range"]').val(),n=s.split("/");e.bigwheelgame.starttime=n[0],e.bigwheelgame.endtime=n[1],e.bigwheelgame.gather_type=$('input[name="msg_game"]:checked').val(),a.post({id:0},e.bigwheelgame,function(a){1==a.status?(e.bigwheelgame.nexttype=0,e.flag=t,1==t?e.bkType=!0:e.bkType=!1,3==t?e.type="save":e.type="next"):o.create("danger",a.msg)},function(e){o.create("danger",e.data.error.message)})}if(2==e.flag&&(1==t&&(e.flag=t,1==t?e.bkType=!0:e.bkType=!1,3==t?e.type="save":e.type="next"),3==t)){e.bigwheelgame.nexttype=2;var s=$('input[name="created_range"]').val(),n=s.split("/");e.bigwheelgame.starttime=n[0],e.bigwheelgame.endtime=n[1],e.bigwheelgame.gather_type=$('input[name="msg_game"]:checked').val(),a.post({id:0},e.bigwheelgame,function(a){1==a.status?(e.bigwheelgame.nexttype=0,e.flag=t,1==t?e.bkType=!0:e.bkType=!1,3==t?e.type="save":e.type="next"):o.create("danger",a.msg);
},function(e){o.create("danger",e.data.error.message)})}3==e.flag&&(e.flag=t,1==t?e.bkType=!0:e.bkType=!1,3==t?e.type="save":e.type="next")},e.save=function(s){var n=$('input[name="created_range"]').val(),r=n.split("/");e.bigwheelgame.starttime=r[0],e.bigwheelgame.endtime=r[1];var i=$('input[name="f_range"]').val(),c=i.split("/");e.bigwheelgame.firststarttime=c[0],e.bigwheelgame.firstendtime=c[1],e.bigwheelgame.type1=$('select[name="type_1"]').attr("data-id"),e.bigwheelgame.awards1=$('input[name="type_name_1"]').val(),e.bigwheelgame.coupon1=$(".gh_1").val(),e.bigwheelgame.pb1=$('input[name="type_pa_1"]').val(),e.bigwheelgame.sum1=$('input[name="type_size_1"]').val(),e.bigwheelgame.restrict1=$(".rt1").val(),e.bigwheelgame.type2=$('select[name="type_2"]').attr("data-id"),e.bigwheelgame.awards2=$('input[name="type_name_2"]').val(),e.bigwheelgame.coupon2=$(".gh_2").val(),e.bigwheelgame.pb2=$('input[name="type_pa_2"]').val(),e.bigwheelgame.sum2=$('input[name="type_size_2"]').val(),e.bigwheelgame.restrict2=$(".rt2").val(),e.bigwheelgame.type3=$('select[name="type_3"]').attr("data-id"),e.bigwheelgame.awards3=$('input[name="type_name_3"]').val(),e.bigwheelgame.coupon3=$(".gh_3").val(),e.bigwheelgame.pb3=$('input[name="type_pa_3"]').val(),e.bigwheelgame.sum3=$('input[name="type_size_3"]').val(),e.bigwheelgame.restrict3=$(".rt3").val(),e.bigwheelgame.type4=$('select[name="type_4"]').attr("data-id"),e.bigwheelgame.awards4=$('input[name="type_name_4"]').val(),e.bigwheelgame.coupon4=$(".gh_4").val(),e.bigwheelgame.pb4=$('input[name="type_pa_4"]').val(),e.bigwheelgame.sum4=$('input[name="type_size_4"]').val(),e.bigwheelgame.restrict4=$(".rt4").val(),e.bigwheelgame.type5=$('select[name="type_5"]').attr("data-id"),e.bigwheelgame.awards5=$('input[name="type_name_5"]').val(),e.bigwheelgame.coupon5=$(".gh_5").val(),e.bigwheelgame.pb5=$('input[name="type_pa_5"]').val(),e.bigwheelgame.sum5=$('input[name="type_size_5"]').val(),e.bigwheelgame.restrict5=$(".rt5").val(),e.bigwheelgame.type6=$('select[name="type_6"]').attr("data-id"),e.bigwheelgame.awards6=$('input[name="type_name_6"]').val(),e.bigwheelgame.coupon6=$(".gh_6").val(),e.bigwheelgame.pb6=$('input[name="type_pa_6"]').val(),e.bigwheelgame.sum6=$('input[name="type_size_6"]').val(),e.bigwheelgame.restrict6=$(".rt6").val(),e.bigwheelgame.upmusic_arrinfo&&(e.bigwheelgame.uploadmusic_url=e.bigwheelgame.upmusic_arrinfo.url),e.bigwheelgame.gather_type=$('input[name="msg_game"]:checked').val();var l=0;2==e.active_type&&(l=e.listinfo.type_id),s&&a.post({id:l},e.bigwheelgame,function(e){1==e.status?(o.create("success",e.msg),t.go("shop.game.bigwheel.list")):o.create("danger",e.msg)},function(e){o.create("danger",e.data.error.message)})},a.musicList({},function(t){e.data=t.info}),e._global=_global,e.logo2=e._global.source_url+"/xiaodian/game/new_rotor/zp_logo1.jpg",e.bigwheelgame.logo="",e.$watch("bigwheelgame.logo",function(){void 0!=e.bigwheelgame.logo&&""!=e.bigwheelgame.logo&&(e.logo2=e._global.url.ms+e.bigwheelgame.logo)}),$(".tempBigwheel").on("click","li",function(){var t=$(this).index()+1,a=e._global.source_url+"/xiaodian/game/new_rotor/tle"+t+".png",o=e._global.source_url+"/xiaodian/game/new_rotor/zp_bg"+t+".png",s=e._global.source_url+"/xiaodian/game/new_rotor/zp_logo"+t+".jpg",n="game_bg"+t;$(".user_logo").attr("src",a),$(".games_zp_img").attr("src",o),""!=$(".games_zp_logo").attr("ng-src")?$(".games_zp_logo").attr("src",$(".games_zp_logo").attr("ng-src")):$(".games_zp_logo").attr("src",s),$(this).addClass("temp_active").siblings().removeClass(),$(".game_bg").removeClass().addClass("game_bg").addClass(n),$(".tempBigwheel").attr("ng-value",t),e.bigwheelgame.activity_template=$(".tempBigwheel").attr("ng-value")}),e.bigwheelgame.ad_image="",e.$watch("bigwheelgame.ad_image",function(){void 0!=e.bigwheelgame.ad_image&&""!=e.bigwheelgame.ad_image&&(e.adImg=e._global.url.ms+e.bigwheelgame.ad_image)}),$(".ad_check").on("click",function(){$(".ad_check").is(":checked")?e.bigwheelgame.ad_on_off=1:e.bigwheelgame.ad_on_off=0}),$('select[name="date_chose"]').on("change",function(){e.bigwheelgame.cjts=$(this).val()}),$(".f_check").on("click",function(){$(".f_check").is(":checked")?e.bigwheelgame.f_on_off=1:e.bigwheelgame.f_on_off=0}),e.award_keyup=function(e){var t=$('input[name="type_name_'+e+'"]').val();$("#zhuanjp"+e).html(t)},$('select[name="type_1"]').on("change",function(){$('input[name="type_name_1"]').val(""),$('input[name="type_pa_1"]').val(""),$('input[name="type_size_1"]').val(""),$(".type_img_1").hide(),$(".type_quan_1").hide(),$(".rest1").hide(),$('input[name="type_size_1"]').attr("readonly",!0),$('input[name="type_name_1"]').attr("readonly",!0),$('input[name="type_pa_1"]').attr("readonly",!0),$(".type_quan_1 .btn").html("使用券"),$(".gh_1").val(0),$("#zhuanjp1").html("");var e=$(this).val();$(this).attr("data-id",e),""==e&&$(".rest1").hide(),1==e&&($('input[name="type_size_1"]').attr("readonly",!1),$('input[name="type_name_1"]').attr("readonly",!1),$('input[name="type_pa_1"]').attr("readonly",!1),$(".type_quan_1").hide(),$(".type_img_1,.rest1").show()),2==e&&($('input[name="type_pa_1"]').attr("readonly",!1),$(".type_img_1").hide(),$(".type_quan_1,.rest1").show())}),$('select[name="type_2"]').on("change",function(){$('input[name="type_name_2"]').val(""),$('input[name="type_pa_2"]').val(""),$('input[name="type_size_2"]').val(""),$(".type_img_2").hide(),$(".type_quan_2").hide(),$(".rest2").hide(),$('input[name="type_size_2"]').attr("readonly",!0),$('input[name="type_name_2"]').attr("readonly",!0),$('input[name="type_pa_2"]').attr("readonly",!0),$(".type_quan_2 .btn").html("使用券"),$(".gh_2").val(0),$("#zhuanjp2").html("");var e=$(this).val();$(this).attr("data-id",e),""==e&&$(".rest2").hide(),1==e&&($('input[name="type_size_2"]').attr("readonly",!1),$('input[name="type_name_2"]').attr("readonly",!1),$('input[name="type_pa_2"]').attr("readonly",!1),$(".type_quan_2").hide(),$(".type_img_2,.rest2").show()),2==e&&($('input[name="type_pa_2"]').attr("readonly",!1),$(".type_img_2").hide(),$(".type_quan_2,.rest2").show())}),$('select[name="type_3"]').on("change",function(){$('input[name="type_name_3"]').val(""),$('input[name="type_pa_3"]').val(""),$('input[name="type_size_3"]').val(""),$(".type_img_3").hide(),$(".type_quan_3").hide(),$(".rest3").hide(),$('input[name="type_size_3"]').attr("readonly",!0),$('input[name="type_name_3"]').attr("readonly",!0),$('input[name="type_pa_3"]').attr("readonly",!0),$(".type_quan_3 .btn").html("使用券"),$(".gh_3").val(0),$("#zhuanjp3").html("");var e=$(this).val();$(this).attr("data-id",e),""==e&&$(".rest3").hide(),1==e&&($('input[name="type_size_3"]').attr("readonly",!1),$('input[name="type_name_3"]').attr("readonly",!1),$('input[name="type_pa_3"]').attr("readonly",!1),$(".type_quan_3").hide(),$(".type_img_3,.rest3").show()),2==e&&($('input[name="type_pa_3"]').attr("readonly",!1),$(".type_img_3").hide(),$(".type_quan_3,.rest3").show())}),$('select[name="type_4"]').on("change",function(){$('input[name="type_name_4"]').val(""),$('input[name="type_pa_4"]').val(""),$('input[name="type_size_4"]').val(""),$(".type_img_4").hide(),$(".type_quan_4").hide(),$(".rest4").hide(),$('input[name="type_size_4"]').attr("readonly",!0),$('input[name="type_name_4"]').attr("readonly",!0),$('input[name="type_pa_4"]').attr("readonly",!0),$(".type_quan_4 .btn").html("使用券"),$(".gh_4").val(0),$("#zhuanjp4").html("");var e=$(this).val();$(this).attr("data-id",e),""==e&&$(".rest4").hide(),1==e&&($('input[name="type_size_4"]').attr("readonly",!1),$('input[name="type_name_4"]').attr("readonly",!1),$('input[name="type_pa_4"]').attr("readonly",!1),$(".type_quan_4").hide(),$(".type_img_4,.rest4").show()),2==e&&($('input[name="type_pa_4"]').attr("readonly",!1),$(".type_img_4").hide(),$(".type_quan_4,.rest4").show())}),$('select[name="type_5"]').on("change",function(){$('input[name="type_name_5"]').val(""),$('input[name="type_pa_5"]').val(""),$('input[name="type_size_5"]').val(""),$(".type_img_5").hide(),$(".type_quan_5").hide(),$(".rest5").hide(),$('input[name="type_size_5"]').attr("readonly",!0),$('input[name="type_name_5"]').attr("readonly",!0),$('input[name="type_pa_5"]').attr("readonly",!0),$(".type_quan_5 .btn").html("使用券"),$(".gh_5").val(0),$("#zhuanjp5").html("");var e=$(this).val();$(this).attr("data-id",e),""==e&&$(".rest5").hide(),1==e&&($('input[name="type_size_5"]').attr("readonly",!1),$('input[name="type_name_5"]').attr("readonly",!1),$('input[name="type_pa_5"]').attr("readonly",!1),$(".type_quan_5").hide(),$(".type_img_5,.rest5").show()),2==e&&($('input[name="type_pa_5"]').attr("readonly",!1),$(".type_img_5").hide(),$(".type_quan_5,.rest5").show())}),$('select[name="type_6"]').on("change",function(){$('input[name="type_name_6"]').val(""),$('input[name="type_pa_6"]').val(""),$('input[name="type_size_6"]').val(""),$(".type_img_6").hide(),$(".type_quan_6").hide(),$(".rest6").hide(),$('input[name="type_size_6"]').attr("readonly",!0),$('input[name="type_name_6"]').attr("readonly",!0),$('input[name="type_pa_6"]').attr("readonly",!0),$(".type_quan_6 .btn").html("使用券"),$(".gh_6").val(0),$("#zhuanjp6").html("");var e=$(this).val();$(this).attr("data-id",e),""==e&&$(".rest6").hide(),1==e&&($('input[name="type_size_6"]').attr("readonly",!1),$('input[name="type_name_6"]').attr("readonly",!1),$('input[name="type_pa_6"]').attr("readonly",!1),$(".type_quan_6").hide(),$(".type_img_6,.rest6").show()),2==e&&($('input[name="type_pa_6"]').attr("readonly",!1),$(".type_img_6").hide(),$(".type_quan_6,.rest6").show())}),e.bigwheelgame.image1="",e.$watch("bigwheelgame.image1",function(){void 0!=e.bigwheelgame.image1&&""!=e.bigwheelgame.image1&&(e.t_img1=e._global.url.ms+e.bigwheelgame.image1)}),e.bigwheelgame.image2="",e.$watch("bigwheelgame.image2",function(){void 0!=e.bigwheelgame.image2&&""!=e.bigwheelgame.image2&&(e.t_img2=e._global.url.ms+e.bigwheelgame.image2)}),e.bigwheelgame.image3="",e.$watch("bigwheelgame.image3",function(){void 0!=e.bigwheelgame.image3&&""!=e.bigwheelgame.image3&&(e.t_img3=e._global.url.ms+e.bigwheelgame.image3)}),e.bigwheelgame.image4="",e.$watch("bigwheelgame.image4",function(){void 0!=e.bigwheelgame.image4&&""!=e.bigwheelgame.image4&&(e.t_img4=e._global.url.ms+e.bigwheelgame.image4)}),e.bigwheelgame.image5="",e.$watch("bigwheelgame.image5",function(){void 0!=e.bigwheelgame.image5&&""!=e.bigwheelgame.image5&&(e.t_img5=e._global.url.ms+e.bigwheelgame.image5)}),e.bigwheelgame.image6="",e.$watch("bigwheelgame.image6",function(){void 0!=e.bigwheelgame.image6&&""!=e.bigwheelgame.image6&&(e.t_img6=e._global.url.ms+e.bigwheelgame.image6)}),$(".rt1").on("click",function(){$(".rt1").is(":checked")?$(this).attr("value","1"):$(this).attr("value","-1")}),$(".rt2").on("click",function(){$(".rt2").is(":checked")?$(this).attr("value","1"):$(this).attr("value","-1")}),$(".rt3").on("click",function(){$(".rt3").is(":checked")?$(this).attr("value","1"):$(this).attr("value","-1")}),$(".rt4").on("click",function(){$(".rt4").is(":checked")?$(this).attr("value","1"):$(this).attr("value","-1")}),$(".rt5").on("click",function(){$(".rt5").is(":checked")?$(this).attr("value","1"):$(this).attr("value","-1")}),$(".rt6").on("click",function(){$(".rt6").is(":checked")?$(this).attr("value","1"):$(this).attr("value","-1")}),e.useCard=function(e){s.open({animation:!1,templateUrl:"assets/js/apps/game/templates/bigwheel.add.modal.html",controller:"bigwheelModelCtrl",resolve:{jiangnum:function(){return e}}})}}]).controller("bigwheelModelCtrl",["$scope","Flash","bigwheel_add_Resource","$modalInstance","jiangnum",function(e,t,a,o,s){a.quanList({},function(t){e.data=t.data}),e.quanF=function(e){$("#"+e).addClass("quan_on").siblings().removeClass("quan_on")},e.btn_text="确定",e.ok=function(){var e=$(".quan_on").find(".quanname").text(),a=$(".quan_on").attr("id");""==e?t.create("danger","请选择优惠券"):($(".gh_"+s).val(a),$('input[name="type_name_'+s+'"]').val(e),$(".type_quan_"+s+" .btn").html("修改券"),$("#zhuanjp"+s).html(e),o.dismiss("cancel"))},e.cancel=function(){o.dismiss("cancel")}}])}),define("apps/game/controllers/bigwheel.look",["apps/common/controllers/controllers"],function(e){e.controller("shop.game.bigwheel.look",["$scope","$state","bigwheel_add_Resource","Flash","$modal","$stateParams",function(e,t,a,o,s,n){e.flag=1,e.nextAbled=!1,e.bkType=!0,e.listinfo={type_id:n.type_id,type:n.type},e.gImgFlag=!1,a.list_info({id:e.listinfo.type_id},function(t){e.bigwheelInfo=t.info,""!=e.bigwheelInfo.ad_image&&($("#ad_img1").attr("src",e._global.url.ms+e.bigwheelInfo.ad_image),$("#ad_img2").attr("src",e._global.url.ms+e.bigwheelInfo.ad_image)),0==e.bigwheelInfo.type1&&(e.bigwheelInfo.pb1="",e.bigwheelInfo.sum1="",e.bigwheelInfo.restrict1=""),0==e.bigwheelInfo.type2&&(e.bigwheelInfo.pb2="",e.bigwheelInfo.sum2="",e.bigwheelInfo.restrict2=""),0==e.bigwheelInfo.type3&&(e.bigwheelInfo.pb3="",e.bigwheelInfo.sum3="",e.bigwheelInfo.restrict3=""),0==e.bigwheelInfo.type4&&(e.bigwheelInfo.pb4="",e.bigwheelInfo.sum4="",e.bigwheelInfo.restrict4=""),0==e.bigwheelInfo.type5&&(e.bigwheelInfo.pb5="",e.bigwheelInfo.sum5="",e.bigwheelInfo.restrict5=""),0==e.bigwheelInfo.type6&&(e.bigwheelInfo.pb6="",e.bigwheelInfo.sum6="",e.bigwheelInfo.restrict6=""),2==e.bigwheelInfo.type1&&(e.bigwheelInfo.sum1=""),2==e.bigwheelInfo.type2&&(e.bigwheelInfo.sum2=""),2==e.bigwheelInfo.type3&&(e.bigwheelInfo.sum3=""),2==e.bigwheelInfo.type4&&(e.bigwheelInfo.sum4=""),2==e.bigwheelInfo.type5&&(e.bigwheelInfo.sum5=""),2==e.bigwheelInfo.type6&&(e.bigwheelInfo.sum6=""),1==e.bigwheelInfo.ad_on_off&&(e.gImgFlag=!0)}),e.nextChoice=function(t){e.flag=t+1,e.bkType=!1,2==t&&(e.nextAbled=!0)},e.backFlag=function(t){e.bkType||(e.flag=t-1,e.nextAbled=!1,2==t&&(e.bkType=!0))},e.updateFlag=function(t){e.flag=t,1==t?e.bkType=!0:e.bkType=!1,3==t?e.nextAbled=!0:e.nextAbled=!1},e._global=_global}])}),define("apps/game/controllers/_base",["apps/game/controllers/bigwheel.list","apps/game/controllers/bigwheel.records","apps/game/controllers/bigwheel.user_records","apps/game/controllers/bigwheel.add","apps/game/controllers/bigwheel.look"],function(){}),define("apps/game/directives/_base",[],function(){}),define("apps/game/main",["apps/game/states/_base","apps/game/services/_base","apps/game/controllers/_base","apps/game/directives/_base"],function(){}),define("apps/certification/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("certification",{abstract:!0,url:"/certification",templateUrl:"assets/js/apps/merchant/templates/layout.html"}).state("certification.info",{url:"/info",controller:"certification.info",templateUrl:"assets/js/apps/certification/templates/info.html",resolve:{certificationLoader:["certificationLoader",function(e){return e()}]}})}])}),define("apps/certification/states/_base",["apps/certification/states/main"],function(){}),define("apps/certification/controllers/certification",["apps/common/controllers/controllers"],function(e){e.controller("certification.info",["$scope","$resource","$modal","certification","certificationLoader","Flash",function(e,t,a,o,s,n){e.auth_info=s,e.pass={},e.btn_text="实名认证",e.submitForm=function(t){t&&(e.btn_text="认证中...",e.form.$invalid=!0,o.update(e.pass,function(t){if(t.status)e.btn_text="实名认证",n.create("success"," 认证成功"),e.auth_info.status=1,e.auth_info.data.auth_name=t.data.auth_name,e.auth_info.data.auth_number=t.data.auth_number;else{var o=function(o){var s=a.open({animation:!1,controller:"certification.modal",template:'<div class="modal-body">                                                    <div class="row">                                                        <div class="col-sm-12">                                                            <div class="controls">                                                                <div class="text-center">{{msg.titile}}{{msg.content}}</div>                                                            </div>                                                        </div>                                                    </div>                                        </div>                                        <div class="modal-footer ">                                            <button class="btn btn-primary btn-sm center-block" type="button"  ng-click="close()">{{certification_test}}</button>                                        </div>',size:o,backdrop:"static",resolve:{certificationData:function(){return t}}});s.result.then(function(t){e.pass.auth_number="",e.pass.auth_name=""})};o(),e.btn_text="实名认证",e.form.$invalid=!1}},function(t){e.btn_text="实名认证",e.form.$invalid=!1,n.create("danger",t.data.error.message)}))}}]),e.controller("certification.modal",["$scope","$resource","$modal","certification","$modalInstance","Flash","certificationData",function(e,t,a,o,s,n,r){e.certification_test="重新输入",e.msg=r.msg,"实名认证通道已被锁定，24小时后自动解锁"==r.msg&&(e.certification_test="明天再来"),e.close=function(){s.close(0)}}])}),define("apps/certification/controllers/_base",["apps/certification/controllers/certification"],function(){}),define("apps/certification/directives/_base",[],function(){}),define("apps/certification/services/certification",["apps/common/services/services"],function(e){e.factory("certification",["$resource",function(e){return e("/certification/info.json",{},{update:{method:"PUT"}})}]),e.factory("certificationLoader",["certification","$q",function(e,t){return function(){var a=t.defer();return e.get(function(e){a.resolve(e)}),a.promise}}])}),define("apps/certification/services/_base",["apps/certification/services/certification"],function(){}),define("apps/certification/main",["apps/certification/states/_base","apps/certification/controllers/_base","apps/certification/directives/_base","apps/certification/services/_base"],function(){}),define("apps/integral/states/integral",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.integral",{abstract:!0,url:"/integral",template:"<div ui-view></div>"}).state("shop.apps.integral.list",{url:"/list",templateUrl:"assets/js/apps/integral/templates/integral.html",controller:"integral.list"}).state("shop.apps.integral.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/integral/templates/integral.info.html",controller:"integral.info"}).state("shop.apps.integral.add",{url:"/add",templateUrl:"assets/js/apps/integral/templates/integral.info.html",controller:"integral.info"}).state("shop.apps.integral.code",{url:"/code/:id",templateUrl:"assets/js/apps/integral/templates/integral.code.html",controller:"integral.code"}).state("shop.apps.craete.code",{url:"/create",templateUrl:"assets/js/apps/integral/templates/create.code.html"}).state("shop.apps.integral.exchange",{url:"/exchange/:id",templateUrl:"assets/js/apps/integral/templates/integral.exchange.html",controller:"integral.exchange.list"})}])}),define("apps/integral/states/config",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("shop.apps.config",{abstract:!0,url:"/config",template:"<div ui-view></div>"}).state("shop.apps.integral.config",{url:"/config",templateUrl:"assets/js/apps/integral/templates/integral.config.html",controller:"integral.config"})}])}),define("apps/integral/states/_base",["apps/integral/states/integral","apps/integral/states/config"],function(){}),define("apps/integral/services/integral",["apps/common/services/services"],function(e){e.factory("integralResource",["$resource",function(e){return e("/integral/codes.json",{},{update:{method:"PUT"},query:{method:"GET",isArray:!1},delete:{method:"DELETE"}})}]),e.factory("integraldelResource",["$resource",function(e){return e("/integral/delete/:id.json",{id:"@id"},{delete:{method:"DELETE"}})}]),e.factory("integralAddResource",["$resource",function(e){return e("/integral/code.json",{},{save:{method:"POST"},update:{method:"PUT"}})}]),e.factory("items",["$resource",function(e){return e("",{},{})}]),e.factory("integralConfigResource",["$resource",function(e){return e("/integral/config.json",{},{save:{method:"POST"},query:{method:"GET",isArray:!1}})}]),e.factory("integralCardResource",["$resource",function(e){return e("/integral/card/:cardno.json",{cardno:"@cardno"},{save:{method:"POST"},queryCards:{method:"GET",isArray:!1}})}]),e.factory("integralCardResource",["$resource",function(e){return e("/integral/card/:cardno.json",{cardno:"@cardno"},{save:{method:"POST"},queryCards:{method:"GET",isArray:!1}})}]),e.factory("integralCardsResource",["$resource",function(e){return e("/integral/cards.json",{},{save:{method:"POST"},queryCards:{method:"GET",isArray:!1}})}]),e.factory("integralDelCardResource",["$resource",function(e){return e("/integral/card/delete/:id.json",{id:"@id"},{delCard:{method:"DELETE"}})}]),e.factory("integralCardsExchangeResource",["$resource",function(e){return e("/integral/exchange_list.json",{},{query:{method:"GET"}})}])}),define("apps/integral/services/_base",["apps/integral/services/integral"],function(){}),define("apps/integral/controllers/integral.list",["apps/common/controllers/controllers"],function(e){e.controller("integral.list",["$scope","$resource","integralResource","Flash","$modal","integraldelResource",function(e,t,a,o,s,n){e.type=1,e.sortableOptions={cursor:"move",zIndex:999,axis:"x"},e.add_goods=function(){var e=s.open({animation:!1,templateUrl:"assets/js/apps/integral/templates/integral.info.html",controller:"integral.info"});e.result.then(function(e){r()})},e.dataArr={},e.edit_goods=function(t,a,o,n,i){var c=s.open({animation:!1,templateUrl:"assets/js/apps/integral/templates/integral.info.html",controller:"integral.info",resolve:{items:function(){return e.dataArr.name=t,e.dataArr.score=a,e.dataArr.starttime=o,e.dataArr.endtime=n,e.dataArr.id=i,e.dataArr}}});c.result.then(function(e){r()})},e.findcards=function(){var e=s.open({animation:!0,templateUrl:"assets/js/apps/integral/templates/integral.card.html",controller:"integral.card",windowClass:"modal-open",size:"lg"});e.result.then(function(){},function(){})},e.searchInfo={start_time:"",end_time:"",status:0};var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.query({offset:(t.offset-1)*t.limit,limit:t.limit,keywords:e.keywords,status:e.status,start_time:e.searchInfo.start_time,end_time:e.searchInfo.end_time},function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(e.searchInfo.dates=null,t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.sort=function(t){"asc"==t?e.sorts="desc":e.sorts="asc",r()},e.remove=function(e,t){n.delete({id:t},function(e){e.status?(r(),o.create("success"," 删除成功！")):o.create("success"," 删除失败！")},function(e){o.create("danger",e.data.msg)})},e.export=function(){var t="integral/export_codes.json?export=yes";e.keywords&&(t+="&keywords="+e.keywords),e.status&&(t+="&status="+e.status);var a=$('input[name="created_range"]').val();""!=a&&(a=a.split("/"),t+="&start_time="+a[0]+"&end_time="+a[1]),window.location.href=t}}])}),define("apps/integral/controllers/integral.info",["apps/common/controllers/controllers"],function(e){e.controller("integral.info",["$scope","$http","integralResource","$stateParams","Flash","$state","$modalInstance","$timeout","integralAddResource","items",function(e,t,a,o,s,n,r,i,c,l){if(l.id){if(e.title="修改积分码",e.data=l,e.type=2,""!=l.starttime&&""!=l.endtime){for(var d=l.starttime.split("."),p=l.endtime.split("."),u="",m="",g=0;g<d.length;g++)u+=d[g]+"-";for(var g=0;g<p.length;g++)m+=p[g]+"-";var f=u.substr(0,u.length-1)+"/"+m.substr(0,m.length-1)}i(function(){$('input[name="created_range1"]').val(f)},200)}else e.title="新增积分码",e.btn_text="保存",e.type=1;e.btn_text="保存",e.submitForm=function(t){if(t){if(""==e.data.name)return $("input[name='name']").focus(),void s.create("danger","请输入积分码名称");if(isNaN(Number(e.data.score))||Number(e.data.score)<=0)return $("input[name='score']").focus(),void s.create("danger","输入正确的积分数");var a=/^[+-]?[1-9]?[0-9]*\.[0-9]*$/;if(a.test(e.data.score))return void s.create("danger","输入正整数积分数");var o=$('input[name="created_range1"]').val();if(""==o)return s.create("danger","请先选择时间"),!1;o=o.split("/"),e.data.start_date=o[0],e.data.end_date=o[1],e.btn_text="保存中...",e.form.$invalid=!0,l.id?c.update({id:l.id},e.data,function(e){e.status?(s.create("success"," 保存成功！"),r.close()):s.create("danger",e.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)}):c.save(e.data,function(e){e.status?(s.create("success"," 保存成功！"),r.close()):s.create("danger",e.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)})}}}])}),define("apps/integral/controllers/integral.code",["apps/common/controllers/controllers"],function(e){e.controller("integral.code",["$scope","integralDelCardResource","integralResource","$stateParams","Flash","$state","$modal","integralCardsResource",function(e,t,a,o,s,n,r,i){e.paginationConf={currentPage:1,itemsPerPage:10},e.createCode=function(){var e=r.open({animation:!1,templateUrl:"assets/js/apps/integral/templates/create.code.html",controller:"integral.create.code",windowClass:"modal-open",resolve:{coupon_id:function(){return o.id}}});e.result.then(function(e){c()})},void 0==e.dates&&(e.dates={},e.dates.startDate="",e.dates.endDate="");var c=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};i.queryCards({id:o.id,offset:(t.offset-1)*t.limit,limit:t.limit,start_time:e.dates.startDate,end_time:e.dates.endDate},function(t){e.data=t.data,e.paginationConf.totalItems=t._count})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c),e.search=function(){1==e.paginationConf.currentPage?c():e.paginationConf.currentPage=1},e.flag=!1,e.remove=function(a,o){void 0!=o&&""!=o&&t.delCard({id:o},function(t){if(t.status){var a=e.data,n="";angular.forEach(a,function(e,t){o==e.id&&(n=t)}),a.splice(n,1),e.data=a}else s.create("danger",t.msg)})},e.export=function(){var t="integral/export_cards/"+o.id+".json?export=yes";e.keywords&&(t+="&keywords="+e.keywords),window.location.href=t}}])}),define("apps/integral/controllers/create.code",["apps/common/controllers/controllers"],function(e){e.controller("integral.create.code",["$scope","$http","integralResource","$stateParams","Flash","$state","$modal","integralCardsResource","$modalInstance",function(e,t,a,o,s,n,r,i,c){var l=o.id;e.cancel=function(){c.dismiss("cancel")},e.chars=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];var d=function(t){for(var a="",o=0;o<t;o++){var s=Math.ceil(61*Math.random());a+=e.chars[s]}return a};e.data={},e.createCode=function(){var t=e.random_count,a="";if("undefined"==typeof e.data.codes&&(e.data.codes=""),!isNaN(t)&&t>0&&t<=1e4)for(var o=0;o<t;o++)a=d(6),""!=e.data.codes&&"undefined"!=typeof e.data.codes?e.data.codes=e.data.codes+"\n"+a:e.data.codes=e.data.codes+a;else e.form.random_count.$invalid=!0,e.random_count_error=!0},e.btn_text="保存",e.submitForm=function(t){if(t){e.btn_text="保存中...",e.form.$invalid=!0;var a={id:l,codes:e.data.codes};i.save(a,function(t){e.btn_text="保存",t.status?s.create("success"," 保存成功！"):s.create("success",t.msg),c.close(l)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)})}}}])}),define("apps/integral/controllers/integral.config",["apps/common/controllers/controllers"],function(e){e.controller("integral.config",["$scope","$http","integralConfigResource","$stateParams","Flash","$state","$modal","$timeout",function(e,t,a,o,s,n,r,i){e.title="积分码配置",e.type=2;var c=function(){a.get({id:o.id},function(t){e.data=t.data,2==t.status?($(".prefix-group").show(),$(".length-group").show()):($(".prefix-group").hide(),$(".length-group").hide())})};c(),e.title="积分码配置",a.get({},function(t){e.data=t}),e.changeStatus=function(e){2==e?($(".prefix-group").show(),$(".length-group").show()):($(".prefix-group").hide(),$(".length-group").hide())},e.btn_text="保存",e.submitForm=function(){if(isNaN(Number(e.data.maxday))||Number(e.maxday)<=0)return $("input[name='max_day']").focus(),void s.create("danger",e.data.maxday);if(isNaN(Number(e.data.status))||Number(e.data.status)<=0)return void s.create("danger","请选择一项");if(2==e.data.status){if(""==e.data.prefix)return void s.create("danger","请输入前缀");var t=/^[0-9A-Za-z]{1,4}$/;if(!t.test(e.data.prefix))return void s.create("danger","请输入正确的前缀")}else e.data.prefix="";e.form.$invalid=!0,e.btn_text="保存中...",a.save(e.data,function(t){e.form.$invalid=!1,t.status?(s.create("success"," 保存成功！"),n.go("shop.apps.integral.list",{})):s.create("danger",t.msg)},function(t){e.btn_text="保存",e.form.$invalid=!1,s.create("danger",t.data.msg)})}}])}),define("apps/integral/controllers/integral.card",["apps/common/controllers/controllers"],function(e){e.controller("integral.card",["$scope","$http","integralCardResource","$stateParams","Flash","$state","$modalInstance","$timeout",function(e,t,a,o,s,n,r,i){e.btn_text="查询",e.title="查询积分卡使用情况",e.data={cardno:""},e.search=function(){return""==e.data.cardno?($("input[name='cardno']").focus(),void s.create("danger","请输入查询卡号")):void a.queryCards({cardno:e.data.cardno},function(e){e.status?s.create("success",e.msg):s.create("danger",e.msg)})},e.cancel=function(){r.dismiss("cancel")},e.flush=function(){$("input[name='cardno']").val(""),$("input[name='cardno']").focus()}}])}),define("apps/integral/controllers/integral.exchange.list",["apps/common/controllers/controllers"],function(e){e.controller("integral.exchange.list",["$scope","$resource","integralCardsExchangeResource","Flash","$modal","$stateParams",function(e,t,a,o,s,n){e.dataArr={},e.paginationConf={currentPage:1,itemsPerPage:10},void 0==e.dates&&(e.dates={},e.dates.startDate="",e.dates.endDate="");var r=function(){var t={offset:e.paginationConf.currentPage,limit:e.paginationConf.itemsPerPage};a.query({id:n.id,offset:(t.offset-1)*t.limit,limit:t.limit,startDate:e.searchInfo.start_time,endDate:e.searchInfo.end_time},function(t){e.data=t.data,e.paginationConf.totalItems=t._count})};e.searchInfo={id:n.id},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",r),e.search=function(){var t=$('input[name="created_range"]').val();""!=t?(e.searchInfo.dates=null,t=t.split("/"),e.searchInfo.start_time=t[0],e.searchInfo.end_time=t[1]):(e.searchInfo.start_time="",e.searchInfo.end_time=""),1==e.paginationConf.currentPage?r():e.paginationConf.currentPage=1},e.export=function(){var t="integral/export_exchange_list.json?export=yes",a=$('input[name="created_range"]').val();""!=a?(e.searchInfo.dates=null,a=a.split("/"),e.searchInfo.start_time=a[0],e.searchInfo.end_time=a[1],t+="&start_date="+e.searchInfo.start_time+"&end_date="+e.searchInfo.end_time+"&id="+n.id):(e.searchInfo.start_time="",e.searchInfo.end_time="",t+="&id="+n.id),window.location.href=t}}])}),define("apps/integral/controllers/_base",["apps/integral/controllers/integral.list","apps/integral/controllers/integral.info","apps/integral/controllers/integral.code","apps/integral/controllers/create.code","apps/integral/controllers/integral.config","apps/integral/controllers/integral.card","apps/integral/controllers/integral.exchange.list"],function(){}),define("apps/integral/directives/integral",["apps/common/directives/directives","apps/common/controllers/controllers"],function(e,t){e.directive("showToggle",[function(){return{restrict:"AE",replace:!0,scope:!1,link:function(e,t,a,o){e.showText="显示",e.toggle=function(){e.flag=!e.flag,e.flag?e.showText="隐藏":e.showText="显示"}}}}])}),define("apps/integral/directives/_base",["apps/integral/directives/integral"],function(){}),define("apps/integral/main",["apps/integral/states/_base","apps/integral/services/_base","apps/integral/controllers/_base","apps/integral/directives/_base"],function(){}),
define("apps/welfare/states/dashboard",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("welfare",{abstract:!0,url:"/welfare",templateUrl:"assets/js/apps/welfare/templates/layout.html"}).state("welfare.dashboard",{url:"",templateUrl:"assets/js/apps/welfare/templates/dashboard.html",controller:"welfare.dashboard"})}])}),define("apps/welfare/states/_base",["apps/welfare/states/dashboard"],function(){}),define("apps/welfare/services/dashboard",["apps/common/services/services"],function(e){e.factory("welfareResource",["$resource",function(e){return e("/invite/inviteinfo.json",{},{get:{method:"GET"}})}])}),define("apps/welfare/services/_base",["apps/welfare/services/dashboard"],function(){}),define("apps/welfare/controllers/dashboard",["apps/common/controllers/controllers"],function(e){e.controller("welfare.dashboard",["$scope","$modal","$timeout","welfareResource",function(e,t,a,o){o.get(function(t){e.invite=t,e.rules=t.invite_reward_rules;var a=t.invite_url,o=$(".linkCopy").text(),s=""+o+"注册地址："+a;$("#regAddress").val(s)}),e.copy_link=function(){var e=document.getElementById("regAddress");if(e.select(),tag=document.execCommand("Copy"),tag){t.open({animation:!1,templateUrl:"assets/js/apps/welfare/templates/welfare_template.html",controller:"welfareTemplateCtrl"})}}}]).controller("welfareTemplateCtrl",["$scope","$modalInstance","$modal",function(e,t,a){e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/welfare/controllers/_base",["apps/welfare/controllers/dashboard"],function(){}),define("apps/welfare/directives/_base",[],function(){}),define("apps/welfare/main",["apps/welfare/states/_base","apps/welfare/services/_base","apps/welfare/controllers/_base","apps/welfare/directives/_base"],function(){}),define("apps/rrds_promotion/controllers/rrdspromotion.goodsmateriallibrary.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdspromotion.goodsmateriallibrary.ctrl",["$scope","rrdsPromotionGoodsMaterialLibraryResource","$stateParams","ngPopover","Flash",function(e,t,a,o,s){var n=this,r=function(e){n.qrcodeInfo=e},i=function(){o.close(),s.create("success"," 复制成功！")},c=function(e){Utils.prompt("Press cmd+c to copy the text below.",e)},l=function(){var e={merchant_name:n.query.merchant_name||null,title:n.query.title||null,point:n.query.point||null,pay_money:n.query.pay_money||null,charges_money:n.query.charges_money||null,is_published:n.query.is_published},t=$('input[name="created_date"]').val();t&&(e.created_at_start=t.split("/")[0],e.created_at_end=t.split("/")[1]);var a=$('input[name="update_date"]').val();return a&&(e.updated_at_start=a.split("/")[0],e.updated_at_end=a.split("/")[1]),e},d=function(e){var o=l();return a.id&&(o.template_id=a.id),o.offset="search"==e?0:(n.paginationConf.currentPage-1)*n.paginationConf.itemsPerPage,o.limit=n.paginationConf.itemsPerPage,t.getGoodsMaterialList(o,function(e){n.data=e.data,n.paginationConf.totalItems=e._total})},p=function(){n.paginationConf={currentPage:1,itemsPerPage:10},n.material_libraries=[],n.is_published_types=[{name:"全部",value:null},{name:"上架",value:1},{name:"下架",value:0}],n.query={is_published:n.is_published_types[0].value},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",d)};n.showQrcode=r,n.showMessage=i,n.fallback=c,n.search=d,p()}])}),define("apps/rrds_promotion/controllers/rrdspromotion.setting.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdspromotion.setting.ctrl",["$scope","$modal","rrdsPromotionSettingResource","Flash",function(e,t,a,o){var s=this,n=function(){t.open({animation:!1,templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.setting.modal.html",controller:"rrdspromotion.setting.modal.ctrl",controllerAs:"vm",resolve:{operation:function(){return{status:0}}}}).result.then(function(e){c()})},r=function(e){t.open({animation:!1,templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.setting.modal.html",controller:"rrdspromotion.setting.modal.ctrl",controllerAs:"vm",resolve:{operation:function(){return{status:1,id:e}}}}).result.then(function(e){c()})},i=function(e){return a.deleteTag({id:e},function(e){e.status?(o.create("success",e.msg||"删除成功"),c()):o.create("danger",e.msg||"删除失败")})},c=function(){var e={offset:(s.paginationConf.currentPage-1)*s.paginationConf.itemsPerPage,limit:s.paginationConf.itemsPerPage};return a.getTags(e,function(e){s.data=e.data,s.paginationConf.totalItems=e._total})},l=function(){s.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",c)};s.add=n,s.edit=r,s.remove=i,l()}])}),define("apps/rrds_promotion/controllers/rrdspromotion.setting.modal.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdspromotion.setting.modal.ctrl",["$scope","operation","$modalInstance","rrdsPromotionSettingResource","Flash",function(e,t,a,o,s){var n=this,r=function(e){return o.getTagDetail({id:e},function(e){n.data=e})},i=function(){return n.modal.btnDisabled=!0,n.modal.btnText=n.modal.btnText+"中...",t.status?o.updateTag({id:n.id,title:n.data.title},function(e){e.status?(s.create("success",e.msg||"修改成功"),a.close()):(s.create("danger",e.msg||"修改失败"),n.modal.btnDisabled=!1,n.modal.btnText=t.status?"修改":"保存")}):o.saveTag({title:n.data.title},function(e){e.status?(s.create("success",e.msg||"保存成功"),a.close()):(s.create("danger",e.msg||"保存失败"),n.modal.btnDisabled=!1,n.modal.btnText=t.status?"修改":"保存")})},c=function(){t.status?(n.modal={title:"编辑",btnText:"修改",btnDisabled:!1},t.id&&(n.id=t.id,r(t.id))):(n.modal={title:"添加",btnText:"保存",btnDisabled:!1},n.data={})};n.submit=i,c()}])}),define("apps/rrds_promotion/controllers/rrdspromotion.templatelibrary.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdspromotion.templatelibrary.ctrl",["$scope","rrdsPromotionTemplateLibraryResource","Flash",function(e,t,a){var o=this,s=function(e){return t.deleteTemplate({id:e},function(e){e.status?(a.create("success",e.msg||"删除成功"),c()):a.create("danger",e.msg||"删除失败")})},n=function(e){return t.shelveTemplate({id:e.id,status:e.status?0:1},function(t){t.status?(a.create("success",t.msg||(e.status?"下架":"上架")+"成功"),c()):a.create("danger",t.msg||(e.status?"下架":"上架")+"失败")})},r=function(e){return t.stickTemplate({id:e.id,top_status:e.top?0:1},function(t){t.status?(a.create("success",t.msg||(e.top?"取消置顶成功":"置顶成功")),c()):a.create("danger",t.msg||(e.top?"取消置顶失败":"置顶失败"))})},i=function(){var e={title:o.query.title||null,status:o.query.status},t=$('input[name="created_date"]').val();return t&&(e.created_at_s=t.split("/")[0],e.created_at_e=t.split("/")[1]),e},c=function(e){var a=i();return a.offset="search"==e?0:(o.paginationConf.currentPage-1)*o.paginationConf.itemsPerPage,a.limit=o.paginationConf.itemsPerPage,t.getTemplateList(a,function(e){o.data=e.data,o.paginationConf.totalItems=e._count})},l=function(){o.is_published_types=[{name:"全部",value:null},{name:"上架",value:1},{name:"下架",value:0}],o.paginationConf={currentPage:1,itemsPerPage:10},o.query={},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",c)};o.remove=s,o.unShelve=n,o.stick=r,o.search=c,l()}])}),define("apps/rrds_promotion/controllers/rrdspromotion.manage.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdspromotion.manage.ctrl",["$scope","rrdsPromotionGoodsMaterialLibraryResource","Flash","$state","$stateParams","tagResource","articleGoodsList","articleGoodsSelected","rrdspromotionData","$timeout","designValidate","rrdspromotionManageResource","rrdsPromotionSettingResource","$q",function(e,t,a,o,s,n,r,i,c,l,d,p,u,m){var g=function(e){return e&&e.replace(/\s/g,"").length||0},f=function(t){if("next"===t){if(0===e.slices.length)return a.create("danger","您还没拖动模块到手机！"),!1;var o=angular.copy(e.slices);for(var s in o){var n=d[o[s].type](o[s].content,e.data.title);if(n)return e.editSlice(e.slices[s],n),v(),!1}e.step=2}else e.step=1},h=function(t){e.slices.splice(t,1),e.design=!1},_=function(t,a){angular.forEach(e.slices,function(e,t){e.class=!1}),t.class=!0,e.design=t,l(function(){e.$broadcast("design_data",t),angular.isUndefined(a)||e.$broadcast("design_dirty",a)},200)},v=function(){e.disabledBtnStatus=!1,s.id?e.disabledBtnText="修改":e.disabledBtnText="保存"},y=function(t){return p.getDetail({id:t},function(t){t&&(e.data=t,e.slices=t.data)})},b=function(){e.disabledBtnStatus=!0,s.id?e.disabledBtnText="修改中...":e.disabledBtnText="保存中...",e.config=e.data;var t=[];if(angular.forEach(e.tags,function(e){e.checked&&t.push(e.id)}),e.config.keywords=t.join(","),0===e.slices.length)return a.create("danger","您还没拖动模块到手机！"),v(),!1;var n=angular.copy(e.slices);for(var r in n){var i=d[n[r].type](n[r].content,e.data.title);if(i)return e.editSlice(e.slices[r],i),v(),!1}e.config.data=n,s.id?(e.config.id=s.id,p.update(e.config,function(e){return e.status?(a.create("success",e.msg||"修改成功!"),void o.go("rrds_promotion.sub.template_library")):(a.create("danger",e.msg||"修改失败!"),v(),!1)},function(e){a.create("danger",e.data.error.message),v()})):p.add(e.config,function(e){return e.status?(a.create("success",e.msg||"添加成功"),void o.go("rrds_promotion.sub.template_library")):(a.create("danger",e.msg||"添加失败"),v(),!1)},function(e){a.create("danger",e.data.error.message),v()})},$=function(){return u.getTags(function(t){e.tags=t.data})},k=function(a){return t.getDetail({id:a},function(t){t&&(e.data=t,e.slices=t.data,e.data.stars="0",e.data.active=1,e.data.status="0")})},P=function(){e.step=1,s.id?(e.showTime=!0,m.all([$().$promise,y(s.id).$promise]).then(function(t){angular.forEach(e.tags,function(t){angular.forEach(e.data.keywords,function(e){t.id==e&&(t.checked=!0)})})})):s.aid?($(),k(s.aid)):($(),e.slices=[{type:"tuiwen_title",icon:"fa fa-bold",name:"标题",content:{title_type:"1",date_type:"1",date:moment().format("YYYY-MM-DD")}}],e.config={},e.data={stars:"0",active:1},e.data.status="0"),e.icon_list=c.concat(),e.sortableOptions={cursor:"move",placeholder:"comp-place",connectWith:".apps-container",zIndex:99999,opacity:.6,items:".comp-thumb:not(.not-sortable)",stop:function(t,a){a.item.sortable.droptarget&&t.target!=a.item.sortable.droptarget[0]&&(e.icon_list=c.concat(),"mouseup"==t.handleObj.type&&e.editSlice(a.item.sortable.moved))}},e.sortableTpls={cursor:"move",zIndex:99999,opacity:.6,axis:"y"},v(),e.levels=[{name:"无评级",value:0},{name:"一星级",value:1},{name:"二星级",value:2},{name:"三星级",value:3},{name:"四星级",value:4},{name:"五星级",value:5},{name:"六星级",value:6}],e.actives=[{name:"是",value:1},{name:"否",value:0}],e.editorOptions=angular.extend({},window._editorOptions,{extraPlugins:"uploadimage",height:"150px"})};e.stepChange=f,e.textCount=g,e.removeSlice=h,e.editSlice=_,e.submitForm=b,P()}])}),define("apps/rrds_promotion/controllers/_base",["apps/rrds_promotion/controllers/rrdspromotion.goodsmateriallibrary.ctrl","apps/rrds_promotion/controllers/rrdspromotion.setting.ctrl","apps/rrds_promotion/controllers/rrdspromotion.setting.modal.ctrl","apps/rrds_promotion/controllers/rrdspromotion.templatelibrary.ctrl","apps/rrds_promotion/controllers/rrdspromotion.manage.ctrl"],function(){}),define("apps/rrds_promotion/directives/_base",function(){}),define("apps/rrds_promotion/services/rrdspromotion.data",["apps/common/services/services"],function(e){e.factory("rrdspromotionData",[function(){var e=[{type:"text",icon:"fa fa-font",name:"富文本",content:{}},{type:"tuiwen_title",icon:"fa fa-bold",name:"标题",content:{title_type:"1",date_type:"1",date:moment().format("YYYY-MM-DD")}},{type:"video",icon:"fa fa-film",name:"视频",content:{}}];return e}])}),define("apps/rrds_promotion/services/rrdspromotion.templatelibrary.service",["apps/common/services/services"],function(e){e.factory("rrdsPromotionTemplateLibraryResource",["$resource",function(e){return e("/unlimitedarticle/template_list.json",{id:"@id"},{getTemplateList:{method:"GET",isArray:!1},deleteTemplate:{method:"POST",url:"/unlimitedarticle/template_del/:id.json"},shelveTemplate:{method:"POST",url:"/unlimitedarticle/template_status/:id.json"},stickTemplate:{method:"POST",url:"/unlimitedarticle/template_top/:id.json"}})}])}),define("apps/rrds_promotion/services/rrdspromotion.goodsmateriallibrary.service",["apps/common/services/services"],function(e){e.factory("rrdsPromotionGoodsMaterialLibraryResource",["$resource",function(e){return e("/unlimitedarticle/articles/:id.json",{id:"@id"},{getGoodsMaterialList:{method:"GET",isArray:!1},getDetail:{method:"GET",isArray:!1,url:"/unlimitedarticle/article/:id.json"}})}])}),define("apps/rrds_promotion/services/rrdspromotion.setting.service",["apps/common/services/services"],function(e){e.factory("rrdsPromotionSettingResource",["$resource",function(e){return e("/unlimitedarticle/articletags.json",{id:"@id"},{getTags:{method:"GET",isArray:!1},deleteTag:{method:"DELETE",isArray:!1,url:"/unlimitedarticle/articletag/:id.json"},getTagDetail:{method:"GET",isArray:!1,url:"/unlimitedarticle/articletag/:id.json"},saveTag:{method:"POST",url:"/unlimitedarticle/articletag.json"},updateTag:{method:"PUT",url:"/unlimitedarticle/articletag/:id.json"}})}])}),define("apps/rrds_promotion/services/rrdspromotion.manage.service",["apps/common/services/services"],function(e){e.factory("rrdspromotionManageResource",["$resource",function(e){return e("",{id:"@id"},{add:{method:"POST",url:"/unlimitedarticle/template_add.json"},update:{method:"POST",url:"unlimitedarticle/template_edit/:id.json"},getDetail:{method:"GET",url:"/unlimitedarticle/template_detail/:id.json",isArray:!1}})}])}),define("apps/rrds_promotion/services/_base",["apps/rrds_promotion/services/rrdspromotion.data","apps/rrds_promotion/services/rrdspromotion.templatelibrary.service","apps/rrds_promotion/services/rrdspromotion.goodsmateriallibrary.service","apps/rrds_promotion/services/rrdspromotion.setting.service","apps/rrds_promotion/services/rrdspromotion.manage.service"],function(){}),define("apps/rrds_promotion/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("rrds_promotion",{abstract:!0,url:"/rrds_promotion",templateUrl:"assets/js/apps/rrds_promotion/templates/main.html"}).state("rrds_promotion.sub",{abstract:!0,url:"/sub",template:"<div ui-view></div>"}).state("rrds_promotion.sub.template_library",{url:"/template_library",templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.templatelibrary.html",controller:"rrdspromotion.templatelibrary.ctrl",controllerAs:"vm"}).state("rrds_promotion.sub.add",{url:"/add",templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.manage.html",controller:"rrdspromotion.manage.ctrl"}).state("rrds_promotion.sub.edit",{url:"/edit?id?aid",templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.manage.html",controller:"rrdspromotion.manage.ctrl"}).state("rrds_promotion.goods_material_library",{url:"/goods_material_library?id",templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.goodsmateriallibrary.html",controller:"rrdspromotion.goodsmateriallibrary.ctrl",controllerAs:"vm"}).state("rrds_promotion.setting",{url:"/setting",templateUrl:"assets/js/apps/rrds_promotion/templates/rrdspromotion.setting.html",controller:"rrdspromotion.setting.ctrl",controllerAs:"vm"})}])}),define("apps/rrds_promotion/states/_base",["apps/rrds_promotion/states/main"],function(){}),define("apps/rrds_promotion/main",["apps/rrds_promotion/controllers/_base","apps/rrds_promotion/directives/_base","apps/rrds_promotion/services/_base","apps/rrds_promotion/states/_base"],function(){}),define("apps/rrdhelp/controllers/helpcenter",["apps/common/controllers/controllers"],function(e){e.controller("helpcenter",["$scope","$stateParams","getMenuList","getMenuContent","getMenu","$http","getOtherSetting","$sce","getKeyWords",function(e,t,a,o,s,n,r,i,c){e.memuname="",e.isLink=!1;var l=t.id;e.currentMenu={},e.getContent=function(t){e.isLink=!1,e.currentMenu=t,o.get({id:t.id},function(t){e.menucontent=t.data})},a.get(function(t){if(e.menulist=t.data,l){var a="",o="",n="",r=l.split("_");a=r[0],2==r.length?(n=r[1],s.get({id:a},function(t){e.getContent(t)})):r.length>2&&(o=r[1],n=r[2],s.get({id:o},function(t){e.getContent(t)}))}return e.menulist.free[0]?void(e.menulist.free[0].m2.length>0?e.getContent(e.menulist.free[0].m2):e.getContent(e.menulist.free[0])):void(e.menulist.self.m2[0]?e.getContent(e.menulist.self.m2[0]):e.getContent(e.menulist.self))}),r.get(function(t){t.status&&(e.otherSetting=t.data)}),e.fileDown=function(e){window.location.href=e},e.toggle=function(t,a){e.mId=$(t.currentTarget).data("id"),a.childShow=!a.childShow},e.render=function(e){return i.trustAsHtml(e)},e.mySearch=!1,e.keywordsNum=0,e.search=function(t){e.mySearch=!0,c.post({keyword:e.keyword},function(t){t.status&&(e.KeyWord=t.data,e.keywordsNum=t.data.length)})},e.goTotop=function(t,a){e.mySearch=!1,e.isLink=!0},e.goToMenu=function(t){e.mySearch=!1,e.isLink=!0,goTotop()},e.backhome=function(){e.mySearch=!1,e.menulist.free.length>0&&(e.mId=e.menulist.free[0].id,e.memuname=e.menulist.free[0].menu_name)},e.renderName=function(t,a){if(l){var o=l.split("_");o.length>2?a&&a.id==o[1]&&(e.memuname=t.menu_name,t.childShow=!0):t.id==o[0]&&(e.memuname=t.menu_name)}return a?a.menu_name:t.menu_name}}])}),define("apps/rrdhelp/controllers/_base",["apps/rrdhelp/controllers/helpcenter"],function(){}),define("apps/rrdhelp/directives/_base",[],function(){}),define("apps/rrdhelp/services/helpcenter",["apps/common/services/services"],function(e){e.factory("getMenuList",["$resource",function(e){return e("setting/get_menu_list.json",{},{get:{method:"GET",isArray:!1}})}]),e.factory("getMenuContent",["$resource",function(e){return e("setting/get_menu_content/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("getMenu",["$resource",function(e){return e("setting/get_menu/:id.json",{id:"@id"},{get:{method:"GET",isArray:!1}})}]),e.factory("getOtherSetting",["$resource",function(e){return e("setting/get_other_setting.json",{},{get:{method:"GET",isArray:!1}})}]),e.factory("getKeyWords",["$resource",function(e){return e("setting/post_select_menu.json",{keyword:"@keyword"},{post:{method:"POST",isArray:!1}})}])}),define("apps/rrdhelp/services/_base",["apps/rrdhelp/services/helpcenter"],function(){}),define("apps/rrdhelp/states/helpcenter",["apps/common/states/states"],function(e){e.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("helpcenter",{url:"/helpcenter/:id",templateUrl:"assets/js/apps/rrdhelp/templates/helpcenter.html",controller:"helpcenter"})}])}),define("apps/rrdhelp/states/_base",["apps/rrdhelp/states/helpcenter"],function(){}),define("apps/rrdhelp/main",["apps/rrdhelp/controllers/_base","apps/rrdhelp/directives/_base","apps/rrdhelp/services/_base","apps/rrdhelp/states/_base"],function(){}),define("apps/flow/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("flow",{url:"/flow",abstract:!0,templateUrl:"assets/js/apps/flow/templates/layout.html"}).state("flow.info",{url:"",templateUrl:"assets/js/apps/flow/templates/main.html",controller:"flow.info",resolve:{flowSetting:["$q","flowSet",function(e,t){var a=e.defer();return t.get(function(e){a.resolve(e)}),a.promise}]}}).state("flow.setting",{url:"/setting",templateUrl:"assets/js/apps/flow/templates/flow.setting.html",controller:"flow.setting"})}])}),define("apps/flow/states/content",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("flow.content",{abstract:!0,url:"/content",template:"<div ui-view></div>"}).state("flow.content.main",{url:"",templateUrl:"assets/js/apps/flow/templates/flow.content.html",controller:"flow.content"})}])}),define("apps/flow/states/content_activity",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("flow.content.activity",{abstract:!0,url:"/activity",template:"<div ui-view></div>"}).state("flow.content.activity.add",{url:"/add",templateUrl:"assets/js/apps/flow/templates/flow.content.activityInfo.html",controller:"flow.content.activity.info"}).state("flow.content.activity.edit",{url:"/edit/:id",templateUrl:"assets/js/apps/flow/templates/flow.content.activityInfo.html",controller:"flow.content.activity.info"})}])}),define("apps/flow/states/content_goods",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("flow.content.goods",{abstract:!0,url:"/goods",template:"<div ui-view></div>"}).state("flow.content.goods.add",{url:"/add",templateUrl:"assets/js/apps/flow/templates/flow.content.goodsInfo.html",controller:"flow.content.goods.info"}).state("flow.content.goods.edit",{url:"/edit/{id:[0-9]{1,4}}",templateUrl:"assets/js/apps/flow/templates/flow.content.goodsInfo.html",controller:"flow.content.goods.info"})}])}),define("apps/flow/states/_base",["apps/flow/states/main","apps/flow/states/content","apps/flow/states/content_activity","apps/flow/states/content_goods"],function(){}),define("apps/flow/controllers/main",["apps/common/controllers/controllers"],function(e){e.controller("flow.info",["$scope","flowSet","flowContent","flowSetting","flowMain","Flash","$http","$location",function(e,t,a,o,s,n,r,i){e.info={isOpen:1==o.is_join_flow_treasure,isChecked:0,status:!1,his_total_amount:0,his_order_cnt:0,his_user_cnt:0},1==o.is_join_flow_treasure&&s.getInfo(function(t){e.info.his_total_amount=t.his_total_amount,e.info.his_order_cnt=t.his_order_cnt,e.info.his_user_cnt=t.his_user_cnt}),e.ranges={"今天":[moment(),moment()],"明天":[moment().add("days",1),moment().add("days",1)],"未来7天":[moment(),moment().add("days",6)],"未来15天":[moment(),moment().add("days",15)],"本月":[moment(),moment().endOf("month")],"昨天":[moment().subtract("days",1),moment().subtract("days",1)]},e.isCheckedClick=function(){0==e.info.isChecked?e.info.isChecked=1:e.info.isChecked=0},e.shopCate={data:""},a.getInfo(function(t){t.data;e.data=t.data,e.shopCate.data=t.shopCate}),e.num=3,e.next=function(){10==e.num?e.num--:e.num++},e.isFlowTypeClick=function(e){0==e.is_selected?e.is_selected=1:e.is_selected=0},e.joinFlow=function(){if(1==e.info.isChecked){for(var a={list:e.shopCate.data,ids:[]},o=0;o<e.shopCate.data.length;o++)1==e.shopCate.data[o].is_selected&&a.ids.push(e.shopCate.data[o].id);if(0==a.ids.length)return n.create("danger","请选择投放类型"),!1;t.revise({exclude_shop_category:a.ids},function(e){1==e.status?(n.create("success","修改成功"),$modalInstance.close(a)):n.create("danger",e.message)}),e.info.status=!0,t.revise({is_join_flow_treasure:1},function(t){t.status?(e.info.status=!1,n.create("success","您以成功加入流量交换计划"),e.info.isOpen=!0,i.path("/flow/content")):(e.info.status=!1,n.create("danger",t.message))},function(t){e.info.status=!1,n.create("danger",res.data.error.message)})}else n.create("danger","请同意流量交换计划服务协议")},e.paginationConf={currentPage:1,itemsPerPage:10},e.searchInfo={time:"",offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage};var c=function(){e.searchInfo.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.searchInfo.limit=e.paginationConf.itemsPerPage,1==o.is_join_flow_treasure&&s.getList(e.searchInfo,function(t){e.paginationConf.totalItems=t._count,e.list=t.data})};e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",c)}])}),define("apps/flow/controllers/setting",["apps/common/controllers/controllers"],function(e){e.controller("flow.setting",["$scope",function(e){}])}),define("apps/flow/controllers/content",["apps/common/controllers/controllers"],function(e){e.controller("flow.content",["$scope","Flash","$modal","flowContent","flowSet",function(e,t,a,o,s){e.info={enabled:!1,status:!1},e.data={},e.shopCate=[];var n=[];o.getInfo(function(t){var a=t.data;e.data=t.data,e.shopCate=t.shopCate;for(var o=0;o<a.recommend.length;o++){var s=a.recommend[o].goods_id;n.push(s)}1==a.setting.is_intelligence_flow_treasure?e.info.enabled=!0:e.info.enabled=!1}),e.intelligent_open=function(){var a=1==e.info.enabled?1:0;e.info.status=!0,s.revise({is_intelligence_flow_treasure:a},function(o){o.status?(e.info.status=!1,t.create("success"," 操作成功！"),e.info.enabled=1==a):(e.info.status=!1,t.create("danger",o.message),e.info.enabled=1!=a)},function(a){e.info.status=!1,t.create("danger",res.data.error.message)})},e.showTyeoModel=function(){var t={list:e.shopCate,select:e.data.setting.exclude_shop_category},o=a.open({animation:!1,templateUrl:"assets/js/apps/flow/templates/flow.content.type.html",controller:"flowTypeModalCtrl",resolve:{data:function(){return t}}});o.result.then(function(t){t&&(e.shopCate=t.list)})},e.showSpecificationtxt=function(){var e={};a.open({animation:!1,templateUrl:"assets/js/apps/flow/templates/flow.content.specificationtxt.html",controller:"flowTypeModalCtrl",resolve:{data:function(){return e}}})},e.deleteItem=function(a,s,n){o.delete({id:a},function(a){a.status?("0"==s?e.data.bottom="":e.data.recommend.splice(n,1),t.create("success",a.message)):t.create("danger",a.message)})},e.showGoodsModal=function(){var t=a.open({animation:!1,templateUrl:"assets/js/apps/flow/templates/flow_goods_modal.html",controller:"flow.modal.goods",resolve:{data:function(){return n}}});t.result.then(function(t){t&&(e.data.recommend.push(t),n.push(t.goods_id))})}}])}),define("apps/flow/controllers/content_activity",["apps/common/controllers/controllers"],function(e){e.controller("flow.content.activity.info",["$scope","Flash","$modal","$stateParams","flowContent","createImg","$location",function(e,t,a,o,s,n,r){e.info={title:"添加",butText:"提交",butStatus:!1,typeInfo:{id:"",name:"",type:""},typeList:[{id:7,name:"首页",type:"index"},{id:1,name:"秒杀",type:"seckill"},{id:2,name:"砍价",type:"bargain"},{id:3,name:"拼团V3",type:"tuan"},{id:4,name:"众筹",type:"collect"},{id:5,name:"竞猜",type:"guess"},{id:6,name:"拍卖",type:"auction"}]},e.fromItem={type:1,activity_type:"",activity_id:"",goods_id:"",picList:"",pic:"",title:"",styles:{font_size:"inherit",font_family:"inherit",color:"inherit",left:0,top:0}},e.editWhite={width:"80px",height:"30px",float:"left",display:"none"},o.id?(e.info.title="编辑",e.info.butText="修改",e.fromItem.id=o.id,s.detail({id:o.id},function(t){e.fromItem.type=t.data.type,e.fromItem.activity_type=t.data.activity_type,e.fromItem.activity_id=t.data.activity_id,e.fromItem.title="",e.fromItem.goods_id=t.data.goods_id,e.fromItem.pic=t.data.pic,e.fromItem.styles=t.data.styles,e.editWhite.display="block",e.showEipt=!0;for(var a=0;a<e.info.typeList.length;a++)e.info.typeList[a].type==t.data.activity_type&&(e.info.typeInfo.id=e.info.typeList[a].id,e.info.typeInfo.name=e.info.typeList[a].name,e.info.typeInfo.type=e.info.typeList[a].type)})):(e.info.title="添加",e.info.butText="提交",e.showAipt=!0),e.myStyle=!0,e.createNum=0,e.createImg=function(){return""==e.fromItem.title&&o.id?(t.create("danger","活动文案不能为空"),!1):(e.createInfo=angular.copy(e.fromItem.styles),e.createInfo.pic=_global.url.ms+e.fromItem.pic,e.createInfo.title=e.fromItem.title,void n.create(e.createInfo,function(a){1==a.status?(e.fromItem.pic=a.pic,e.createNum=1,e.myStyle=!1,t.create("success","已经成功生成图片了！")):(e.createNum=0,t.create("danger","图片生成失败！"))}))},e.typeSelect=function(t){e.info.typeInfo.id=t.id,e.info.typeInfo.name=t.name,e.info.typeInfo.type=t.type,e.fromItem.activity_type=t.type},e.getAdd=function(){if(""!=e.info.typeInfo.id){var o=a.open({animation:!1,templateUrl:"assets/js/apps/flow/templates/flow_activity_modal.html",controller:"flow.modal.activity",resolve:{typeInfo:function(){return e.info.typeInfo}}});o.result.then(function(t){t&&(e.fromItem.activity_id=t.id,e.fromItem.goods_id=t.goods_id,e.fromItem.title=t.title)})}else t.create("danger","请选择活动类型")},e.$watch("picList",function(t,a){void 0!=t&&(e.fromItem.pic=t[t.length-1].url)}),e.showImgList=function(){var t=a.open({animation:!1,templateUrl:"assets/js/apps/flow/templates/flow.img.list.html",controller:"flow.content.activity.imgList"});t.result.then(function(t){t&&(e.fromItem.pic=t.url)})},e.save=function(){return""==e.fromItem.activity_type?(t.create("danger","请选择活动类型"),!1):7!=e.info.typeInfo.id&&""==e.fromItem.goods_id?(t.create("danger","请选择活动"),!1):""==e.fromItem.pic?(t.create("danger","活动图片不能为空"),!1):640!=$(".oldimg img").width()||100!=$(".oldimg img").height()?(t.create("danger","活动图片尺寸必须是：640*100像素"),!1):""==e.fromItem.title?(t.create("danger","活动文案不能为空"),!1):0==e.createNum?(t.create("danger","还未生成图片"),!1):(e.info.butStatus=!0,e.info.butText="提交中",void(o.id?s.edit(e.fromItem,function(a){e.result=!0,a.status?(t.create("success",a.message),r.path("/flow/content")):t.create("danger",a.message),e.info.butStatus=!1,e.info.butText="提交"}):s.add(e.fromItem,function(a){a.status?(t.create("success",a.message),r.path("/flow/content")):t.create("danger",a.message),e.info.butStatus=!1,e.info.butText="提交"})))}}]),e.controller("flow.content.activity.imgList",["$scope","$modalInstance",function(e,t){e.msUrl=_global.url.ms,e.imgList=[{id:1,name:"服饰鞋包",url:"2017/06/13/FkvXnRrl9BIiPosbWTeXmNb58TVa.jpg"},{id:2,name:"钟表首饰",url:"2017/06/13/FmmNRdsRjaKfTtOd2OkwmCFbNa6N.jpg"},{id:3,name:"户外运动",url:"2017/06/13/Fkzk4_Wafv1CjJIY45i8y225oFY9.jpg"},{id:4,name:"食品",url:"2017/06/13/FkAOKMs_c_rx0NSVL0irhCZKIzRO.jpg"},{id:5,name:"母婴儿童",url:"/2017/06/13/FpUSZP6UaYVT24njuemF7NMJcgmo.jpg"},{id:6,name:"护肤彩妆",url:"2017/06/13/FoBAxJxsDH_tJ6V8O49WvIVMg0cH.jpg"},{id:7,name:"日用百货",url:"2017/06/13/FqyjiXmoshL060giqSy_Gx3r3KZp.jpg"},{id:8,name:"数码家电",url:"2017/06/13/FuD4qyrsPEqZJ1NTGEN52O_G_nEM.jpg"},{id:9,name:"家具家装",url:"2017/06/13/Fo3oecOYO0HnOn4wEIm9Sm2Jni3c.jpg"},{id:10,name:"汽车用品",url:"2017/06/13/FpornzyqxgQLLLh0_FrytS6DqEZu.jpg"},{id:11,name:"软件及虚拟产品",url:"2017/06/13/Fk-AmUI3LYwx6PezmllSExwyhody.jpg"},{id:12,name:"图书音像",url:"2017/06/13/FiDC0m12bnUQfh2PTK8gl30SIP1n.jpg"},{id:13,name:"办公用品",url:"2017/06/13/FnQz1TIlT61Q61PgHoGciI3L2Gy9.jpg"},{id:14,name:"综合电商",url:"2017/06/13/FjcaqUtiP2IIWDuS8lMXkAueHuqT.jpg"},{id:15,name:"线上服务",url:"/2017/06/13/FnYcSTCXRR8vDw_zOqQxGJ8YY1SO.jpg"},{id:16,name:"休闲美食",url:"2017/06/13/Fja3iFzprfyKjuP4XdMS_eur_7Cf.jpg"},{id:17,name:"休闲娱乐",url:"/2017/06/13/FmgJYk1-NsU8n6p9HRLG7GW3WUi8.jpg"},{id:18,name:"文化场馆",url:"2017/06/13/FuGz5UxtNOeyXD-Km8EAemQULnwP.jpg"},{id:19,name:"房产小区",url:"2017/06/13/FlpKZQj3nBOCLOIgASQMIPwrD8D5.jpg"},{id:20,name:"医疗保险",url:"2017/06/13/FnUYo0vdjUwrB-WDrp2SWhL94IOz.jpg"},{id:21,name:"教育培训",url:"/2017/06/13/Fv8-4MOD_bbJhJT-_9zsUjx5TzYn.jpg"},{id:22,name:"婚恋交友",url:"2017/06/13/FlHDueWbZ8j8SOeq-_uxc4DpTY-7.jpg"},{id:23,name:"旅游",url:"2017/06/13/Fujs0YeUA9ZPEo_glh1Nnvr-gJvw.jpg"}],e.selectItem=function(e){t.close(e)},e.cancel=function(){t.dismiss("cancel")}}])}),define("apps/flow/controllers/content_goods",["apps/common/controllers/controllers"],function(e){e.controller("flow.content.goods.info",["$scope","Flash","$stateParams","flowContent","$location",function(e,t,a,o,s){e.info={butText:"提交",butStatus:!1},e.fromItem={id:a.id,type:0,goods_id:"",picList:"",pic:"",title:""},o.detail({id:a.id},function(a){a.status?(e.fromItem.title=a.data.title,e.fromItem.goods_id=a.data.goods_id,e.fromItem.pic=a.data.pic):(t.create("danger",a.message),s.path("/flow/content"))}),e.$watch("picList",function(t,a){void 0!=t&&(e.fromItem.pic=t[t.length-1].url)}),e.save=function(n){return n.fromItem_title.$invalid?(n.fromItem_title.$dirty=!0,$("input[name='fromItem_title']").focus(),!1):""==e.fromItem.pic?(t.create("danger","请选择商品图片"),!1):void(a.id&&(e.info.butText="提交中",e.info.butStatus=!0,o.edit(e.fromItem,function(a){a.status?(t.create("success",a.message),s.path("/flow/content")):t.create("danger",a.message),e.info.butText="提交",e.info.butStatus=!1})))}}])}),define("apps/flow/controllers/flow_modal",["apps/common/controllers/controllers"],function(e){e.controller("flow.modal.activity",["$scope","Flash","flowContent","typeInfo","$modalInstance",function(e,t,a,o,s){e._global=_global,e.cancel=function(){s.dismiss("cancel")},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",activity_type:o.type
};var n=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,a.getApp(e.params,function(t){e.paginationConf.totalItems=t.count,e.data=t.data})};e.search=function(){n()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",n),e.choice=function(e){s.close(e)}}]),e.controller("flow.modal.goods",["$scope","Flash","$stateParams","flowContent","tagResource","goodsResource","data","$modalInstance",function(e,t,a,o,s,n,r,i){function c(){s.get({},function(t){e.tags=t.data,e.goodsTags=angular.copy(t.data),e.tags.unshift(e.defaultTag)})}e._global=_global,e.ids=r,e.cancel=function(){i.dismiss("cancel")},e.tag={},e.tag.selected=e.defaultTag={id:0,name:"所有分组"},e.paginationConf={currentPage:1,itemsPerPage:5},e.params={offset:(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,limit:e.paginationConf.itemsPerPage,title:"",sale:1,column:"created_at",direction:"desc"},c();var l=function(){e.params.offset=(e.paginationConf.currentPage-1)*e.paginationConf.itemsPerPage,e.params.limit=e.paginationConf.itemsPerPage,Object.keys(e.tag).length>0&&(e.params.goods_tag_id=e.tag.selected.id),n.get(e.params,function(t){e.paginationConf.totalItems=t._count,e.data=t.data})};e.search=function(){l()},e.$watch("paginationConf.currentPage + paginationConf.itemsPerPage",l),e.sorting={price:"",stock:"",csale:""},e.sortChange=function(t){e.params.column==t?e.params.direction="desc"==e.params.direction?"asc":"desc":(e.params.column=t,e.params.direction="desc"),l()},e.$watch("params.direction + params.column",function(t,a){"undefined"!=typeof t&&angular.forEach(e.sorting,function(t,a){a==e.params.column?e.sorting[a]="sorting-"+("desc"==e.params.direction?"asc":"desc"):e.sorting[a]=""})}),e.selectItem=function(e){var a={type:0,goods_id:e.id,pic:e.img,title:e.title};o.add(a,function(e){e.status?(t.create("success",e.message),i.close(e.data)):t.create("danger",e.message)})}}]),e.controller("flowTypeModalCtrl",["$scope","$state","$modalInstance","data","flowSet","Flash",function(e,t,a,o,s,n){e.list=o.list,e.but={text:"确定",status:!1},e.isFlowTypeClick=function(e){0==e.is_selected?e.is_selected=1:e.is_selected=0},e.save=function(){for(var t={list:e.list,ids:[]},o=0;o<e.list.length;o++)1==e.list[o].is_selected&&t.ids.push(e.list[o].id);return 0==t.ids.length?(n.create("danger","请选择投放类型"),!1):(e.but.text="修改中",e.but.status=!0,void s.revise({exclude_shop_category:t.ids},function(o){1==o.status?(n.create("success","修改成功"),a.close(t)):n.create("danger",o.message),e.but.text="确定",e.but.status=!1}))},e.cancel=function(){a.dismiss("cancel")}}])}),define("apps/flow/controllers/_base",["apps/flow/controllers/main","apps/flow/controllers/setting","apps/flow/controllers/content","apps/flow/controllers/content_activity","apps/flow/controllers/content_goods","apps/flow/controllers/flow_modal"],function(){}),define("apps/flow/directives/_base",[],function(){}),define("apps/flow/services/server",["apps/common/services/services"],function(e){e.factory("flowSet",["$resource",function(e){return e("/flow/setting.json",{},{get:{method:"GET"},revise:{method:"PUT"},feedback:{method:"post",url:"flow/feedback.json"}})}]),e.factory("flowContent",["$resource",function(e){return e("/flow/getAds.json",{id:"@id"},{getInfo:{method:"get",url:"/flow/getAds.json"},delete:{method:"delete",url:"/flow/deleteAd/:id.json"},getApp:{method:"get",url:"/flow/app.json"},add:{method:"post",url:"/flow/postAd.json"},edit:{method:"put",url:"/flow/putAd/:id.json"},detail:{method:"get",url:"/flow/getAd/:id.json"},getGoods:{method:"get",url:"/flow/goods.json"}})}]),e.factory("flowMain",["$resource",function(e){return e("",{},{getInfo:{method:"get",url:"/flow/flowCount.json"},getList:{method:"get",url:"/flow/flowDayCount.json"}})}]),e.factory("createImg",["$resource",function(e){return e("",{},{create:{method:"post",url:"/flow/createImg.json"}})}])}),define("apps/flow/services/_base",["apps/flow/services/server"],function(){}),define("apps/flow/main",["apps/flow/states/_base","apps/flow/controllers/_base","apps/flow/directives/_base","apps/flow/services/_base"],function(){}),define("apps/rrds_poster/controllers/rrdsposter.goodsmateriallibrary.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdsposter.goodsmateriallibrary.ctrl",["$scope","rrdsPosterGoodsMaterialLibraryResource","$stateParams","$modal","Flash",function(e,t,a,o,s){var n=this,r=function(e){o.open({templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.view.modal.html",controller:"rrdsposter.view.modal.ctrl",controllerAs:"vm",windowClass:"rrdsPosterView-modal-window",resolve:{operation:function(){return{url:_global.url.ms+e.img}}}})},i=function(){var e={shop_name:n.query.shop_name||null,title:n.query.title||null,use_max:n.query.use_max?n.query.use_max:0==n.query.use_max?0:null,use_min:n.query.use_min?n.query.use_min:0==n.query.use_min?0:null,enabled:n.query.enabled},t=$('input[name="created_date"]').val();t&&(e.csTime=t.split("/")[0],e.ceTime=t.split("/")[1]);var a=$('input[name="update_date"]').val();return a&&(e.usTime=a.split("/")[0],e.ueTime=a.split("/")[1]),e},c=function(e){var o=i();return a.id&&(o.template_id=a.id),o.page="search"==e?0:n.paginationConf.currentPage,o.pagesize=n.paginationConf.itemsPerPage,t.getGoodsMaterialList(o,function(e){n.data=e.data,n.paginationConf.totalItems=e.count})},l=function(){n.paginationConf={currentPage:1,itemsPerPage:10},n.is_used_types=[{name:"全部",value:null},{name:"已启用",value:1},{name:"未启用",value:0}],n.query={enabled:n.is_used_types[0].value},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",c)};n.viewTemplate=r,n.search=c,l()}])}),define("apps/rrds_poster/controllers/rrdsposter.setting.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdsposter.setting.ctrl",["$scope","$modal","rrdsPosterSettingResource","Flash",function(e,t,a,o){var s=this,n=function(){t.open({animation:!1,templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.setting.modal.html",controller:"rrdsposter.setting.modal.ctrl",controllerAs:"vm",resolve:{operation:function(){return{status:0}}}}).result.then(function(e){c()})},r=function(e){t.open({animation:!1,templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.setting.modal.html",controller:"rrdsposter.setting.modal.ctrl",controllerAs:"vm",resolve:{operation:function(){return{item:e,status:1}}}}).result.then(function(e){c()})},i=function(e){return a.deleteTag({id:e},function(e){0==e.code?(o.create("success",e.msg||"删除成功"),c()):o.create("danger",e.msg||"删除失败")})},c=function(){var e={offset:(s.paginationConf.currentPage-1)*s.paginationConf.itemsPerPage,limit:s.paginationConf.itemsPerPage};return a.getTags(e,function(e){s.data=e.data,s.paginationConf.totalItems=e.count})},l=function(){s.paginationConf={currentPage:1,itemsPerPage:10},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",c)};s.add=n,s.edit=r,s.remove=i,l()}])}),define("apps/rrds_poster/controllers/rrdsposter.setting.modal.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdsposter.setting.modal.ctrl",["$scope","operation","$modalInstance","rrdsPosterSettingResource","Flash",function(e,t,a,o,s){var n=this,r=function(){return n.modal.btnDisabled=!0,n.modal.btnText=n.modal.btnText+"中...",t.status?o.updateTag({id:n.data.id,name:n.data.name},function(e){0==e.code?(s.create("success",e.msg||"修改成功"),a.close()):(s.create("danger",e.msg||"修改失败"),n.modal.btnDisabled=!1,n.modal.btnText=t.status?"修改":"保存")}):o.saveTag({name:n.data.name},function(e){0==e.code?(s.create("success",e.msg||"保存成功"),a.close()):(s.create("danger",e.msg||"保存失败"),n.modal.btnDisabled=!1,n.modal.btnText=t.status?"修改":"保存")})},i=function(){t.status?(n.modal={title:"编辑",btnText:"修改",btnDisabled:!1},t.item&&(n.data=t.item)):(n.modal={title:"添加",btnText:"保存",btnDisabled:!1},n.data={})};n.submit=r,i()}])}),define("apps/rrds_poster/controllers/rrdsposter.templatelibrary.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdsposter.templatelibrary.ctrl",["$scope","rrdsPosterTemplateLibraryResource","Flash",function(e,t,a){var o=this,s=function(e){return t.deleteTemplate({id:e},function(e){0==e.code?(a.create("success",e.msg||"删除成功"),c()):a.create("danger",e.msg||"删除失败")})},n=function(e){return t.shelveTemplate({id:e.id,status:e.status?0:1},function(t){0==t.code?(a.create("success",t.msg||(e.status?"下架":"上架")+"成功"),c()):a.create("danger",t.msg||(e.status?"下架":"上架")+"失败")})},r=function(e){return t.stickTemplate({id:e.id,top_status:e.top?0:1},function(t){0==t.code?(a.create("success",t.msg||(e.top?"取消置顶成功":"置顶成功")),c()):a.create("danger",t.msg||(e.top?"取消置顶失败":"置顶失败"))})},i=function(){var e={title:o.query.title||null,status:o.query.status},t=$('input[name="created_date"]').val();return t&&(e.sTime=t.split("/")[0],e.eTime=t.split("/")[1]),e},c=function(e){var a=i();return a.page="search"==e?1:o.paginationConf.currentPage,a.pagesize=o.paginationConf.itemsPerPage,t.getTemplateList(a,function(e){o.data=e.data,o.paginationConf.totalItems=e.count})},l=function(){o.statuses=[{name:"全部",value:null},{name:"上架",value:1},{name:"下架",value:0}],o.paginationConf={currentPage:1,itemsPerPage:10},o.query={status:angular.copy(o.statuses[0].value)},e.$watch("vm.paginationConf.currentPage + vm.paginationConf.itemsPerPage",c)};o.remove=s,o.unShelve=n,o.stick=r,o.search=c,l()}])}),define("apps/rrds_poster/controllers/rrdsposter.manage.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdsposter.manage.ctrl",["$scope","Flash","rrdsPosterManageResource","$stateParams","$state",function(e,t,a,o,s){var n=this,r=function(){return a.getFontFamilies(function(e){n.fontFamilies=e,o.id||(n.data.word_a_data.type=angular.copy(n.fontFamilies[0].type),n.data.word_b_data.type=angular.copy(n.fontFamilies[0].type))})},i=function(e){switch(e){case"fg_img":n.data.fg_data.left=1*angular.element(document).find("#fg_img_show").css("left").split("px")[0],n.data.fg_data.top=1*angular.element(document).find("#fg_img_show").css("top").split("px")[0];break;case"gh_img":n.data.gh_data.left=1*angular.element(document).find("#gh_img_show").css("left").split("px")[0],n.data.gh_data.top=1*angular.element(document).find("#gh_img_show").css("top").split("px")[0];break;case"word_a":n.data.word_a_data.left=1*angular.element(document).find("#word_a_default_show").css("left").split("px")[0],n.data.word_a_data.top=1*angular.element(document).find("#word_a_default_show").css("top").split("px")[0];break;case"word_b":n.data.word_b_data.left=1*angular.element(document).find("#word_b_default_show").css("left").split("px")[0],n.data.word_b_data.top=1*angular.element(document).find("#word_b_default_show").css("top").split("px")[0];break;case"qrcode_data":n.data.qrcode_data.left=1*angular.element(document).find("#qrcode_data_show").css("left").split("px")[0],n.data.qrcode_data.top=1*angular.element(document).find("#qrcode_data_show").css("top").split("px")[0]}},c=function(e){i(e)},l=function(e){i(e)},d=function(e){i(e)},p=function(){return a.getTags(function(e){0==e.code&&(n.tags=e.data,o.id||(n.data.tag_id=n.tags[0].id))})},u=function(e){return a.getTemplateDetail({id:e},function(e){0==e.code&&(n.data=e.data,r(),p())})},m=function(){var e=angular.copy(n.data);return 1==e.is_show_fg_img&&(e.fg_data.left=angular.copy(Math.round(1*angular.element(document).find("#fg_img_show").css("left").split("px")[0])),e.fg_data.top=angular.copy(Math.round(1*angular.element(document).find("#fg_img_show").css("top").split("px")[0])),e.fg_data.wide=angular.copy(Math.round(1*e.fg_data.wide)),e.fg_data.height=angular.copy(Math.round(1*e.fg_data.height))),e.qrcode_data.left=angular.copy(Math.round(1*angular.element(document).find("#qrcode_data_show").css("left").split("px")[0])),e.qrcode_data.top=angular.copy(Math.round(1*angular.element(document).find("#qrcode_data_show").css("top").split("px")[0])),e.qrcode_data.wide=angular.copy(Math.round(1*e.qrcode_data.wide)),e.qrcode_data.height=angular.copy(Math.round(1*e.qrcode_data.height)),1==e.is_show_gh_img&&(e.gh_data.left=angular.copy(Math.round(1*angular.element(document).find("#gh_img_show").css("left").split("px")[0])),e.gh_data.top=angular.copy(Math.round(1*angular.element(document).find("#gh_img_show").css("top").split("px")[0])),e.gh_data.wide=angular.copy(Math.round(1*e.gh_data.wide)),e.gh_data.height=angular.copy(Math.round(1*e.gh_data.height))),1==e.is_show_word_a&&(e.word_a_data.left=angular.copy(Math.round(1*angular.element(document).find("#word_a_default_show").css("left").split("px")[0])),e.word_a_data.top=angular.copy(Math.round(1*angular.element(document).find("#word_a_default_show").css("top").split("px")[0])),e.word_a_data.size=angular.copy(Math.round(1*e.word_a_data.size))),1==e.is_show_word_b&&(e.word_b_data.left=angular.copy(Math.round(1*angular.element(document).find("#word_b_default_show").css("left").split("px")[0])),e.word_b_data.top=angular.copy(Math.round(1*angular.element(document).find("#word_b_default_show").css("top").split("px")[0])),e.word_b_data.size=angular.copy(Math.round(1*e.word_b_data.size))),e},g=function(){var e=m();return o.id?(n.savebtn.disabled=!0,n.savebtn.value="修改中...",a.update(e,function(e){0==e.code?t.create("success",e.msg||"修改成功"):t.create("danger",e.msg||"修改失败"),f()})):(n.savebtn.disabled=!0,n.savebtn.value="保存中...",a.add(e,function(e){0==e.code?(t.create("success",e.msg||"创建成功"),s.go("rrdsposter.sub.template_library")):(t.create("danger",e.msg||"创建失败"),f())}))},f=function(){o.id?n.savebtn={disabled:!1,value:"修改"}:n.savebtn={disabled:!1,value:"保存"}},h=function(){f(),n.starLevels=[{type:0,name:"无评级"},{type:1,name:"一星级"},{type:2,name:"二星级"},{type:3,name:"三星级"},{type:4,name:"四星级"},{type:5,name:"五星级"},{type:6,name:"六星级"}],n.statuses=[{type:1,name:"是"},{type:0,name:"否"}],n.fontSizes=[12,13,14,15,16,17,18,19,20,21,22,24,26,28,30],o.id?u(o.id):(p(),n.data={is_show_gh_img:1,status:0,is_show_fg_img:1,is_show_word_a:1,is_show_word_b:1,word_a_default:"文字一",word_b_default:"文字二",bg_img:"spread/temp76144-1497418044.jpg",fg_img:"spread/temp13236-1497436652.jpg",gh_img:"spread/temp64078-1497418581.jpg",fg_data:{wide:100,height:100,top:380,left:20},gh_data:{wide:100,height:100,top:50,left:20},qrcode_data:{wide:100,height:100,top:380,left:160},word_b_data:{size:14,color:"#ff0000",top:320,left:160},word_a_data:{size:14,color:"#ff0000",top:320,left:20},merchant_level:3},r())};n.radioChanged=i,n.submit=g,n.paramsChange=c,n.imgClick=l,n.textClick=d,h()}])}),define("apps/rrds_poster/controllers/rrdsposter.view.modal.ctrl",["apps/common/controllers/controllers"],function(e){e.controller("rrdsposter.view.modal.ctrl",["$scope","Flash","operation",function(e,t,a){var o=this,s=function(){a.url&&(o.url=a.url)};s()}])}),define("apps/rrds_poster/controllers/_base",["apps/rrds_poster/controllers/rrdsposter.goodsmateriallibrary.ctrl","apps/rrds_poster/controllers/rrdsposter.setting.ctrl","apps/rrds_poster/controllers/rrdsposter.setting.modal.ctrl","apps/rrds_poster/controllers/rrdsposter.templatelibrary.ctrl","apps/rrds_poster/controllers/rrdsposter.manage.ctrl","apps/rrds_poster/controllers/rrdsposter.view.modal.ctrl"],function(){}),define("apps/rrds_poster/directives/_base",[],function(){}),define("apps/rrds_poster/services/rrdsposter.templatelibrary.service",["apps/common/services/services"],function(e){e.factory("rrdsPosterTemplateLibraryResource",["$resource",function(e){return e("/template/templates.json",{id:"@id"},{getTemplateList:{method:"GET",isArray:!1},deleteTemplate:{method:"POST",url:"/template/del/:id.json"},shelveTemplate:{method:"POST",url:"/template/up_down/:id.json"},stickTemplate:{method:"POST",url:"/template/on_show/:id.json"}})}])}),define("apps/rrds_poster/services/rrdsposter.goodsmateriallibrary.service",["apps/common/services/services"],function(e){e.factory("rrdsPosterGoodsMaterialLibraryResource",["$resource",function(e){return e("/template/merchant_templates.json",{id:"@id"},{getGoodsMaterialList:{method:"GET",isArray:!1},getDetail:{method:"GET",isArray:!1,url:"/unlimitedarticle/article/:id.json"}})}])}),define("apps/rrds_poster/services/rrdsposter.setting.service",["apps/common/services/services"],function(e){e.factory("rrdsPosterSettingResource",["$resource",function(e){return e("template/tags.json",{id:"@id"},{getTags:{method:"GET",isArray:!1},deleteTag:{method:"POST",isArray:!1,url:"/template/tags_del/:id.json"},saveTag:{method:"POST",url:"/template/tags.json"},updateTag:{method:"PUT",url:"/template/tags/:id.json"}})}])}),define("apps/rrds_poster/services/rrdsposter.manage.service",["apps/common/services/services"],function(e){e.factory("rrdsPosterManageResource",["$resource",function(e){return e("",{id:"@id"},{add:{method:"POST",url:"/template/template.json"},update:{method:"PUT",url:"template/template/:id.json"},getTemplateDetail:{method:"GET",url:"/template/template/:id.json",isArray:!1},getFontFamilies:{method:"GET",url:"/font.json",isArray:!0},getTags:{method:"GET",url:"template/tpl_tags.json",isArray:!1}})}])}),define("apps/rrds_poster/services/_base",["apps/rrds_poster/services/rrdsposter.templatelibrary.service","apps/rrds_poster/services/rrdsposter.goodsmateriallibrary.service","apps/rrds_poster/services/rrdsposter.setting.service","apps/rrds_poster/services/rrdsposter.manage.service"],function(){}),define("apps/rrds_poster/states/main",["apps/common/states/states"],function(e){e.config(["$stateProvider",function(e){e.state("rrdsposter",{abstract:!0,url:"/rrdsposter",templateUrl:"assets/js/apps/rrds_poster/templates/main.html"}).state("rrdsposter.sub",{abstract:!0,url:"/sub",template:"<div ui-view></div>"}).state("rrdsposter.sub.template_library",{url:"/template_library",templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.templatelibrary.html",controller:"rrdsposter.templatelibrary.ctrl",controllerAs:"vm"}).state("rrdsposter.sub.add",{url:"/add",templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.manage.html",controller:"rrdsposter.manage.ctrl",controllerAs:"vm"}).state("rrdsposter.sub.edit",{url:"/edit?id",templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.manage.html",controller:"rrdsposter.manage.ctrl",controllerAs:"vm"}).state("rrdsposter.goods_material_library",{url:"/goods_material_library?id",templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.goodsmateriallibrary.html",controller:"rrdsposter.goodsmateriallibrary.ctrl",controllerAs:"vm"}).state("rrdsposter.setting",{url:"/setting",templateUrl:"assets/js/apps/rrds_poster/templates/rrdsposter.setting.html",controller:"rrdsposter.setting.ctrl",controllerAs:"vm"})}])}),define("apps/rrds_poster/states/_base",["apps/rrds_poster/states/main"],function(){}),define("apps/rrds_poster/main",["apps/rrds_poster/controllers/_base","apps/rrds_poster/directives/_base","apps/rrds_poster/services/_base","apps/rrds_poster/states/_base"],function(){}),define("bootstrap",["angular","app","apps/demo/main","apps/common/directives/_base","apps/common/filters/_base","apps/common/services/_base","apps/auth/main","apps/shop/main","apps/goods/main","apps/design/main","apps/order/main","apps/delivery/main","apps/ump/main","apps/apps/main","apps/guider/main","apps/member/main","apps/credit/main","apps/trade/main","apps/weixin/main","apps/stat/main","apps/merchant/main","apps/profile/main","apps/partner/main","apps/announce/main","apps/mall/main","apps/mall_design/main","apps/mall_shop/main","apps/mall_goods/main","apps/supplier/main","apps/distributor/main","apps/team/main","apps/virtualgoods/main","apps/app/main","apps/magic/main","apps/trip/main","apps/ticket/main","apps/hotel/main","apps/game/main","apps/certification/main","apps/integral/main","apps/welfare/main","apps/rrds_promotion/main","apps/rrdhelp/main","apps/flow/main","apps/rrds_poster/main","apps/rrdhelp/main"],function(e){e.element(document).ready(function(){e.bootstrap(document,["mch"])})});